# API通用规范文档

## 基本原则

1. **简单优先**：字段设计尽量简单直接，避免过度设计
2. **兼容性**：新API要兼容现有网页前端，通过版本号区分
3. **统一格式**：所有API采用统一的请求响应格式

## 请求规范

### 基础URL
```
开发环境: http://localhost:3001/api/v2
生产环境: https://api.yourdomain.com/api/v2
```

### 请求头
```json
{
  "Content-Type": "application/json",
  "X-Platform": "miniprogram",  // 标识请求来源
  "X-Version": "1.0.0"          // 客户端版本
}
```

## 响应规范

### 成功响应
```json
{
  "code": 0,
  "message": "success",
  "data": {
    // 具体数据
  }
}
```

### 错误响应
```json
{
  "code": 1001,  // 错误码
  "message": "错误描述",
  "data": null
}
```

### 分页响应
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [],      // 数据列表
    "total": 100,    // 总数
    "page": 1,       // 当前页
    "pageSize": 10   // 每页数量
  }
}
```

## 错误码规范

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 1001 | 参数错误 |
| 1002 | 数据不存在 |
| 1003 | 操作失败 |
| 2001 | 未登录 |
| 2002 | 无权限 |
| 3001 | 服务器错误 |

## 数据类型规范

1. **ID统一使用字符串**：虽然数据库是INTEGER，但API返回统一转为string
2. **时间格式**：统一使用 ISO 8601 格式（YYYY-MM-DDTHH:mm:ss.sssZ）
3. **金额**：统一使用分为单位的整数，避免浮点数精度问题
4. **状态值**：使用有意义的字符串，不用数字

## 版本管理

- v1: 现有网页前端使用（保持不变）
- v2: 小程序使用（新标准）

通过URL路径区分版本：
- `/api/v1/...` - 旧版本
- `/api/v2/...` - 新版本

## 安全要求

1. 所有API必须使用HTTPS（生产环境）
2. 敏感操作需要登录验证
3. 防止SQL注入，所有参数必须验证
4. 限流保护：每个IP每分钟最多60次请求

## 性能要求

1. 列表接口必须支持分页
2. 响应时间不超过2秒
3. 大数据量接口需要添加缓存