"use strict";var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,i=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&o(e,r,t[r]);if(a)for(var r of a(t))s.call(t,r)&&o(e,r,t[r]);return e},c=(e,a)=>t(e,r(a)),l=(e,t,r)=>new Promise((a,n)=>{var s=e=>{try{i(r.next(e))}catch(t){n(t)}},o=e=>{try{i(r.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,o);i((r=r.apply(e,t)).next())});const d=require("./taro.js"),u={baseURL:"http://emagen.323424.xyz/api/v2",timeout:1e4,retry:3};function p(e){return l(this,arguments,function*(e,t={}){const{method:r="GET",data:a,header:n={},showLoading:s=!1,loadingTitle:o="\u52a0\u8f7d\u4e2d..."}=t;s&&d.Taro.showLoading({title:o,mask:!0});try{const t=yield d.Taro.request({url:`${u.baseURL}${e}`,method:r,data:a,header:i({"Content-Type":"application/json"},n),timeout:u.timeout});s&&d.Taro.hideLoading();const o=t.data;if(0!==o.code){console.error(`API\u4e1a\u52a1\u9519\u8bef: ${e}`,o);const r=new Error(o.message||"\u8bf7\u6c42\u5931\u8d25");throw r.response={status:t.statusCode,data:o},r}return o}catch(c){throw s&&d.Taro.hideLoading(),console.error(`API\u7f51\u7edc\u9519\u8bef: ${e}`,c),c}})}const h=(e,t,r)=>{const a=t?"?"+Object.keys(t).filter(e=>void 0!==t[e]&&null!==t[e]).map(e=>`${e}=${encodeURIComponent(t[e])}`).join("&"):"";return p(e+a,c(i({},r),{method:"GET"}))},m=(e,t,r)=>p(e,c(i({},r),{method:"POST",data:t})),g=[{id:"member-card",type:"member",name:"\u4f1a\u5458\u793c\u5361",image:"/assets/images/gift/card/member-card.png",description:"\u5c0a\u4eab\u4f1a\u5458\u4e13\u5c5e\u4f18\u60e0",features:["\u5168\u95e8\u5e97\u901a\u7528","\u957f\u671f\u6709\u6548","\u53ef\u7d2f\u8ba1\u79ef\u5206","\u4eab\u53d7\u4f1a\u5458\u4ef7"],terms:"\u672c\u5361\u4e3a\u4e0d\u8bb0\u540d\u5361\u7247\uff0c\u8bf7\u59a5\u5584\u4fdd\u7ba1"},{id:"electronic-card",type:"electronic",name:"\u7535\u5b50\u793c\u5361",image:"/assets/images/gift/card/gift-card.png",description:"\u4fbf\u6377\u7684\u7535\u5b50\u793c\u54c1\u5361",features:["\u5373\u4e70\u5373\u7528","\u53ef\u8f6c\u8d60\u597d\u53cb","\u7ebf\u4e0a\u8d2d\u4e70","\u626b\u7801\u4f7f\u7528"],terms:"\u7535\u5b50\u5361\u6709\u6548\u671f\u4e3a\u8d2d\u4e70\u4e4b\u65e5\u8d77\u4e00\u5e74\u5185"}],x=[{id:"pillow",name:"\u62a4\u9888\u52a9\u7720\u5c0f\u6795",image:"/assets/images/gift/product/neck-pillow.png",price:299,originalPrice:399,unit:"\u4e2a",description:"\u4eba\u4f53\u5de5\u5b66\u8bbe\u8ba1\uff0c\u7f13\u89e3\u9888\u90e8\u538b\u529b",features:["\u8bb0\u5fc6\u68c9\u6750\u8d28","\u4eba\u4f53\u5de5\u5b66\u8bbe\u8ba1","\u53ef\u62c6\u6d17\u6795\u5957","\u900f\u6c14\u6392\u6c57"],specifications:{"\u6750\u8d28":"\u8bb0\u5fc6\u68c9+\u5929\u9e45\u7ed2","\u5c3a\u5bf8":"50cm x 30cm x 10cm","\u91cd\u91cf":"1.2kg","\u989c\u8272":"\u7070\u8272/\u7c73\u8272"}},{id:"therapy",name:"\u836f\u98df\u540c\u6e90\u7406\u7597\u5305",image:"/assets/images/gift/product/health-food.png",price:199,originalPrice:299,unit:"\u5957",description:"\u4f20\u7edf\u4e2d\u836f\u914d\u65b9\uff0c\u795b\u5bd2\u9664\u6e7f",features:["\u7eaf\u4e2d\u836f\u914d\u65b9","\u70ed\u6577\u7406\u7597","\u53ef\u91cd\u590d\u4f7f\u7528","\u4fbf\u643a\u8bbe\u8ba1"],specifications:{"\u6210\u5206":"\u827e\u8349\u3001\u751f\u59dc\u3001\u5f53\u5f52\u7b49","\u89c4\u683c":"\u5355\u5305200g\uff0c\u4e00\u59573\u5305","\u4f7f\u7528\u65b9\u6cd5":"\u5fae\u6ce2\u52a0\u70ed2-3\u5206\u949f","\u6709\u6548\u671f":"\u751f\u4ea7\u65e5\u671f\u8d7724\u4e2a\u6708"}}],y=()=>1;class f{static getAllGiftCards(){return g}static getGiftCardById(e){return g.find(t=>t.id===e)}static getAllProducts(){return x}static getProductById(e){return x.find(t=>t.id===e)}static createGiftCardOrder(e){return l(this,null,function*(){try{const t={orderType:"product",userId:y(),title:`\u7535\u5b50\u793c\u5361 \xa5${(e.amount/100).toFixed(0)}`,amount:e.amount*e.quantity,paymentMethod:e.paymentMethod,extraData:{productType:"gift_card",cardType:"electronic",faceValue:e.amount,quantity:e.quantity,customMessage:e.customMessage||"\u4e16\u754c\u4e0a\u6700\u597d\u7684\u7238\u7238"}},r=yield m("/orders/create",t,{showLoading:!0,loadingTitle:"\u521b\u5efa\u8ba2\u5355\u4e2d..."});return r.data}catch(t){throw console.error("\u521b\u5efa\u793c\u5361\u8ba2\u5355\u5931\u8d25:",t),new Error(t.message||"\u521b\u5efa\u793c\u5361\u8ba2\u5355\u5931\u8d25")}})}static createProductOrder(e){return l(this,null,function*(){try{const t=this.getProductById(e.productId);if(!t)throw new Error("\u5546\u54c1\u4e0d\u5b58\u5728");const r={orderType:"product",userId:y(),title:t.name,amount:100*t.price*e.quantity,paymentMethod:e.paymentMethod,extraData:{productType:"merchandise",productId:e.productId,quantity:e.quantity,specifications:t.specifications}},a=yield m("/orders/create",r,{showLoading:!0,loadingTitle:"\u521b\u5efa\u8ba2\u5355\u4e2d..."});return a.data}catch(t){throw console.error("\u521b\u5efa\u5546\u54c1\u8ba2\u5355\u5931\u8d25:",t),new Error(t.message||"\u521b\u5efa\u5546\u54c1\u8ba2\u5355\u5931\u8d25")}})}static payOrder(e){return l(this,null,function*(){try{const t=yield m("/orders/pay",e,{showLoading:!0,loadingTitle:"\u652f\u4ed8\u4e2d..."});return t.data}catch(t){throw console.error("\u652f\u4ed8\u8ba2\u5355\u5931\u8d25:",t),new Error(t.message||"\u652f\u4ed8\u5931\u8d25")}})}static handleWechatPay(e){return l(this,null,function*(){return new Promise((t,r)=>{d.Taro.requestPayment({timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:()=>{t()},fail:e=>{r(new Error(e.errMsg||"\u652f\u4ed8\u5931\u8d25"))}})})})}}const w=()=>{try{const e=d.Taro.getStorageSync("userInfo");return e||null}catch(e){return console.error("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25:",e),null}},S=()=>{const e=w();return(null==e?void 0:e.id)||1},v=()=>{const e=w();return(null==e?void 0:e.phone)||"13800138000"},I=e=>{try{d.Taro.setStorageSync("userInfo",e)}catch(t){console.error("\u8bbe\u7f6e\u7528\u6237\u4fe1\u606f\u5931\u8d25:",t)}},j=e=>e?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"\u672a\u8bbe\u7f6e",T=()=>l(exports,null,function*(){try{const{code:e}=yield d.Taro.login(),t=yield m("/users/wechat-login",{code:e});if(t.data)return t.data.userInfo&&!t.data.needBindPhone&&I(t.data.userInfo),t.data;throw new Error("\u5fae\u4fe1\u767b\u5f55\u5931\u8d25\uff1a\u8fd4\u56de\u6570\u636e\u5f02\u5e38")}catch(e){throw console.error("\u5fae\u4fe1\u767b\u5f55\u5931\u8d25:",e),e}}),N=e=>l(exports,null,function*(){try{if(!e){const t=w();e=null==t?void 0:t.phone}if(!e)return console.warn("\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff1a\u7f3a\u5c11\u624b\u673a\u53f7"),null;const t=yield h(`/users/info?phone=${e}`);if(t.data){const e={id:t.data.id,phone:t.data.phone,username:t.data.username,nickname:t.data.nickname,avatar:t.data.avatar,openid:t.data.openid,membershipNumber:t.data.membershipNumber,memberLevel:t.data.memberLevel,balance:t.data.balance,totalSpent:t.data.totalSpent,totalVisits:t.data.totalVisits,discountRate:t.data.discount_rate||t.data.discountRate};return I(e),e}return null}catch(t){return console.error("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25:",t),null}}),b=()=>l(exports,null,function*(){try{const e=w();if(e&&e.phone){const t=yield N(e.phone);return t||e}const t=yield T();return!t.needBindPhone&&t.userInfo?t.userInfo:null}catch(e){return console.error("\u81ea\u52a8\u767b\u5f55\u5931\u8d25:",e),null}});class E{getUserInfo(){return{userId:S(),userPhone:v()}}getDisplayStatus(e){if("pending"===e.paymentStatus)return"pending";if("cancelled"===e.paymentStatus||"refunded"===e.paymentStatus)return e.paymentStatus;if("paid"===e.paymentStatus&&"service"===e.orderType){if(e.appointmentStatus)switch(e.appointmentStatus){case"completed":return"completed";case"serving":return"serving";case"cancelled":return"cancelled";case"pending":case"confirmed":default:return"paid"}if(e.appointmentDate&&e.appointmentTime){const t=new Date(`${e.appointmentDate} ${e.appointmentTime}`),r=new Date(t.getTime()+6e4*(e.duration||60)),a=new Date;if(r<a)return"paid"}}return e.paymentStatus}enrichOrderWithStoreAndTherapistInfo(e){return l(this,null,function*(){try{const t=[];e.storeId&&!e.storeName&&t.push(h(`/stores/${e.storeId}`).then(t=>{const r=t.data;e.storeName=r.name,e.storeAddress=r.address}).catch(t=>l(this,null,function*(){console.error(`\u83b7\u53d6\u95e8\u5e97\u4fe1\u606f\u5931\u8d25 (storeId: ${e.storeId}):`,t);const r=yield this.getDefaultStoreInfo();r?(e.storeName=`${r.name}\uff08\u66ff\u4ee3\u663e\u793a\uff09`,e.storeAddress=r.address):(e.storeName="\u95e8\u5e97\u4fe1\u606f\u6682\u65f6\u65e0\u6cd5\u83b7\u53d6",e.storeAddress="\u8bf7\u8054\u7cfb\u5ba2\u670d\u83b7\u53d6\u8be6\u60c5")}))),e.therapistId&&!e.therapistAvatar&&t.push(h(`/therapists/${e.therapistId}`).then(t=>{const r=t.data;e.therapistAvatar=r.avatar,e.therapistName||(e.therapistName=r.name)}).catch(t=>{console.error(`\u83b7\u53d6\u6280\u5e08\u4fe1\u606f\u5931\u8d25 (therapistId: ${e.therapistId}):`,t),e.therapistAvatar||(e.therapistAvatar="https://img.yzcdn.cn/vant/cat.jpeg")})),t.length>0&&(yield Promise.allSettled(t))}catch(t){console.error("\u8865\u5168\u8ba2\u5355\u4fe1\u606f\u5931\u8d25:",t)}})}getDefaultStoreInfo(){return l(this,null,function*(){var e,t;try{const r=yield h("/stores/nearby",{page:1,pageSize:1});if(null==(t=null==(e=r.data)?void 0:e.list)?void 0:t[0]){const e=r.data.list[0];return{name:e.name,address:e.address}}}catch(r){console.error("\u83b7\u53d6\u9ed8\u8ba4\u95e8\u5e97\u4fe1\u606f\u5931\u8d25:",r)}return null})}enrichOrderListWithStoreAndTherapistInfo(e){return l(this,null,function*(){try{const t=new Set,r=new Set;e.forEach(e=>{e.storeId&&!e.storeName&&t.add(e.storeId.toString()),e.therapistId&&!e.therapistAvatar&&r.add(e.therapistId.toString())});const a=[],n=new Map,s=new Map,o=new Set;Array.from(t).forEach(e=>{a.push(h(`/stores/${e}`).then(t=>{n.set(e,t.data)}).catch(t=>{console.warn(`\u95e8\u5e97\u4e0d\u5b58\u5728\uff0c\u5c06\u8fc7\u6ee4\u76f8\u5173\u8ba2\u5355 (storeId: ${e}):`,t.message),o.add(e)}))}),Array.from(r).forEach(e=>{a.push(h(`/therapists/${e}`).then(t=>{s.set(e,t.data)}).catch(t=>{console.error(`\u6279\u91cf\u83b7\u53d6\u6280\u5e08\u4fe1\u606f\u5931\u8d25 (therapistId: ${e}):`,t)}))}),a.length>0&&(yield Promise.allSettled(a));const i=e.filter(e=>!e.storeId||!o.has(e.storeId.toString())||(console.warn(`\u8fc7\u6ee4\u65e0\u6548\u8ba2\u5355: ${e.orderNo}\uff08\u95e8\u5e97 ${e.storeId} \u4e0d\u5b58\u5728\uff09`),!1));return i.forEach(e=>{if(e.storeId&&!e.storeName){const t=n.get(e.storeId.toString());t&&(e.storeName=t.name,e.storeAddress=t.address)}if(e.therapistId&&!e.therapistAvatar){const t=s.get(e.therapistId.toString());t?(e.therapistAvatar=t.avatar,e.therapistName||(e.therapistName=t.name)):e.therapistAvatar="https://img.yzcdn.cn/vant/cat.jpeg"}}),i}catch(t){return console.error("\u6279\u91cf\u8865\u5168\u8ba2\u5355\u5217\u8868\u4fe1\u606f\u5931\u8d25:",t),e}})}createAppointmentOrder(e){return l(this,null,function*(){try{const{userId:t,userPhone:r}=this.getUserInfo();console.log("\ud83d\udcdd \u521b\u5efa\u8ba2\u5355\u539f\u59cb\u53c2\u6570:",e),console.log("\ud83d\udcdd therapistId\u7c7b\u578b:",typeof e.therapistId,"\u503c:",e.therapistId);const a={therapistId:Number(e.therapistId),storeId:Number(e.storeId),userId:t,userPhone:r,appointmentDate:e.appointmentDate,startTime:e.appointmentTime,duration:e.duration||60,serviceId:e.serviceId,serviceName:e.serviceName,price:e.discountPrice||e.price};console.log("\ud83d\udce4 \u5b9e\u9645\u53d1\u9001\u7684\u8bf7\u6c42\u6570\u636e:",a),console.log("\ud83d\udce4 \u8f6c\u6362\u540e\u7684therapistId:",a.therapistId,"\u662f\u5426\u4e3aNaN:",isNaN(a.therapistId));const n=yield m("/appointments/create-with-order",a,{showLoading:!0,loadingTitle:"\u521b\u5efa\u8ba2\u5355\u4e2d..."}),s=c(i({},n.data.order),{therapistName:e.therapistName,therapistAvatar:e.therapistAvatar,serviceName:e.serviceName,duration:e.duration,appointmentDate:e.appointmentDate,appointmentTime:e.appointmentTime,totalAmount:e.discountPrice||e.price});return{order:s,appointment:n.data.appointment}}catch(t){throw console.error("\u521b\u5efa\u8ba2\u5355\u5931\u8d25:",t),new Error(t.message||"\u521b\u5efa\u8ba2\u5355\u5931\u8d25")}})}getPaymentParams(e){return l(this,null,function*(){try{const t=yield m("/orders/pay",{orderNo:e,paymentMethod:"wechat"});return t.data.wxPayParams?t.data.wxPayParams:{timeStamp:String(Math.floor(Date.now()/1e3)),nonceStr:Math.random().toString(36).substr(2,15),package:`prepay_id=${Math.random().toString(36).substr(2,15)}`,signType:"MD5",paySign:Math.random().toString(36).substr(2,32)}}catch(t){throw console.error("\u83b7\u53d6\u652f\u4ed8\u53c2\u6570\u5931\u8d25:",t),new Error("\u83b7\u53d6\u652f\u4ed8\u53c2\u6570\u5931\u8d25")}})}updateOrderStatus(e,t){return l(this,null,function*(){try{const t=yield m("/orders/pay",{orderNo:e,paymentMethod:"balance"});return{orderNo:e,paymentStatus:"paid",paidAt:t.data.paidAt||(new Date).toISOString()}}catch(t){throw console.error("\u66f4\u65b0\u8ba2\u5355\u72b6\u6001\u5931\u8d25:",t),new Error(t.message||"\u652f\u4ed8\u5931\u8d25")}})}getOrderDetail(e){return l(this,null,function*(){try{const t=yield h(`/orders/${e}`),r=t.data;return r.amount&&(r.totalAmount=r.amount/100),r.extraData&&(r.therapistId=r.extraData.therapistId,r.therapistName=r.extraData.therapistName,r.storeId=r.extraData.storeId,r.appointmentDate=r.extraData.appointmentDate,r.appointmentTime=r.extraData.startTime,r.duration=r.extraData.duration,r.serviceName=r.extraData.serviceName||r.title,r.appointmentStatus=r.extraData.appointmentStatus,yield this.enrichOrderWithStoreAndTherapistInfo(r)),r.displayStatus=this.getDisplayStatus(r),r}catch(t){throw console.error("\u83b7\u53d6\u8ba2\u5355\u8be6\u60c5\u5931\u8d25:",t),new Error("\u8ba2\u5355\u4e0d\u5b58\u5728\u6216\u5df2\u5220\u9664")}})}getOrderList(e,t,r=1,a=20){return l(this,null,function*(){try{const{userId:n}=this.getUserInfo(),s={userId:n,page:r,pageSize:a};e&&(s.status=e),t&&(s.orderType=t);const o=yield h("/orders",s),i=o.data.list.map(e=>(e.amount&&(e.totalAmount=e.amount/100),e.extraData&&(e.therapistId=e.extraData.therapistId,e.therapistName=e.extraData.therapistName,e.storeId=e.extraData.storeId,e.storeName=e.extraData.storeName,e.storeAddress=e.extraData.storeAddress,e.appointmentDate=e.extraData.appointmentDate,e.appointmentTime=e.extraData.startTime,e.duration=e.extraData.duration,e.serviceName=e.extraData.serviceName||e.title,e.appointmentStatus=e.extraData.appointmentStatus),e.therapistAvatar||(e.therapistAvatar="https://img.yzcdn.cn/vant/cat.jpeg"),e.displayStatus=this.getDisplayStatus(e),e)),c=yield this.enrichOrderListWithStoreAndTherapistInfo(i);return c}catch(n){return console.error("\u83b7\u53d6\u8ba2\u5355\u5217\u8868\u5931\u8d25:",n),[]}})}cancelOrder(e,t="\u7528\u6237\u53d6\u6d88"){return l(this,null,function*(){try{const{userId:r}=this.getUserInfo(),a=yield m("/orders/cancel",{orderNo:e,userId:r,reason:t},{showLoading:!0,loadingTitle:"\u53d6\u6d88\u4e2d..."});return a.data}catch(r){throw console.error("\u53d6\u6d88\u8ba2\u5355\u5931\u8d25:",r),new Error(r.message||"\u53d6\u6d88\u8ba2\u5355\u5931\u8d25")}})}rebookOrder(e){return l(this,null,function*(){try{const t=yield this.getOrderDetail(e);return d.Taro.setStorageSync("rebookOrderInfo",{therapistId:t.therapistId,therapistName:t.therapistName,storeId:t.storeId,storeName:t.storeName,serviceId:t.serviceId,serviceName:t.serviceName,duration:t.duration}),!0}catch(t){return console.error("\u91cd\u65b0\u9884\u7ea6\u5931\u8d25:",t),!1}})}getOrderStatistics(){return l(this,null,function*(){try{const{userId:e}=this.getUserInfo(),t=yield h("/orders",{userId:e,page:1,pageSize:100}),r=t.data.list;return{total:r.length,pendingPayment:r.filter(e=>"pending"===e.paymentStatus).length,paid:r.filter(e=>"paid"===e.paymentStatus).length,completed:r.filter(e=>"paid"===e.paymentStatus&&new Date(e.appointmentDate+" "+e.appointmentTime)<new Date).length,cancelled:r.filter(e=>"cancelled"===e.paymentStatus).length}}catch(e){return console.error("\u83b7\u53d6\u8ba2\u5355\u7edf\u8ba1\u5931\u8d25:",e),{total:0,pendingPayment:0,paid:0,completed:0,cancelled:0}}})}}const R=new E;function P(e,t){if(!e||e>=1)return null;const r=Math.round(100*(1-e)),a=new Date,n=new Date(a.getTime()+31536e6);return{id:`virtual_${t}_discount`,userId:t.toString(),type:"discount",name:r>=30?"\u65b0\u4eba\u4e13\u4eab\u5238":"\u4f1a\u5458\u6298\u6263\u5238",description:`\u5168\u573a\u670d\u52a1${Math.round(100*e)}\u6298`,discountRate:e,discountPercentage:r,validFrom:a.toISOString(),validTo:n.toISOString(),status:"unused",isAutoApply:!0}}function D(e,t){const r=Math.round(e*t),a=e-r,n=Math.round(100*t);return{originalPrice:e,finalPrice:r,savedAmount:a,discountDisplay:`${n}\u6298`}}class A{constructor(){this.vouchers=[],this.currentVoucher=null}getMyVouchers(){return l(this,null,function*(){const e=w();if(!e)return[];if(e.discountRate&&e.discountRate<1){const t=P(e.discountRate,e.id.toString());if(t)return this.vouchers=[t],[t]}return[]})}getAvailableVouchers(e){return l(this,null,function*(){const t=yield this.getMyVouchers(),r=new Date;return t.filter(t=>{if("unused"!==t.status)return!1;const a=new Date(t.validFrom),n=new Date(t.validTo);return!(r<a||r>n)&&!(t.minAmount&&e<t.minAmount)})})}setCurrentVoucher(e){this.currentVoucher=e,e?d.Taro.setStorageSync("selectedVoucher",e):d.Taro.removeStorageSync("selectedVoucher")}getCurrentVoucher(){if(!this.currentVoucher)try{this.currentVoucher=d.Taro.getStorageSync("selectedVoucher")}catch(e){console.error("\u83b7\u53d6\u9009\u4e2d\u793c\u5238\u5931\u8d25:",e)}return this.currentVoucher}markVoucherAsUsed(e,t){const r=this.vouchers.find(t=>t.id===e);r&&(r.status="used",r.usedAt=(new Date).toISOString(),r.orderNo=t),this.setCurrentVoucher(null)}isNewUser(){const e=w();if(!e||!e.discountRate)return!1;const t=Math.round(100*(1-e.discountRate));return t>=30}getNewUserVoucherInfo(){const e=w();if(!e||!e.discountRate||e.discountRate>=1)return{hasVoucher:!1};const t=Math.round(100*(1-e.discountRate));return{hasVoucher:!0,discountPercentage:t,description:`\u606d\u559c\u83b7\u5f97\u65b0\u4eba\u4e13\u4eab${t}%\u4f18\u60e0\u5238\uff01`}}}const M=new A;class V{getCurrentUserId(){return S()}getBalance(){return l(this,null,function*(){try{const e=this.getCurrentUserId(),t=yield h("/users/wallet/balance",{userId:e}),r=t.data.balance||0,a=r/100;return console.log("\ud83d\udcb0 \u4f59\u989d\u67e5\u8be2:",{"\u5206":r,"\u5143":a.toFixed(2)}),a}catch(e){throw console.error("\u83b7\u53d6\u4f59\u989d\u5931\u8d25:",e),new Error("\u83b7\u53d6\u4f59\u989d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})}getBalanceDetails(){return l(this,null,function*(){try{const e=this.getCurrentUserId(),t=yield h("/users/wallet/balance",{userId:e}),r=t.data;return{balance:r.balance/100,totalSpent:r.totalSpent/100,totalVisits:r.totalVisits}}catch(e){throw console.error("\u83b7\u53d6\u4f59\u989d\u8be6\u60c5\u5931\u8d25:",e),new Error("\u83b7\u53d6\u4f59\u989d\u8be6\u60c5\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})}getRechargeOptions(){return l(this,null,function*(){try{const e=yield h("/recharge/configs");return e.data.map(e=>c(i({},e),{amount:e.amount/100,bonus:e.bonus/100}))}catch(e){return console.error("\u83b7\u53d6\u5145\u503c\u914d\u7f6e\u5931\u8d25:",e),this.getDefaultRechargeOptions()}})}getDefaultRechargeOptions(){return[{id:1,amount:100,bonus:0,label:"100\u5143",sortOrder:1},{id:2,amount:200,bonus:0,label:"200\u5143",sortOrder:2},{id:3,amount:500,bonus:50,label:"500\u5143",sortOrder:3,promotionTag:"\u8d6050\u5143"},{id:4,amount:1e3,bonus:100,label:"1000\u5143",sortOrder:4,promotionTag:"\u8d60100\u5143"},{id:5,amount:2e3,bonus:300,label:"2000\u5143",sortOrder:5,promotionTag:"\u8d60300\u5143"},{id:6,amount:5e3,bonus:1e3,label:"5000\u5143",sortOrder:6,promotionTag:"\u8d601000\u5143",isRecommended:!0}]}createRechargeOrder(e,t=0){return l(this,null,function*(){try{const r=this.getCurrentUserId(),a={orderType:"recharge",userId:r,userPhone:v(),title:t>0?`\u5145\u503c${e}\u5143\uff0c\u8d60\u9001${t}\u5143`:`\u5145\u503c${e}\u5143`,amount:100*e,paymentMethod:"wechat",extraData:{bonus:100*t,actualRecharge:100*(e+t)}},n=yield m("/orders/create",a,{showLoading:!0,loadingTitle:"\u521b\u5efa\u8ba2\u5355\u4e2d..."});return n.data}catch(r){throw console.error("\u521b\u5efa\u5145\u503c\u8ba2\u5355\u5931\u8d25:",r),new Error(r.message||"\u521b\u5efa\u5145\u503c\u8ba2\u5355\u5931\u8d25")}})}getTransactions(e=1,t=20,r){return l(this,null,function*(){try{const a=this.getCurrentUserId(),n={userId:a,page:e,pageSize:t};r&&(n.type=r);const s=yield h("/users/wallet/transactions",n);return s.data.list.map(e=>c(i({},e),{amount:e.amount/100,balance:e.balance/100}))}catch(a){return console.error("\u83b7\u53d6\u4ea4\u6613\u8bb0\u5f55\u5931\u8d25:",a),[]}})}payWithBalance(e,t){return l(this,null,function*(){try{const t=yield m("/orders/pay",{orderNo:e,paymentMethod:"balance"},{showLoading:!0,loadingTitle:"\u652f\u4ed8\u4e2d..."});return{success:!0,balance:t.data.balance/100,message:"\u652f\u4ed8\u6210\u529f"}}catch(t){throw console.error("\u4f59\u989d\u652f\u4ed8\u5931\u8d25:",t),new Error(t.message||"\u4f59\u989d\u4e0d\u8db3\u6216\u652f\u4ed8\u5931\u8d25")}})}handleWechatPay(e){return l(this,null,function*(){return new Promise((t,r)=>{d.Taro.requestPayment({timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:()=>t(),fail:e=>r(new Error(e.errMsg||"\u652f\u4ed8\u5931\u8d25"))})})})}refundToBalance(e,t,r="\u8ba2\u5355\u9000\u6b3e"){return l(this,null,function*(){try{const a=yield m("/users/wallet/refund",{phone:v(),amount:100*t,orderNo:e,description:r},{showLoading:!0,loadingTitle:"\u9000\u6b3e\u4e2d..."});return{success:!0,balance:a.data.balance/100,transactionId:a.data.transactionId,message:"\u9000\u6b3e\u6210\u529f"}}catch(a){throw console.error("\u9000\u6b3e\u5931\u8d25:",a),new Error(a.message||"\u9000\u6b3e\u5931\u8d25")}})}clearCache(){try{d.Taro.removeStorageSync("userInfo"),d.Taro.removeStorageSync("walletCache"),console.log("\u94b1\u5305\u7f13\u5b58\u5df2\u6e05\u7a7a")}catch(e){console.error("\u6e05\u7a7a\u7f13\u5b58\u5931\u8d25:",e)}}}const $=new V;class k{getNearbyStores(e,t,r=1,a=10){return l(this,null,function*(){try{const n=yield p("/stores/nearby",{data:{latitude:e,longitude:t,page:r,pageSize:a}});return console.log("\u2705 \u95e8\u5e97\u5217\u8868API\u8c03\u7528\u6210\u529f:",n),n&&n.data&&n.data.list?n.data:(console.log("\u26a0\ufe0f API\u4e0d\u5b58\u5728\uff0c\u4f7f\u7528mock\u6570\u636e"),{list:[],total:0,page:1,pageSize:10,hasMore:!1})}catch(n){return console.log("\u26a0\ufe0f \u95e8\u5e97API\u8c03\u7528\u5931\u8d25\uff0c\u4f7f\u7528mock\u6570\u636e:",n),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}getStoreDetail(e){return l(this,null,function*(){try{const t=yield p(`/stores/${e}`);return console.log("\u2705 \u95e8\u5e97\u8be6\u60c5API\u8c03\u7528\u6210\u529f:",t),t}catch(t){return console.log("\u26a0\ufe0f \u95e8\u5e97\u8be6\u60c5API\u8c03\u7528\u5931\u8d25:",t),null}})}searchStores(e,t=1,r=10){return l(this,null,function*(){try{const a=yield p("/stores/search",{data:{keyword:e,page:t,pageSize:r}});return console.log("\u2705 \u95e8\u5e97\u641c\u7d22API\u8c03\u7528\u6210\u529f:",a),a.data||{list:[],total:0,page:1,pageSize:10,hasMore:!1}}catch(a){return console.log("\u26a0\ufe0f \u95e8\u5e97\u641c\u7d22API\u8c03\u7528\u5931\u8d25:",a),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}getStoresByStatus(e,t=1,r=10){return l(this,null,function*(){try{const a=yield p("/stores/filter",{data:{status:e,page:t,pageSize:r}});return console.log("\u2705 \u95e8\u5e97\u7b5b\u9009API\u8c03\u7528\u6210\u529f:",a),a.data||{list:[],total:0,page:1,pageSize:10,hasMore:!1}}catch(a){return console.log("\u26a0\ufe0f \u95e8\u5e97\u7b5b\u9009API\u8c03\u7528\u5931\u8d25:",a),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}}const O=new k;class z{getCurrentLocation(){return l(this,null,function*(){try{const t=yield d.Taro.getSetting(),r=(null==t?void 0:t.authSetting)||{};let a;r["scope.userLocation"]||(yield d.Taro.authorize({scope:"scope.userLocation"}));try{a=yield d.Taro.getLocation({type:"gcj02",isHighAccuracy:!0})}catch(e){console.warn("gcj02\u5750\u6807\u7cfb\u4e0d\u652f\u6301\uff0c\u5c1d\u8bd5wgs84:",e),a=yield d.Taro.getLocation({type:"wgs84"})}return{latitude:a.latitude,longitude:a.longitude}}catch(t){console.error("\u83b7\u53d6\u4f4d\u7f6e\u5931\u8d25:",t);const e=(null==t?void 0:t.errMsg)||"";return(e.includes("auth deny")||e.includes("authorize:fail"))&&d.Taro.showModal({title:"\u63d0\u793a",content:"\u9700\u8981\u83b7\u53d6\u60a8\u7684\u4f4d\u7f6e\u4fe1\u606f\u6765\u63a8\u8350\u9644\u8fd1\u95e8\u5e97",confirmText:"\u53bb\u8bbe\u7f6e",success:e=>{e.confirm&&d.Taro.openSetting()}}),console.log("\u4f7f\u7528\u9ed8\u8ba4\u4f4d\u7f6e\uff1a\u4e0a\u6d77\u5e02\u4e2d\u5fc3"),{latitude:31.2304,longitude:121.4737}}})}calculateDistance(e,t,r,a){const n=Math.PI/180,s=6371,o=(r-e)*n,i=(a-t)*n,c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e*n)*Math.cos(r*n)*Math.sin(i/2)*Math.sin(i/2),l=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return Number((s*l).toFixed(1))}formatDistance(e){return e<1?`${Math.round(1e3*e)}m`:`${e}km`}}const C=new z;class L{getRecommendedTherapists(e=1,t=10,r){return l(this,null,function*(){try{const a=yield p("/therapists/recommended",{data:{page:e,pageSize:t,latitude:null==r?void 0:r.latitude,longitude:null==r?void 0:r.longitude}});return console.log("\u2705 \u63a8\u8350\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",a),a.data||{list:[],total:0,page:1,pageSize:10,hasMore:!1}}catch(a){return console.log("\u26a0\ufe0f \u63a8\u8350\u63a8\u62ff\u5e08API\u8c03\u7528\u5931\u8d25\uff0c\u4f7f\u7528mock\u6570\u636e:",a),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}getRecommendedTherapistsWithDistance(e=1,t=10){return l(this,null,function*(){var r,a,n,s,o;try{const d=yield C.getCurrentLocation(),u=yield p("/therapists/recommended",{data:{page:e,pageSize:t,latitude:d.latitude,longitude:d.longitude}});console.log("\u2705 \u63a8\u8350\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",u);const h=(null==(r=u.data)?void 0:r.list)||[],m=yield Promise.all(h.map(e=>l(this,null,function*(){try{const t=yield O.getStoreDetail(e.storeId),r=(null==t?void 0:t.data)||t;let a=null;return(null==r?void 0:r.latitude)&&(null==r?void 0:r.longitude)&&(a=C.calculateDistance(d.latitude,d.longitude,r.latitude,r.longitude)),c(i({},e),{distance:a})}catch(t){return console.warn(`\u83b7\u53d6\u6280\u5e08 ${e.id} \u95e8\u5e97\u4fe1\u606f\u5931\u8d25:`,t),c(i({},e),{distance:null})}})));return m.sort((e,t)=>null===e.distance&&null===t.distance?0:null===e.distance?1:null===t.distance?-1:e.distance-t.distance),{list:m,total:(null==(a=u.data)?void 0:a.total)||m.length,page:(null==(n=u.data)?void 0:n.page)||e,pageSize:(null==(s=u.data)?void 0:s.pageSize)||t,hasMore:(null==(o=u.data)?void 0:o.hasMore)||!1}}catch(d){return console.log("\u26a0\ufe0f \u63a8\u8350\u63a8\u62ff\u5e08\u8ddd\u79bb\u8ba1\u7b97API\u8c03\u7528\u5931\u8d25:",d),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}getTherapistsByStore(e,t=1,r=10){return l(this,null,function*(){const a=yield p(`/stores/${e}/therapists`,{data:{page:t,pageSize:r}});console.log("\u2705 \u95e8\u5e97\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",a);const n=Array.isArray(a.data)?a.data:[];return{list:n,total:n.length,page:1,pageSize:n.length,hasMore:!1}})}getTherapistDetail(e){return l(this,null,function*(){try{const t=yield p(`/therapists/${e}`);return console.log("\u2705 \u63a8\u62ff\u5e08\u8be6\u60c5API\u8c03\u7528\u6210\u529f:",t),t}catch(t){throw console.log("\u26a0\ufe0f \u63a8\u62ff\u5e08\u8be6\u60c5API\u8c03\u7528\u5931\u8d25:",t),t}})}getTherapistsByExpertise(e,t=1,r=10){return l(this,null,function*(){const a=yield p("/therapists/search",{data:{expertise:e,page:t,pageSize:r}});return console.log("\u2705 \u4e13\u957f\u7b5b\u9009\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",a),a.data})}searchTherapists(e,t=1,r=10){return l(this,null,function*(){const a=yield p("/therapists/search",{data:{keyword:e,page:t,pageSize:r}});return console.log("\u2705 \u641c\u7d22\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",a),a.data})}getAvailableSlots(e,t,r=60){return l(this,null,function*(){try{const a=yield p("/appointments/available-slots",{data:{therapistId:e,date:t,duration:r}});return console.log("\u2705 \u83b7\u53d6\u53ef\u9884\u7ea6\u65f6\u6bb5API\u8c03\u7528\u6210\u529f:",a),a.data}catch(a){console.log("\u26a0\ufe0f \u83b7\u53d6\u53ef\u9884\u7ea6\u65f6\u6bb5API\u8c03\u7528\u5931\u8d25\uff0c\u8fd4\u56de\u9ed8\u8ba4\u5168\u90e8\u53ef\u7528:",a);const e=[];for(let t=9;t<=21;t++)for(let r=0;r<60;r+=10){const a=`${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`;e.push({time:a,available:!0,status:"available"})}return{date:t,slots:e,workTime:{start:"09:00",end:"21:00"}}}})}}const U=new L;class B{createReview(e){return l(this,null,function*(){if(e.content.length<1)throw new Error("\u8bc4\u4ef7\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a");if(e.content.length>500)throw new Error("\u8bc4\u4ef7\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7500\u5b57");if(e.rating<1||e.rating>5)throw new Error("\u8bc4\u5206\u5fc5\u987b\u57281-5\u4e4b\u95f4");try{const t=yield m("/reviews",e,{showLoading:!0,loadingTitle:"\u63d0\u4ea4\u8bc4\u4ef7\u4e2d..."});return d.Taro.eventCenter.trigger("review:created",t.data),t.data}catch(t){throw console.error("\u521b\u5efa\u8bc4\u4ef7\u5931\u8d25:",t),new Error(t.message||"\u521b\u5efa\u8bc4\u4ef7\u5931\u8d25")}})}getTherapistReviews(e,t=1,r=10,a){return l(this,null,function*(){try{const n={page:t,pageSize:r};a&&(n.rating=a);const s=yield h(`/therapists/${e}/reviews`,n);return s.data}catch(n){return console.error("\u83b7\u53d6\u63a8\u62ff\u5e08\u8bc4\u4ef7\u5931\u8d25:",n),{list:[],total:0,page:t,pageSize:r,hasMore:!1}}})}getUserReviews(e,t=1,r=10){return l(this,null,function*(){try{const a=yield h(`/users/${e}/reviews`,{page:t,pageSize:r});return a.data}catch(a){return console.error("\u83b7\u53d6\u7528\u6237\u8bc4\u4ef7\u5931\u8d25:",a),{list:[],total:0,page:t,pageSize:r,hasMore:!1}}})}getReviewDetail(e){return l(this,null,function*(){try{const t=yield h(`/reviews/${e}`);return t.data}catch(t){throw console.error("\u83b7\u53d6\u8bc4\u4ef7\u8be6\u60c5\u5931\u8d25:",t),new Error(t.message||"\u8bc4\u4ef7\u4e0d\u5b58\u5728")}})}getReviewStats(e){return l(this,null,function*(){try{const t=yield h(`/therapists/${e}/review-stats`);return t.data}catch(t){return console.error("\u83b7\u53d6\u8bc4\u4ef7\u7edf\u8ba1\u5931\u8d25:",t),{totalCount:0,averageRating:0,ratingBreakdown:{1:0,2:0,3:0,4:0,5:0}}}})}checkCanReview(e){return l(this,null,function*(){var t;try{const r=yield d.Taro.request({url:`${u.baseURL}/reviews/${e}`,method:"GET",header:{"Content-Type":"application/json"},timeout:u.timeout}),a=r.data;return 1002===a.code?(console.log("\u8bc4\u4ef7\u4e0d\u5b58\u5728\uff0c\u53ef\u4ee5\u521b\u5efa\u8bc4\u4ef7"),!0):0!==a.code||!(null==(t=a.data)?void 0:t.reviewId)||(console.log("\u8bc4\u4ef7\u5df2\u5b58\u5728\uff0c\u4e0d\u80fd\u518d\u8bc4\u4ef7"),!1)}catch(r){return console.warn("\u68c0\u67e5\u8bc4\u4ef7\u72b6\u6001\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u9ed8\u8ba4\u5141\u8bb8\u8bc4\u4ef7"),!0}})}batchCheckReviewStatus(e){return l(this,null,function*(){const t={},r=e.map(e=>l(this,null,function*(){const r=yield this.checkCanReview(e);t[e]=r}));return yield Promise.allSettled(r),t})}clearCache(){try{const e=d.Taro.getStorageInfoSync().keys;e.forEach(e=>{e.startsWith("review_cache_")&&d.Taro.removeStorageSync(e)})}catch(e){console.error("\u6e05\u9664\u8bc4\u4ef7\u7f13\u5b58\u5931\u8d25:",e)}}}const q=new B,W=[{id:"1",name:"\u9888\u80a9\u8170\u817f\u75db\u8c03\u7406",order:1},{id:"2",name:"\u809d\u80c6\u813e\u80c3\u8c03\u7406",order:2},{id:"3",name:"\u5931\u7720\u8c03\u7406",order:3},{id:"4",name:"\u5bab\u5bd2\u75db\u7ecf\u8c03\u7406",order:4},{id:"5",name:"\u8159\u7b4b\u6839\u9ab6",order:5},{id:"6",name:"\u8fd0\u52a8\u62c9\u4f38",order:6},{id:"7",name:"\u4f53\u6001\u8c03\u7406",order:7}],F=[{id:"s1",categoryId:"1",name:"\u3010\u4e0d\u6ee1\u610f\u9000\u3011\u9888\u80a9\u8170\u817f\u75db\u7279\u8272\u8c03\u740660\u5206\u949f",description:"\u4e13\u4e1a\u624b\u6cd5\u8c03\u7406\u5404\u7c7b\u75db\u75c7",duration:60,price:298,discountPrice:258,availability:"available",tag:"\u4e0d\u6ee1\u610f\u9000"},{id:"s2",categoryId:"1",name:"\u3010\u51ac\u5b63\u517b\u751f\u3011\u80a9\u9888\u8170\u80cc\u63a8\u62ff+\u70ed\u759760\u5206\u949f",description:"\u6e29\u7ecf\u901a\u7edc\uff0c\u9a71\u5bd2\u517b\u751f",duration:60,price:268,discountPrice:238,availability:"available",tag:"\u51ac\u5b63\u517b\u751f"},{id:"s3",categoryId:"1",name:"\u3010\u521d\u6b21\u4e13\u4eab\u3011\u80a9\u9888\u758f\u901a+\u808c\u8089\u653e\u677e",description:"\u65b0\u5ba2\u7279\u60e0\uff0c\u6df1\u5ea6\u653e\u677e",duration:60,price:198,discountPrice:98,availability:"available",tag:"\u521d\u6b21\u4e13\u4eab"},{id:"s4",categoryId:"2",name:"\u3010\u8212\u809d\u6da6\u80ba\u3011\u63a8\u62ff+\u827e\u7078\uff5c\u517b\u8eab\u4f34\u4fa390\u5206\u949f",description:"\u758f\u809d\u7406\u6c14\uff0c\u6da6\u80ba\u517b\u9634",duration:90,price:398,discountPrice:358,availability:"available",tag:"\u70ed\u9500"},{id:"s5",categoryId:"2",name:"\u3010\u4e13\u9879\u8c03\u7406\u3011\u7ea4\u517b\u7626\u8eab\xb7\u813e\u80c3\u810f\u8151\u8c03\u740660\u5206\u949f",description:"\u8c03\u7406\u813e\u80c3\uff0c\u5065\u5eb7\u7626\u8eab",duration:60,price:318,discountPrice:288,availability:"available",tag:"\u4e13\u9879\u8c03\u7406"},{id:"s6",categoryId:"3",name:"\u3010\u6df1\u5ea6\u653e\u677e\u3011\u5168\u8eab\u63a8\u62ff20\u5e74\u7ecf\u517860\u5206\u949f",description:"\u7ecf\u5178\u624b\u6cd5\uff0c\u6df1\u5ea6\u52a9\u7720",duration:60,price:268,discountPrice:238,availability:"available",tag:"\u7ecf\u5178"},{id:"s7",categoryId:"4",name:"\u3010\u7279\u8272\u517b\u751f\u3011\u5173\u5143\u7078\u624b\u5de5\u60ac\u707860\u5206\u949f",description:"\u6e29\u8865\u80be\u9633\uff0c\u8c03\u7406\u5bab\u5bd2",duration:60,price:288,discountPrice:258,availability:"available",tag:"\u7279\u8272"},{id:"s8",categoryId:"4",name:"\u3010\u672c\u5e97\u70ed\u9500\u3011\u7279\u8272\u94fa\u59dc\u5173\u5143\u707860\u5206\u949f",description:"\u94fa\u59dc\u6e29\u7078\uff0c\u6696\u5bab\u8c03\u7ecf",duration:60,price:298,discountPrice:268,availability:"busy",tag:"\u70ed\u9500"},{id:"s9",categoryId:"5",name:"\u3010\u4f53\u6001\u8c03\u6574\u3011\u5927\u5e08\u624b\u6cd5\u4e2d\u5f0f\u6574\u810a60\u5206\u949f",description:"\u6b63\u9aa8\u6574\u810a\uff0c\u8c03\u6574\u4f53\u6001",duration:60,price:398,discountPrice:368,availability:"available",tag:"\u5927\u5e08\u624b\u6cd5"},{id:"s10",categoryId:"6",name:"\u8fd0\u52a8\u6062\u590d\u62c9\u4f38",description:"\u4e13\u4e1a\u8fd0\u52a8\u540e\u6062\u590d",duration:45,price:198,discountPrice:168,availability:"available"},{id:"s11",categoryId:"7",name:"\u3010\u51c0\u6392\u5bd2\u6c14\u3011\u62d4\u7f50/\u522e\u75e7\u4e8c\u9009\u4e00",description:"\u795b\u6e7f\u6392\u5bd2\uff0c\u758f\u901a\u7ecf\u7edc",duration:30,price:128,discountPrice:98,availability:"available",tag:"\u4e8c\u9009\u4e00"},{id:"s12",categoryId:"7",name:"\u3010\u82b3\u9999\u6ecb\u517b\u3011\u6c89\u6d78\u5f0f\u7cbe\u6cb9SPA",description:"\u7cbe\u6cb9\u62a4\u7406\uff0c\u8eab\u5fc3\u653e\u677e",duration:90,price:428,discountPrice:398,availability:"available",tag:"\u7cbe\u6cb9SPA"}],G="",_=({items:e,therapist:t,onCheckout:r,onMaskClick:a,onRemoveItem:n})=>{const[s,o]=d.reactExports.useState(!1),[i,c]=d.reactExports.useState(180),l=d.reactExports.useRef(null),u=e.reduce((e,t)=>e+t.price,0),p=e.reduce((e,t)=>e+(t.discountPrice||t.price),0),h=u-p,m=e.length>0;d.reactExports.useEffect(()=>(m&&s?l.current=setInterval(()=>{c(e=>e<=1?(clearInterval(l.current),d.Taro.showToast({title:"\u652f\u4ed8\u8d85\u65f6\u4e86\u5466\uff0c\u5feb\u5feb\u91cd\u65b0\u4e0b\u5355\u5427~",icon:"none"}),o(!1),180):e-1)},1e3):l.current&&clearInterval(l.current),()=>{l.current&&clearInterval(l.current)}),[m,s]);const g=e=>{const t=Math.floor(e/60),r=e%60;return`${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},x=e=>{const t=new Date(e),r=new Date,a=t.toDateString()===r.toDateString();if(a)return"\u4eca\u5929";const n=t.getMonth()+1,s=t.getDate();return`${n}\u6708${s}\u65e5`},y=()=>{m?o(!0):d.Taro.showToast({title:"\u8bf7\u5148\u9009\u62e9\u670d\u52a1",icon:"none"})},f=()=>{a&&a(),o(!1)},w=()=>{r()};return d.jsxRuntimeExports.jsxs(d.jsxRuntimeExports.Fragment,{children:[s&&d.jsxRuntimeExports.jsx(d.View,{className:"cart-mask",onClick:f}),d.jsxRuntimeExports.jsx(d.View,{className:"shopping-cart",children:d.jsxRuntimeExports.jsxs(d.View,{className:"cart-bar",children:[d.jsxRuntimeExports.jsx(d.View,{className:"cart-info",children:m?d.jsxRuntimeExports.jsxs(d.jsxRuntimeExports.Fragment,{children:[d.jsxRuntimeExports.jsxs(d.Text,{className:"total-price",children:["\xa5",p]}),h>0&&d.jsxRuntimeExports.jsxs(d.Text,{className:"savings",children:["\u5df2\u4f18\u60e0\xa5",h]})]}):d.jsxRuntimeExports.jsx(d.Text,{className:"empty-text",children:"\u8bf7\u9009\u62e9\u670d\u52a1\u9879\u76ee"})}),d.jsxRuntimeExports.jsx(d.View,{className:"checkout-btn "+(m?"":"disabled"),onClick:y,children:"\u53bb\u7ed3\u7b97"})]})}),s&&d.jsxRuntimeExports.jsxs(d.View,{className:"cart-expanded",children:[d.jsxRuntimeExports.jsx(d.View,{className:"expanded-header",children:d.jsxRuntimeExports.jsx(d.Text,{className:"title",children:"\u9884\u7ea6\u8be6\u60c5"})}),d.jsxRuntimeExports.jsx(d.View,{className:"service-list",children:e.map((e,r)=>d.jsxRuntimeExports.jsxs(d.View,{className:"service-item",children:[d.jsxRuntimeExports.jsx(d.Image,{className:"therapist-avatar",src:e.therapistAvatar||(null==t?void 0:t.avatar)||""}),d.jsxRuntimeExports.jsxs(d.View,{className:"service-info",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"info-header",children:[d.jsxRuntimeExports.jsx(d.Text,{className:"therapist-name",children:e.therapistName}),d.jsxRuntimeExports.jsxs(d.Text,{className:"duration",children:[e.duration,"\u5206\u949f"]})]}),d.jsxRuntimeExports.jsx(d.View,{className:"info-detail",children:d.jsxRuntimeExports.jsx(d.Text,{className:"service-name",children:e.serviceName})}),d.jsxRuntimeExports.jsx(d.View,{className:"info-time",children:d.jsxRuntimeExports.jsxs(d.Text,{className:"time-text",children:[x(e.date)," ",e.time," \u81f3 ",(()=>{const[t,r]=e.time.split(":").map(Number),a=r+e.duration,n=t+Math.floor(a/60),s=a%60;return`${n}:${s.toString().padStart(2,"0")}`})()]})})]}),d.jsxRuntimeExports.jsxs(d.View,{className:"item-actions",children:[d.jsxRuntimeExports.jsx(d.View,{className:"price-info",children:d.jsxRuntimeExports.jsxs(d.Text,{className:"price",children:["\xa5",e.discountPrice||e.price]})}),n&&d.jsxRuntimeExports.jsx(d.View,{className:"remove-btn",onClick:()=>n(r),children:"\u2715"})]})]},r))}),d.jsxRuntimeExports.jsxs(d.View,{className:"addon-section",children:[d.jsxRuntimeExports.jsx(d.Text,{className:"section-title",children:"\u53ef\u9009\u589e\u503c\u9879\u76ee"}),d.jsxRuntimeExports.jsxs(d.View,{className:"addon-list",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"addon-item",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"addon-info",children:[d.jsxRuntimeExports.jsx(d.Text,{className:"addon-name",children:"\u522e\u75e720\u5206\u949f"}),d.jsxRuntimeExports.jsx(d.Text,{className:"addon-price",children:"\xa5 99"})]}),d.jsxRuntimeExports.jsx(d.View,{className:"addon-action",children:"+"})]}),d.jsxRuntimeExports.jsxs(d.View,{className:"addon-item",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"addon-info",children:[d.jsxRuntimeExports.jsx(d.Text,{className:"addon-name",children:"\u52a0\u949f20\u5206\u949f"}),d.jsxRuntimeExports.jsx(d.Text,{className:"addon-price",children:"\xa5 99"})]}),d.jsxRuntimeExports.jsx(d.View,{className:"addon-action",children:"+"})]})]})]}),d.jsxRuntimeExports.jsxs(d.View,{className:"checkout-section",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"price-summary",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"cart-icon",children:[d.jsxRuntimeExports.jsx(d.Text,{className:"icon",children:"\ud83d\uded2"}),d.jsxRuntimeExports.jsx(d.View,{className:"badge",children:"1"})]}),d.jsxRuntimeExports.jsxs(d.View,{className:"price-detail",children:[d.jsxRuntimeExports.jsxs(d.Text,{className:"final-price",children:["\xa5 ",p]}),u>p&&d.jsxRuntimeExports.jsxs(d.Text,{className:"original-price",children:["\xa5 ",u]})]}),d.jsxRuntimeExports.jsx(d.Text,{className:"discount-tip",children:"\u5df2\u4eab\u53d7\u6700\u5927\u4f18\u60e0\u51cf20\u5143"})]}),d.jsxRuntimeExports.jsxs(d.View,{className:"checkout-footer",children:[d.jsxRuntimeExports.jsxs(d.Text,{className:"countdown",children:["\u652f\u4ed8\u5012\u8ba1\u65f6: ",g(i)]}),d.jsxRuntimeExports.jsx(d.View,{className:"confirm-btn",onClick:w,children:"\u53bb\u7ed3\u7b97"})]})]})]})]})},H="",J=({size:e="medium",text:t="\u9884\u7ea6"})=>d.jsxRuntimeExports.jsx(d.View,{className:`booking-button booking-button-${e}`,children:d.jsxRuntimeExports.jsx(d.Text,{className:"button-text",children:t})});exports.BookingButton=J,exports.GiftService=f,exports.ShoppingCart=_,exports.calculateDiscountPrice=D,exports.checkAndAutoLogin=b,exports.fetchUserInfo=N,exports.getCurrentUserInfo=w,exports.getLocationService=C,exports.maskPhone=j,exports.orderService=R,exports.post=m,exports.request=p,exports.reviewService=q,exports.setUserInfo=I,exports.storeService=O,exports.symptomCategories=W,exports.symptomServices=F,exports.therapistService=U,exports.voucherService=M,exports.walletService=$,exports.wechatLogin=T;
