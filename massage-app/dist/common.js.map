{"version":3,"file":"common.js","sources":["../src/config/api.ts","../src/constants/error-codes.ts","../src/utils/request.ts","../src/config/assets.ts","../src/utils/user.ts","../src/services/gift.service.ts","../src/utils/image.ts","../src/services/store.ts","../src/services/location.ts","../src/pages/appointment/therapist/components/ShoppingCart/index.tsx","../src/mock/data/symptoms.ts","../src/services/symptom.ts","../src/services/therapist.ts","../src/services/order.ts","../src/utils/amount.ts","../src/services/payment.service.ts","../src/services/wallet.service.ts","../src/types/voucher.ts","../src/services/voucher.service.ts","../src/services/review.ts","../src/components/BookingButton/index.tsx"],"sourcesContent":["export const API_CONFIG = {\n  // ç”Ÿäº§ç¯å¢ƒé…ç½®\n  // æ³¨ï¼šåœ¨ WeChat å°ç¨‹åºä¸­ä¸èƒ½ä½¿ç”¨ process.envï¼Œä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯\n  // ä½¿ç”¨ç¡¬ç¼–ç çš„é»˜è®¤å€¼ï¼Œç»“åˆ npm script çš„ TARO_APP_API ç¯å¢ƒå˜é‡å®Œæˆç¼–è¯‘æ—¶æ›¿æ¢\n  baseURL: 'https://mingyitang1024.com/api/v2',\n  timeout: 10000,\n  retry: 3\n};\n\n/**\n * è·å–APIåŸºç¡€URL\n * @returns å®Œæ•´çš„APIåŸºç¡€URL\n */\nexport const getApiBaseUrl = () => {\n  return API_CONFIG.baseURL;\n};","/**\n * é”™è¯¯ç å¸¸é‡å®šä¹‰\n * ç»Ÿä¸€ç®¡ç†ç³»ç»Ÿä¸­æ‰€æœ‰çš„é”™è¯¯ç ï¼Œä¾¿äºå‰åç«¯äº¤äº’å’Œé”™è¯¯å¤„ç†\n */\n\n// é”™è¯¯ç åˆ†ç±»ï¼š\n// 1xxx - å®¢æˆ·ç«¯è¯·æ±‚é”™è¯¯ï¼ˆå‚æ•°é”™è¯¯ã€ä¸šåŠ¡é€»è¾‘é”™è¯¯ç­‰ï¼‰\n// 2xxx - èº«ä»½è®¤è¯å’Œæˆæƒé”™è¯¯\n// 3xxx - æœåŠ¡å™¨é”™è¯¯\n// 4xxx - ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯ï¼ˆæ”¯ä»˜ã€çŸ­ä¿¡ç­‰ï¼‰\n\nexport const ERROR_CODES = {\n  // æˆåŠŸ\n  SUCCESS: 0,\n\n  // 1xxx - å®¢æˆ·ç«¯è¯·æ±‚é”™è¯¯\n  PARAM_ERROR: 1001,           // å‚æ•°é”™è¯¯\n  INVALID_INPUT: 1002,         // è¾“å…¥æ— æ•ˆ\n  NOT_FOUND: 1003,             // èµ„æºä¸å­˜åœ¨\n  DUPLICATE: 1004,             // é‡å¤æ“ä½œ\n  INVALID_STATE: 1005,         // æ— æ•ˆçš„çŠ¶æ€è½¬æ¢\n  OPERATION_FAILED: 1006,      // æ“ä½œå¤±è´¥\n  INSUFFICIENT_BALANCE: 1007,  // ä½™é¢ä¸è¶³\n  QUOTA_EXCEEDED: 1008,        // é…é¢è¶…è¿‡\n  INVALID_PHONE: 1009,         // æ— æ•ˆçš„æ‰‹æœºå·\n  USER_NOT_FOUND: 1010,        // ç”¨æˆ·ä¸å­˜åœ¨\n\n  // 2xxx - èº«ä»½è®¤è¯å’Œæˆæƒé”™è¯¯\n  UNAUTHORIZED: 2001,          // æœªç™»å½•/æ— æœ‰æ•ˆä»¤ç‰Œ\n  FORBIDDEN: 2002,             // æ— æƒé™è®¿é—®\n  TOKEN_EXPIRED: 2003,         // ä»¤ç‰Œå·²è¿‡æœŸ\n  INVALID_TOKEN: 2004,         // æ— æ•ˆçš„ä»¤ç‰Œ\n  SESSION_EXPIRED: 2005,       // ä¼šè¯å·²è¿‡æœŸ\n\n  // 3xxx - æœåŠ¡å™¨é”™è¯¯\n  INTERNAL_ERROR: 3001,        // æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\n  SERVICE_UNAVAILABLE: 3002,   // æœåŠ¡ä¸å¯ç”¨\n  DATABASE_ERROR: 3003,        // æ•°æ®åº“é”™è¯¯\n  EXTERNAL_API_ERROR: 3004,    // å¤–éƒ¨APIé”™è¯¯\n\n  // 4xxx - ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯\n  PAYMENT_ERROR: 4001,         // æ”¯ä»˜å¤±è´¥\n  PAYMENT_TIMEOUT: 4002,       // æ”¯ä»˜è¶…æ—¶\n  SMS_ERROR: 4003,             // çŸ­ä¿¡å‘é€å¤±è´¥\n  WECHAT_ERROR: 4004,          // å¾®ä¿¡æ¥å£é”™è¯¯\n} as const;\n\n/**\n * é”™è¯¯ç ä¸ç”¨æˆ·å‹å¥½æç¤ºçš„æ˜ å°„\n * ç”¨äºåœ¨APIè¯·æ±‚å¤±è´¥æ—¶å‘ç”¨æˆ·å±•ç¤ºåˆé€‚çš„æç¤ºä¿¡æ¯\n */\nexport const ERROR_MESSAGE_MAP: Record<number, string> = {\n  [ERROR_CODES.SUCCESS]: 'æ“ä½œæˆåŠŸ',\n  [ERROR_CODES.PARAM_ERROR]: 'å‚æ•°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥',\n  [ERROR_CODES.INVALID_INPUT]: 'è¾“å…¥æ ¼å¼ä¸æ­£ç¡®',\n  [ERROR_CODES.NOT_FOUND]: 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨',\n  [ERROR_CODES.DUPLICATE]: 'æ“ä½œé‡å¤ï¼Œè¯·å‹¿é‡å¤æäº¤',\n  [ERROR_CODES.INVALID_STATE]: 'å½“å‰çŠ¶æ€ä¸å…è®¸æ­¤æ“ä½œ',\n  [ERROR_CODES.OPERATION_FAILED]: 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•',\n  [ERROR_CODES.INSUFFICIENT_BALANCE]: 'ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼',\n  [ERROR_CODES.QUOTA_EXCEEDED]: 'è¶…å‡ºé…é¢é™åˆ¶',\n  [ERROR_CODES.INVALID_PHONE]: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®',\n  [ERROR_CODES.USER_NOT_FOUND]: 'ç”¨æˆ·ä¸å­˜åœ¨',\n  [ERROR_CODES.UNAUTHORIZED]: 'è¯·å…ˆç™»å½•',\n  [ERROR_CODES.FORBIDDEN]: 'æ‚¨æ— æƒæ‰§è¡Œæ­¤æ“ä½œ',\n  [ERROR_CODES.TOKEN_EXPIRED]: 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',\n  [ERROR_CODES.INVALID_TOKEN]: 'æ— æ•ˆçš„ç™»å½•çŠ¶æ€',\n  [ERROR_CODES.SESSION_EXPIRED]: 'ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',\n  [ERROR_CODES.INTERNAL_ERROR]: 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•',\n  [ERROR_CODES.SERVICE_UNAVAILABLE]: 'æœåŠ¡ç»´æŠ¤ä¸­ï¼Œè¯·ç¨åé‡è¯•',\n  [ERROR_CODES.DATABASE_ERROR]: 'æ•°æ®åº“é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•',\n  [ERROR_CODES.EXTERNAL_API_ERROR]: 'ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•',\n  [ERROR_CODES.PAYMENT_ERROR]: 'æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•',\n  [ERROR_CODES.PAYMENT_TIMEOUT]: 'æ”¯ä»˜è¶…æ—¶ï¼Œè¯·é‡æ–°æ”¯ä»˜',\n  [ERROR_CODES.SMS_ERROR]: 'çŸ­ä¿¡å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',\n  [ERROR_CODES.WECHAT_ERROR]: 'å¾®ä¿¡æ¥å£å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•',\n};\n\n/**\n * è·å–ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º\n * @param code é”™è¯¯ç \n * @param defaultMessage é»˜è®¤æç¤ºä¿¡æ¯\n * @returns ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º\n */\nexport function getErrorMessage(code: number, defaultMessage?: string): string {\n  return ERROR_MESSAGE_MAP[code] || defaultMessage || 'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n}\n\n/**\n * åˆ¤æ–­æ˜¯å¦ä¸ºè®¤è¯ç›¸å…³é”™è¯¯\n */\nexport function isAuthError(code: number): boolean {\n  return [\n    ERROR_CODES.UNAUTHORIZED,\n    ERROR_CODES.TOKEN_EXPIRED,\n    ERROR_CODES.INVALID_TOKEN,\n    ERROR_CODES.SESSION_EXPIRED,\n  ].includes(code);\n}\n\n/**\n * åˆ¤æ–­æ˜¯å¦ä¸ºæœåŠ¡å™¨é”™è¯¯\n */\nexport function isServerError(code: number): boolean {\n  return code >= 3000 && code < 4000;\n}\n\n/**\n * åˆ¤æ–­æ˜¯å¦ä¸ºç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯\n */\nexport function isExternalError(code: number): boolean {\n  return code >= 4000 && code < 5000;\n}\n","import Taro from '@tarojs/taro';\nimport { API_CONFIG } from '@/config/api';\nimport { ERROR_CODES, getErrorMessage, isAuthError } from '@/constants/error-codes';\n\ninterface RequestOptions {\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE';\n  data?: any;\n  header?: Record<string, string>;\n  showLoading?: boolean;\n  loadingTitle?: string;\n}\n\ninterface ApiResponse<T = any> {\n  code: number;\n  message: string;\n  data: T;\n}\n\n/**\n * ç»Ÿä¸€è¯·æ±‚å°è£…\n * @param url - APIè·¯å¾„\n * @param options - è¯·æ±‚é€‰é¡¹\n * @returns Promise<ApiResponse>\n */\nexport async function request<T = any>(\n  url: string,\n  options: RequestOptions = {}\n): Promise<ApiResponse<T>> {\n  const {\n    method = 'GET',\n    data,\n    header = {},\n    showLoading = false,\n    loadingTitle = 'åŠ è½½ä¸­...'\n  } = options;\n\n  // æ˜¾ç¤ºåŠ è½½æç¤º\n  if (showLoading) {\n    Taro.showLoading({ title: loadingTitle, mask: true });\n  }\n\n  try {\n    const response = await Taro.request({\n      url: `${API_CONFIG.baseURL}${url}`,\n      method,\n      data,\n      header: {\n        'Content-Type': 'application/json',\n        ...header\n      },\n      timeout: API_CONFIG.timeout\n    });\n\n    // éšè—åŠ è½½æç¤º\n    if (showLoading) {\n      Taro.hideLoading();\n    }\n\n    // å¤„ç†å“åº”\n    const result = response.data as ApiResponse<T>;\n\n    // ä¸šåŠ¡é”™è¯¯å¤„ç†\n    if (result.code !== ERROR_CODES.SUCCESS) {\n      console.error(`APIä¸šåŠ¡é”™è¯¯: ${url}`, {\n        code: result.code,\n        message: result.message,\n        data: result\n      });\n\n      // å¤„ç†è®¤è¯ç›¸å…³é”™è¯¯\n      if (isAuthError(result.code)) {\n        // æ¸…é™¤æœ¬åœ°è®¤è¯ä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µ\n        console.warn('è®¤è¯è¿‡æœŸï¼Œè·³è½¬åˆ°ç™»å½•é¡µ');\n        Taro.removeStorageSync('userInfo');\n        Taro.removeStorageSync('userToken');\n        // TODO: å¯¼èˆªåˆ°ç™»å½•é¡µ (æ ¹æ®å®é™…åº”ç”¨æ¶æ„è°ƒæ•´)\n      }\n\n      const errorMessage = getErrorMessage(result.code, result.message);\n      const error: any = new Error(errorMessage);\n      error.code = result.code;\n      error.response = {\n        status: response.statusCode,\n        data: result\n      };\n      throw error;\n    }\n\n    return result;\n  } catch (error: any) {\n    // éšè—åŠ è½½æç¤º\n    if (showLoading) {\n      Taro.hideLoading();\n    }\n\n    // ç½‘ç»œé”™è¯¯å¤„ç†\n    console.error(`APIç½‘ç»œé”™è¯¯: ${url}`, error);\n\n    // æŠ›å‡ºé”™è¯¯ä¾›ä¸Šå±‚å¤„ç†\n    throw error;\n  }\n}\n\n/**\n * GETè¯·æ±‚\n */\nexport const get = <T = any>(url: string, params?: any, options?: RequestOptions) => {\n  // æ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²\n  const queryString = params ?\n    '?' + Object.keys(params)\n      .filter(key => params[key] !== undefined && params[key] !== null)\n      .map(key => `${key}=${encodeURIComponent(params[key])}`)\n      .join('&') : '';\n\n  return request<T>(url + queryString, { ...options, method: 'GET' });\n};\n\n/**\n * POSTè¯·æ±‚\n */\nexport const post = <T = any>(url: string, data?: any, options?: RequestOptions) => {\n  return request<T>(url, { ...options, method: 'POST', data });\n};\n\n/**\n * PUTè¯·æ±‚\n */\nexport const put = <T = any>(url: string, data?: any, options?: RequestOptions) => {\n  return request<T>(url, { ...options, method: 'PUT', data });\n};\n\n/**\n * DELETEè¯·æ±‚\n */\nexport const del = <T = any>(url: string, data?: any, options?: RequestOptions) => {\n  return request<T>(url, { ...options, method: 'DELETE', data });\n};","/**\n * èµ„æºé…ç½®æ–‡ä»¶ - é›†ä¸­ç®¡ç†é™æ€èµ„æºURL\n *\n * ç”¨é€”ï¼šé›†ä¸­é…ç½®æ‰€æœ‰é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€è§†é¢‘ç­‰ï¼‰çš„è®¿é—®åœ°å€\n * ä¼˜åŠ¿ï¼š\n * - åç»­æ¢CDNæˆ–æ”¹å›¾ç‰‡ï¼Œåªéœ€ä¿®æ”¹æ­¤æ–‡ä»¶\n * - æ”¯æŒç¯å¢ƒå˜é‡åˆ‡æ¢ï¼ˆç”Ÿäº§/å¼€å‘ï¼‰\n * - æ‰€æœ‰é¡µé¢å…±ç”¨ä¸€ä»½é…ç½®ï¼Œä¿æŒä¸€è‡´æ€§\n *\n * è¯´æ˜ï¼š\n * - ç¤¼å¡ã€å•†å“å›¾ç‰‡ï¼šç”±åç«¯æä¾›çš„é™æ€CDNè·¯å¾„\n * - æ¨æ‹¿å¸ˆå¤´åƒï¼šç”±APIè¿”å›çš„avatar_urlå­—æ®µï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºHTTPS\n * - é—¨åº—å›¾ç‰‡ï¼šç”±APIè¿”å›çš„imageså­—æ®µï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºHTTPS\n * - ç”¨æˆ·å¤´åƒï¼šç”±APIè¿”å›çš„avatarå­—æ®µï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºHTTPS\n */\n\nimport { normalizeImageUrl } from '@/utils/image'\n\n// åœ¨ WeChat å°ç¨‹åºä¸­ï¼Œä¸èƒ½ä½¿ç”¨ process.envï¼ˆç¼–è¯‘åä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ï¼‰\n// Taro ä¼šå°† TARO_APP_* ç¯å¢ƒå˜é‡é€šè¿‡ç¼–è¯‘æ—¶æ›¿æ¢å®ç°\n// é‡‡ç”¨ç¡¬ç¼–ç æ–¹æ¡ˆï¼Œä¿è¯å°ç¨‹åºå’ŒH5éƒ½èƒ½æ­£å¸¸è¿è¡Œ\nconst CDN_BASE = 'https://mingyitang1024.com/static';\n\nexport const ASSETS_CONFIG = {\n  // èµ„æºæœåŠ¡å™¨åŸºç¡€URL\n  baseUrl: CDN_BASE,\n\n  // ç¤¼å¡å›¾ç‰‡ - âœ… å·²åœ¨æœåŠ¡å™¨ä¸ŠéªŒè¯å­˜åœ¨ (200 OK)\n  giftCard: {\n    member: `${CDN_BASE}/card/member-card.png`,\n    electronic: `${CDN_BASE}/card/gift-card.png`\n  },\n\n  // å‘¨è¾¹å•†å“å›¾ç‰‡ - å·²åˆ é™¤ï¼ˆæš–è´´å’Œè‰¾æ¡é¡µé¢å·²ä¸‹çº¿ï¼‰\n  product: {},\n\n  // æ¨èbanner - âš ï¸ æš‚æ— \n  // ç”±åç«¯é€šè¿‡APIè¿”å›æˆ–ç”±é¡µé¢å¤„ç†\n  banners: {\n    goodnight: ''\n  },\n\n  // æ¨æ‹¿å¸ˆå¤´åƒ - âœ… å·²åœ¨æœåŠ¡å™¨ä¸ŠéªŒè¯å­˜åœ¨\n  // è·¯å¾„: /static/therapists/è€å¸ˆæ”¶é›†ä¸­æ–‡åŸç‰ˆ/{é—¨åº—å}/{è€å¸ˆå}.jpg\n  therapists: {\n    baseUrl: `${CDN_BASE}/therapists/è€å¸ˆæ”¶é›†ä¸­æ–‡åŸç‰ˆ`\n  },\n\n  // é»˜è®¤å›¾ç‰‡ - ç”¨äºç¼ºå¤±çš„å›¾ç‰‡URL\n  default: `${CDN_BASE}/default.png`\n};\n\n/**\n * ä¾¿æ·å‡½æ•°ï¼šè·å–èµ„æºURL\n * ä½¿ç”¨åœºæ™¯ï¼šå½“èµ„æºè·¯å¾„å­˜å‚¨åœ¨æ•°æ®åº“æ—¶ï¼Œç›´æ¥æ‹¼æ¥å®Œæ•´URL\n *\n * @param path èµ„æºç›¸å¯¹è·¯å¾„ï¼Œå¦‚ '/card/member-card.png'\n * @returns å®Œæ•´çš„èµ„æºURL\n */\nexport const getAssetUrl = (path: string | null | undefined): string => {\n  // å¦‚æœè·¯å¾„ä¸ºç©ºï¼Œè¿”å›é»˜è®¤å›¾ç‰‡\n  if (!path) {\n    return ASSETS_CONFIG.default;\n  }\n\n  // å¦‚æœå·²ç»æ˜¯å®Œæ•´URLï¼Œç›´æ¥è¿”å›\n  if (path.startsWith('http://') || path.startsWith('https://')) {\n    return path;\n  }\n\n  // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ‹¼æ¥åŸºç¡€URL\n  const cleanPath = path.startsWith('/') ? path : `/${path}`;\n  return `${CDN_BASE}${cleanPath}`;\n};\n","/**\n * ç”¨æˆ·ä¿¡æ¯ç»Ÿä¸€ç®¡ç†å·¥å…·\n * è§£å†³ç”¨æˆ·é‰´æƒä¸ä¸€è‡´é—®é¢˜\n */\nimport Taro from '@tarojs/taro'\nimport { get, post } from './request'\n\nexport interface UserInfo {\n  id: number\n  phone: string\n  nickname?: string\n  avatar?: string\n  openid?: string\n  username?: string\n  membershipNumber?: string\n  memberLevel?: string\n  balance?: number\n  totalSpent?: number\n  totalVisits?: number\n  discountRate?: number  // ç”¨æˆ·æŠ˜æ‰£ç‡ï¼Œå¦‚ 0.68 è¡¨ç¤º68æŠ˜\n}\n\n/**\n * è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯\n * ç»Ÿä¸€çš„ç”¨æˆ·ä¿¡æ¯è·å–å…¥å£\n */\nexport const getCurrentUserInfo = (): UserInfo | null => {\n  try {\n    const userInfo = Taro.getStorageSync('userInfo')\n    return userInfo || null\n  } catch (error) {\n    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\n    return null\n  }\n}\n\n/**\n * è·å–å½“å‰ç”¨æˆ·ID\n * æ‰€æœ‰æœåŠ¡ç»Ÿä¸€ä½¿ç”¨æ­¤æ–¹æ³•è·å–ç”¨æˆ·ID\n */\nexport const getCurrentUserId = (): number => {\n  const userInfo = getCurrentUserInfo()\n  return userInfo?.id || 1 // é»˜è®¤ç”¨æˆ·IDä¸º1ï¼ˆå¼€å‘ç¯å¢ƒï¼‰\n}\n\n/**\n * è·å–å½“å‰ç”¨æˆ·æ‰‹æœºå·\n * æ‰€æœ‰æœåŠ¡ç»Ÿä¸€ä½¿ç”¨æ­¤æ–¹æ³•è·å–æ‰‹æœºå·\n */\nexport const getCurrentUserPhone = (): string => {\n  const userInfo = getCurrentUserInfo()\n  return userInfo?.phone || '13800138000' // é»˜è®¤æ‰‹æœºå·ï¼ˆå¼€å‘ç¯å¢ƒï¼‰\n}\n\n/**\n * è®¾ç½®ç”¨æˆ·ä¿¡æ¯\n */\nexport const setUserInfo = (userInfo: UserInfo): void => {\n  try {\n    Taro.setStorageSync('userInfo', userInfo)\n  } catch (error) {\n    console.error('è®¾ç½®ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\n  }\n}\n\n/**\n * æ¸…é™¤ç”¨æˆ·ä¿¡æ¯\n */\nexport const clearUserInfo = (): void => {\n  try {\n    Taro.removeStorageSync('userInfo')\n  } catch (error) {\n    console.error('æ¸…é™¤ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\n  }\n}\n\n/**\n * æ‰‹æœºå·è„±æ•å¤„ç†\n */\nexport const maskPhone = (phone: string): string => {\n  if (!phone) return 'æœªè®¾ç½®'\n  return phone.replace(/(\\d{3})\\d{4}(\\d{4})/, '$1****$2')\n}\n\n/**\n * å¾®ä¿¡ç™»å½•\n */\nexport interface WechatLoginResult {\n  needBindPhone: boolean\n  openid: string\n  sessionKey: string\n  userInfo?: UserInfo\n  userStatus?: 'complete' | 'need_bind_phone' | 'need_register'\n}\n\nexport const wechatLogin = async (): Promise<WechatLoginResult> => {\n  try {\n    // 1. è·å–å¾®ä¿¡code\n    const { code } = await Taro.login()\n\n    // 2. è°ƒç”¨åç«¯å¾®ä¿¡ç™»å½•API\n    const response = await post('/users/wechat-login', { code })\n\n    if (response.data) {\n      // å¦‚æœæœ‰å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼Œä¿å­˜åˆ°æœ¬åœ°\n      if (response.data.userInfo && !response.data.needBindPhone) {\n        setUserInfo(response.data.userInfo)\n      }\n\n      return response.data\n    }\n\n    throw new Error('å¾®ä¿¡ç™»å½•å¤±è´¥ï¼šè¿”å›æ•°æ®å¼‚å¸¸')\n  } catch (error) {\n    console.error('å¾®ä¿¡ç™»å½•å¤±è´¥:', error)\n    throw error\n  }\n}\n\n/**\n * ç»‘å®šæ‰‹æœºå·ï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰\n */\nexport const bindPhone = async (openid: string, phone: string) => {\n  try {\n    const response = await post('/users/bind-phone', {\n      openid,\n      phone\n    })\n\n    if (response.data) {\n      // ç»‘å®šæˆåŠŸåï¼Œè·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯å¹¶ä¿å­˜\n      const userInfo = await fetchUserInfo(phone)\n      if (userInfo) {\n        setUserInfo(userInfo)\n      }\n      return response.data\n    }\n\n    throw new Error('æ‰‹æœºå·ç»‘å®šå¤±è´¥')\n  } catch (error: any) {\n    console.error('æ‰‹æœºå·ç»‘å®šå¤±è´¥:', error)\n\n    // å°è¯•æå–æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯\n    if (error?.response?.data?.error?.message) {\n      throw new Error(error.response.data.error.message)\n    } else if (error?.response?.status === 500) {\n      throw new Error('è¯¥æ‰‹æœºå·å·²è¢«å ç”¨')\n    } else if (error?.message) {\n      throw error\n    } else {\n      throw new Error('æ‰‹æœºå·ç»‘å®šå¤±è´¥ï¼Œè¯·é‡è¯•')\n    }\n  }\n}\n\n/**\n * ä½¿ç”¨å¾®ä¿¡æ‰‹æœºå·ç»„ä»¶ç»‘å®šæ‰‹æœºå·\n * @param openid å¾®ä¿¡openid\n * @param code å¾®ä¿¡æ‰‹æœºå·æˆæƒcode\n */\nexport const bindPhoneWx = async (openid: string, code: string) => {\n  try {\n    const response = await post('/users/bind-phone-wx', {\n      openid,\n      code\n    })\n\n    if (response.data) {\n      // ç»‘å®šæˆåŠŸåï¼Œè·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯å¹¶ä¿å­˜\n      if (response.data.phone) {\n        const userInfo = await fetchUserInfo(response.data.phone)\n        if (userInfo) {\n          setUserInfo(userInfo)\n        }\n      }\n      return response.data\n    }\n\n    throw new Error('æ‰‹æœºå·ç»‘å®šå¤±è´¥')\n  } catch (error: any) {\n    console.error('å¾®ä¿¡æ‰‹æœºå·ç»‘å®šå¤±è´¥:', error)\n\n    if (error?.response?.data?.error?.message) {\n      throw new Error(error.response.data.error.message)\n    } else if (error?.message) {\n      throw error\n    } else {\n      throw new Error('æ‰‹æœºå·ç»‘å®šå¤±è´¥ï¼Œè¯·é‡è¯•')\n    }\n  }\n}\n\n/**\n * ä½¿ç”¨å¾®ä¿¡æ‰‹æœºå·ç»„ä»¶æ¢ç»‘æ‰‹æœºå·\n * @param userId ç”¨æˆ·ID\n * @param oldPhone æ—§æ‰‹æœºå·\n * @param code å¾®ä¿¡æ‰‹æœºå·æˆæƒcode\n */\nexport const changePhoneWx = async (userId: number, oldPhone: string, code: string) => {\n  try {\n    const response = await post('/users/change-phone-wx', {\n      userId,\n      oldPhone,\n      code\n    })\n\n    if (response.data) {\n      // æ¢ç»‘æˆåŠŸåï¼Œæ›´æ–°æœ¬åœ°ç”¨æˆ·ä¿¡æ¯\n      if (response.data.phone) {\n        const userInfo = await fetchUserInfo(response.data.phone)\n        if (userInfo) {\n          setUserInfo(userInfo)\n        }\n      }\n      return response.data\n    }\n\n    throw new Error('æ‰‹æœºå·æ¢ç»‘å¤±è´¥')\n  } catch (error: any) {\n    console.error('å¾®ä¿¡æ‰‹æœºå·æ¢ç»‘å¤±è´¥:', error)\n\n    if (error?.response?.data?.error?.message) {\n      throw new Error(error.response.data.error.message)\n    } else if (error?.message) {\n      throw error\n    } else {\n      throw new Error('æ‰‹æœºå·æ¢ç»‘å¤±è´¥ï¼Œè¯·é‡è¯•')\n    }\n  }\n}\n\n/**\n * ä»APIè·å–ç”¨æˆ·ä¿¡æ¯\n */\nexport const fetchUserInfo = async (phone?: string): Promise<UserInfo | null> => {\n  try {\n    // å¦‚æœæ²¡æœ‰ä¼ æ‰‹æœºå·ï¼Œå°è¯•ä»æœ¬åœ°è·å–\n    if (!phone) {\n      const localUserInfo = getCurrentUserInfo()\n      phone = localUserInfo?.phone\n    }\n\n    if (!phone) {\n      console.warn('æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯ï¼šç¼ºå°‘æ‰‹æœºå·')\n      return null\n    }\n\n    const response = await get(`/users/info?phone=${phone}`)\n\n    if (response.data) {\n      const userInfo: UserInfo = {\n        id: response.data.id,\n        phone: response.data.phone,\n        username: response.data.username,\n        nickname: response.data.nickname,\n        avatar: response.data.avatar,\n        openid: response.data.openid,\n        membershipNumber: response.data.membershipNumber,\n        memberLevel: response.data.memberLevel,\n        balance: response.data.balance,\n        totalSpent: response.data.totalSpent,\n        totalVisits: response.data.totalVisits,\n        discountRate: response.data.discount_rate || response.data.discountRate\n      }\n\n      // ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜\n      setUserInfo(userInfo)\n      return userInfo\n    }\n\n    return null\n  } catch (error) {\n    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\n    return null\n  }\n}\n\n/**\n * è·å–ç”¨æˆ·IDï¼ˆä¸¥æ ¼æ¨¡å¼ - ç”¨äºæ”¯ä»˜ã€ä¸‹å•ç­‰å…³é”®æ“ä½œï¼‰\n * å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œè¿”å› nullï¼Œè°ƒç”¨æ–¹éœ€è¦å¤„ç†ç™»å½•è·³è½¬\n */\nexport const getCurrentUserIdStrict = (): number | null => {\n  const userInfo = getCurrentUserInfo()\n  if (!userInfo || !userInfo.id) {\n    return null\n  }\n  return userInfo.id\n}\n\n/**\n * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œå¦‚æœªç™»å½•åˆ™è·³è½¬ç™»å½•é¡µ\n */\nexport const requireLogin = async (): Promise<boolean> => {\n  const userInfo = getCurrentUserInfo()\n\n  if (!userInfo || !userInfo.phone) {\n    console.warn('âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•')\n    Taro.showToast({\n      title: 'è¯·å…ˆç™»å½•',\n      icon: 'none'\n    })\n\n    // è·³è½¬åˆ°ç™»å½•é¡µï¼ˆæˆ–å°ç¨‹åºé¦–å±ï¼‰\n    // æ ¹æ®ä½ çš„æ¶æ„è°ƒæ•´è¿™ä¸ªURL\n    setTimeout(() => {\n      Taro.redirectTo({\n        url: '/pages/mine/index'  // å‡è®¾ä»\"æˆ‘çš„\"é¡µé¢å¯ä»¥ç™»å½•\n      })\n    }, 1500)\n\n    return false\n  }\n\n  return true\n}\n\n/**\n * æ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶è‡ªåŠ¨ç™»å½•\n */\nexport const checkAndAutoLogin = async (): Promise<UserInfo | null> => {\n  try {\n    // 1. å…ˆæ£€æŸ¥æœ¬åœ°ç¼“å­˜\n    const localUserInfo = getCurrentUserInfo()\n    if (localUserInfo && localUserInfo.phone) {\n      // å°è¯•åˆ·æ–°ç”¨æˆ·ä¿¡æ¯\n      const freshUserInfo = await fetchUserInfo(localUserInfo.phone)\n      return freshUserInfo || localUserInfo\n    }\n\n    // 2. æœ¬åœ°æ²¡æœ‰ä¿¡æ¯ï¼Œå°è¯•å¾®ä¿¡ç™»å½•\n    const loginResult = await wechatLogin()\n\n    if (!loginResult.needBindPhone && loginResult.userInfo) {\n      // å·²æœ‰å®Œæ•´ç”¨æˆ·ä¿¡æ¯\n      return loginResult.userInfo\n    }\n\n    // 3. éœ€è¦ç»‘å®šæ‰‹æœºå·ï¼Œè¿”å›nullè®©é¡µé¢å¤„ç†\n    return null\n\n  } catch (error) {\n    console.error('è‡ªåŠ¨ç™»å½•å¤±è´¥:', error)\n    return null\n  }\n}\n\n/**\n * åˆå§‹åŒ–é»˜è®¤ç”¨æˆ·ä¿¡æ¯ï¼ˆå¼€å‘ç¯å¢ƒï¼‰\n * @deprecated å»ºè®®ä½¿ç”¨ checkAndAutoLogin æ›¿ä»£\n */\nexport const initDefaultUserInfo = (): void => {\n  const existingUserInfo = getCurrentUserInfo()\n  if (!existingUserInfo) {\n    console.warn('âš ï¸  ä½¿ç”¨å¼€å‘ç¯å¢ƒé»˜è®¤ç”¨æˆ·ä¿¡æ¯ï¼Œç”Ÿäº§ç¯å¢ƒè¯·è°ƒç”¨ checkAndAutoLogin')\n    const defaultUserInfo: UserInfo = {\n      id: 1,\n      phone: '13800138000',\n      nickname: 'æµ‹è¯•ç”¨æˆ·',\n      avatar: 'https://img.yzcdn.cn/vant/cat.jpeg'\n    }\n    setUserInfo(defaultUserInfo)\n    console.log('ğŸ”§ å·²åˆå§‹åŒ–é»˜è®¤ç”¨æˆ·ä¿¡æ¯:', defaultUserInfo)\n  }\n}","import {\n  GiftCard,\n  Product,\n  CreateOrderRequest,\n  OrderResponse\n} from '@/types'\nimport { post } from '@/utils/request'\nimport { ASSETS_CONFIG } from '@/config/assets'\nimport { getCurrentUserId, getCurrentUserIdStrict, getCurrentUserInfo } from '@/utils/user'\n\n// é™æ€ç¤¼å¡æ•°æ®ï¼ˆæ›¿ä»£mockï¼‰\nconst GIFT_CARDS: GiftCard[] = [\n  {\n    id: 'member-card',\n    type: 'member',\n    name: 'ä¼šå‘˜ç¤¼å¡',\n    image: ASSETS_CONFIG.giftCard.member,\n    description: 'å°Šäº«ä¼šå‘˜ä¸“å±ä¼˜æƒ ',\n    features: [\n      'å…¨é—¨åº—é€šç”¨',\n      'é•¿æœŸæœ‰æ•ˆ',\n      'å¯ç´¯è®¡ç§¯åˆ†',\n      'äº«å—ä¼šå‘˜ä»·'\n    ],\n    terms: 'æœ¬å¡ä¸ºä¸è®°åå¡ç‰‡ï¼Œè¯·å¦¥å–„ä¿ç®¡'\n  },\n  {\n    id: 'electronic-card',\n    type: 'electronic',\n    name: 'ç”µå­ç¤¼å¡',\n    image: ASSETS_CONFIG.giftCard.electronic,\n    description: 'ä¾¿æ·çš„ç”µå­ç¤¼å“å¡',\n    features: [\n      'å³ä¹°å³ç”¨',\n      'å¯è½¬èµ å¥½å‹',\n      'çº¿ä¸Šè´­ä¹°',\n      'æ‰«ç ä½¿ç”¨'\n    ],\n    terms: 'ç”µå­å¡æœ‰æ•ˆæœŸä¸ºè´­ä¹°ä¹‹æ—¥èµ·ä¸€å¹´å†…'\n  }\n]\n\n// æš–è´´äº§å“æ•°æ®\nconst NUANTIE_PRODUCTS: Product[] = [\n  {\n    id: 'nuantie-waist',\n    name: 'è•²è‰¾è…°è…¹æš–è´´',\n    image: 'https://mingyitang1024.com/static/gift/product/nuantie/yaofu.jpg',\n    price: 9900,      // Â¥99\n    originalPrice: 9900,\n    unit: 'è´´',\n    description: 'è‡ªå‘çƒ­è‰¾è‰æš–æŠ¤è…°è´´',\n    features: [],\n    specifications: {}\n  },\n  {\n    id: 'nuantie-knee',\n    name: 'è•²è‰¾æŠ¤è†æš–è´´',\n    image: 'https://mingyitang1024.com/static/gift/product/nuantie/huxi.jpg',\n    price: 9900,      // Â¥99\n    originalPrice: 9900,\n    unit: 'è´´',\n    description: 'è‡ªå‘çƒ­è‰¾è‰æŠ¤è† é©±å¯’ä¿æš–',\n    features: [],\n    specifications: {}\n  },\n  {\n    id: 'nuantie-moxa',\n    name: 'è•²è‰¾ç¸è´´',\n    image: 'https://mingyitang1024.com/static/gift/product/nuantie/xinai.jpg',\n    price: 9900,      // Â¥99\n    originalPrice: 9900,\n    unit: 'è´´',\n    description: 'è‡ªå‘çƒ­è‰¾è‰ç²¾æ²¹ç©´ä½ç¸è´´',\n    features: [],\n    specifications: {}\n  }\n]\n\n// è‰¾æ¡äº§å“æ•°æ®\nconst AIJIU_PRODUCTS: Product[] = [\n  {\n    id: 'aijiu-stick',\n    name: 'è•²è‰¾æ¡',\n    image: 'https://mingyitang1024.com/static/gift/product/aijiu/xinaitiao.jpg',\n    price: 9900,      // Â¥99\n    originalPrice: 9900,\n    unit: 'æ¡',\n    description: 'è‰¾ç¸è‰¾æ¡ 3å¹´é™ˆè‰¾',\n    features: [],\n    specifications: {}\n  },\n  {\n    id: 'aijiu-moxa-ball',\n    name: 'è•²è‰¾é¥¼',\n    image: 'https://mingyitang1024.com/static/gift/product/aijiu/xinaibing.jpg',\n    price: 9900,      // Â¥99\n    originalPrice: 9900,\n    unit: 'é¥¼',\n    description: 'é“åœ°è•²è‰¾æ³¡è„šæ³¡æ¾¡è‰¾è‰é¥¼',\n    features: [],\n    specifications: {}\n  },\n  {\n    id: 'aijiu-column',\n    name: 'æ–°è‰¾æŸ±',\n    image: 'https://mingyitang1024.com/static/gift/product/aijiu/xinaizhu.jpg',\n    price: 9900,      // Â¥99\n    originalPrice: 9900,\n    unit: 'æŸ±',\n    description: 'ææ—¶çæ•…é‡Œç‰¹äº§æ–°è‰¾æŸ±',\n    features: [],\n    specifications: {}\n  }\n]\n\n// é™æ€å•†å“æ•°æ®ï¼ˆæ›¿ä»£mockï¼‰\n// âœ… æ³¨æ„ï¼šprice å’Œ originalPrice ä½¿ç”¨æ•´æ•°åˆ†ä¸ºå•ä½ï¼Œä¸ä½¿ç”¨å°æ•°\n// ä¾‹å¦‚: 299.00å…ƒ = 29900åˆ†ï¼Œ19900åˆ† = 199å…ƒ\nconst PRODUCTS: Product[] = [\n  ...NUANTIE_PRODUCTS,\n  ...AIJIU_PRODUCTS\n]\n\n\n/**\n * ç¤¼å¡æœåŠ¡\n */\nexport class GiftService {\n  /**\n   * è·å–æ‰€æœ‰ç¤¼å¡\n   */\n  static getAllGiftCards(): GiftCard[] {\n    return GIFT_CARDS\n  }\n\n  /**\n   * æ ¹æ®IDè·å–ç¤¼å¡è¯¦æƒ…\n   */\n  static getGiftCardById(id: string): GiftCard | undefined {\n    return GIFT_CARDS.find(card => card.id === id)\n  }\n\n  /**\n   * è·å–æ‰€æœ‰å•†å“\n   */\n  static getAllProducts(): Product[] {\n    return PRODUCTS\n  }\n\n  /**\n   * æ ¹æ®IDè·å–å•†å“è¯¦æƒ…\n   */\n  static getProductById(id: string): Product | undefined {\n    return PRODUCTS.find(product => product.id === id)\n  }\n\n  /**\n   * è·å–æš–è´´äº§å“åˆ—è¡¨\n   */\n  static getNuantieProducts(): Product[] {\n    return NUANTIE_PRODUCTS\n  }\n\n  /**\n   * è·å–è‰¾æ¡äº§å“åˆ—è¡¨\n   */\n  static getAijiuProducts(): Product[] {\n    return AIJIU_PRODUCTS\n  }\n\n  /**\n   * åˆ›å»ºç¤¼å¡è´­ä¹°è®¢å•\n   * @param params.cardId ç¤¼å¡ID\n   * @param params.amount ç¤¼å¡é¢å€¼ï¼ˆåˆ†ä¸ºå•ä½ï¼‰\n   */\n  static async createGiftCardOrder(params: {\n    cardId: string                      // âœ… æ–°å¢ï¼šç¤¼å¡ID\n    amount: number      // âœ… åˆ†ä¸ºå•ä½\n    quantity: number\n    paymentMethod: 'wechat' | 'balance'\n    customMessage?: string\n  }): Promise<OrderResponse> {\n    try {\n      // âœ… ä¸¥æ ¼æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆå‚è€ƒé¢„çº¦è®¢å•ï¼‰\n      const strictUserId = getCurrentUserIdStrict()\n      if (!strictUserId) {\n        throw new Error('è¯·å…ˆç™»å½•åå†è´­ä¹°ç¤¼å¡')\n      }\n\n      // âœ… å¦‚æœæ˜¯å¾®ä¿¡æ”¯ä»˜ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰openid\n      if (params.paymentMethod === 'wechat') {\n        const userInfo = getCurrentUserInfo()\n        if (!userInfo?.openid) {\n          throw new Error('å¾®ä¿¡æ”¯ä»˜éœ€è¦å…ˆå®Œæˆå¾®ä¿¡ç™»å½•æˆæƒï¼Œè¯·å‰å¾€\"æˆ‘çš„\"é¡µé¢ç™»å½•')\n        }\n      }\n\n      const userId = getCurrentUserId()\n      const orderData: CreateOrderRequest = {\n        orderType: 'product',\n        userId: userId,\n        title: `ç”µå­ç¤¼å¡ Â¥${(params.amount / 100).toFixed(2)}`,\n        amount: params.amount * params.quantity,  // âœ… ç›´æ¥ç›¸ä¹˜ï¼Œç»“æœæ˜¯åˆ†\n        paymentMethod: params.paymentMethod,\n        extraData: {\n          productType: 'gift_card',\n          productId: params.cardId,           // âœ… æŒ‰APIæ–‡æ¡£ä½¿ç”¨ productId\n          productName: 'ç”µå­ç¤¼å¡',             // âœ… æ–°å¢ï¼šå•†å“åç§°ï¼ˆAPIæ–‡æ¡£å¿…éœ€ï¼‰\n          quantity: params.quantity,\n          cardType: 'electronic',\n          faceValue: params.amount,           // âœ… ä¿æŒåˆ†ä¸ºå•ä½\n          customMessage: params.customMessage || 'ä¸–ç•Œä¸Šæœ€å¥½çš„çˆ¸çˆ¸'\n        }\n      }\n\n      // ğŸ è°ƒè¯•æ—¥å¿—\n      console.log('ğŸ åˆ›å»ºç¤¼å¡è®¢å•')\n      console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·ID:', userId)\n      console.log('ğŸ“¦ è®¢å•æ•°æ®:', {\n        orderType: orderData.orderType,\n        userId: orderData.userId,\n        title: orderData.title,\n        amount: `${orderData.amount}åˆ† (Â¥${(orderData.amount / 100).toFixed(2)})`,\n        paymentMethod: orderData.paymentMethod,\n        extraData: orderData.extraData\n      })\n\n      const response = await post('/orders/create', orderData, {\n        showLoading: true,\n        loadingTitle: 'åˆ›å»ºè®¢å•ä¸­...'\n      })\n\n      console.log('âœ… ç¤¼å¡è®¢å•åˆ›å»ºæˆåŠŸ')\n      console.log('ğŸ“‹ è®¢å•å“åº”:', {\n        orderNo: response.data.orderNo,\n        amount: `${response.data.amount}åˆ† (Â¥${(response.data.amount / 100).toFixed(2)})`,\n        paymentStatus: response.data.paymentStatus,\n        hasWxPayParams: !!response.data.wxPayParams\n      })\n\n      return response.data\n    } catch (error: any) {\n      console.error('âŒ åˆ›å»ºç¤¼å¡è®¢å•å¤±è´¥:', error)\n\n      // âœ… æå–å®Œæ•´çš„é”™è¯¯ä¿¡æ¯\n      const errorCode = error?.code || error?.response?.data?.code\n      const errorMessage = error?.response?.data?.message\n        || error?.message\n        || 'åˆ›å»ºç¤¼å¡è®¢å•å¤±è´¥'\n\n      // âœ… è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•\n      console.error('ğŸ“‹ é”™è¯¯è¯¦æƒ…:', {\n        code: errorCode,\n        message: errorMessage,\n        responseData: error?.response?.data,\n        fullError: error\n      })\n\n      // âœ… é’ˆå¯¹ç‰¹å®šé”™è¯¯ç æä¾›æ›´å‹å¥½çš„æç¤º\n      if (errorCode === 1003) {\n        if (errorMessage.includes('openid')) {\n          throw new Error('å¾®ä¿¡æ”¯ä»˜æˆæƒå¤±è´¥ï¼Œè¯·å‰å¾€\"æˆ‘çš„\"é¡µé¢é‡æ–°ç™»å½•')\n        }\n      }\n\n      if (errorCode === 1007) {\n        throw new Error('ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆå……å€¼')\n      }\n\n      throw new Error(errorMessage)\n    }\n  }\n\n  /**\n   * åˆ›å»ºå•†å“è´­ä¹°è®¢å•\n   */\n  static async createProductOrder(params: {\n    productId: string\n    quantity: number\n    paymentMethod: 'wechat' | 'balance'\n  }): Promise<OrderResponse> {\n    try {\n      // âœ… ä¸¥æ ¼æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆå‚è€ƒé¢„çº¦è®¢å•ï¼‰\n      const strictUserId = getCurrentUserIdStrict()\n      if (!strictUserId) {\n        throw new Error('è¯·å…ˆç™»å½•åå†è´­ä¹°å•†å“')\n      }\n\n      // âœ… å¦‚æœæ˜¯å¾®ä¿¡æ”¯ä»˜ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰openid\n      if (params.paymentMethod === 'wechat') {\n        const userInfo = getCurrentUserInfo()\n        if (!userInfo?.openid) {\n          throw new Error('å¾®ä¿¡æ”¯ä»˜éœ€è¦å…ˆå®Œæˆå¾®ä¿¡ç™»å½•æˆæƒï¼Œè¯·å‰å¾€\"æˆ‘çš„\"é¡µé¢ç™»å½•')\n        }\n      }\n\n      const product = this.getProductById(params.productId)\n      if (!product) {\n        throw new Error('å•†å“ä¸å­˜åœ¨')\n      }\n\n      const orderData: CreateOrderRequest = {\n        orderType: 'product',\n        userId: getCurrentUserId(),\n        title: product.name,\n        amount: product.price * params.quantity,  // âœ… ç›´æ¥ç›¸ä¹˜ï¼Œç»“æœæ˜¯åˆ†ï¼ˆproduct.priceå·²æ˜¯åˆ†ä¸ºå•ä½ï¼‰\n        paymentMethod: params.paymentMethod,\n        extraData: {\n          productType: 'merchandise',\n          productId: params.productId,\n          productName: product.name,              // âœ… æ–°å¢ï¼šå•†å“åç§°ï¼ˆAPIæ–‡æ¡£å¿…éœ€ï¼‰\n          quantity: params.quantity,\n          specifications: product.specifications\n        }\n      }\n\n      // ğŸ è°ƒè¯•æ—¥å¿—\n      console.log('ğŸ“¦ åˆ›å»ºå•†å“è®¢å•')\n      console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·ID:', getCurrentUserId())\n      console.log('ğŸ“‹ è®¢å•æ•°æ®:', {\n        orderType: orderData.orderType,\n        userId: orderData.userId,\n        title: orderData.title,\n        amount: `${orderData.amount}åˆ† (Â¥${(orderData.amount / 100).toFixed(2)})`,\n        paymentMethod: orderData.paymentMethod,\n        extraData: orderData.extraData\n      })\n\n      const response = await post('/orders/create', orderData, {\n        showLoading: true,\n        loadingTitle: 'åˆ›å»ºè®¢å•ä¸­...'\n      })\n\n      console.log('âœ… å•†å“è®¢å•åˆ›å»ºæˆåŠŸ')\n      console.log('ğŸ“‹ è®¢å•å“åº”:', {\n        orderNo: response.data.orderNo,\n        amount: `${response.data.amount}åˆ† (Â¥${(response.data.amount / 100).toFixed(2)})`,\n        paymentStatus: response.data.paymentStatus,\n        hasWxPayParams: !!response.data.wxPayParams\n      })\n\n      return response.data\n    } catch (error: any) {\n      console.error('âŒ åˆ›å»ºå•†å“è®¢å•å¤±è´¥:', error)\n\n      // âœ… æå–å®Œæ•´çš„é”™è¯¯ä¿¡æ¯\n      const errorCode = error?.code || error?.response?.data?.code\n      const errorMessage = error?.response?.data?.message\n        || error?.message\n        || 'åˆ›å»ºå•†å“è®¢å•å¤±è´¥'\n\n      // âœ… è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•\n      console.error('ğŸ“‹ é”™è¯¯è¯¦æƒ…:', {\n        code: errorCode,\n        message: errorMessage,\n        responseData: error?.response?.data,\n        fullError: error\n      })\n\n      // âœ… é’ˆå¯¹ç‰¹å®šé”™è¯¯ç æä¾›æ›´å‹å¥½çš„æç¤º\n      if (errorCode === 1003) {\n        if (errorMessage.includes('openid')) {\n          throw new Error('å¾®ä¿¡æ”¯ä»˜æˆæƒå¤±è´¥ï¼Œè¯·å‰å¾€\"æˆ‘çš„\"é¡µé¢é‡æ–°ç™»å½•')\n        }\n      }\n\n      if (errorCode === 1007) {\n        throw new Error('ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆå……å€¼')\n      }\n\n      throw new Error(errorMessage)\n    }\n  }\n\n}","/**\n * å›¾ç‰‡URLå¤„ç†å·¥å…·\n *\n * ç”¨é€”ï¼š\n * 1. å°†HTTP URLè½¬æ¢ä¸ºHTTPSï¼ˆWeChatè¦æ±‚ï¼‰\n * 2. å¤„ç†ç¼ºå¤±æˆ–æ— æ•ˆçš„å›¾ç‰‡URL\n * 3. æä¾›å¤‡ç”¨å›¾ç‰‡æ–¹æ¡ˆ\n */\n\n/**\n * è½¬æ¢å›¾ç‰‡URLä¸ºHTTPS\n * @param url å›¾ç‰‡URL - å¯èƒ½ä¸º undefined/null\n * @returns HTTPSæ ¼å¼çš„URLï¼Œæˆ– undefined å¦‚æœè¾“å…¥æ— æ•ˆ\n *\n * ğŸš€ æ”¹è¿›ï¼šä¸å¯¹ undefined/null è¿”å›é»˜è®¤å€¼\n * è¿™æ ·è°ƒç”¨æ–¹å¯ä»¥åŒºåˆ†\"æ— å€¼\"å’Œ\"æœ‰å€¼\"çš„æƒ…å†µ\n */\nexport const normalizeImageUrl = (url: string | undefined | null): string | undefined => {\n  // ğŸš€ æ”¹è¿›ï¼šè¿”å› undefined è€Œä¸æ˜¯é»˜è®¤å€¼\n  // è¿™æ ·åç»­é€»è¾‘å¯ä»¥é€šè¿‡ !url æ¥æ­£ç¡®åˆ¤æ–­æ˜¯å¦éœ€è¦è·å–çœŸå®æ•°æ®\n  if (!url) {\n    return undefined;\n  }\n\n  // å·²ç»æ˜¯HTTPSï¼Œç›´æ¥è¿”å›\n  if (url.startsWith('https://')) {\n    return url;\n  }\n\n  // HTTPè½¬HTTPS\n  if (url.startsWith('http://')) {\n    return url.replace('http://', 'https://');\n  }\n\n  // ç›¸å¯¹è·¯å¾„ï¼ŒåŠ ä¸ŠHTTPSå‰ç¼€\n  if (url.startsWith('/')) {\n    return `https://mingyitang1024.com${url}`;\n  }\n\n  // å…¶ä»–æƒ…å†µï¼Œå½“ä½œç›¸å¯¹è·¯å¾„å¤„ç†\n  return `https://mingyitang1024.com/static${url.startsWith('/') ? url : '/' + url}`;\n};\n\n/**\n * è·å–é»˜è®¤å›¾ç‰‡\n */\nexport const getDefaultImage = (): string => {\n  return 'https://mingyitang1024.com/static/default.png';\n};\n\n/**\n * éªŒè¯å›¾ç‰‡URLæ˜¯å¦æœ‰æ•ˆ\n * æ³¨ï¼šåœ¨å°ç¨‹åºä¸­ï¼Œæœ€å¥½åœ¨æœåŠ¡å±‚å¤„ç†ï¼Œè€Œä¸æ˜¯åœ¨æ¸²æŸ“æ—¶\n */\nexport const isValidImageUrl = (url: string): boolean => {\n  return !!(url && (url.startsWith('https://') || url.startsWith('http://') || url.startsWith('/')));\n};\n\n/**\n * å›¾ç‰‡URLå¤„ç†å·¥å…·ç±»\n * é€‚ç”¨äºä»APIè¿”å›çš„åŠ¨æ€å›¾ç‰‡URL\n */\nexport class ImageUrlHelper {\n  /**\n   * å¤„ç†æ¨æ‹¿å¸ˆå¤´åƒ\n   * @param avatarUrl APIè¿”å›çš„å¤´åƒURLï¼ˆå¯èƒ½æ˜¯HTTPï¼‰\n   * @returns HTTPSæ ¼å¼çš„URLï¼Œæˆ– undefined å¦‚æœè¾“å…¥æ— æ•ˆ\n   */\n  static normalizeTherapistAvatar(avatarUrl: string | undefined): string | undefined {\n    return normalizeImageUrl(avatarUrl);\n  }\n\n  /**\n   * å¤„ç†é—¨åº—å›¾ç‰‡\n   * @param imageUrl APIè¿”å›çš„é—¨åº—å›¾ç‰‡URL\n   * @returns HTTPSæ ¼å¼çš„URLï¼Œæˆ– undefined å¦‚æœè¾“å…¥æ— æ•ˆ\n   */\n  static normalizeStoreImage(imageUrl: string | undefined): string | undefined {\n    return normalizeImageUrl(imageUrl);\n  }\n\n  /**\n   * å¤„ç†ç”¨æˆ·å¤´åƒ\n   * @param avatarUrl APIè¿”å›çš„ç”¨æˆ·å¤´åƒ\n   * @returns HTTPSæ ¼å¼çš„URLï¼Œæˆ– undefined å¦‚æœè¾“å…¥æ— æ•ˆ\n   */\n  static normalizeUserAvatar(avatarUrl: string | undefined): string | undefined {\n    return normalizeImageUrl(avatarUrl);\n  }\n}\n","import { request } from '@/utils/request'\nimport type { Store, PageData } from '@/types'\nimport { normalizeImageUrl } from '@/utils/image'\n\nclass StoreService {\n  // è·å–é™„è¿‘é—¨åº—\n  async getNearbyStores(\n    latitude: number,\n    longitude: number,\n    page: number = 1,\n    pageSize: number = 10\n  ): Promise<PageData<Store>> {\n    try {\n      const data = await request('/stores/nearby', {\n        data: { latitude, longitude, page, pageSize }\n      })\n\n      console.log('âœ… é—¨åº—åˆ—è¡¨APIè°ƒç”¨æˆåŠŸ:', data)\n\n      // è§„èŒƒåŒ–å›¾ç‰‡URLï¼ˆHTTPâ†’HTTPSï¼‰\n      const normalizedStores = data.data.list.map((store: Store) => ({\n        ...store,\n        image: normalizeImageUrl(store.image),\n        images: store.images?.map(img => normalizeImageUrl(img))\n      }))\n\n      return {\n        ...data.data,\n        list: normalizedStores\n      }\n    } catch (error) {\n      // âš ï¸ é”™è¯¯ç›´æ¥æŠ›å‡ºï¼Œè®©è°ƒç”¨æ–¹å¤„ç†\n      console.error('âŒ é—¨åº—åˆ—è¡¨APIè°ƒç”¨å¤±è´¥:', error)\n      throw error\n    }\n  }\n  \n  // è·å–é—¨åº—è¯¦æƒ…\n  async getStoreDetail(storeId: string) {\n    try {\n      const data = await request(`/stores/${storeId}`)\n      console.log('âœ… é—¨åº—è¯¦æƒ…APIè°ƒç”¨æˆåŠŸ:', data)\n\n      // è§„èŒƒåŒ–å›¾ç‰‡URLï¼ˆHTTPâ†’HTTPSï¼‰\n      if (data?.data) {\n        return {\n          ...data,\n          data: {\n            ...data.data,\n            image: normalizeImageUrl(data.data.image),\n            images: data.data.images?.map((img: string) => normalizeImageUrl(img))\n          }\n        }\n      }\n      return data\n    } catch (error) {\n      console.log('âš ï¸ é—¨åº—è¯¦æƒ…APIè°ƒç”¨å¤±è´¥:', error)\n      return null\n    }\n  }\n  \n  // æœç´¢é—¨åº—\n  async searchStores(keyword: string, page: number = 1, pageSize: number = 10): Promise<PageData<Store>> {\n    try {\n      const data = await request('/stores/search', {\n        data: { keyword, page, pageSize }\n      })\n\n      console.log('âœ… é—¨åº—æœç´¢APIè°ƒç”¨æˆåŠŸ:', data)\n      return data.data || { list: [], total: 0, page: 1, pageSize: 10, hasMore: false }\n    } catch (error) {\n      console.log('âš ï¸ é—¨åº—æœç´¢APIè°ƒç”¨å¤±è´¥:', error)\n      return { list: [], total: 0, page: 1, pageSize: 10, hasMore: false }\n    }\n  }\n\n  // æ ¹æ®çŠ¶æ€ç­›é€‰é—¨åº—\n  async getStoresByStatus(\n    status: Store['status'],\n    page: number = 1,\n    pageSize: number = 10\n  ): Promise<PageData<Store>> {\n    try {\n      const data = await request('/stores/filter', {\n        data: { status, page, pageSize }\n      })\n\n      console.log('âœ… é—¨åº—ç­›é€‰APIè°ƒç”¨æˆåŠŸ:', data)\n      return data.data || { list: [], total: 0, page: 1, pageSize: 10, hasMore: false }\n    } catch (error) {\n      console.log('âš ï¸ é—¨åº—ç­›é€‰APIè°ƒç”¨å¤±è´¥:', error)\n      return { list: [], total: 0, page: 1, pageSize: 10, hasMore: false }\n    }\n  }\n}\n\nexport const storeService = new StoreService()","import Taro from '@tarojs/taro'\n\nexport interface Location {\n  latitude: number\n  longitude: number\n}\n\nclass LocationService {\n  // è·å–ç”¨æˆ·å½“å‰ä½ç½®\n  async getCurrentLocation(): Promise<Location> {\n    try {\n      // æ£€æŸ¥æˆæƒçŠ¶æ€\n      const settingRes = await Taro.getSetting()\n      const authSetting = settingRes?.authSetting || {}\n\n      if (!authSetting['scope.userLocation']) {\n        // è¯·æ±‚æˆæƒ\n        await Taro.authorize({\n          scope: 'scope.userLocation'\n        })\n      }\n      \n      // è·å–ä½ç½®ï¼Œå…ˆå°è¯•gcj02ï¼Œå¤±è´¥åˆ™é™çº§åˆ°wgs84\n      let res\n      try {\n        res = await Taro.getLocation({\n          type: 'gcj02', // å›½å†…ç«æ˜Ÿåæ ‡ç³»\n          isHighAccuracy: true\n        })\n      } catch (gcj02Error) {\n        console.warn('gcj02åæ ‡ç³»ä¸æ”¯æŒï¼Œå°è¯•wgs84:', gcj02Error)\n        // é™çº§åˆ°wgs84åæ ‡ç³»\n        res = await Taro.getLocation({\n          type: 'wgs84' // GPSåŸå§‹åæ ‡ç³»\n        })\n      }\n\n      return {\n        latitude: res.latitude,\n        longitude: res.longitude\n      }\n    } catch (error) {\n      console.error('è·å–ä½ç½®å¤±è´¥:', error)\n\n      // å¦‚æœç”¨æˆ·æ‹’ç»æˆæƒæˆ–å…¶ä»–é”™è¯¯ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®ï¼ˆä¸Šæµ·å¸‚ä¸­å¿ƒï¼‰\n      const errorMsg = (error as any)?.errMsg || ''\n\n      // åªåœ¨ç”¨æˆ·æ˜ç¡®æ‹’ç»æˆæƒæ—¶æ‰æ˜¾ç¤ºå¼¹çª—\n      if (errorMsg.includes('auth deny') || errorMsg.includes('authorize:fail')) {\n        Taro.showModal({\n          title: 'æç¤º',\n          content: 'éœ€è¦è·å–æ‚¨çš„ä½ç½®ä¿¡æ¯æ¥æ¨èé™„è¿‘é—¨åº—',\n          confirmText: 'å»è®¾ç½®',\n          success: (res) => {\n            if (res.confirm) {\n              Taro.openSetting()\n            }\n          }\n        })\n      }\n\n      // æ— è®ºä»€ä¹ˆé”™è¯¯ï¼Œéƒ½è¿”å›é»˜è®¤ä½ç½®ï¼ˆä¸Šæµ·å¸‚ä¸­å¿ƒï¼‰\n      console.log('ä½¿ç”¨é»˜è®¤ä½ç½®ï¼šä¸Šæµ·å¸‚ä¸­å¿ƒ')\n      return {\n        latitude: 31.2304,\n        longitude: 121.4737\n      }\n    }\n  }\n  \n  // è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆå•ä½ï¼šå…¬é‡Œï¼‰\n  calculateDistance(\n    lat1: number,\n    lng1: number,\n    lat2: number,\n    lng2: number\n  ): number {\n    const rad = Math.PI / 180\n    const R = 6371 // åœ°çƒåŠå¾„ï¼ˆå…¬é‡Œï¼‰\n    \n    const dLat = (lat2 - lat1) * rad\n    const dLng = (lng2 - lng1) * rad\n    \n    const a = \n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(lat1 * rad) * Math.cos(lat2 * rad) *\n      Math.sin(dLng / 2) * Math.sin(dLng / 2)\n      \n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n    \n    return Number((R * c).toFixed(1))\n  }\n  \n  // æ ¼å¼åŒ–è·ç¦»æ˜¾ç¤º\n  formatDistance(distance: number): string {\n    if (distance < 1) {\n      return `${Math.round(distance * 1000)}m`\n    }\n    return `${distance}km`\n  }\n}\n\nexport const getLocationService = new LocationService()","import React, { useState, useEffect, useRef } from 'react'\nimport { View, Text, Image } from '@tarojs/components'\nimport Taro from '@tarojs/taro'\nimport './index.scss'\n\ninterface CartItem {\n  id?: string  // å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¯é€‰ï¼Œå‘åå…¼å®¹ï¼‰\n  serviceId: string\n  serviceName: string\n  duration: number\n  price: number\n  discountPrice?: number\n  date: string\n  time: string\n  therapistId?: string\n  therapistName: string\n  therapistAvatar?: string\n}\n\ninterface ShoppingCartProps {\n  items: CartItem[]\n  therapist?: any\n  onCheckout: () => void\n  onMaskClick?: () => void\n  onRemoveItem?: (index: number) => void\n}\n\nconst ShoppingCart: React.FC<ShoppingCartProps> = ({\n  items,\n  therapist,\n  onCheckout,\n  onMaskClick,\n  onRemoveItem\n}) => {\n  const [isExpanded, setIsExpanded] = useState(false)\n  const [countdown, setCountdown] = useState(180) // 3åˆ†é’Ÿ = 180ç§’\n  const timerRef = useRef<any>(null)\n\n  // è®¡ç®—æ€»ä»·\n  const totalOriginalPrice = items.reduce((sum, item) => sum + item.price, 0)\n  const totalDiscountPrice = items.reduce((sum, item) => sum + (item.discountPrice || item.price), 0)\n  const totalSavings = totalOriginalPrice - totalDiscountPrice\n  const hasItems = items.length > 0\n\n  // å€’è®¡æ—¶é€»è¾‘\n  useEffect(() => {\n    if (hasItems && isExpanded) {\n      timerRef.current = setInterval(() => {\n        setCountdown((prev) => {\n          if (prev <= 1) {\n            clearInterval(timerRef.current)\n            // æ—¶é—´åˆ°ï¼Œå¯ä»¥è§¦å‘é‡ç½®é€»è¾‘\n            Taro.showToast({\n              title: 'æ”¯ä»˜è¶…æ—¶äº†å‘¦ï¼Œå¿«å¿«é‡æ–°ä¸‹å•å§~',\n              icon: 'none'\n            })\n            setIsExpanded(false)\n            return 180\n          }\n          return prev - 1\n        })\n      }, 1000)\n    } else {\n      if (timerRef.current) {\n        clearInterval(timerRef.current)\n      }\n    }\n\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current)\n      }\n    }\n  }, [hasItems, isExpanded])\n\n  // æ ¼å¼åŒ–å€’è®¡æ—¶æ˜¾ç¤º\n  const formatCountdown = (seconds: number) => {\n    const mins = Math.floor(seconds / 60)\n    const secs = seconds % 60\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n  }\n\n  // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr)\n    const today = new Date()\n    const isToday = date.toDateString() === today.toDateString()\n    \n    if (isToday) {\n      return 'ä»Šå¤©'\n    }\n    \n    const month = date.getMonth() + 1\n    const day = date.getDate()\n    return `${month}æœˆ${day}æ—¥`\n  }\n\n  const handleCheckoutClick = () => {\n    if (!hasItems) {\n      Taro.showToast({\n        title: 'è¯·å…ˆé€‰æ‹©æœåŠ¡',\n        icon: 'none'\n      })\n      return\n    }\n    \n    setIsExpanded(true)\n  }\n\n  const handleMaskClick = () => {\n    // ç‚¹å‡»é®ç½©ï¼šæ¸…ç©ºè´­ç‰©è½¦å¹¶å…³é—­å¼¹çª—\n    if (onMaskClick) {\n      onMaskClick()\n    }\n    setIsExpanded(false)\n  }\n\n  const handleConfirmCheckout = () => {\n    onCheckout()\n  }\n\n  return (\n    <>\n      {/* åŠé€æ˜é®ç½© */}\n      {isExpanded && (\n        <View className=\"cart-mask\" onClick={handleMaskClick} />\n      )}\n\n      {/* åº•éƒ¨å›ºå®šæ  */}\n      <View className=\"shopping-cart\">\n        <View className=\"cart-bar\">\n          <View className=\"cart-info\">\n            {hasItems ? (\n              <>\n                <Text className=\"total-price\">Â¥{totalDiscountPrice}</Text>\n                {totalSavings > 0 && (\n                  <Text className=\"savings\">å·²ä¼˜æƒ Â¥{totalSavings}</Text>\n                )}\n              </>\n            ) : (\n              <Text className=\"empty-text\">è¯·é€‰æ‹©æœåŠ¡é¡¹ç›®</Text>\n            )}\n          </View>\n          \n          <View \n            className={`checkout-btn ${!hasItems ? 'disabled' : ''}`} \n            onClick={handleCheckoutClick}\n          >\n            å»ç»“ç®—\n          </View>\n        </View>\n      </View>\n\n      {/* å±•å¼€çš„è´­ç‰©è½¦è¯¦æƒ… */}\n      {isExpanded && (\n        <View className=\"cart-expanded\">\n          <View className=\"expanded-header\">\n            <Text className=\"title\">é¢„çº¦è¯¦æƒ…</Text>\n          </View>\n\n          {/* æœåŠ¡è¯¦æƒ… */}\n          <View className=\"service-list\">\n            {items.map((item, index) => (\n              <View key={index} className=\"service-item\">\n                <Image\n                  className=\"therapist-avatar\"\n                  src={item.therapistAvatar || therapist?.avatar || ''}\n                />\n                <View className=\"service-info\">\n                  <View className=\"info-header\">\n                    <Text className=\"therapist-name\">{item.therapistName}</Text>\n                    <Text className=\"duration\">{item.duration}åˆ†é’Ÿ</Text>\n                  </View>\n                  <View className=\"info-detail\">\n                    <Text className=\"service-name\">{item.serviceName}</Text>\n                  </View>\n                  <View className=\"info-time\">\n                    <Text className=\"time-text\">\n                      {formatDate(item.date)} {item.time} è‡³ {\n                        // è®¡ç®—ç»“æŸæ—¶é—´\n                        (() => {\n                          const [hour, minute] = item.time.split(':').map(Number)\n                          const endMinute = minute + item.duration\n                          const endHour = hour + Math.floor(endMinute / 60)\n                          const finalMinute = endMinute % 60\n                          return `${endHour}:${finalMinute.toString().padStart(2, '0')}`\n                        })()\n                      }\n                    </Text>\n                  </View>\n                </View>\n                <View className=\"item-actions\">\n                  <View className=\"price-info\">\n                    <Text className=\"price\">Â¥{item.discountPrice || item.price}</Text>\n                  </View>\n                  {onRemoveItem && (\n                    <View\n                      className=\"remove-btn\"\n                      onClick={() => onRemoveItem(index)}\n                    >\n                      âœ•\n                    </View>\n                  )}\n                </View>\n              </View>\n            ))}\n          </View>\n\n          {/* åº•éƒ¨ç»“ç®—ä¿¡æ¯ */}\n          <View className=\"checkout-section\">\n            <View className=\"price-summary\">\n              <View className=\"cart-icon\">\n                <Text className=\"icon\">ğŸ›’</Text>\n                <View className=\"badge\">1</View>\n              </View>\n              <View className=\"price-detail\">\n                <Text className=\"final-price\">Â¥ {totalDiscountPrice}</Text>\n                {totalOriginalPrice > totalDiscountPrice && (\n                  <Text className=\"original-price\">Â¥ {totalOriginalPrice}</Text>\n                )}\n              </View>\n              <Text className=\"discount-tip\">å·²äº«å—æœ€å¤§ä¼˜æƒ å‡20å…ƒ</Text>\n            </View>\n            \n            <View className=\"checkout-footer\">\n              <Text className=\"countdown\">æ”¯ä»˜å€’è®¡æ—¶: {formatCountdown(countdown)}</Text>\n              <View className=\"confirm-btn\" onClick={handleConfirmCheckout}>\n                å»ç»“ç®—\n              </View>\n            </View>\n          </View>\n        </View>\n      )}\n    </>\n  )\n}\n\nexport default ShoppingCart","// ç—‡çŠ¶åˆ†ç±»æ•°æ®\nexport const symptomCategories = [\n  { id: '1', name: 'é¢ˆè‚©è…°è…¿ç—›è°ƒç†', order: 1 },\n  { id: '2', name: 'è‚èƒ†è„¾èƒƒè°ƒç†', order: 2 },\n  { id: '3', name: 'å¤±çœ è°ƒç†', order: 3 },\n  { id: '4', name: 'å®«å¯’ç—›ç»è°ƒç†', order: 4 },\n  { id: '5', name: 'è…™ç­‹æ ¹éª¶', order: 5 },\n  { id: '6', name: 'è¿åŠ¨æ‹‰ä¼¸', order: 6 },\n  { id: '7', name: 'ä½“æ€è°ƒç†', order: 7 }\n]\n\n// ç—‡çŠ¶æœåŠ¡é¡¹ç›®æ•°æ®\nexport const symptomServices = [\n  // é¢ˆè‚©è…°è…¿ç—›è°ƒç†\n  {\n    id: 's1',\n    categoryId: '1',\n    name: 'ã€ä¸æ»¡æ„é€€ã€‘é¢ˆè‚©è…°è…¿ç—›ç‰¹è‰²è°ƒç†60åˆ†é’Ÿ',\n    description: 'ä¸“ä¸šæ‰‹æ³•è°ƒç†å„ç±»ç—›ç—‡',\n    duration: 60,\n    price: 298,\n    discountPrice: 258,\n    availability: 'available' as const,\n    tag: 'ä¸æ»¡æ„é€€'\n  },\n  {\n    id: 's2',\n    categoryId: '1',\n    name: 'ã€å†¬å­£å…»ç”Ÿã€‘è‚©é¢ˆè…°èƒŒæ¨æ‹¿+çƒ­ç–—60åˆ†é’Ÿ',\n    description: 'æ¸©ç»é€šç»œï¼Œé©±å¯’å…»ç”Ÿ',\n    duration: 60,\n    price: 268,\n    discountPrice: 238,\n    availability: 'available' as const,\n    tag: 'å†¬å­£å…»ç”Ÿ'\n  },\n  {\n    id: 's3',\n    categoryId: '1',\n    name: 'ã€åˆæ¬¡ä¸“äº«ã€‘è‚©é¢ˆç–é€š+è‚Œè‚‰æ”¾æ¾',\n    description: 'æ–°å®¢ç‰¹æƒ ï¼Œæ·±åº¦æ”¾æ¾',\n    duration: 60,\n    price: 198,\n    discountPrice: 98,\n    availability: 'available' as const,\n    tag: 'åˆæ¬¡ä¸“äº«'\n  },\n\n  // è‚èƒ†è„¾èƒƒè°ƒç†\n  {\n    id: 's4',\n    categoryId: '2',\n    name: 'ã€èˆ’è‚æ¶¦è‚ºã€‘æ¨æ‹¿+è‰¾ç¸ï½œå…»èº«ä¼´ä¾£90åˆ†é’Ÿ',\n    description: 'ç–è‚ç†æ°”ï¼Œæ¶¦è‚ºå…»é˜´',\n    duration: 90,\n    price: 398,\n    discountPrice: 358,\n    availability: 'available' as const,\n    tag: 'çƒ­é”€'\n  },\n  {\n    id: 's5',\n    categoryId: '2',\n    name: 'ã€ä¸“é¡¹è°ƒç†ã€‘çº¤å…»ç˜¦èº«Â·è„¾èƒƒè„è…‘è°ƒç†60åˆ†é’Ÿ',\n    description: 'è°ƒç†è„¾èƒƒï¼Œå¥åº·ç˜¦èº«',\n    duration: 60,\n    price: 318,\n    discountPrice: 288,\n    availability: 'available' as const,\n    tag: 'ä¸“é¡¹è°ƒç†'\n  },\n\n  // å¤±çœ è°ƒç†\n  {\n    id: 's6',\n    categoryId: '3',\n    name: 'ã€æ·±åº¦æ”¾æ¾ã€‘å…¨èº«æ¨æ‹¿20å¹´ç»å…¸60åˆ†é’Ÿ',\n    description: 'ç»å…¸æ‰‹æ³•ï¼Œæ·±åº¦åŠ©çœ ',\n    duration: 60,\n    price: 268,\n    discountPrice: 238,\n    availability: 'available' as const,\n    tag: 'ç»å…¸'\n  },\n\n  // å®«å¯’ç—›ç»è°ƒç†\n  {\n    id: 's7',\n    categoryId: '4',\n    name: 'ã€ç‰¹è‰²å…»ç”Ÿã€‘å…³å…ƒç¸æ‰‹å·¥æ‚¬ç¸60åˆ†é’Ÿ',\n    description: 'æ¸©è¡¥è‚¾é˜³ï¼Œè°ƒç†å®«å¯’',\n    duration: 60,\n    price: 288,\n    discountPrice: 258,\n    availability: 'available' as const,\n    tag: 'ç‰¹è‰²'\n  },\n  {\n    id: 's8',\n    categoryId: '4',\n    name: 'ã€æœ¬åº—çƒ­é”€ã€‘ç‰¹è‰²é“ºå§œå…³å…ƒç¸60åˆ†é’Ÿ',\n    description: 'é“ºå§œæ¸©ç¸ï¼Œæš–å®«è°ƒç»',\n    duration: 60,\n    price: 298,\n    discountPrice: 268,\n    availability: 'busy' as const,\n    tag: 'çƒ­é”€'\n  },\n\n  // è…™ç­‹æ ¹éª¶\n  {\n    id: 's9',\n    categoryId: '5',\n    name: 'ã€ä½“æ€è°ƒæ•´ã€‘å¤§å¸ˆæ‰‹æ³•ä¸­å¼æ•´è„Š60åˆ†é’Ÿ',\n    description: 'æ­£éª¨æ•´è„Šï¼Œè°ƒæ•´ä½“æ€',\n    duration: 60,\n    price: 398,\n    discountPrice: 368,\n    availability: 'available' as const,\n    tag: 'å¤§å¸ˆæ‰‹æ³•'\n  },\n\n  // è¿åŠ¨æ‹‰ä¼¸\n  {\n    id: 's10',\n    categoryId: '6',\n    name: 'è¿åŠ¨æ¢å¤æ‹‰ä¼¸',\n    description: 'ä¸“ä¸šè¿åŠ¨åæ¢å¤',\n    duration: 45,\n    price: 198,\n    discountPrice: 168,\n    availability: 'available' as const\n  },\n\n  // ä½“æ€è°ƒç†\n  {\n    id: 's11',\n    categoryId: '7',\n    name: 'ã€å‡€æ’å¯’æ°”ã€‘æ‹”ç½/åˆ®ç—§äºŒé€‰ä¸€',\n    description: 'ç¥›æ¹¿æ’å¯’ï¼Œç–é€šç»ç»œ',\n    duration: 30,\n    price: 128,\n    discountPrice: 98,\n    availability: 'available' as const,\n    tag: 'äºŒé€‰ä¸€'\n  },\n  {\n    id: 's12',\n    categoryId: '7',\n    name: 'ã€èŠ³é¦™æ»‹å…»ã€‘æ²‰æµ¸å¼ç²¾æ²¹SPA',\n    description: 'ç²¾æ²¹æŠ¤ç†ï¼Œèº«å¿ƒæ”¾æ¾',\n    duration: 90,\n    price: 428,\n    discountPrice: 398,\n    availability: 'available' as const,\n    tag: 'ç²¾æ²¹SPA'\n  }\n]\n\n// è·å–æ¨æ‹¿å¸ˆæ”¯æŒçš„ç—‡çŠ¶æœåŠ¡\nexport const getTherapistSymptomServices = (therapistId: string) => {\n  // æ¨¡æ‹Ÿä¸åŒæ¨æ‹¿å¸ˆæ”¯æŒä¸åŒçš„æœåŠ¡é¡¹ç›®\n  // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œè¿”å›æ‰€æœ‰æœåŠ¡\n  return symptomServices.map(service => ({\n    ...service,\n    therapistId,\n    // æ¨¡æ‹ŸåŠ¨æ€å¯ç”¨æ€§\n    availability: Math.random() > 0.7 ? 'busy' : service.availability\n  }))\n}","import { symptomCategories } from '../mock/data/symptoms'\nimport { request } from '@/utils/request'\n\n/**\n * æ™ºèƒ½åˆ†ç±»å‡½æ•°ï¼šæ ¹æ®æœåŠ¡åç§°è‡ªåŠ¨åˆ†é…åˆ°ç—‡çŠ¶åˆ†ç±»\n * @param name æœåŠ¡åç§°\n * @returns åˆ†ç±»ID\n */\nfunction classifyServiceByName(name: string): string {\n  // ä¼˜å…ˆåŒ¹é…æ›´å…·ä½“çš„å…³é”®è¯\n  if (name.includes('ç²¾æ²¹') || name.includes('SPA') || name.includes('èŠ³é¦™')) {\n    return '7' // ä½“æ€è°ƒç†\n  } else if (name.includes('é¢ˆè‚©') || name.includes('è…°èƒŒ') || name.includes('è…°è…¿ç—›') || name.includes('ç‰¹è‰²è°ƒç†')) {\n    return '1' // é¢ˆè‚©è…°è…¿ç—›è°ƒç†\n  } else if (name.includes('è‚') || name.includes('èˆ’è‚') || name.includes('è‚º') || name.includes('è„¾èƒƒ')) {\n    return '2' // è‚èƒ†è„¾èƒƒè°ƒç†\n  } else if (name.includes('é“ºå§œ') || name.includes('å®«å¯’')) {\n    return '4' // å®«å¯’ç—›ç»è°ƒç†\n  } else if (name.includes('æ‹”ç½') || name.includes('åˆ®ç—§')) {\n    return '5' // è…™ç­‹æ ¹éª¶\n  } else if (name.includes('æ•´è„Š') || name.includes('ä½“æ€')) {\n    return '7' // ä½“æ€è°ƒç†\n  } else if (name.includes('å…³å…ƒç¸') || name.includes('æ‚¬ç¸')) {\n    return '2' // è‰¾ç¸ç±»å½’åˆ°è‚èƒ†è„¾èƒƒè°ƒç†\n  } else if (name.includes('å…¨èº«') || name.includes('æ”¾æ¾') || name.includes('æ·±åº¦')) {\n    return '3' // å¤±çœ è°ƒç†\n  } else if (name.includes('è‚Œè‚‰') || name.includes('ç–é€š') || name.includes('æ‹‰ä¼¸')) {\n    return '6' // è¿åŠ¨æ‹‰ä¼¸\n  }\n\n  return '1' // é»˜è®¤åˆ†ç±»ï¼šé¢ˆè‚©è…°è…¿ç—›è°ƒç†\n}\n\nexport const symptomService = {\n  // è·å–ç—‡çŠ¶åˆ†ç±»\n  async getCategories() {\n    return {\n      code: 200,\n      data: symptomCategories,\n      message: 'success'\n    }\n  },\n\n  /**\n   * è·å–æ¨æ‹¿å¸ˆçš„ç—‡çŠ¶æœåŠ¡åˆ—è¡¨\n   * âœ… æ”¹è¿›ï¼šç°åœ¨ä»æ¨æ‹¿å¸ˆæ‰€å±çš„é—¨åº—APIè·å–çœŸå®æœåŠ¡æ•°æ®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è¿‡æ—¶çš„mock\n   * @param therapistId æ¨æ‹¿å¸ˆID\n   * @returns æœåŠ¡åˆ—è¡¨ï¼ˆå¸¦åˆ†ç±»ï¼‰\n   */\n  async getTherapistSymptomServices(therapistId: string) {\n    if (!therapistId) {\n      throw new Error('æ¨æ‹¿å¸ˆIDä¸èƒ½ä¸ºç©º')\n    }\n\n    try {\n      // ç¬¬ä¸€æ­¥ï¼šè·å–æ¨æ‹¿å¸ˆè¯¦æƒ…ï¼ˆåŒ…å«æ‰€å±é—¨åº—IDï¼‰\n      const therapistResponse = await request(`/therapists/${therapistId}`)\n      const therapist = therapistResponse.data\n\n      if (!therapist || !therapist.storeId) {\n        console.error(`æ¨æ‹¿å¸ˆ ${therapistId} çš„é—¨åº—ä¿¡æ¯ä¸å­˜åœ¨`)\n        return {\n          code: 200,\n          data: [],\n          message: 'success'\n        }\n      }\n\n      // ç¬¬äºŒæ­¥ï¼šä»é—¨åº—APIè·å–å®é™…æœåŠ¡åˆ—è¡¨\n      const storeData = await request(`/stores/${therapist.storeId}`)\n      const services = storeData.data.services || []\n\n      // ç¬¬ä¸‰æ­¥ï¼šæ™ºèƒ½åˆ†ç±»\n      const categorizedServices = services.map((service: any) => ({\n        ...service,\n        categoryId: classifyServiceByName(service.name),\n        availability: 'available',\n        description: service.name\n      }))\n\n      console.log(`âœ… è·å–æ¨æ‹¿å¸ˆ ${therapistId} çš„æœåŠ¡åˆ—è¡¨æˆåŠŸï¼Œå…± ${categorizedServices.length} ä¸ªæœåŠ¡`)\n\n      return {\n        code: 200,\n        data: categorizedServices,\n        message: 'success'\n      }\n    } catch (error: any) {\n      console.error(`âŒ è·å–æ¨æ‹¿å¸ˆ ${therapistId} çš„æœåŠ¡å¤±è´¥:`, error.message)\n      // è¿”å›ç©ºæ•°ç»„è€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯ï¼Œä¿è¯å‰ç«¯ä¸ä¼šå´©æºƒ\n      return {\n        code: 200,\n        data: [],\n        message: 'success'\n      }\n    }\n  },\n\n  /**\n   * è·å–é—¨åº—æ‰€æœ‰æ¨æ‹¿å¸ˆçš„ç—‡çŠ¶æœåŠ¡åˆ—è¡¨\n   * âœ… ä¿ç•™ä¸å˜ï¼šå·²ç»åœ¨ä½¿ç”¨çœŸå®API\n   * @param storeId é—¨åº—ID\n   * @returns æœåŠ¡åˆ—è¡¨ï¼ˆå¸¦åˆ†ç±»ï¼‰\n   */\n  async getStoreSymptomServices(storeId: string) {\n    if (!storeId) {\n      throw new Error('é—¨åº—IDä¸èƒ½ä¸ºç©º')\n    }\n\n    try {\n      // ä»é—¨åº—è¯¦æƒ…APIè·å–æœåŠ¡åˆ—è¡¨\n      const storeData = await request(`/stores/${storeId}`)\n      const services = storeData.data.services || []\n\n      // æ™ºèƒ½åˆ†ç±»\n      const categorizedServices = services.map((service: any) => ({\n        ...service,\n        categoryId: classifyServiceByName(service.name),\n        availability: 'available',\n        description: service.name\n      }))\n\n      console.log(`âœ… è·å–é—¨åº— ${storeId} çš„æœåŠ¡åˆ—è¡¨æˆåŠŸï¼Œå…± ${categorizedServices.length} ä¸ªæœåŠ¡`)\n\n      return {\n        code: 200,\n        data: categorizedServices,\n        message: 'success'\n      }\n    } catch (error: any) {\n      console.error(`âŒ è·å–é—¨åº— ${storeId} çš„æœåŠ¡å¤±è´¥:`, error.message)\n      // è¿”å›ç©ºæ•°ç»„è€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯\n      return {\n        code: 200,\n        data: [],\n        message: 'success'\n      }\n    }\n  },\n\n  /**\n   * æ ¹æ®åˆ†ç±»IDè·å–æœåŠ¡åˆ—è¡¨\n   * âœ… æ”¹è¿›ï¼šç°åœ¨ç›´æ¥ä»APIæ•°æ®è¿‡æ»¤ï¼Œè€Œä¸æ˜¯ä½¿ç”¨mock\n   * @param therapistId æ¨æ‹¿å¸ˆID\n   * @param categoryId åˆ†ç±»ID\n   * @returns åˆ†ç±»æœåŠ¡åˆ—è¡¨\n   */\n  async getServicesByCategory(therapistId: string, categoryId: string) {\n    if (!therapistId) {\n      throw new Error('æ¨æ‹¿å¸ˆIDä¸èƒ½ä¸ºç©º')\n    }\n\n    // è·å–æ¨æ‹¿å¸ˆçš„æ‰€æœ‰æœåŠ¡\n    const allServicesResponse = await this.getTherapistSymptomServices(therapistId)\n    const allServices = allServicesResponse.data || []\n\n    // æŒ‰åˆ†ç±»è¿‡æ»¤\n    const filteredServices = allServices.filter(service => service.categoryId === categoryId)\n\n    return {\n      code: 200,\n      data: filteredServices,\n      message: 'success'\n    }\n  }\n}","import { request } from '@/utils/request'\nimport type { Therapist, PageData } from '@/types'\nimport { storeService } from './store'\nimport { getLocationService } from './location'\nimport { normalizeImageUrl } from '@/utils/image'\n\nclass TherapistService {\n  // è·å–æ¨èæ¨æ‹¿å¸ˆ\n  async getRecommendedTherapists(\n    page: number = 1,\n    pageSize: number = 10,\n    userLocation?: { latitude: number; longitude: number }\n  ): Promise<PageData<Therapist>> {\n    try {\n      const data = await request('/therapists/recommended', {\n        data: { page, pageSize, latitude: userLocation?.latitude, longitude: userLocation?.longitude }\n      })\n\n      console.log('âœ… æ¨èæ¨æ‹¿å¸ˆAPIè°ƒç”¨æˆåŠŸ:', data)\n      return data.data || { list: [], total: 0, page: 1, pageSize: 10, hasMore: false }\n    } catch (error) {\n      console.log('âš ï¸ æ¨èæ¨æ‹¿å¸ˆAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨mockæ•°æ®:', error)\n      return { list: [], total: 0, page: 1, pageSize: 10, hasMore: false }\n    }\n  }\n\n  // è·å–æ¨èæ¨æ‹¿å¸ˆå¹¶è®¡ç®—è·ç¦»\n  async getRecommendedTherapistsWithDistance(\n    page: number = 1,\n    pageSize: number = 10\n  ): Promise<PageData<Therapist & { distance: number | null }>> {\n    try {\n      // 1. è·å–ç”¨æˆ·ä½ç½®\n      const userLocation = await getLocationService.getCurrentLocation()\n\n      // 2. è·å–æ¨æ‹¿å¸ˆåˆ—è¡¨ï¼ˆä¼ å…¥ç”¨æˆ·ä½ç½®ï¼‰\n      const data = await request('/therapists/recommended', {\n        data: {\n          page,\n          pageSize,\n          latitude: userLocation.latitude,\n          longitude: userLocation.longitude\n        }\n      })\n\n      console.log('âœ… æ¨èæ¨æ‹¿å¸ˆAPIè°ƒç”¨æˆåŠŸ:', data)\n\n      const therapists = data.data?.list || []\n\n      // 3. è§„èŒƒåŒ–æ¨æ‹¿å¸ˆå¤´åƒURLï¼ˆHTTPâ†’HTTPSï¼‰\n      const normalizedTherapists = therapists.map((therapist: Therapist) => ({\n        ...therapist,\n        avatar: normalizeImageUrl(therapist.avatar)\n      }))\n\n      // 4. ä¸ºæ¯ä¸ªæ¨æ‹¿å¸ˆè®¡ç®—è·ç¦»\n      const therapistsWithDistance = await Promise.all(\n        normalizedTherapists.map(async (therapist: Therapist) => {\n          try {\n            // è·å–æ¨æ‹¿å¸ˆå¯¹åº”é—¨åº—ä¿¡æ¯\n            const storeData = await storeService.getStoreDetail(therapist.storeId)\n            const store = storeData?.data || storeData\n\n            let distance: number | null = null\n\n            // å¦‚æœé—¨åº—æœ‰ä½ç½®ä¿¡æ¯ï¼Œè®¡ç®—è·ç¦»\n            // APIè¿”å›çš„ä½ç½®æ•°æ®ç›´æ¥åœ¨storeå¯¹è±¡ä¸Šï¼Œä¸æ˜¯åµŒå¥—çš„locationå¯¹è±¡\n            if (store?.latitude && store?.longitude) {\n              distance = getLocationService.calculateDistance(\n                userLocation.latitude,\n                userLocation.longitude,\n                store.latitude,\n                store.longitude\n              )\n            }\n\n            return {\n              ...therapist,\n              distance\n            }\n          } catch (error) {\n            console.warn(`è·å–æŠ€å¸ˆ ${therapist.id} é—¨åº—ä¿¡æ¯å¤±è´¥:`, error)\n            return {\n              ...therapist,\n              distance: null\n            }\n          }\n        })\n      )\n\n      // 4. æŒ‰è·ç¦»æ’åºï¼ˆè·ç¦»è¿‘çš„æ’åœ¨å‰é¢ï¼Œnullå€¼æ’åœ¨åé¢ï¼‰\n      therapistsWithDistance.sort((a, b) => {\n        if (a.distance === null && b.distance === null) return 0\n        if (a.distance === null) return 1\n        if (b.distance === null) return -1\n        return a.distance - b.distance\n      })\n\n      return {\n        list: therapistsWithDistance,\n        total: data.data?.total || therapistsWithDistance.length,\n        page: data.data?.page || page,\n        pageSize: data.data?.pageSize || pageSize,\n        hasMore: data.data?.hasMore || false\n      }\n    } catch (error) {\n      console.log('âš ï¸ æ¨èæ¨æ‹¿å¸ˆè·ç¦»è®¡ç®—APIè°ƒç”¨å¤±è´¥:', error)\n      return { list: [], total: 0, page: 1, pageSize: 10, hasMore: false }\n    }\n  }\n\n  // æ ¹æ®é—¨åº—è·å–æ¨æ‹¿å¸ˆ\n  async getTherapistsByStore(\n    storeId: string,\n    page: number = 1,\n    pageSize: number = 10\n  ): Promise<PageData<Therapist>> {\n    const data = await request(`/stores/${storeId}/therapists`, {\n      data: { page, pageSize }\n    })\n\n    console.log('âœ… é—¨åº—æ¨æ‹¿å¸ˆAPIè°ƒç”¨æˆåŠŸ:', data)\n\n    // APIè¿”å›çš„dataæ˜¯æ•°ç»„ï¼Œéœ€è¦è½¬æ¢ä¸ºPageDataæ ¼å¼\n    const therapistArray = Array.isArray(data.data) ? data.data : []\n    return {\n      list: therapistArray,\n      total: therapistArray.length,\n      page: 1,\n      pageSize: therapistArray.length,\n      hasMore: false\n    }\n  }\n  \n  // è·å–æ¨æ‹¿å¸ˆè¯¦æƒ…\n  async getTherapistDetail(therapistId: string) {\n    try {\n      const data = await request(`/therapists/${therapistId}`)\n      console.log('âœ… æ¨æ‹¿å¸ˆè¯¦æƒ…APIè°ƒç”¨æˆåŠŸ:', data)\n      return data\n    } catch (error) {\n      console.log('âš ï¸ æ¨æ‹¿å¸ˆè¯¦æƒ…APIè°ƒç”¨å¤±è´¥:', error)\n      throw error // è®©ä¸Šå±‚å¤„ç†é”™è¯¯\n    }\n  }\n  \n  // æŒ‰æ“…é•¿é¡¹ç›®ç­›é€‰æ¨æ‹¿å¸ˆ\n  async getTherapistsByExpertise(\n    expertise: string,\n    page: number = 1,\n    pageSize: number = 10\n  ): Promise<PageData<Therapist>> {\n    const data = await request('/therapists/search', {\n      data: { expertise, page, pageSize }\n    })\n\n    console.log('âœ… ä¸“é•¿ç­›é€‰æ¨æ‹¿å¸ˆAPIè°ƒç”¨æˆåŠŸ:', data)\n    return data.data\n  }\n  \n  // æœç´¢æ¨æ‹¿å¸ˆ\n  async searchTherapists(\n    keyword: string,\n    page: number = 1,\n    pageSize: number = 10\n  ): Promise<PageData<Therapist>> {\n    const data = await request('/therapists/search', {\n      data: { keyword, page, pageSize }\n    })\n\n    console.log('âœ… æœç´¢æ¨æ‹¿å¸ˆAPIè°ƒç”¨æˆåŠŸ:', data)\n    return data.data\n  }\n\n  // è·å–æŠ€å¸ˆå¯é¢„çº¦æ—¶æ®µ\n  async getAvailableSlots(\n    therapistId: string,\n    date: string,\n    duration: number = 60\n  ): Promise<{\n    date: string\n    slots: Array<{\n      time: string\n      available: boolean\n      status: 'available' | 'busy' | 'break'\n    }>\n    workTime: {\n      start: string\n      end: string\n    }\n  }> {\n    try {\n      const data = await request('/appointments/available-slots', {\n        data: { therapistId, date, duration }\n      })\n\n      console.log('âœ… è·å–å¯é¢„çº¦æ—¶æ®µAPIè°ƒç”¨æˆåŠŸ:', data)\n      return data.data\n    } catch (error) {\n      // âš ï¸ é”™è¯¯ç›´æ¥æŠ›å‡ºï¼Œè®©è°ƒç”¨æ–¹å¤„ç†\n      // è¿™æ ·å¯ä»¥åŒºåˆ†ä¸åŒçš„é”™è¯¯åœºæ™¯ï¼ˆæ¨æ‹¿å¸ˆä¸å­˜åœ¨ã€ç½‘ç»œé”™è¯¯ç­‰ï¼‰\n      console.error('âŒ è·å–å¯é¢„çº¦æ—¶æ®µAPIè°ƒç”¨å¤±è´¥:', error)\n      throw error\n    }\n  }\n\n  // è·å–é—¨åº—æ‰€æœ‰æ¨æ‹¿å¸ˆçš„æ’ç­ä¿¡æ¯\n  // ç”¨äºç—‡çŠ¶é¡µé¢æ˜¾ç¤ºæŠ€å¸ˆå¯ç”¨æ€§\n  async getTherapistsAvailability(\n    storeId: string,\n    date: string,\n    days: number = 3\n  ): Promise<any[]> {\n    try {\n      const data = await request(`/stores/${storeId}/therapists/availability`, {\n        data: { date, days }\n      })\n\n      console.log('âœ… é—¨åº—æ¨æ‹¿å¸ˆæ’ç­APIè°ƒç”¨æˆåŠŸ:', data)\n\n      // APIè¿”å›çš„dataæ˜¯æ•°ç»„ï¼Œç›´æ¥è¿”å›\n      return Array.isArray(data.data) ? data.data : []\n    } catch (error) {\n      console.error('âŒ é—¨åº—æ¨æ‹¿å¸ˆæ’ç­APIè°ƒç”¨å¤±è´¥:', error)\n      // è¿”å›ç©ºæ•°ç»„ï¼Œä¿è¯å…¼å®¹æ€§\n      return []\n    }\n  }\n}\n\nexport const therapistService = new TherapistService()","import Taro from '@tarojs/taro'\nimport { get, post } from '@/utils/request'\nimport { getCurrentUserId, getCurrentUserPhone, getCurrentUserIdStrict } from '@/utils/user'\nimport { normalizeImageUrl } from '@/utils/image'  // ğŸš€ æ–°å¢ï¼šå›¾ç‰‡URLè§„èŒƒåŒ–å·¥å…·\n\n/**\n * è®¢å•æ•°æ®æ¥å£\n */\nexport interface OrderData {\n  orderNo: string\n  orderType: 'service' | 'product' | 'recharge'\n  userId: number\n  userPhone: string\n  title: string\n  amount: number\n  paymentMethod: 'wechat' | 'balance'\n  paymentStatus: 'pending' | 'paid' | 'cancelled' | 'refunded'\n  createdAt: string\n  paidAt?: string\n  extraData?: any\n\n  // æœåŠ¡è®¢å•ç‰¹æœ‰å­—æ®µ\n  appointmentId?: number  // é¢„çº¦IDï¼ˆç”¨äºè¯„ä»·ï¼‰\n  therapistId?: string\n  therapistName?: string\n  therapistAvatar?: string\n  storeId?: string\n  storeName?: string\n  storeAddress?: string\n  serviceId?: string\n  serviceName?: string\n  duration?: number\n  appointmentDate?: string  // âœ… é¢„çº¦æ—¥æœŸ (YYYY-MM-DD)\n  startTime?: string        // âœ… æ”¹ä¸º startTimeï¼ˆä¸APIå¯¹é½ï¼‰\n  appointmentStatus?: 'pending' | 'confirmed' | 'serving' | 'completed' | 'cancelled'  // é¢„çº¦çŠ¶æ€\n\n  // è®¡ç®—å­—æ®µ\n  // totalAmount å·²å¼ƒç”¨ï¼šåº”è¯¥ä½¿ç”¨ amountï¼ˆåˆ†ä¸ºå•ä½ï¼‰ï¼Œåœ¨UIå±‚ä½¿ç”¨ formatAmount() è½¬æ¢æ˜¾ç¤º\n  paymentDeadline?: string\n  displayStatus?: string  // ç»¼åˆæ˜¾ç¤ºçŠ¶æ€\n}\n\n/**\n * è®¢å•åˆ—è¡¨å“åº”\n */\ninterface OrderListResponse {\n  list: OrderData[]\n  total: number\n  page: number\n  pageSize: number\n  hasMore: boolean\n}\n\n/**\n * åˆ›å»ºè®¢å•å‚æ•°\n * âœ… æ—¶é—´å­—æ®µä¸APIå¯¹é½\n */\nexport interface CreateOrderParams {\n  therapistId: string\n  storeId: string\n  serviceId: string\n  serviceName: string\n  duration: number\n  price: number\n  discountPrice?: number\n  appointmentDate: string\n  appointmentTime: string  // âœ… ä¿ç•™è¿™ä¸ªå­—æ®µåç”¨äºé¡µé¢å…¼å®¹æ€§ï¼Œserviceå±‚ä¼šæ˜ å°„åˆ° startTime\n  therapistName: string\n  therapistAvatar?: string\n  paymentMethod: 'wechat' | 'balance'  // âœ… æ–°å¢ï¼šæ”¯ä»˜æ–¹å¼ï¼ˆå¿…å¡«ï¼‰\n  addons?: Array<{\n    id: string\n    name: string\n    price: number\n  }>\n}\n\n/**\n * æ”¯ä»˜å‚æ•°\n */\nexport interface PaymentParams {\n  timeStamp: string\n  nonceStr: string\n  package: string\n  signType: string\n  paySign: string\n  total_fee?: string | number  // âœ… æ–°å¢ï¼šå¾®ä¿¡æ”¯ä»˜æ‰€éœ€çš„æ€»é‡‘é¢ï¼ˆåˆ†ä¸ºå•ä½ï¼‰\n}\n\n/**\n * å–æ¶ˆè®¢å•å“åº”\n */\ninterface CancelOrderResponse {\n  orderNo: string\n  paymentStatus: string\n  refundAmount?: number\n  refundRate?: number\n  cancelledAt?: string\n}\n\n/**\n * è®¢å•æœåŠ¡ç±»\n * ç”Ÿäº§çº§ä»£ç ï¼šå®Œå…¨ä½¿ç”¨çœŸå®API\n */\nclass OrderService {\n  /**\n   * è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯\n   */\n  private getUserInfo() {\n    return {\n      userId: getCurrentUserId(),\n      userPhone: getCurrentUserPhone()\n    }\n  }\n\n  /**\n   * è·å–ç»¼åˆæ˜¾ç¤ºçŠ¶æ€\n   * ç»“åˆæ”¯ä»˜çŠ¶æ€å’Œé¢„çº¦çŠ¶æ€ï¼Œè¿”å›æœ€ç»ˆçš„æ˜¾ç¤ºçŠ¶æ€\n   */\n  private getDisplayStatus(order: OrderData): string {\n    // æ”¯ä»˜æœªå®Œæˆ\n    if (order.paymentStatus === 'pending') {\n      return 'pending'\n    }\n\n    // å·²å–æ¶ˆæˆ–é€€æ¬¾\n    if (order.paymentStatus === 'cancelled' || order.paymentStatus === 'refunded') {\n      return order.paymentStatus\n    }\n\n    // å·²æ”¯ä»˜çš„æœåŠ¡è®¢å•ï¼Œæ ¹æ®é¢„çº¦çŠ¶æ€ç»†åˆ†\n    if (order.paymentStatus === 'paid' && order.orderType === 'service') {\n      // å¦‚æœæœ‰é¢„çº¦çŠ¶æ€ï¼Œä¼˜å…ˆä½¿ç”¨\n      if (order.appointmentStatus) {\n        switch(order.appointmentStatus) {\n          case 'completed':\n            return 'completed'  // å·²å®Œæˆï¼ˆç®¡ç†å‘˜æ ‡è®°ï¼‰\n          case 'serving':\n            return 'serving'    // æœåŠ¡ä¸­ï¼ˆè™½ç„¶å°‘è§ï¼Œä½†å¯èƒ½å­˜åœ¨ï¼‰\n          case 'cancelled':\n            return 'cancelled'  // é¢„çº¦å·²å–æ¶ˆ\n          case 'pending':         // å¾…ç¡®è®¤\n          case 'confirmed':       // å·²ç¡®è®¤\n          default:\n            return 'paid'       // éƒ½å½’ç±»ä¸º\"å¾…æœåŠ¡\"\n        }\n      }\n\n      // æ²¡æœ‰é¢„çº¦çŠ¶æ€æ—¶ï¼Œæ ¹æ®æ—¶é—´æ¨æ–­\n      if (order.appointmentDate && order.startTime) {\n        const appointmentDateTime = new Date(`${order.appointmentDate} ${order.startTime}`)\n        const endDateTime = new Date(appointmentDateTime.getTime() + (order.duration || 60) * 60000)\n        const now = new Date()\n\n        // å¦‚æœæœåŠ¡æ—¶é—´å·²ç»ç»“æŸï¼Œä½†æ²¡æœ‰æ ‡è®°completedï¼Œæš‚æ—¶å½’ç±»ä¸ºå¾…æœåŠ¡\n        // ç­‰å¾…ç®¡ç†å‘˜æ‰‹åŠ¨æ ‡è®°ä¸ºcompleted\n        if (endDateTime < now) {\n          // æœåŠ¡æ—¶é—´å·²è¿‡ï¼Œå¯èƒ½å·²å®Œæˆä½†æœªæ ‡è®°\n          // ä¿å®ˆå¤„ç†ï¼šä»æ˜¾ç¤ºä¸º\"å¾…æœåŠ¡\"ï¼Œé¿å…è¯¯åˆ¤\n          return 'paid'\n        }\n      }\n    }\n\n    // é»˜è®¤è¿”å›æ”¯ä»˜çŠ¶æ€\n    return order.paymentStatus\n  }\n\n  /**\n   * è¡¥å…¨è®¢å•çš„é—¨åº—å’ŒæŠ€å¸ˆä¿¡æ¯\n   * @param order è®¢å•å¯¹è±¡\n   * @private\n   */\n  private async enrichOrderWithStoreAndTherapistInfo(order: OrderData): Promise<void> {\n    try {\n      const promises: Promise<any>[] = []\n\n      // å¹¶å‘è·å–é—¨åº—ä¿¡æ¯\n      if (order.storeId && !order.storeName) {\n        promises.push(\n          get(`/stores/${order.storeId}`)\n            .then(storeResponse => {\n              const store = storeResponse.data\n              order.storeName = store.name\n              order.storeAddress = store.address\n            })\n            .catch(async (error) => {\n              console.error(`è·å–é—¨åº—ä¿¡æ¯å¤±è´¥ (storeId: ${order.storeId}):`, error)\n              // å°è¯•è·å–é»˜è®¤é—¨åº—ä¿¡æ¯\n              const defaultStore = await this.getDefaultStoreInfo()\n              if (defaultStore) {\n                order.storeName = `${defaultStore.name}ï¼ˆæ›¿ä»£æ˜¾ç¤ºï¼‰`\n                order.storeAddress = defaultStore.address\n              } else {\n                // æœ€åçš„é™çº§æ–¹æ¡ˆ\n                order.storeName = 'é—¨åº—ä¿¡æ¯æš‚æ—¶æ— æ³•è·å–'\n                order.storeAddress = 'è¯·è”ç³»å®¢æœè·å–è¯¦æƒ…'\n              }\n            })\n        )\n      }\n\n      // å¹¶å‘è·å–æŠ€å¸ˆä¿¡æ¯\n      if (order.therapistId && !order.therapistAvatar) {\n        promises.push(\n          get(`/therapists/${order.therapistId}`)\n            .then(therapistResponse => {\n              const therapist = therapistResponse.data\n              order.therapistAvatar = therapist.avatar\n              // å¦‚æœextraDataä¸­æ²¡æœ‰æŠ€å¸ˆå§“åï¼Œåˆ™ä½¿ç”¨APIè¿”å›çš„å§“å\n              if (!order.therapistName) {\n                order.therapistName = therapist.name\n              }\n            })\n            .catch(error => {\n              console.error(`è·å–æŠ€å¸ˆä¿¡æ¯å¤±è´¥ (therapistId: ${order.therapistId}):`, error)\n              // å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤å¤´åƒ\n              if (!order.therapistAvatar) {\n                order.therapistAvatar = 'https://img.yzcdn.cn/vant/cat.jpeg'\n              }\n            })\n        )\n      }\n\n      // ç­‰å¾…æ‰€æœ‰APIè°ƒç”¨å®Œæˆ\n      if (promises.length > 0) {\n        await Promise.allSettled(promises)\n      }\n    } catch (error) {\n      console.error('è¡¥å…¨è®¢å•ä¿¡æ¯å¤±è´¥:', error)\n      // ä¸æŠ›å‡ºé”™è¯¯ï¼Œç¡®ä¿è®¢å•è¯¦æƒ…ä»èƒ½æ­£å¸¸è¿”å›\n    }\n  }\n\n  /**\n   * è·å–é»˜è®¤é—¨åº—ä¿¡æ¯ï¼ˆå½“åŸé—¨åº—ä¸å­˜åœ¨æ—¶ä½¿ç”¨ï¼‰\n   * @private\n   */\n  private async getDefaultStoreInfo(): Promise<{ name: string; address: string } | null> {\n    try {\n      const response = await get('/stores/nearby', { page: 1, pageSize: 1 })\n      if (response.data?.list?.[0]) {\n        const store = response.data.list[0]\n        return {\n          name: store.name,\n          address: store.address\n        }\n      }\n    } catch (error) {\n      console.error('è·å–é»˜è®¤é—¨åº—ä¿¡æ¯å¤±è´¥:', error)\n    }\n    return null\n  }\n\n  /**\n   * æ‰¹é‡è¡¥å…¨è®¢å•åˆ—è¡¨çš„é—¨åº—å’ŒæŠ€å¸ˆä¿¡æ¯ï¼Œè¿‡æ»¤æ— æ•ˆè®¢å•\n   * @param orders è®¢å•åˆ—è¡¨\n   * @returns è¿‡æ»¤åçš„æœ‰æ•ˆè®¢å•åˆ—è¡¨\n   * @private\n   */\n  private async enrichOrderListWithStoreAndTherapistInfo(orders: OrderData[]): Promise<OrderData[]> {\n    try {\n      // æ”¶é›†éœ€è¦è·å–çš„é—¨åº—IDå’ŒæŠ€å¸ˆIDï¼ˆå»é‡ï¼‰\n      const storeIds = new Set<string>()\n      const therapistIds = new Set<string>()\n\n      orders.forEach(order => {\n        if (order.storeId && !order.storeName) {\n          storeIds.add(order.storeId.toString())\n        }\n        if (order.therapistId && !order.therapistAvatar) {\n          therapistIds.add(order.therapistId.toString())\n        }\n      })\n\n      // å¹¶å‘è·å–æ‰€æœ‰éœ€è¦çš„é—¨åº—å’ŒæŠ€å¸ˆä¿¡æ¯\n      const promises: Promise<any>[] = []\n      const storeMap = new Map<string, any>()\n      const therapistMap = new Map<string, any>()\n      const invalidStoreIds = new Set<string>()\n\n      // æ‰¹é‡è·å–é—¨åº—ä¿¡æ¯\n      Array.from(storeIds).forEach(storeId => {\n        promises.push(\n          get(`/stores/${storeId}`)\n            .then(response => {\n              storeMap.set(storeId, response.data)\n            })\n            .catch(error => {\n              console.warn(`é—¨åº—ä¸å­˜åœ¨ï¼Œå°†è¿‡æ»¤ç›¸å…³è®¢å• (storeId: ${storeId}):`, error.message)\n              invalidStoreIds.add(storeId)\n            })\n        )\n      })\n\n      // æ‰¹é‡è·å–æŠ€å¸ˆä¿¡æ¯\n      Array.from(therapistIds).forEach(therapistId => {\n        promises.push(\n          get(`/therapists/${therapistId}`)\n            .then(response => {\n              therapistMap.set(therapistId, response.data)\n            })\n            .catch(error => {\n              console.error(`æ‰¹é‡è·å–æŠ€å¸ˆä¿¡æ¯å¤±è´¥ (therapistId: ${therapistId}):`, error)\n            })\n        )\n      })\n\n      // ç­‰å¾…æ‰€æœ‰APIè°ƒç”¨å®Œæˆ\n      if (promises.length > 0) {\n        await Promise.allSettled(promises)\n      }\n\n      // ğŸš€ è¿‡æ»¤æ‰é—¨åº—ä¸å­˜åœ¨çš„æ— æ•ˆè®¢å•\n      const validOrders = orders.filter(order => {\n        if (order.storeId && invalidStoreIds.has(order.storeId.toString())) {\n          console.warn(`è¿‡æ»¤æ— æ•ˆè®¢å•: ${order.orderNo}ï¼ˆé—¨åº— ${order.storeId} ä¸å­˜åœ¨ï¼‰`)\n          return false\n        }\n        return true\n      })\n\n      // åªå¯¹æœ‰æ•ˆè®¢å•å¡«å……ä¿¡æ¯\n      validOrders.forEach(order => {\n        // å¡«å……é—¨åº—ä¿¡æ¯\n        if (order.storeId && !order.storeName) {\n          const store = storeMap.get(order.storeId.toString())\n          if (store) {\n            order.storeName = store.name\n            order.storeAddress = store.address\n          }\n        }\n\n        // å¡«å……æŠ€å¸ˆä¿¡æ¯\n        if (order.therapistId && !order.therapistAvatar) {\n          const therapist = therapistMap.get(order.therapistId.toString())\n          if (therapist) {\n            order.therapistAvatar = therapist.avatar\n            if (!order.therapistName) {\n              order.therapistName = therapist.name\n            }\n          } else {\n            // å¦‚æœæ²¡æœ‰è·å–åˆ°æŠ€å¸ˆä¿¡æ¯ï¼Œè®¾ç½®é»˜è®¤å¤´åƒ\n            order.therapistAvatar = 'https://img.yzcdn.cn/vant/cat.jpeg'\n          }\n        }\n      })\n\n      return validOrders\n    } catch (error) {\n      console.error('æ‰¹é‡è¡¥å…¨è®¢å•åˆ—è¡¨ä¿¡æ¯å¤±è´¥:', error)\n      // å‘ç”Ÿé”™è¯¯æ—¶è¿”å›åŸå§‹è®¢å•åˆ—è¡¨\n      return orders\n    }\n  }\n\n  /**\n   * åˆ›å»ºé¢„çº¦è®¢å•ï¼ˆé€šè¿‡é¢„çº¦æ¥å£ï¼‰\n   * @param params åˆ›å»ºè®¢å•å‚æ•°\n   * @returns è®¢å•å’Œé¢„çº¦ä¿¡æ¯\n   */\n  async createAppointmentOrder(params: CreateOrderParams) {\n    try {\n      // âœ… ä¸¥æ ¼æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n      const strictUserId = getCurrentUserIdStrict()\n      if (!strictUserId) {\n        throw new Error('è¯·å…ˆç™»å½•')\n      }\n\n      const { userId, userPhone } = this.getUserInfo()\n\n      // è°ƒè¯•æ—¥å¿— - æŸ¥çœ‹åŸå§‹å‚æ•°\n      console.log('ğŸ“ åˆ›å»ºè®¢å•åŸå§‹å‚æ•°:', params)\n      console.log('ğŸ“ therapistIdç±»å‹:', typeof params.therapistId, 'å€¼:', params.therapistId)\n\n      const requestData = {\n        therapistId: Number(params.therapistId),\n        storeId: Number(params.storeId),\n        userId,\n        userPhone,\n        appointmentDate: params.appointmentDate,\n        startTime: params.appointmentTime,\n        duration: params.duration || 60,\n        serviceId: params.serviceId,\n        serviceName: params.serviceName,\n        price: (params.discountPrice || params.price) * 100,  // âœ… è½¬æ¢ä¸ºåˆ†ï¼ˆparamsä¸­æ˜¯å…ƒï¼‰\n        paymentMethod: params.paymentMethod  // âœ… æ–°å¢ï¼šä¼ é€’æ”¯ä»˜æ–¹å¼\n      }\n\n      // è°ƒè¯•æ—¥å¿— - æŸ¥çœ‹è½¬æ¢åçš„è¯·æ±‚æ•°æ®\n      console.log('ğŸ“¤ å®é™…å‘é€çš„è¯·æ±‚æ•°æ®:', requestData)\n      console.log('ğŸ“¤ è½¬æ¢åçš„therapistId:', requestData.therapistId, 'æ˜¯å¦ä¸ºNaN:', isNaN(requestData.therapistId))\n      console.log('ğŸ“¤ æ”¯ä»˜æ–¹å¼:', requestData.paymentMethod)\n\n      const response = await post('/appointments/create-with-order', requestData, {\n        showLoading: true,\n        loadingTitle: 'åˆ›å»ºè®¢å•ä¸­...'\n      })\n\n      // æå–è®¢å•ä¿¡æ¯\n      const orderData: OrderData = {\n        ...response.data.order,\n        therapistName: params.therapistName,\n        therapistAvatar: params.therapistAvatar,\n        serviceName: params.serviceName,\n        duration: params.duration,\n        appointmentDate: params.appointmentDate,\n        startTime: params.appointmentTime  // âœ… æ˜ å°„åˆ° startTime\n        // âœ… amount å·²ç»ä»APIè¿”å›ï¼Œå•ä½ä¸ºåˆ†\n      }\n\n      return {\n        order: orderData,\n        appointment: response.data.appointment\n      }\n    } catch (error: any) {\n      console.error('åˆ›å»ºè®¢å•å¤±è´¥:', error)\n      throw new Error(error.message || 'åˆ›å»ºè®¢å•å¤±è´¥')\n    }\n  }\n\n  /**\n   * è·å–æ”¯ä»˜å‚æ•°ï¼ˆä»…è·å–ï¼Œä¸æ”¹å˜è®¢å•çŠ¶æ€ï¼‰\n   * @param orderNo è®¢å•å·\n   * @returns å¾®ä¿¡æ”¯ä»˜å‚æ•°æˆ–ç©ºå¯¹è±¡\n   */\n  async getPaymentParams(orderNo: string): Promise<PaymentParams | any> {\n    try {\n      // âœ… è°ƒç”¨æ–°æ¥å£ï¼šè·å–æ”¯ä»˜å‚æ•°ï¼ˆä¸æ”¹å˜è®¢å•çŠ¶æ€ï¼‰\n      const response = await get(`/orders/${orderNo}/payment-params`)\n\n      console.log('ğŸ’³ åç«¯æ”¯ä»˜å‚æ•°å“åº”:', response.data)\n\n      // è¿”å›å¾®ä¿¡æ”¯ä»˜å‚æ•°\n      if (response.data.wxPayParams) {\n        const paymentParams = response.data.wxPayParams\n\n        // âœ… ç¡®ä¿ total_fee åŒ…å«åœ¨å“åº”ä¸­\n        if (!paymentParams.total_fee && response.data.amount) {\n          paymentParams.total_fee = response.data.amount\n        }\n\n        console.log('ğŸ’³ å¾®ä¿¡æ”¯ä»˜å‚æ•°å·²æå–:', {\n          timeStamp: paymentParams.timeStamp,\n          nonceStr: paymentParams.nonceStr?.substring(0, 8) + '...',\n          package: paymentParams.package,\n          signType: paymentParams.signType,\n          paySign: paymentParams.paySign?.substring(0, 16) + '...',\n          total_fee: paymentParams.total_fee\n        })\n\n        return paymentParams\n      }\n\n      // âœ… å¦‚æœæ˜¯ä½™é¢æ”¯ä»˜ï¼Œè¿”å› null æˆ–ç©ºå¯¹è±¡ï¼ˆå‰ç«¯ä¼šä½¿ç”¨ /orders/pay è¿›è¡Œå®é™…æ”¯ä»˜ï¼‰\n      console.log('ğŸ’° ä½™é¢æ”¯ä»˜è®¢å•ï¼Œæ— éœ€å¾®ä¿¡æ”¯ä»˜å‚æ•°')\n      return null\n    } catch (error: any) {\n      console.error('ğŸ’³ è·å–æ”¯ä»˜å‚æ•°å¤±è´¥:', error)\n      console.error('ğŸ’³ é”™è¯¯è¯¦æƒ…:', {\n        message: error.message,\n        response: error.response?.data\n      })\n      throw new Error('è·å–æ”¯ä»˜å‚æ•°å¤±è´¥')\n    }\n  }\n\n  /**\n   * æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆä½™é¢æ”¯ä»˜ï¼‰\n   * @param orderNo è®¢å•å·\n   * @param status è®¢å•çŠ¶æ€\n   * @returns æ›´æ–°åçš„è®¢å•\n   */\n  async updateOrderStatus(orderNo: string, status: OrderData['paymentStatus']): Promise<OrderData> {\n    try {\n      // ä½¿ç”¨ä½™é¢æ”¯ä»˜æ¥å£\n      const response = await post('/orders/pay', {\n        orderNo,\n        paymentMethod: 'balance'\n      })\n\n      return {\n        orderNo,\n        paymentStatus: 'paid',\n        paidAt: response.data.paidAt || new Date().toISOString()\n      } as OrderData\n    } catch (error: any) {\n      console.error('æ›´æ–°è®¢å•çŠ¶æ€å¤±è´¥:', error)\n      throw new Error(error.message || 'æ”¯ä»˜å¤±è´¥')\n    }\n  }\n\n  /**\n   * è·å–è®¢å•è¯¦æƒ…\n   * @param orderNo è®¢å•å·\n   * @returns è®¢å•è¯¦æƒ…\n   */\n  async getOrderDetail(orderNo: string): Promise<OrderData> {\n    try {\n      // ä½¿ç”¨RESTfulé£æ ¼çš„APIè·¯å¾„\n      const response = await get(`/orders/${orderNo}`)\n\n      // âœ… APIè¿”å›çš„amountå·²ç»æ˜¯åˆ†ä¸ºå•ä½ï¼Œä¿æŒåˆ†ä¸ºå•ä½è¿”å›\n      const order = response.data\n      // amount ä¿æŒåˆ†ä¸ºå•ä½ï¼Œç”±UIå±‚ä½¿ç”¨ formatAmount() è½¬æ¢æ˜¾ç¤º\n\n      // ä»extraDataä¸­æå–é¢„çº¦ä¿¡æ¯\n      if (order.extraData) {\n        order.appointmentId = order.extraData.appointmentId\n        order.therapistId = order.extraData.therapistId\n        order.therapistName = order.extraData.therapistName\n        // ğŸš€ æ–°å¢ï¼šè§„èŒƒåŒ–æŠ€å¸ˆå¤´åƒURLä¸ºHTTPS\n        order.therapistAvatar = normalizeImageUrl(order.extraData.therapistAvatar)\n        order.storeId = order.extraData.storeId\n        order.appointmentDate = order.extraData.appointmentDate\n        order.startTime = order.extraData.startTime  // âœ… æ”¹ä¸º startTime\n        order.duration = order.extraData.duration\n        order.serviceName = order.extraData.serviceName || order.title\n\n        // ğŸš€ è¯»å–é¢„çº¦çŠ¶æ€ï¼ˆåç«¯æ–°å¢å­—æ®µï¼‰\n        order.appointmentStatus = order.extraData.appointmentStatus\n\n        // ğŸš€ è‡ªåŠ¨è·å–å®Œæ•´çš„é—¨åº—å’ŒæŠ€å¸ˆä¿¡æ¯\n        await this.enrichOrderWithStoreAndTherapistInfo(order)\n      }\n\n      // è®¡ç®—ç»¼åˆæ˜¾ç¤ºçŠ¶æ€\n      order.displayStatus = this.getDisplayStatus(order)\n\n      return order\n    } catch (error: any) {\n      console.error('è·å–è®¢å•è¯¦æƒ…å¤±è´¥:', error)\n      throw new Error('è®¢å•ä¸å­˜åœ¨æˆ–å·²åˆ é™¤')\n    }\n  }\n\n  /**\n   * è·å–è®¢å•åˆ—è¡¨\n   * @param status è®¢å•çŠ¶æ€ï¼ˆå¯é€‰ï¼‰\n   * @param orderType è®¢å•ç±»å‹ï¼ˆå¯é€‰ï¼‰\n   * @param page é¡µç \n   * @param pageSize æ¯é¡µæ•°é‡\n   * @returns è®¢å•åˆ—è¡¨\n   */\n  async getOrderList(\n    status?: OrderData['paymentStatus'],\n    orderType?: OrderData['orderType'],\n    page: number = 1,\n    pageSize: number = 20\n  ): Promise<OrderData[]> {\n    try {\n      const { userId } = this.getUserInfo()\n\n      const params: any = { userId, page, pageSize }\n      if (status) params.status = status\n      if (orderType) params.orderType = orderType\n\n      const response = await get<OrderListResponse>('/orders', params)\n\n      // å¤„ç†è®¢å•æ•°æ®\n      const orders = response.data.list.map(order => {\n        // âœ… APIè¿”å›çš„amountå·²ç»æ˜¯åˆ†ä¸ºå•ä½ï¼Œä¿æŒåˆ†ä¸ºå•ä½è¿”å›\n        // amount ä¿æŒåˆ†ä¸ºå•ä½ï¼Œç”±UIå±‚ä½¿ç”¨ formatAmount() è½¬æ¢æ˜¾ç¤º\n\n        // ä»extraDataä¸­æå–ä¿¡æ¯\n        if (order.extraData) {\n          order.appointmentId = order.extraData.appointmentId\n          order.therapistId = order.extraData.therapistId\n          order.therapistName = order.extraData.therapistName\n          // ğŸš€ æ–°å¢ï¼šæ­£ç¡®æå–æŠ€å¸ˆå¤´åƒURLå¹¶è§„èŒƒåŒ–ä¸ºHTTPS\n          order.therapistAvatar = normalizeImageUrl(order.extraData.therapistAvatar)\n          order.storeId = order.extraData.storeId\n          order.storeName = order.extraData.storeName // ç§»é™¤ç¡¬ç¼–ç é»˜è®¤å€¼\n          order.storeAddress = order.extraData.storeAddress // ç§»é™¤ç¡¬ç¼–ç é»˜è®¤å€¼\n          order.appointmentDate = order.extraData.appointmentDate\n          order.startTime = order.extraData.startTime  // âœ… æ”¹ä¸º startTime\n          order.duration = order.extraData.duration\n          order.serviceName = order.extraData.serviceName || order.title\n\n          // ğŸš€ è¯»å–é¢„çº¦çŠ¶æ€ï¼ˆåç«¯æ–°å¢å­—æ®µï¼‰\n          order.appointmentStatus = order.extraData.appointmentStatus\n        }\n\n        // è®¡ç®—ç»¼åˆæ˜¾ç¤ºçŠ¶æ€\n        order.displayStatus = this.getDisplayStatus(order)\n\n        return order\n      })\n\n      // ğŸš€ æ‰¹é‡è¡¥å…¨é—¨åº—å’ŒæŠ€å¸ˆä¿¡æ¯ï¼Œå¹¶è¿‡æ»¤æ— æ•ˆè®¢å•\n      const validOrders = await this.enrichOrderListWithStoreAndTherapistInfo(orders)\n\n      return validOrders\n    } catch (error: any) {\n      console.error('è·å–è®¢å•åˆ—è¡¨å¤±è´¥:', error)\n      return []\n    }\n  }\n\n  /**\n   * å–æ¶ˆè®¢å•\n   * @param orderNo è®¢å•å·\n   * @param reason å–æ¶ˆåŸå› \n   * @returns å–æ¶ˆç»“æœ\n   */\n  async cancelOrder(orderNo: string, reason: string = 'ç”¨æˆ·å–æ¶ˆ'): Promise<CancelOrderResponse> {\n    try {\n      const { userId } = this.getUserInfo()\n\n      const response = await post<CancelOrderResponse>('/orders/cancel', {\n        orderNo,\n        userId,\n        reason\n      }, {\n        showLoading: true,\n        loadingTitle: 'å–æ¶ˆä¸­...'\n      })\n\n      return response.data\n    } catch (error: any) {\n      console.error('å–æ¶ˆè®¢å•å¤±è´¥:', error)\n      throw new Error(error.message || 'å–æ¶ˆè®¢å•å¤±è´¥')\n    }\n  }\n\n  /**\n   * ç”³è¯·é€€æ¬¾ï¼ˆé€šè¿‡è®¢å•APIï¼‰\n   * @param orderNo è®¢å•å·\n   * @param reason é€€æ¬¾åŸå› ï¼ˆå¯é€‰ï¼‰\n   * @returns é€€æ¬¾å•ä¿¡æ¯\n   */\n  async requestRefund(orderNo: string, reason?: string): Promise<any> {\n    try {\n      const { userId } = this.getUserInfo()\n\n      const response = await post(`/orders/${orderNo}/refund`, {\n        userId,\n        reason: reason || 'ç”¨æˆ·ç”³è¯·é€€æ¬¾'\n      }, {\n        showLoading: true,\n        loadingTitle: 'ç”³è¯·é€€æ¬¾ä¸­...'\n      })\n\n      return response.data\n    } catch (error: any) {\n      console.error('ç”³è¯·é€€æ¬¾å¤±è´¥:', error)\n      throw new Error(error.message || 'ç”³è¯·é€€æ¬¾å¤±è´¥')\n    }\n  }\n\n  /**\n   * æŸ¥è¯¢é€€æ¬¾è¯¦æƒ…\n   * @param refundId é€€æ¬¾å•å·\n   * @returns é€€æ¬¾è¯¦æƒ…\n   */\n  async getRefundDetail(refundId: string): Promise<any> {\n    try {\n      const response = await get(`/refunds/${refundId}`)\n      return response.data\n    } catch (error: any) {\n      console.error('è·å–é€€æ¬¾è¯¦æƒ…å¤±è´¥:', error)\n      throw new Error('é€€æ¬¾å•ä¸å­˜åœ¨æˆ–å·²åˆ é™¤')\n    }\n  }\n\n  /**\n   * é‡æ–°é¢„çº¦ï¼ˆåŸºäºå·²æœ‰è®¢å•ï¼‰\n   * @param orderNo åŸè®¢å•å·\n   * @returns æ˜¯å¦æˆåŠŸ\n   */\n  async rebookOrder(orderNo: string): Promise<boolean> {\n    try {\n      // è·å–åŸè®¢å•ä¿¡æ¯\n      const originalOrder = await this.getOrderDetail(orderNo)\n\n      // ä¿å­˜åˆ°ä¸´æ—¶å­˜å‚¨ï¼Œä¾›é¢„çº¦é¡µé¢ä½¿ç”¨\n      Taro.setStorageSync('rebookOrderInfo', {\n        therapistId: originalOrder.therapistId,\n        therapistName: originalOrder.therapistName,\n        storeId: originalOrder.storeId,\n        storeName: originalOrder.storeName,\n        serviceId: originalOrder.serviceId,\n        serviceName: originalOrder.serviceName,\n        duration: originalOrder.duration\n      })\n\n      return true\n    } catch (error) {\n      console.error('é‡æ–°é¢„çº¦å¤±è´¥:', error)\n      return false\n    }\n  }\n\n  /**\n   * è·å–è®¢å•ç»Ÿè®¡\n   * @returns è®¢å•ç»Ÿè®¡ä¿¡æ¯\n   */\n  async getOrderStatistics() {\n    try {\n      const { userId } = this.getUserInfo()\n      const response = await get('/orders', { userId, page: 1, pageSize: 100 })\n\n      const orders = response.data.list\n\n      return {\n        total: orders.length,\n        pendingPayment: orders.filter((o: OrderData) => o.paymentStatus === 'pending').length,\n        paid: orders.filter((o: OrderData) => o.paymentStatus === 'paid').length,\n        completed: orders.filter((o: OrderData) => o.paymentStatus === 'paid' &&\n          new Date(o.appointmentDate + ' ' + o.startTime) < new Date()).length,  // âœ… æ”¹ä¸º startTime\n        cancelled: orders.filter((o: OrderData) => o.paymentStatus === 'cancelled').length\n      }\n    } catch (error) {\n      console.error('è·å–è®¢å•ç»Ÿè®¡å¤±è´¥:', error)\n      return {\n        total: 0,\n        pendingPayment: 0,\n        paid: 0,\n        completed: 0,\n        cancelled: 0\n      }\n    }\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹å®ä¾‹\nexport const orderService = new OrderService()","/**\n * é‡‘é¢å•ä½ç»Ÿä¸€å¤„ç†å·¥å…·åº“\n *\n * é‡‘é¢å•ä½è§„èŒƒï¼š\n * - APIè¿”å›ï¼šåˆ†ï¼ˆfenï¼‰- æ•´æ•°ï¼Œæ— ç²¾åº¦é—®é¢˜\n * - æœåŠ¡å±‚è¿”å›ï¼šåˆ†ï¼ˆfenï¼‰- ä¿æŒAPIè¿”å›çš„åŸå§‹å•ä½ï¼Œä¾›ä¸Šå±‚è°ƒç”¨\n * - UIå±•ç¤ºï¼šå…ƒï¼ˆyuanï¼‰- è°ƒç”¨è½¬æ¢å‡½æ•°åœ¨ç»„ä»¶ä¸­è½¬æ¢\n *\n * è¿™æ ·åšçš„å¥½å¤„ï¼š\n * 1. æœåŠ¡å±‚é€»è¾‘æ¸…æ™°ï¼Œç›´æ¥ä»APIè·å–åˆ†ä¸ºå•ä½çš„æ•°æ®ï¼Œæ— éœ€è½¬æ¢\n * 2. ç»„ä»¶å±‚è´Ÿè´£æ˜¾ç¤ºï¼Œè½¬æ¢é€»è¾‘é›†ä¸­åœ¨UIå±‚\n * 3. é¿å…ä¸­é—´å±‚å¤šæ¬¡è½¬æ¢å¯¼è‡´çš„ç²¾åº¦é—®é¢˜\n */\n\n/**\n * å°†åˆ†è½¬æ¢ä¸ºå…ƒï¼ˆå››èˆäº”å…¥ï¼‰\n * @param amountInCents é‡‘é¢ï¼ˆåˆ†ï¼‰\n * @returns é‡‘é¢ï¼ˆå…ƒï¼‰\n */\nexport function centsToYuan(amountInCents: number | undefined | null): number {\n  if (!amountInCents && amountInCents !== 0) return 0\n  return Math.round(amountInCents) / 100\n}\n\n/**\n * å°†å…ƒè½¬æ¢ä¸ºåˆ†ï¼ˆé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼‰\n * @param amountInYuan é‡‘é¢ï¼ˆå…ƒï¼‰\n * @returns é‡‘é¢ï¼ˆåˆ†ï¼‰\n */\nexport function yuanToCents(amountInYuan: number | undefined | null): number {\n  if (!amountInYuan && amountInYuan !== 0) return 0\n  return Math.round(amountInYuan * 100)\n}\n\n/**\n * æ ¼å¼åŒ–é‡‘é¢ä¸ºæ˜¾ç¤ºå­—ç¬¦ä¸²ï¼ˆå…ƒï¼‰\n * @param amountInCents é‡‘é¢ï¼ˆåˆ†ï¼‰\n * @param options é€‰é¡¹\n * @returns æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ï¼Œå¦‚ \"99.99å…ƒ\"\n */\nexport function formatAmount(\n  amountInCents: number | undefined | null,\n  options?: {\n    symbol?: string  // è´§å¸ç¬¦å·ï¼Œé»˜è®¤\"ï¿¥\"\n    suffix?: string  // åç¼€ï¼Œé»˜è®¤\"å…ƒ\"\n    precision?: number  // å°æ•°ä½æ•°ï¼Œé»˜è®¤2\n  }\n): string {\n  const {\n    symbol = 'ï¿¥',\n    suffix = 'å…ƒ',\n    precision = 2\n  } = options || {}\n\n  // ğŸš€ æ”¹è¿›ï¼šæ›´æ¸…æ™°çš„å®¹é”™å¤„ç†ï¼Œé¿å…NaN\n  if (amountInCents === undefined || amountInCents === null) {\n    return `${symbol}0.00${suffix}`\n  }\n\n  // éªŒè¯æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—\n  if (typeof amountInCents !== 'number' || isNaN(amountInCents)) {\n    console.warn('âš ï¸ formatAmount: æ— æ•ˆçš„é‡‘é¢è¾“å…¥', { amountInCents, type: typeof amountInCents })\n    return `${symbol}0.00${suffix}`\n  }\n\n  const yuan = centsToYuan(amountInCents)\n\n  // é˜²å¾¡æ€§æ£€æŸ¥ï¼šç¡®ä¿ç»“æœä¸æ˜¯NaN\n  if (isNaN(yuan)) {\n    console.error('âŒ formatAmount: é‡‘é¢è½¬æ¢ç»“æœä¸ºNaN', { amountInCents, yuan })\n    return `${symbol}0.00${suffix}`\n  }\n\n  return `${symbol}${yuan.toFixed(precision)}${suffix}`\n}\n\n/**\n * è·å–èŠ‚çœé‡‘é¢çš„æ˜¾ç¤ºæ–‡æœ¬\n * @param originalPrice åŸä»·ï¼ˆåˆ†ï¼‰\n * @param discountPrice æŠ˜æ‰£ä»·ï¼ˆåˆ†ï¼‰\n * @returns å¦‚ \"èŠ‚çœï¿¥10.00\"\n */\nexport function getSavingsText(\n  originalPrice: number | undefined,\n  discountPrice: number | undefined\n): string {\n  if (!originalPrice || !discountPrice || originalPrice <= discountPrice) {\n    return ''\n  }\n\n  const savings = originalPrice - discountPrice\n  return `èŠ‚çœ${formatAmount(savings)}`\n}\n\n/**\n * è®¡ç®—æŠ˜æ‰£ç‡ç™¾åˆ†æ¯”\n * @param originalPrice åŸä»·ï¼ˆåˆ†ï¼‰\n * @param discountPrice æŠ˜æ‰£ä»·ï¼ˆåˆ†ï¼‰\n * @returns æŠ˜æ‰£ç‡ï¼Œå¦‚0.8è¡¨ç¤º8æŠ˜\n */\nexport function getDiscountRate(\n  originalPrice: number | undefined,\n  discountPrice: number | undefined\n): number {\n  if (!originalPrice || originalPrice === 0) return 1\n  if (!discountPrice) return 0\n\n  return Math.round((discountPrice / originalPrice) * 10) / 10\n}\n\n/**\n * åˆ¤æ–­é‡‘é¢æ˜¯å¦æœ‰æ•ˆï¼ˆå¤§äº0ï¼‰\n */\nexport function isValidAmount(amount: number | undefined | null): boolean {\n  return Boolean(amount) && amount! > 0\n}\n","/**\n * æ”¯ä»˜æœåŠ¡\n * æ”¯æŒæ¨¡æ‹Ÿæ”¯ä»˜å’Œä½™é¢æ”¯ä»˜ï¼ˆä¸ªäººå°ç¨‹åºå¯ç”¨ï¼‰\n */\nimport Taro from '@tarojs/taro'\nimport { post } from '@/utils/request'\nimport { getCurrentUserIdStrict } from '@/utils/user'\n\ninterface PaymentConfig {\n  useMockPayment: boolean\n  enableBalancePayment: boolean\n  enableWechatPayment: boolean\n}\n\ninterface PaymentOptions {\n  orderNo: string\n  amount: number\n  paymentMethod: 'wechat' | 'balance' | 'mock'\n  title?: string\n}\n\nclass PaymentService {\n  private config: PaymentConfig = {\n    // ä¼ä¸šå°ç¨‹åºçœŸå®æ”¯ä»˜é…ç½®\n    useMockPayment: false,  // å…³é—­æ¨¡æ‹Ÿæ”¯ä»˜\n    enableBalancePayment: true,\n    enableWechatPayment: true  // å¯ç”¨çœŸå®å¾®ä¿¡æ”¯ä»˜\n  }\n\n  /**\n   * ç»Ÿä¸€æ”¯ä»˜å…¥å£\n   */\n  async pay(options: PaymentOptions): Promise<boolean> {\n    const { paymentMethod } = options\n\n    // ä½™é¢æ”¯ä»˜\n    if (paymentMethod === 'balance') {\n      return this.payWithBalance(options)\n    }\n\n    // çœŸå®å¾®ä¿¡æ”¯ä»˜\n    if (paymentMethod === 'wechat') {\n      return this.payWithWechat(options)\n    }\n\n    throw new Error('ä¸æ”¯æŒçš„æ”¯ä»˜æ–¹å¼')\n  }\n\n/**\n   * ä½™é¢æ”¯ä»˜\n   */\n  private async payWithBalance(options: PaymentOptions): Promise<boolean> {\n    try {\n      // âœ… ä¸¥æ ¼æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n      const userId = getCurrentUserIdStrict()\n      if (!userId) {\n        Taro.showToast({ title: 'è¯·å…ˆç™»å½•', icon: 'none' })\n        return false\n      }\n\n      Taro.showLoading({ title: 'æ”¯ä»˜ä¸­...' })\n\n      console.log('ğŸ’° ä½™é¢æ”¯ä»˜è¯·æ±‚å‚æ•°:', {\n        orderNo: options.orderNo,\n        paymentMethod: 'balance'\n      })\n\n      // è°ƒç”¨ä½™é¢æ”¯ä»˜æ¥å£\n      const response = await post('/orders/pay', {\n        orderNo: options.orderNo,\n        paymentMethod: 'balance'\n      })\n\n      console.log('ğŸ’° ä½™é¢æ”¯ä»˜å“åº”:', response)\n\n      Taro.hideLoading()\n\n      if (response.code === 0) {\n        // æ˜¾ç¤ºæ–°ä½™é¢\n        // âœ… APIè¿”å›çš„balanceå·²ç»æ˜¯åˆ†ä¸ºå•ä½ï¼Œéœ€è¦è½¬ä¸ºå…ƒæ˜¾ç¤º\n        const balanceInYuan = (response.data.balance || 0) / 100\n        Taro.showToast({\n          title: `æ”¯ä»˜æˆåŠŸ\\nä½™é¢ï¼šÂ¥${balanceInYuan.toFixed(2)}`,\n          icon: 'success',\n          duration: 2000\n        })\n        return true\n      } else {\n        throw new Error(response.message || 'ä½™é¢ä¸è¶³')\n      }\n    } catch (error: any) {\n      console.error('ğŸ’° ä½™é¢æ”¯ä»˜å¤±è´¥:', error)\n      console.error('ğŸ’° é”™è¯¯è¯¦æƒ…:', error.response || error.message)\n      Taro.hideLoading()\n      Taro.showToast({\n        title: error.message || 'æ”¯ä»˜å¤±è´¥',\n        icon: 'none'\n      })\n      return false\n    }\n  }\n\n  /**\n   * çœŸå®å¾®ä¿¡æ”¯ä»˜ï¼ˆéœ€è¦ä¼ä¸šè®¤è¯ï¼‰\n   * æ³¨æ„ï¼šwxPayParams å·²ç»åœ¨åˆ›å»ºè®¢å•æ—¶ç”±åç«¯è¿”å›\n   */\n  private async payWithWechat(options: PaymentOptions): Promise<boolean> {\n    try {\n      console.log('ğŸ’³ å¼€å§‹çœŸå®å¾®ä¿¡æ”¯ä»˜ï¼Œè®¢å•å·:', options.orderNo)\n\n      // âš ï¸ é‡è¦ï¼šwxPayParams åº”è¯¥ç”±åˆ›å»ºè®¢å•æ¥å£è¿”å›ï¼Œè€Œä¸æ˜¯å•ç‹¬è·å–\n      // å¦‚æœæ²¡æœ‰ä¼ å…¥æ”¯ä»˜å‚æ•°ï¼Œéœ€è¦ä»è®¢å•æœåŠ¡è·å–\n      // è¿™é‡Œå‡è®¾è°ƒç”¨æ–¹å·²ç»åœ¨optionsä¸­é™„å¸¦äº†wxPayParams\n      const wxPayParams = (options as any).wxPayParams\n\n      if (!wxPayParams) {\n        throw new Error('ç¼ºå°‘å¾®ä¿¡æ”¯ä»˜å‚æ•°ï¼Œè¯·å…ˆåˆ›å»ºè®¢å•')\n      }\n\n      // âœ… éªŒè¯æ”¯ä»˜å‚æ•°å®Œæ•´æ€§\n      const requiredFields = ['timeStamp', 'nonceStr', 'package', 'signType', 'paySign']\n      const missingFields = requiredFields.filter(field => !wxPayParams[field])\n\n      if (missingFields.length > 0) {\n        console.error('âŒ å¾®ä¿¡æ”¯ä»˜å‚æ•°ä¸å®Œæ•´ï¼Œç¼ºå°‘å­—æ®µ:', missingFields)\n        throw new Error(`å¾®ä¿¡æ”¯ä»˜å‚æ•°ç¼ºå¤±: ${missingFields.join(', ')}`)\n      }\n\n      console.log('ğŸ’³ å¾®ä¿¡æ”¯ä»˜å‚æ•°:', {\n        timeStamp: wxPayParams.timeStamp,\n        nonceStr: wxPayParams.nonceStr?.substring(0, 8) + '...',\n        package: wxPayParams.package,\n        signType: wxPayParams.signType,\n        paySign: wxPayParams.paySign?.substring(0, 16) + '...'\n      })\n\n      // è°ƒèµ·å¾®ä¿¡æ”¯ä»˜SDK\n      await Taro.requestPayment({\n        timeStamp: wxPayParams.timeStamp,\n        nonceStr: wxPayParams.nonceStr,\n        package: wxPayParams.package,\n        signType: wxPayParams.signType as any,\n        paySign: wxPayParams.paySign\n      })\n\n      console.log('ğŸ’³ ç”¨æˆ·å®Œæˆæ”¯ä»˜ï¼Œç­‰å¾…å¾®ä¿¡å›è°ƒåç«¯æ›´æ–°è®¢å•çŠ¶æ€')\n\n      Taro.showToast({\n        title: 'æ”¯ä»˜æˆåŠŸ',\n        icon: 'success'\n      })\n\n      return true\n    } catch (error: any) {\n      if (error.errMsg === 'requestPayment:fail cancel') {\n        console.log('ğŸ’³ ç”¨æˆ·å–æ¶ˆæ”¯ä»˜')\n        return false\n      }\n\n      console.error('ğŸ’³ å¾®ä¿¡æ”¯ä»˜å¤±è´¥:', error)\n      console.error('ğŸ’³ é”™è¯¯è¯¦æƒ…:', {\n        errMsg: error.errMsg,\n        errCode: error.errCode,\n        message: error.message\n      })\n\n      Taro.showToast({\n        title: error.errMsg || error.message || 'æ”¯ä»˜å¤±è´¥',\n        icon: 'none',\n        duration: 3000\n      })\n      throw error\n    }\n  }\n\n  /**\n   * æ£€æŸ¥æ”¯ä»˜ç¯å¢ƒ\n   */\n  async checkPaymentEnvironment(): Promise<{\n    canUseWechatPay: boolean\n    canUseBalance: boolean\n    message: string\n  }> {\n    return {\n      canUseWechatPay: this.config.enableWechatPayment,\n      canUseBalance: this.config.enableBalancePayment,\n      message: 'æ”¯æŒå¾®ä¿¡æ”¯ä»˜å’Œä½™é¢æ”¯ä»˜'\n    }\n  }\n\n  /**\n   * ç”Ÿæˆå……å€¼ç ï¼ˆçº¿ä¸‹å……å€¼ï¼‰\n   */\n  async generateRechargeCode(amount: number): Promise<{\n    code: string\n    qrcode: string\n    expireTime: string\n  }> {\n    const response = await post('/recharge/generate-code', { amount })\n    return response.data\n  }\n\n  /**\n   * è¾…åŠ©æ–¹æ³•ï¼šå»¶è¿Ÿ\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms))\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹\nexport const paymentService = new PaymentService()\n\n// å¯¼å‡ºæ”¯ä»˜æ–¹å¼æšä¸¾\nexport enum PaymentMethod {\n  WECHAT = 'wechat',\n  BALANCE = 'balance',\n  MOCK = 'mock'\n}","import { get, post } from '@/utils/request'\nimport Taro from '@tarojs/taro'\nimport { getCurrentUserId, getCurrentUserPhone, getCurrentUserIdStrict, getCurrentUserInfo } from '@/utils/user'\n\n/**\n * äº¤æ˜“è®°å½•ç±»å‹\n */\nexport interface Transaction {\n  id: string\n  type: 'recharge' | 'consume' | 'refund'\n  amount: number      // æ­£æ•°ä¸ºå¢åŠ ï¼Œè´Ÿæ•°ä¸ºå‡å°‘\n  balance: number     // äº¤æ˜“åä½™é¢\n  description: string\n  orderId?: string    // å…³è”çš„è®¢å•å·\n  createdAt: string\n}\n\n/**\n * å……å€¼é€‰é¡¹é…ç½®\n * âœ… æ‰€æœ‰é‡‘é¢å­—æ®µéƒ½æ˜¯åˆ†ä¸ºå•ä½ï¼ˆæ•´æ•°ï¼‰\n */\nexport interface RechargeOption {\n  id: number\n  amount: number      // å……å€¼é‡‘é¢ï¼ˆåˆ†ï¼‰âœ… åˆ†ä¸ºå•ä½\n  bonus: number       // èµ é€é‡‘é¢ï¼ˆåˆ†ï¼‰âœ… åˆ†ä¸ºå•ä½\n  label: string       // æ˜¾ç¤ºæ ‡ç­¾ï¼ˆç”¨äºUIæ˜¾ç¤ºï¼Œå¦‚\"100å…ƒ\"ï¼‰\n  sortOrder?: number\n  isActive?: boolean\n  description?: string\n  promotionTag?: string\n  isRecommended?: boolean\n}\n\n/**\n * ä½™é¢å“åº”æ•°æ®\n */\ninterface BalanceResponse {\n  balance: number     // ä½™é¢ï¼ˆåˆ†ï¼‰- APIè¿”å›çš„åŸå§‹å•ä½\n  totalSpent: number  // æ€»æ¶ˆè´¹ï¼ˆåˆ†ï¼‰\n  totalVisits: number // æ€»è®¿é—®æ¬¡æ•°\n}\n\n/**\n * äº¤æ˜“è®°å½•å“åº”\n */\ninterface TransactionsResponse {\n  list: Transaction[]\n  total: number\n  page: number\n  pageSize: number\n  hasMore: boolean\n}\n\n/**\n * é’±åŒ…æœåŠ¡ç±»\n * ç”Ÿäº§çº§ä»£ç ï¼šå®Œå…¨ä½¿ç”¨çœŸå®API\n */\nclass WalletService {\n  /**\n   * è·å–å½“å‰ç”¨æˆ·ID\n   * @returns ç”¨æˆ·ID\n   */\n  private getCurrentUserId(): number {\n    return getCurrentUserId()\n  }\n\n  /**\n   * è·å–é’±åŒ…ä½™é¢\n   * âœ… è¿”å›åˆ†ä¸ºå•ä½ï¼Œç”±é¡µé¢å±‚ä½¿ç”¨ formatAmount() è½¬æ¢ä¸ºå…ƒæ˜¾ç¤º\n   * @returns ä½™é¢ä¿¡æ¯ï¼ˆåˆ†ä¸ºå•ä½ï¼‰\n   */\n  async getBalance(): Promise<number> {\n    try {\n      // âœ… ä¸¥æ ¼æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n      const strictUserId = getCurrentUserIdStrict()\n      if (!strictUserId) {\n        throw new Error('è¯·å…ˆç™»å½•')\n      }\n\n      const userId = this.getCurrentUserId()\n      const response = await get<BalanceResponse>('/users/wallet/balance', { userId })\n\n      // âœ… ç›´æ¥è¿”å›APIæ•°æ®ï¼ˆåˆ†ä¸ºå•ä½ï¼‰\n      const balanceInCents = response.data.balance || 0\n      console.log('ğŸ’° ä½™é¢æŸ¥è¯¢:', {\n        åˆ†: balanceInCents,\n        å…ƒ: (balanceInCents / 100).toFixed(2)\n      })\n      return balanceInCents\n    } catch (error) {\n      console.error('è·å–ä½™é¢å¤±è´¥:', error)\n      throw new Error('è·å–ä½™é¢å¤±è´¥ï¼Œè¯·é‡è¯•')\n    }\n  }\n\n  /**\n   * è·å–ä½™é¢è¯¦æƒ…ï¼ˆåŒ…å«ç»Ÿè®¡ä¿¡æ¯ï¼‰\n   * âœ… è¿”å›åˆ†ä¸ºå•ä½ï¼Œç”±é¡µé¢å±‚è´Ÿè´£è½¬æ¢ä¸ºå…ƒæ˜¾ç¤º\n   * @returns ä½™é¢è¯¦æƒ…ï¼ˆåˆ†ä¸ºå•ä½ï¼‰\n   */\n  async getBalanceDetails(): Promise<BalanceResponse> {\n    try {\n      const userId = this.getCurrentUserId()\n      const response = await get<BalanceResponse>('/users/wallet/balance', { userId })\n      // âœ… ç›´æ¥è¿”å›APIæ•°æ®ï¼ˆåˆ†ä¸ºå•ä½ï¼‰ï¼Œä¸è½¬æ¢\n      return response.data\n    } catch (error) {\n      console.error('è·å–ä½™é¢è¯¦æƒ…å¤±è´¥:', error)\n      throw new Error('è·å–ä½™é¢è¯¦æƒ…å¤±è´¥ï¼Œè¯·é‡è¯•')\n    }\n  }\n\n  /**\n   * è·å–å……å€¼é…ç½®é€‰é¡¹\n   * âœ… è¿”å›åˆ†ä¸ºå•ä½ï¼Œé¡µé¢å±‚ç”¨ formatAmount() è½¬æ¢ä¸ºå…ƒæ˜¾ç¤º\n   * @returns å……å€¼é…ç½®åˆ—è¡¨ï¼ˆåˆ†ä¸ºå•ä½ï¼‰\n   */\n  async getRechargeOptions(): Promise<RechargeOption[]> {\n    try {\n      const response = await get<RechargeOption[]>('/recharge/configs')\n\n      // âœ… ç›´æ¥è¿”å›APIæ•°æ®ï¼ˆåˆ†ä¸ºå•ä½ï¼‰\n      return response.data\n    } catch (error) {\n      console.error('è·å–å……å€¼é…ç½®å¤±è´¥:', error)\n      // è¿”å›é»˜è®¤é…ç½®ä½œä¸ºé™çº§æ–¹æ¡ˆ\n      return this.getDefaultRechargeOptions()\n    }\n  }\n\n  /**\n   * è·å–é»˜è®¤å……å€¼é…ç½®ï¼ˆé™çº§æ–¹æ¡ˆï¼‰\n   * âœ… è¿”å›åˆ†ä¸ºå•ä½\n   * @private\n   */\n  private getDefaultRechargeOptions(): RechargeOption[] {\n    return [\n      { id: 1, amount: 10000, bonus: 0, label: '100å…ƒ', sortOrder: 1 },              // 100å…ƒ = 10000åˆ†\n      { id: 2, amount: 20000, bonus: 0, label: '200å…ƒ', sortOrder: 2 },              // 200å…ƒ = 20000åˆ†\n      { id: 3, amount: 50000, bonus: 5000, label: '500å…ƒ', sortOrder: 3, promotionTag: 'èµ 50å…ƒ' },    // 500å…ƒ = 50000åˆ†\n      { id: 4, amount: 100000, bonus: 10000, label: '1000å…ƒ', sortOrder: 4, promotionTag: 'èµ 100å…ƒ' }, // 1000å…ƒ = 100000åˆ†\n      { id: 5, amount: 200000, bonus: 30000, label: '2000å…ƒ', sortOrder: 5, promotionTag: 'èµ 300å…ƒ' }, // 2000å…ƒ = 200000åˆ†\n      { id: 6, amount: 500000, bonus: 100000, label: '5000å…ƒ', sortOrder: 6, promotionTag: 'èµ 1000å…ƒ', isRecommended: true } // 5000å…ƒ = 500000åˆ†\n    ]\n  }\n\n  /**\n   * åˆ›å»ºå……å€¼è®¢å•\n   * @param amount å……å€¼é‡‘é¢ï¼ˆå…ƒï¼‰\n   * @param bonus èµ é€é‡‘é¢ï¼ˆå…ƒï¼‰\n   * @returns è®¢å•ä¿¡æ¯\n   */\n  async createRechargeOrder(amount: number, bonus: number = 0) {\n    try {\n      // âœ… ä¸¥æ ¼æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n      const strictUserId = getCurrentUserIdStrict()\n      if (!strictUserId) {\n        throw new Error('è¯·å…ˆç™»å½•åå†å……å€¼')\n      }\n\n      // âœ… å……å€¼åªæ”¯æŒå¾®ä¿¡æ”¯ä»˜ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰openid\n      const userInfo = getCurrentUserInfo()\n      if (!userInfo?.openid) {\n        throw new Error('å¾®ä¿¡æ”¯ä»˜éœ€è¦å…ˆå®Œæˆå¾®ä¿¡ç™»å½•æˆæƒï¼Œè¯·å‰å¾€\"æˆ‘çš„\"é¡µé¢ç™»å½•')\n      }\n\n      const userId = this.getCurrentUserId()\n      const userPhone = getCurrentUserPhone()\n\n      const amountInCents = amount * 100\n\n      const orderData = {\n        orderType: 'recharge',\n        userId: userId,\n        userPhone: userPhone,\n        title: bonus > 0 ? `å……å€¼${amount}å…ƒï¼Œèµ é€${bonus}å…ƒ` : `å……å€¼${amount}å…ƒ`,\n        amount: amountInCents, // è½¬æ¢ä¸ºåˆ†\n        paymentMethod: 'wechat',\n        extraData: {\n          rechargeAmount: amount * 100,        // âœ… æŒ‰APIæ–‡æ¡£ä½¿ç”¨ rechargeAmount\n          bonus: bonus * 100,                  // è½¬æ¢ä¸ºåˆ†\n          actualAmount: (amount + bonus) * 100 // âœ… æŒ‰APIæ–‡æ¡£ä½¿ç”¨ actualAmount\n        }\n      }\n\n      // ğŸ’° è°ƒè¯•æ—¥å¿—\n      console.log('ğŸ’° åˆ›å»ºå……å€¼è®¢å•')\n      console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·ID:', userId)\n      console.log('ğŸ“ ç”¨æˆ·æ‰‹æœºå·:', userPhone)\n      console.log('ğŸ“¦ è®¢å•æ•°æ®:', {\n        orderType: orderData.orderType,\n        userId: orderData.userId,\n        title: orderData.title,\n        amount: `${orderData.amount}åˆ† (Â¥${(orderData.amount / 100).toFixed(2)})`,\n        paymentMethod: orderData.paymentMethod,\n        extraData: orderData.extraData\n      })\n\n      const response = await post('/orders/create', orderData, {\n        showLoading: true,\n        loadingTitle: 'åˆ›å»ºè®¢å•ä¸­...'\n      })\n\n      console.log('âœ… å……å€¼è®¢å•åˆ›å»ºæˆåŠŸ')\n      console.log('ğŸ“‹ è®¢å•å“åº”:', {\n        orderNo: response.data.orderNo,\n        amount: `${response.data.amount}åˆ† (Â¥${(response.data.amount / 100).toFixed(2)})`,\n        paymentStatus: response.data.paymentStatus,\n        hasWxPayParams: !!response.data.wxPayParams\n      })\n\n      return response.data\n    } catch (error: any) {\n      console.error('âŒ åˆ›å»ºå……å€¼è®¢å•å¤±è´¥:', error)\n\n      // âœ… æå–å®Œæ•´çš„é”™è¯¯ä¿¡æ¯\n      const errorCode = error?.code || error?.response?.data?.code\n      const errorMessage = error?.response?.data?.message\n        || error?.message\n        || 'åˆ›å»ºå……å€¼è®¢å•å¤±è´¥'\n\n      // âœ… è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•\n      console.error('ğŸ“‹ é”™è¯¯è¯¦æƒ…:', {\n        code: errorCode,\n        message: errorMessage,\n        responseData: error?.response?.data,\n        fullError: error\n      })\n\n      // âœ… é’ˆå¯¹ç‰¹å®šé”™è¯¯ç æä¾›æ›´å‹å¥½çš„æç¤º\n      if (errorCode === 1003) {\n        if (errorMessage.includes('openid')) {\n          throw new Error('å¾®ä¿¡æ”¯ä»˜æˆæƒå¤±è´¥ï¼Œè¯·å‰å¾€\"æˆ‘çš„\"é¡µé¢é‡æ–°ç™»å½•')\n        }\n      }\n\n      throw new Error(errorMessage)\n    }\n  }\n\n  /**\n   * è·å–äº¤æ˜“è®°å½•\n   * âœ… è¿”å›åˆ†ä¸ºå•ä½\n   * @param page é¡µç \n   * @param pageSize æ¯é¡µæ•°é‡\n   * @param type äº¤æ˜“ç±»å‹ï¼ˆå¯é€‰ï¼‰\n   * @returns äº¤æ˜“è®°å½•åˆ—è¡¨ï¼ˆé‡‘é¢ä¸ºåˆ†ä¸ºå•ä½ï¼‰\n   */\n  async getTransactions(\n    page: number = 1,\n    pageSize: number = 20,\n    type?: 'recharge' | 'consume' | 'refund'\n  ): Promise<Transaction[]> {\n    try {\n      const userId = this.getCurrentUserId()\n      const params: any = { userId, page, pageSize }\n      if (type) params.type = type\n\n      const response = await get<TransactionsResponse>('/users/wallet/transactions', params)\n\n      // âœ… ç›´æ¥è¿”å›APIæ•°æ®ï¼ˆåˆ†ä¸ºå•ä½ï¼‰\n      return response.data.list\n    } catch (error) {\n      console.error('è·å–äº¤æ˜“è®°å½•å¤±è´¥:', error)\n      return []\n    }\n  }\n\n  /**\n   * ä½¿ç”¨ä½™é¢æ”¯ä»˜\n   * @param orderNo è®¢å•å·\n   * @param amount æ”¯ä»˜é‡‘é¢ï¼ˆåˆ†ï¼‰\n   * @returns æ”¯ä»˜ç»“æœï¼ˆbalanceä¸ºåˆ†ä¸ºå•ä½ï¼‰\n   */\n  async payWithBalance(orderNo: string, amount: number) {\n    try {\n      const response = await post('/orders/pay', {\n        orderNo,\n        paymentMethod: 'balance'\n      }, {\n        showLoading: true,\n        loadingTitle: 'æ”¯ä»˜ä¸­...'\n      })\n\n      return {\n        success: true,\n        balance: response.data.balance,  // âœ… è¿”å›åˆ†ä¸ºå•ä½\n        message: 'æ”¯ä»˜æˆåŠŸ'\n      }\n    } catch (error: any) {\n      console.error('ä½™é¢æ”¯ä»˜å¤±è´¥:', error)\n      throw new Error(error.message || 'ä½™é¢ä¸è¶³æˆ–æ”¯ä»˜å¤±è´¥')\n    }\n  }\n\n  /**\n   * é€€æ¬¾åˆ°ä½™é¢\n   * @param orderNo è®¢å•å·\n   * @param amount é€€æ¬¾é‡‘é¢ï¼ˆåˆ†ï¼‰\n   * @param reason é€€æ¬¾åŸå› \n   * @returns é€€æ¬¾ç»“æœï¼ˆbalanceä¸ºåˆ†ä¸ºå•ä½ï¼‰\n   */\n  async refundToBalance(orderNo: string, amount: number, reason: string = 'è®¢å•é€€æ¬¾') {\n    try {\n      const response = await post('/users/wallet/refund', {\n        phone: getCurrentUserPhone(),\n        amount: amount,  // âœ… å·²ç»æ˜¯åˆ†ä¸ºå•ä½ï¼Œç›´æ¥å‘é€\n        orderNo: orderNo,\n        description: reason\n      }, {\n        showLoading: true,\n        loadingTitle: 'é€€æ¬¾ä¸­...'\n      })\n\n      return {\n        success: true,\n        balance: response.data.balance,  // âœ… è¿”å›åˆ†ä¸ºå•ä½\n        transactionId: response.data.transactionId,\n        message: 'é€€æ¬¾æˆåŠŸ'\n      }\n    } catch (error: any) {\n      console.error('é€€æ¬¾å¤±è´¥:', error)\n      throw new Error(error.message || 'é€€æ¬¾å¤±è´¥')\n    }\n  }\n\n  /**\n   * æ¸…ç©ºæœ¬åœ°ç¼“å­˜\n   */\n  clearCache(): void {\n    try {\n      Taro.removeStorageSync('userInfo')\n      Taro.removeStorageSync('walletCache')\n      console.log('é’±åŒ…ç¼“å­˜å·²æ¸…ç©º')\n    } catch (error) {\n      console.error('æ¸…ç©ºç¼“å­˜å¤±è´¥:', error)\n    }\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹å®ä¾‹\nexport const walletService = new WalletService()","/**\n * ç¤¼åˆ¸ç›¸å…³ç±»å‹å®šä¹‰\n */\n\nexport interface Voucher {\n  id: string\n  userId: string\n  type: 'discount' | 'cash' | 'gift'  // æŠ˜æ‰£åˆ¸ã€ç°é‡‘åˆ¸ã€ç¤¼å“åˆ¸\n  name: string                        // åˆ¸åç§°\n  description: string                 // æè¿°\n  discountRate?: number              // æŠ˜æ‰£ç‡ï¼šå¦‚ 0.68 è¡¨ç¤º68æŠ˜\n  discountPercentage?: number        // æŠ˜æ‰£ç™¾åˆ†æ¯”ï¼šå¦‚ 32 è¡¨ç¤º32%ä¼˜æƒ \n  cashValue?: number                 // ç°é‡‘é¢å€¼ï¼ˆåˆ†ï¼‰\n  minAmount?: number                 // æœ€ä½æ¶ˆè´¹é‡‘é¢ï¼ˆåˆ†ï¼‰\n  validFrom: string                  // ç”Ÿæ•ˆæ—¶é—´\n  validTo: string                    // è¿‡æœŸæ—¶é—´\n  status: 'unused' | 'used' | 'expired' // åˆ¸çŠ¶æ€\n  usedAt?: string                    // ä½¿ç”¨æ—¶é—´\n  orderNo?: string                   // å…³è”è®¢å•å·\n  isAutoApply?: boolean              // æ˜¯å¦è‡ªåŠ¨åº”ç”¨\n}\n\n/**\n * æ ¹æ®æŠ˜æ‰£ç‡ç”Ÿæˆè™šæ‹Ÿä¼˜æƒ åˆ¸\n */\nexport function generateVoucherFromDiscountRate(discountRate: number, userId: string): Voucher | null {\n  if (!discountRate || discountRate >= 1) {\n    return null // æ— æŠ˜æ‰£æˆ–æŠ˜æ‰£ç‡æ— æ•ˆ\n  }\n\n  const discountPercentage = Math.round((1 - discountRate) * 100)\n  const now = new Date()\n  const oneYearLater = new Date(now.getTime() + 365 * 24 * 60 * 60 * 1000)\n\n  return {\n    id: `virtual_${userId}_discount`,\n    userId: userId.toString(),\n    type: 'discount',\n    name: discountPercentage >= 30 ? 'æ–°äººä¸“äº«åˆ¸' : 'ä¼šå‘˜æŠ˜æ‰£åˆ¸',\n    description: `å…¨åœºæœåŠ¡${Math.round(discountRate * 100)}æŠ˜`,\n    discountRate: discountRate,\n    discountPercentage: discountPercentage,\n    validFrom: now.toISOString(),\n    validTo: oneYearLater.toISOString(),\n    status: 'unused',\n    isAutoApply: true\n  }\n}\n\n/**\n * è®¡ç®—æŠ˜æ‰£åçš„ä»·æ ¼\n */\nexport function calculateDiscountPrice(originalPrice: number, discountRate: number): {\n  originalPrice: number\n  finalPrice: number\n  savedAmount: number\n  discountDisplay: string\n} {\n  const finalPrice = Math.round(originalPrice * discountRate)\n  const savedAmount = originalPrice - finalPrice\n  const discountPercentage = Math.round(discountRate * 100)\n\n  return {\n    originalPrice,\n    finalPrice,\n    savedAmount,\n    discountDisplay: `${discountPercentage}æŠ˜`\n  }\n}","/**\n * ç¤¼åˆ¸æœåŠ¡\n */\nimport { Voucher, generateVoucherFromDiscountRate } from '@/types/voucher'\nimport { getCurrentUserInfo } from '@/utils/user'\nimport Taro from '@tarojs/taro'\n\nclass VoucherService {\n  private vouchers: Voucher[] = []\n  private currentVoucher: Voucher | null = null\n\n  /**\n   * è·å–å½“å‰ç”¨æˆ·çš„ç¤¼åˆ¸åˆ—è¡¨\n   */\n  async getMyVouchers(): Promise<Voucher[]> {\n    const userInfo = getCurrentUserInfo()\n    if (!userInfo) {\n      return []\n    }\n\n    // æ ¹æ®ç”¨æˆ·æŠ˜æ‰£ç‡ç”Ÿæˆè™šæ‹Ÿåˆ¸\n    if (userInfo.discountRate && userInfo.discountRate < 1) {\n      const voucher = generateVoucherFromDiscountRate(userInfo.discountRate, userInfo.id.toString())\n      if (voucher) {\n        this.vouchers = [voucher]\n        return [voucher]\n      }\n    }\n\n    return []\n  }\n\n  /**\n   * è·å–å¯ç”¨ç¤¼åˆ¸åˆ—è¡¨\n   */\n  async getAvailableVouchers(orderAmount: number): Promise<Voucher[]> {\n    const allVouchers = await this.getMyVouchers()\n    const now = new Date()\n\n    return allVouchers.filter(voucher => {\n      // æ£€æŸ¥çŠ¶æ€\n      if (voucher.status !== 'unused') return false\n\n      // æ£€æŸ¥æœ‰æ•ˆæœŸ\n      const validFrom = new Date(voucher.validFrom)\n      const validTo = new Date(voucher.validTo)\n      if (now < validFrom || now > validTo) return false\n\n      // æ£€æŸ¥æœ€ä½æ¶ˆè´¹é‡‘é¢\n      if (voucher.minAmount && orderAmount < voucher.minAmount) return false\n\n      return true\n    })\n  }\n\n  /**\n   * è®¾ç½®å½“å‰é€‰ä¸­çš„ç¤¼åˆ¸\n   */\n  setCurrentVoucher(voucher: Voucher | null) {\n    this.currentVoucher = voucher\n    // å­˜å‚¨åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿è®¢å•é¡µé¢ä½¿ç”¨\n    if (voucher) {\n      Taro.setStorageSync('selectedVoucher', voucher)\n    } else {\n      Taro.removeStorageSync('selectedVoucher')\n    }\n  }\n\n  /**\n   * è·å–å½“å‰é€‰ä¸­çš„ç¤¼åˆ¸\n   */\n  getCurrentVoucher(): Voucher | null {\n    if (!this.currentVoucher) {\n      // å°è¯•ä»æœ¬åœ°å­˜å‚¨æ¢å¤\n      try {\n        this.currentVoucher = Taro.getStorageSync('selectedVoucher')\n      } catch (e) {\n        console.error('è·å–é€‰ä¸­ç¤¼åˆ¸å¤±è´¥:', e)\n      }\n    }\n    return this.currentVoucher\n  }\n\n  /**\n   * æ ‡è®°ç¤¼åˆ¸ä¸ºå·²ä½¿ç”¨\n   */\n  markVoucherAsUsed(voucherId: string, orderNo: string) {\n    const voucher = this.vouchers.find(v => v.id === voucherId)\n    if (voucher) {\n      voucher.status = 'used'\n      voucher.usedAt = new Date().toISOString()\n      voucher.orderNo = orderNo\n    }\n    // æ¸…é™¤é€‰ä¸­çš„åˆ¸\n    this.setCurrentVoucher(null)\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦ä¸ºæ–°ç”¨æˆ·ï¼ˆæœ‰æ–°äººåˆ¸ï¼‰\n   */\n  isNewUser(): boolean {\n    const userInfo = getCurrentUserInfo()\n    if (!userInfo || !userInfo.discountRate) return false\n\n    // 32%åŠä»¥ä¸Šçš„ä¼˜æƒ è®¤ä¸ºæ˜¯æ–°ç”¨æˆ·\n    const discountPercentage = Math.round((1 - userInfo.discountRate) * 100)\n    return discountPercentage >= 30\n  }\n\n  /**\n   * è·å–æ–°äººç¤¼åˆ¸ä¿¡æ¯ï¼ˆç”¨äºå¼¹çª—å±•ç¤ºï¼‰\n   */\n  getNewUserVoucherInfo(): {\n    hasVoucher: boolean\n    discountPercentage?: number\n    description?: string\n  } {\n    const userInfo = getCurrentUserInfo()\n    if (!userInfo || !userInfo.discountRate || userInfo.discountRate >= 1) {\n      return { hasVoucher: false }\n    }\n\n    const discountPercentage = Math.round((1 - userInfo.discountRate) * 100)\n    return {\n      hasVoucher: true,\n      discountPercentage,\n      description: `æ­å–œè·å¾—æ–°äººä¸“äº«${discountPercentage}%ä¼˜æƒ åˆ¸ï¼`\n    }\n  }\n}\n\nexport const voucherService = new VoucherService()","import { post, get } from '@/utils/request'\nimport Taro from '@tarojs/taro'\nimport { API_CONFIG } from '@/config/api'\n\n/**\n * è¯„ä»·æ•°æ®æ¥å£\n */\nexport interface ReviewData {\n  reviewId: number | string\n  appointmentId: number\n  userId?: number\n  userName?: string\n  userAvatar?: string\n  therapistId?: string | number\n  therapistName?: string\n  therapistAvatar?: string\n  storeId?: string | number\n  storeName?: string\n  rating: number\n  content: string\n  tags?: string[]\n  appointmentDate?: string\n  serviceType?: string\n  createdAt: string\n  updatedAt?: string\n}\n\n/**\n * åˆ›å»ºè¯„ä»·å‚æ•°\n */\nexport interface CreateReviewParams {\n  appointmentId: number\n  therapistId?: string\n  rating: number\n  content: string\n  tags?: string[]\n}\n\n/**\n * è¯„ä»·åˆ—è¡¨å“åº”\n */\nexport interface ReviewListResponse {\n  list: ReviewData[]\n  total: number\n  page: number\n  pageSize: number\n  hasMore: boolean\n}\n\n/**\n * è¯„ä»·ç»Ÿè®¡æ•°æ®\n */\nexport interface ReviewStats {\n  totalCount: number\n  averageRating: number\n  ratingBreakdown: {\n    '1': number\n    '2': number\n    '3': number\n    '4': number\n    '5': number\n  }\n}\n\n/**\n * è¯„ä»·æœåŠ¡ç±»\n */\nclass ReviewService {\n  /**\n   * åˆ›å»ºè¯„ä»·\n   * @param params è¯„ä»·å‚æ•°\n   * @returns è¯„ä»·ç»“æœ\n   */\n  async createReview(params: CreateReviewParams): Promise<ReviewData> {\n    // å‚æ•°éªŒè¯\n    if (params.content.length < 1) {\n      throw new Error('è¯„ä»·å†…å®¹ä¸èƒ½ä¸ºç©º')\n    }\n\n    if (params.content.length > 500) {\n      throw new Error('è¯„ä»·å†…å®¹ä¸èƒ½è¶…è¿‡500å­—')\n    }\n\n    if (params.rating < 1 || params.rating > 5) {\n      throw new Error('è¯„åˆ†å¿…é¡»åœ¨1-5ä¹‹é—´')\n    }\n\n    try {\n      const response = await post('/reviews', params, {\n        showLoading: true,\n        loadingTitle: 'æäº¤è¯„ä»·ä¸­...'\n      })\n\n      // è§¦å‘è¯„ä»·æˆåŠŸäº‹ä»¶ï¼ˆå¯ç”¨äºæ›´æ–°ç¼“å­˜ï¼‰\n      Taro.eventCenter.trigger('review:created', response.data)\n\n      return response.data\n    } catch (error: any) {\n      console.error('åˆ›å»ºè¯„ä»·å¤±è´¥:', error)\n      throw new Error(error.message || 'åˆ›å»ºè¯„ä»·å¤±è´¥')\n    }\n  }\n\n  /**\n   * è·å–æ¨æ‹¿å¸ˆè¯„ä»·åˆ—è¡¨\n   * @param therapistId æ¨æ‹¿å¸ˆID\n   * @param page é¡µç \n   * @param pageSize æ¯é¡µæ•°é‡\n   * @param rating è¯„åˆ†ç­›é€‰\n   * @returns è¯„ä»·åˆ—è¡¨\n   */\n  async getTherapistReviews(\n    therapistId: string | number,\n    page: number = 1,\n    pageSize: number = 10,\n    rating?: number\n  ): Promise<ReviewListResponse> {\n    try {\n      const params: any = { page, pageSize }\n      if (rating) {\n        params.rating = rating\n      }\n\n      const response = await get(`/therapists/${therapistId}/reviews`, params)\n      return response.data\n    } catch (error: any) {\n      console.error('è·å–æ¨æ‹¿å¸ˆè¯„ä»·å¤±è´¥:', error)\n      return {\n        list: [],\n        total: 0,\n        page,\n        pageSize,\n        hasMore: false\n      }\n    }\n  }\n\n  /**\n   * è·å–ç”¨æˆ·è¯„ä»·å†å²\n   * @param userId ç”¨æˆ·ID\n   * @param page é¡µç \n   * @param pageSize æ¯é¡µæ•°é‡\n   * @returns è¯„ä»·åˆ—è¡¨\n   */\n  async getUserReviews(\n    userId: number,\n    page: number = 1,\n    pageSize: number = 10\n  ): Promise<ReviewListResponse> {\n    try {\n      const response = await get(`/users/${userId}/reviews`, {\n        page,\n        pageSize\n      })\n      return response.data\n    } catch (error: any) {\n      console.error('è·å–ç”¨æˆ·è¯„ä»·å¤±è´¥:', error)\n      return {\n        list: [],\n        total: 0,\n        page,\n        pageSize,\n        hasMore: false\n      }\n    }\n  }\n\n  /**\n   * è·å–è¯„ä»·è¯¦æƒ…\n   * @param reviewId è¯„ä»·ID\n   * @returns è¯„ä»·è¯¦æƒ…\n   */\n  async getReviewDetail(reviewId: string | number): Promise<ReviewData> {\n    try {\n      const response = await get(`/reviews/${reviewId}`)\n      return response.data\n    } catch (error: any) {\n      console.error('è·å–è¯„ä»·è¯¦æƒ…å¤±è´¥:', error)\n      throw new Error(error.message || 'è¯„ä»·ä¸å­˜åœ¨')\n    }\n  }\n\n  /**\n   * è·å–æ¨æ‹¿å¸ˆè¯„ä»·ç»Ÿè®¡\n   * @param therapistId æ¨æ‹¿å¸ˆID\n   * @returns è¯„ä»·ç»Ÿè®¡\n   */\n  async getReviewStats(therapistId: string | number): Promise<ReviewStats> {\n    try {\n      const response = await get(`/therapists/${therapistId}/review-stats`)\n      return response.data\n    } catch (error: any) {\n      console.error('è·å–è¯„ä»·ç»Ÿè®¡å¤±è´¥:', error)\n      // è¿”å›é»˜è®¤ç»Ÿè®¡æ•°æ®\n      return {\n        totalCount: 0,\n        averageRating: 0,\n        ratingBreakdown: {\n          '1': 0,\n          '2': 0,\n          '3': 0,\n          '4': 0,\n          '5': 0\n        }\n      }\n    }\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦å¯ä»¥è¯„ä»·\n   * @param appointmentId é¢„çº¦ID\n   * @returns æ˜¯å¦å¯ä»¥è¯„ä»·\n   */\n  async checkCanReview(appointmentId: number): Promise<boolean> {\n    try {\n      // ç›´æ¥ä½¿ç”¨Taro.requestæ¥é¿å…request.tsçš„é”™è¯¯æ—¥å¿—\n      const response = await Taro.request({\n        url: `${API_CONFIG.baseURL}/reviews/${appointmentId}`,\n        method: 'GET',\n        header: {\n          'Content-Type': 'application/json'\n        },\n        timeout: API_CONFIG.timeout\n      })\n\n      const result = response.data as any\n\n      // å¦‚æœè¿”å›code 1002ï¼ˆè¯„ä»·ä¸å­˜åœ¨ï¼‰ï¼Œè¯´æ˜å¯ä»¥è¯„ä»·\n      if (result.code === 1002) {\n        console.log('è¯„ä»·ä¸å­˜åœ¨ï¼Œå¯ä»¥åˆ›å»ºè¯„ä»·')\n        return true\n      }\n\n      // å¦‚æœè¿”å›code 0ä¸”æœ‰æ•°æ®ï¼Œè¯´æ˜å·²è¯„ä»·\n      if (result.code === 0 && result.data?.reviewId) {\n        console.log('è¯„ä»·å·²å­˜åœ¨ï¼Œä¸èƒ½å†è¯„ä»·')\n        return false\n      }\n\n      // å…¶ä»–æƒ…å†µé»˜è®¤å¯ä»¥è¯„ä»·\n      return true\n    } catch (error: any) {\n      // ç½‘ç»œé”™è¯¯ç­‰æƒ…å†µï¼Œé»˜è®¤å…è®¸è¯„ä»·\n      console.warn('æ£€æŸ¥è¯„ä»·çŠ¶æ€æ—¶å‘ç”Ÿé”™è¯¯ï¼Œé»˜è®¤å…è®¸è¯„ä»·')\n      return true\n    }\n  }\n\n  /**\n   * æ‰¹é‡è·å–è¯„ä»·çŠ¶æ€\n   * @param appointmentIds é¢„çº¦IDåˆ—è¡¨\n   * @returns è¯„ä»·çŠ¶æ€æ˜ å°„\n   */\n  async batchCheckReviewStatus(\n    appointmentIds: number[]\n  ): Promise<Record<number, boolean>> {\n    const result: Record<number, boolean> = {}\n\n    // å¹¶å‘æ£€æŸ¥æ‰€æœ‰é¢„çº¦çš„è¯„ä»·çŠ¶æ€\n    const promises = appointmentIds.map(async (id) => {\n      const canReview = await this.checkCanReview(id)\n      result[id] = canReview\n    })\n\n    await Promise.allSettled(promises)\n    return result\n  }\n\n  /**\n   * æ¸…é™¤ç¼“å­˜\n   */\n  clearCache() {\n    try {\n      // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„è¯„ä»·ç›¸å…³ç¼“å­˜\n      const keys = Taro.getStorageInfoSync().keys\n      keys.forEach(key => {\n        if (key.startsWith('review_cache_')) {\n          Taro.removeStorageSync(key)\n        }\n      })\n    } catch (error) {\n      console.error('æ¸…é™¤è¯„ä»·ç¼“å­˜å¤±è´¥:', error)\n    }\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹å®ä¾‹\nexport const reviewService = new ReviewService()","import React from 'react'\nimport Taro from '@tarojs/taro'\nimport { View, Text } from '@tarojs/components'\nimport './index.scss'\n\ninterface BookingButtonProps {\n  size?: 'small' | 'medium' | 'large'\n  text?: string\n}\n\nconst BookingButton: React.FC<BookingButtonProps> = ({\n  size = 'medium',\n  text = 'é¢„çº¦'\n}) => {\n  return (\n    <View \n      className={`booking-button booking-button-${size}`}\n    >\n      <Text className=\"button-text\">{text}</Text>\n    </View>\n  )\n}\n\nexport default BookingButton"],"names":["API_CONFIG","baseURL","timeout","retry","ERROR_CODES","SUCCESS","PARAM_ERROR","INVALID_INPUT","NOT_FOUND","DUPLICATE","INVALID_STATE","OPERATION_FAILED","INSUFFICIENT_BALANCE","QUOTA_EXCEEDED","INVALID_PHONE","USER_NOT_FOUND","UNAUTHORIZED","FORBIDDEN","TOKEN_EXPIRED","INVALID_TOKEN","SESSION_EXPIRED","INTERNAL_ERROR","SERVICE_UNAVAILABLE","DATABASE_ERROR","EXTERNAL_API_ERROR","PAYMENT_ERROR","PAYMENT_TIMEOUT","SMS_ERROR","WECHAT_ERROR","ERROR_MESSAGE_MAP","getErrorMessage","code","defaultMessage","isAuthError","includes","request","url","options","method","data","header","showLoading","loadingTitle","Taro","title","mask","response","hideLoading","result","error","message","console","warn","removeStorageSync","errorMessage","Error","status","statusCode","get","params","queryString","Object","keys","filter","key","undefined","map","encodeURIComponent","join","post","CDN_BASE","ASSETS_CONFIG","baseUrl","giftCard","member","electronic","product","banners","goodnight","therapists","default","getCurrentUserInfo","userInfo","getStorageSync","getCurrentUserId","id","getCurrentUserPhone","phone","setUserInfo","setStorageSync","maskPhone","replace","wechatLogin","login","needBindPhone","fetchUserInfo","localUserInfo","username","nickname","avatar","openid","membershipNumber","memberLevel","balance","totalSpent","totalVisits","discountRate","discount_rate","getCurrentUserIdStrict","requireLogin","showToast","icon","setTimeout","redirectTo","checkAndAutoLogin","freshUserInfo","loginResult","GIFT_CARDS","type","name","image","description","features","terms","NUANTIE_PRODUCTS","price","originalPrice","unit","specifications","AIJIU_PRODUCTS","PRODUCTS","GiftService","getAllGiftCards","getGiftCardById","find","card","getAllProducts","getProductById","getNuantieProducts","getAijiuProducts","createGiftCardOrder","strictUserId","paymentMethod","userId","orderData","orderType","amount","toFixed","quantity","extraData","productType","productId","cardId","productName","cardType","faceValue","customMessage","log","orderNo","paymentStatus","hasWxPayParams","wxPayParams","errorCode","responseData","fullError","createProductOrder","normalizeImageUrl","startsWith","StoreService","getNearbyStores","latitude","longitude","page","pageSize","normalizedStores","list","store","images","img","getStoreDetail","storeId","searchStores","keyword","total","hasMore","getStoresByStatus","storeService","LocationService","getCurrentLocation","settingRes","getSetting","authSetting","authorize","scope","res","getLocation","isHighAccuracy","gcj02Error","errorMsg","errMsg","showModal","content","confirmText","success","confirm","openSetting","calculateDistance","lat1","lng1","lat2","lng2","rad","Math","PI","R","dLat","dLng","a","sin","cos","c","atan2","sqrt","Number","formatDistance","distance","round","getLocationService","ShoppingCart","items","therapist","onCheckout","onMaskClick","onRemoveItem","isExpanded","setIsExpanded","useState","countdown","setCountdown","timerRef","useRef","totalOriginalPrice","reduce","sum","item","totalDiscountPrice","discountPrice","totalSavings","hasItems","length","useEffect","current","setInterval","prev","clearInterval","formatCountdown","seconds","mins","floor","secs","toString","padStart","formatDate","dateStr","date","Date","today","isToday","toDateString","month","getMonth","day","getDate","handleCheckoutClick","handleMaskClick","handleConfirmCheckout","jsx","View","jsxs","Fragment","Text","index","Image","therapistAvatar","therapistName","duration","serviceName","time","hour","minute","split","endMinute","endHour","finalMinute","symptomCategories","order","classifyServiceByName","symptomService","getCategories","getTherapistSymptomServices","therapistId","therapistResponse","storeData","services","categorizedServices","service","categoryId","availability","getStoreSymptomServices","getServicesByCategory","allServicesResponse","allServices","filteredServices","TherapistService","getRecommendedTherapists","userLocation","getRecommendedTherapistsWithDistance","normalizedTherapists","therapistsWithDistance","Promise","all","sort","b","getTherapistsByStore","therapistArray","Array","isArray","getTherapistDetail","getTherapistsByExpertise","expertise","searchTherapists","getAvailableSlots","getTherapistsAvailability","days","therapistService","OrderService","getUserInfo","userPhone","getDisplayStatus","appointmentStatus","appointmentDate","startTime","appointmentDateTime","endDateTime","getTime","now","enrichOrderWithStoreAndTherapistInfo","promises","storeName","push","then","storeResponse","storeAddress","address","catch","defaultStore","getDefaultStoreInfo","allSettled","enrichOrderListWithStoreAndTherapistInfo","orders","storeIds","Set","therapistIds","forEach","add","storeMap","Map","therapistMap","invalidStoreIds","from","set","validOrders","has","createAppointmentOrder","requestData","appointmentTime","serviceId","isNaN","appointment","getPaymentParams","paymentParams","total_fee","timeStamp","nonceStr","substring","package","signType","paySign","updateOrderStatus","paidAt","toISOString","getOrderDetail","appointmentId","displayStatus","getOrderList","cancelOrder","reason","requestRefund","getRefundDetail","refundId","rebookOrder","originalOrder","getOrderStatistics","pendingPayment","o","paid","completed","cancelled","orderService","centsToYuan","amountInCents","formatAmount","symbol","suffix","precision","yuan","PaymentService","constructor","config","useMockPayment","enableBalancePayment","enableWechatPayment","pay","payWithBalance","payWithWechat","balanceInYuan","requiredFields","missingFields","field","requestPayment","errCode","checkPaymentEnvironment","canUseWechatPay","canUseBalance","generateRechargeCode","delay","ms","resolve","paymentService","WalletService","getBalance","balanceInCents","åˆ†","å…ƒ","getBalanceDetails","getRechargeOptions","getDefaultRechargeOptions","bonus","label","sortOrder","promotionTag","isRecommended","createRechargeOrder","rechargeAmount","actualAmount","getTransactions","refundToBalance","transactionId","clearCache","walletService","generateVoucherFromDiscountRate","discountPercentage","oneYearLater","validFrom","validTo","isAutoApply","calculateDiscountPrice","finalPrice","savedAmount","discountDisplay","VoucherService","vouchers","currentVoucher","getMyVouchers","voucher","getAvailableVouchers","orderAmount","allVouchers","minAmount","setCurrentVoucher","getCurrentVoucher","e","markVoucherAsUsed","voucherId","v","usedAt","isNewUser","getNewUserVoucherInfo","hasVoucher","voucherService","ReviewService","createReview","rating","eventCenter","trigger","getTherapistReviews","getUserReviews","getReviewDetail","reviewId","getReviewStats","totalCount","averageRating","ratingBreakdown","checkCanReview","batchCheckReviewStatus","appointmentIds","canReview","getStorageInfoSync","reviewService","BookingButton","size","text"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAO,MAAMA,aAAa;AAAA;AAAA;AAAA;AAAA,EAIxBC,SAAS;AAAA,EACTC,SAAS;AAAA,EACTC,OAAO;AACT;ACIO,MAAMC,cAAc;AAAA;AAAA,EAEzBC,SAAS;AAAA;AAAA,EAGTC,aAAa;AAAA;AAAA,EACbC,eAAe;AAAA;AAAA,EACfC,WAAW;AAAA;AAAA,EACXC,WAAW;AAAA;AAAA,EACXC,eAAe;AAAA;AAAA,EACfC,kBAAkB;AAAA;AAAA,EAClBC,sBAAsB;AAAA;AAAA,EACtBC,gBAAgB;AAAA;AAAA,EAChBC,eAAe;AAAA;AAAA,EACfC,gBAAgB;AAAA;AAAA;AAAA,EAGhBC,cAAc;AAAA;AAAA,EACdC,WAAW;AAAA;AAAA,EACXC,eAAe;AAAA;AAAA,EACfC,eAAe;AAAA;AAAA,EACfC,iBAAiB;AAAA;AAAA;AAAA,EAGjBC,gBAAgB;AAAA;AAAA,EAChBC,qBAAqB;AAAA;AAAA,EACrBC,gBAAgB;AAAA;AAAA,EAChBC,oBAAoB;AAAA;AAAA;AAAA,EAGpBC,eAAe;AAAA;AAAA,EACfC,iBAAiB;AAAA;AAAA,EACjBC,WAAW;AAAA;AAAA,EACXC,cAAc;AAAA;AAChB;AAMO,MAAMC,oBAA4C;AAAA,EACvD,CAACzB,YAAYC,OAAO,GAAG;AAAA,EACvB,CAACD,YAAYE,WAAW,GAAG;AAAA,EAC3B,CAACF,YAAYG,aAAa,GAAG;AAAA,EAC7B,CAACH,YAAYI,SAAS,GAAG;AAAA,EACzB,CAACJ,YAAYK,SAAS,GAAG;AAAA,EACzB,CAACL,YAAYM,aAAa,GAAG;AAAA,EAC7B,CAACN,YAAYO,gBAAgB,GAAG;AAAA,EAChC,CAACP,YAAYQ,oBAAoB,GAAG;AAAA,EACpC,CAACR,YAAYS,cAAc,GAAG;AAAA,EAC9B,CAACT,YAAYU,aAAa,GAAG;AAAA,EAC7B,CAACV,YAAYW,cAAc,GAAG;AAAA,EAC9B,CAACX,YAAYY,YAAY,GAAG;AAAA,EAC5B,CAACZ,YAAYa,SAAS,GAAG;AAAA,EACzB,CAACb,YAAYc,aAAa,GAAG;AAAA,EAC7B,CAACd,YAAYe,aAAa,GAAG;AAAA,EAC7B,CAACf,YAAYgB,eAAe,GAAG;AAAA,EAC/B,CAAChB,YAAYiB,cAAc,GAAG;AAAA,EAC9B,CAACjB,YAAYkB,mBAAmB,GAAG;AAAA,EACnC,CAAClB,YAAYmB,cAAc,GAAG;AAAA,EAC9B,CAACnB,YAAYoB,kBAAkB,GAAG;AAAA,EAClC,CAACpB,YAAYqB,aAAa,GAAG;AAAA,EAC7B,CAACrB,YAAYsB,eAAe,GAAG;AAAA,EAC/B,CAACtB,YAAYuB,SAAS,GAAG;AAAA,EACzB,CAACvB,YAAYwB,YAAY,GAAG;AAC9B;AAQgBE,SAAAA,gBAAgBC,MAAcC,gBAAiC;AACtEH,SAAAA,kBAAkBE,IAAI,KAAKC,kBAAkB;AACtD;AAKO,SAASC,YAAYF,MAAuB;AAC1C,SAAA,CACL3B,YAAYY,cACZZ,YAAYc,eACZd,YAAYe,eACZf,YAAYgB,eAAe,EAC3Bc,SAASH,IAAI;AACjB;AC1EA,SAAsBI,QACpBC,IAEyB;AAAA,6CAFzBA,KACAC,UAA0B,IACD;AACnB,UAAA;AAAA,MACJC,SAAS;AAAA,MACTC;AAAAA,MACAC,SAAS,CAAC;AAAA,MACVC,cAAc;AAAA,MACdC,eAAe;AAAA,IACbL,IAAAA;AAGJ,QAAII,aAAa;AACfE,WAAAA,KAAKF,YAAY;AAAA,QAAEG,OAAOF;AAAAA,QAAcG,MAAM;AAAA,MAAA,CAAM;AAAA,IACtD;AAEI,QAAA;AACIC,YAAAA,WAAW,MAAMH,KAAAA,KAAKR,QAAQ;AAAA,QAClCC,KAAK,GAAGpC,WAAWC,OAAO,GAAGmC,GAAG;AAAA,QAChCE;AAAAA,QACAC;AAAAA,QACAC,QAAQ;AAAA,UACN,gBAAgB;AAAA,WACbA;AAAAA,QAELtC,SAASF,WAAWE;AAAAA,MAAAA,CACrB;AAGD,UAAIuC,aAAa;AACfE,aAAAA,KAAKI,YAAY;AAAA,MACnB;AAGA,YAAMC,SAASF,SAASP;AAGpBS,UAAAA,OAAOjB,SAAS3B,YAAYC,SAAS;AAC/B4C,gBAAAA,MAAM,YAAYb,GAAG,IAAI;AAAA,UAC/BL,MAAMiB,OAAOjB;AAAAA,UACbmB,SAASF,OAAOE;AAAAA,UAChBX,MAAMS;AAAAA,QAAAA,CACP;AAGGf,YAAAA,YAAYe,OAAOjB,IAAI,GAAG;AAE5BoB,kBAAQC,KAAK,aAAa;AAC1BT,oBAAKU,kBAAkB,UAAU;AACjCV,oBAAKU,kBAAkB,WAAW;AAAA,QAEpC;AAEA,cAAMC,eAAexB,gBAAgBkB,OAAOjB,MAAMiB,OAAOE,OAAO;AAC1DD,cAAAA,QAAa,IAAIM,MAAMD,YAAY;AACzCL,cAAMlB,OAAOiB,OAAOjB;AACpBkB,cAAMH,WAAW;AAAA,UACfU,QAAQV,SAASW;AAAAA,UACjBlB,MAAMS;AAAAA,QAAAA;AAEFC,cAAAA;AAAAA,MACR;AAEOD,aAAAA;AAAAA,aACAC,OAAY;AAEnB,UAAIR,aAAa;AACfE,aAAAA,KAAKI,YAAY;AAAA,MACnB;AAGAI,cAAQF,MAAM,YAAYb,GAAG,IAAIa,KAAK;AAGhCA,YAAAA;AAAAA,IACR;AAAA,EACF;AAAA;AAKO,MAAMS,MAAM,CAAUtB,KAAauB,QAActB,YAA6B;AAEnF,QAAMuB,cAAcD,SAClB,MAAME,OAAOC,KAAKH,MAAM,EACrBI,OAAOC,CAAAA,QAAOL,OAAOK,GAAG,MAAMC,UAAaN,OAAOK,GAAG,MAAM,IAAI,EAC/DE,IAAIF,CAAAA,QAAO,GAAGA,GAAG,IAAIG,mBAAmBR,OAAOK,GAAG,CAAC,CAAC,EAAE,EACtDI,KAAK,GAAG,IAAI;AAEVjC,SAAAA,QAAWC,MAAMwB,aAAa,iCAAKvB,UAAL;AAAA,IAAcC,QAAQ;AAAA,EAAA,EAAO;AACpE;AAKO,MAAM+B,OAAO,CAAUjC,KAAaG,MAAYF,YAA6B;AAClF,SAAOF,QAAWC,KAAK,iCAAKC,UAAL;AAAA,IAAcC,QAAQ;AAAA,IAAQC;AAAAA,EAAAA,EAAM;AAC7D;ACrGA,MAAM+B,WAAW;AAEV,MAAMC,gBAAgB;AAAA;AAAA,EAE3BC,SAASF;AAAAA;AAAAA,EAGTG,UAAU;AAAA,IACRC,QAAQ,GAAGJ,QAAQ;AAAA,IACnBK,YAAY,GAAGL,QAAQ;AAAA,EACzB;AAAA;AAAA,EAGAM,SAAS,CAAC;AAAA;AAAA;AAAA,EAIVC,SAAS;AAAA,IACPC,WAAW;AAAA,EACb;AAAA;AAAA;AAAA,EAIAC,YAAY;AAAA,IACVP,SAAS,GAAGF,QAAQ;AAAA,EACtB;AAAA;AAAA,EAGAU,SAAS,GAAGV,QAAQ;AACtB;ACxBO,MAAMW,qBAAqBA,MAAuB;AACnD,MAAA;AACIC,UAAAA,WAAWvC,KAAAA,KAAKwC,eAAe,UAAU;AAC/C,WAAOD,YAAY;AAAA,WACZjC,OAAO;AACNA,YAAAA,MAAM,aAAaA,KAAK;AACzB,WAAA;AAAA,EACT;AACF;AAMO,MAAMmC,mBAAmBA,MAAc;AAC5C,QAAMF,WAAWD;AACjB,UAAOC,qCAAUG,OAAM;AACzB;AAMO,MAAMC,sBAAsBA,MAAc;AAC/C,QAAMJ,WAAWD;AACjB,UAAOC,qCAAUK,UAAS;AAC5B;AAKaC,MAAAA,cAAcA,CAACN,aAA6B;AACnD,MAAA;AACGO,SAAAA,KAAAA,eAAe,YAAYP,QAAQ;AAAA,WACjCjC,OAAO;AACNA,YAAAA,MAAM,aAAaA,KAAK;AAAA,EAClC;AACF;AAgBayC,MAAAA,YAAYA,CAACH,UAA0B;AAClD,MAAI,CAACA;AAAc,WAAA;AACZA,SAAAA,MAAMI,QAAQ,uBAAuB,UAAU;AACxD;AAaO,MAAMC,cAAc,MAAwC;AAC7D,MAAA;AAEI,UAAA;AAAA,MAAE7D;AAAAA,IAAAA,IAAS,MAAMY,KAAAA,KAAKkD;AAGtB/C,UAAAA,WAAW,MAAMuB,KAAK,uBAAuB;AAAA,MAAEtC;AAAAA,IAAAA,CAAM;AAE3D,QAAIe,SAASP,MAAM;AAEjB,UAAIO,SAASP,KAAK2C,YAAY,CAACpC,SAASP,KAAKuD,eAAe;AAC9ChD,oBAAAA,SAASP,KAAK2C,QAAQ;AAAA,MACpC;AAEA,aAAOpC,SAASP;AAAAA,IAClB;AAEM,UAAA,IAAIgB,MAAM,eAAe;AAAA,WACxBN,OAAO;AACNA,YAAAA,MAAM,WAAWA,KAAK;AACxBA,UAAAA;AAAAA,EACR;AACF;AAqHa8C,MAAAA,gBAAgB,CAAOR,UAA6C;AAC3E,MAAA;AAEF,QAAI,CAACA,OAAO;AACV,YAAMS,gBAAgBf;AACtBM,cAAQS,+CAAeT;AAAAA,IACzB;AAEA,QAAI,CAACA,OAAO;AACVpC,cAAQC,KAAK,gBAAgB;AACtB,aAAA;AAAA,IACT;AAEA,UAAMN,WAAW,MAAMY,IAAI,qBAAqB6B,KAAK,EAAE;AAEvD,QAAIzC,SAASP,MAAM;AACjB,YAAM2C,WAAqB;AAAA,QACzBG,IAAIvC,SAASP,KAAK8C;AAAAA,QAClBE,OAAOzC,SAASP,KAAKgD;AAAAA,QACrBU,UAAUnD,SAASP,KAAK0D;AAAAA,QACxBC,UAAUpD,SAASP,KAAK2D;AAAAA,QACxBC,QAAQrD,SAASP,KAAK4D;AAAAA,QACtBC,QAAQtD,SAASP,KAAK6D;AAAAA,QACtBC,kBAAkBvD,SAASP,KAAK8D;AAAAA,QAChCC,aAAaxD,SAASP,KAAK+D;AAAAA,QAC3BC,SAASzD,SAASP,KAAKgE;AAAAA,QACvBC,YAAY1D,SAASP,KAAKiE;AAAAA,QAC1BC,aAAa3D,SAASP,KAAKkE;AAAAA,QAC3BC,cAAc5D,SAASP,KAAKoE,iBAAiB7D,SAASP,KAAKmE;AAAAA,MAAAA;AAI7DlB,kBAAYN,QAAQ;AACbA,aAAAA;AAAAA,IACT;AAEO,WAAA;AAAA,WACAjC,OAAO;AACNA,YAAAA,MAAM,aAAaA,KAAK;AACzB,WAAA;AAAA,EACT;AACF;AAMO,MAAM2D,yBAAyBA,MAAqB;AACzD,QAAM1B,WAAWD;AACjB,MAAI,CAACC,YAAY,CAACA,SAASG,IAAI;AACtB,WAAA;AAAA,EACT;AACA,SAAOH,SAASG;AAClB;AAKO,MAAMwB,eAAe,MAA8B;AACxD,QAAM3B,WAAWD;AAEjB,MAAI,CAACC,YAAY,CAACA,SAASK,OAAO;AAChCpC,YAAQC,KAAK,gBAAgB;AAC7BT,SAAAA,KAAKmE,UAAU;AAAA,MACblE,OAAO;AAAA,MACPmE,MAAM;AAAA,IAAA,CACP;AAIDC,eAAW,MAAM;AACfrE,WAAAA,KAAKsE,WAAW;AAAA,QACd7E,KAAK;AAAA;AAAA,MAAA,CACN;AAAA,OACA,IAAI;AAEA,WAAA;AAAA,EACT;AAEO,SAAA;AACT;AAKO,MAAM8E,oBAAoB,MAAsC;AACjE,MAAA;AAEF,UAAMlB,gBAAgBf;AAClBe,QAAAA,iBAAiBA,cAAcT,OAAO;AAExC,YAAM4B,gBAAgB,MAAMpB,cAAcC,cAAcT,KAAK;AAC7D,aAAO4B,iBAAiBnB;AAAAA,IAC1B;AAGMoB,UAAAA,cAAc,MAAMxB;AAE1B,QAAI,CAACwB,YAAYtB,iBAAiBsB,YAAYlC,UAAU;AAEtD,aAAOkC,YAAYlC;AAAAA,IACrB;AAGO,WAAA;AAAA,WAEAjC,OAAO;AACNA,YAAAA,MAAM,WAAWA,KAAK;AACvB,WAAA;AAAA,EACT;AACF;AC7UA,MAAMoE,aAAyB,CAC7B;AAAA,EACEhC,IAAI;AAAA,EACJiC,MAAM;AAAA,EACNC,MAAM;AAAA,EACNC,OAAOjD,cAAcE,SAASC;AAAAA,EAC9B+C,aAAa;AAAA,EACbC,UAAU,CACR,SACA,QACA,SACA,OAAO;AAAA,EAETC,OAAO;AACT,GACA;AAAA,EACEtC,IAAI;AAAA,EACJiC,MAAM;AAAA,EACNC,MAAM;AAAA,EACNC,OAAOjD,cAAcE,SAASE;AAAAA,EAC9B8C,aAAa;AAAA,EACbC,UAAU,CACR,QACA,SACA,QACA,MAAM;AAAA,EAERC,OAAO;AACT,CAAC;AAIH,MAAMC,mBAA8B,CAClC;AAAA,EACEvC,IAAI;AAAA,EACJkC,MAAM;AAAA,EACNC,OAAO;AAAA,EACPK,OAAO;AAAA;AAAA,EACPC,eAAe;AAAA,EACfC,MAAM;AAAA,EACNN,aAAa;AAAA,EACbC,UAAU,CAAE;AAAA,EACZM,gBAAgB,CAAC;AACnB,GACA;AAAA,EACE3C,IAAI;AAAA,EACJkC,MAAM;AAAA,EACNC,OAAO;AAAA,EACPK,OAAO;AAAA;AAAA,EACPC,eAAe;AAAA,EACfC,MAAM;AAAA,EACNN,aAAa;AAAA,EACbC,UAAU,CAAE;AAAA,EACZM,gBAAgB,CAAC;AACnB,GACA;AAAA,EACE3C,IAAI;AAAA,EACJkC,MAAM;AAAA,EACNC,OAAO;AAAA,EACPK,OAAO;AAAA;AAAA,EACPC,eAAe;AAAA,EACfC,MAAM;AAAA,EACNN,aAAa;AAAA,EACbC,UAAU,CAAE;AAAA,EACZM,gBAAgB,CAAC;AACnB,CAAC;AAIH,MAAMC,iBAA4B,CAChC;AAAA,EACE5C,IAAI;AAAA,EACJkC,MAAM;AAAA,EACNC,OAAO;AAAA,EACPK,OAAO;AAAA;AAAA,EACPC,eAAe;AAAA,EACfC,MAAM;AAAA,EACNN,aAAa;AAAA,EACbC,UAAU,CAAE;AAAA,EACZM,gBAAgB,CAAC;AACnB,GACA;AAAA,EACE3C,IAAI;AAAA,EACJkC,MAAM;AAAA,EACNC,OAAO;AAAA,EACPK,OAAO;AAAA;AAAA,EACPC,eAAe;AAAA,EACfC,MAAM;AAAA,EACNN,aAAa;AAAA,EACbC,UAAU,CAAE;AAAA,EACZM,gBAAgB,CAAC;AACnB,GACA;AAAA,EACE3C,IAAI;AAAA,EACJkC,MAAM;AAAA,EACNC,OAAO;AAAA,EACPK,OAAO;AAAA;AAAA,EACPC,eAAe;AAAA,EACfC,MAAM;AAAA,EACNN,aAAa;AAAA,EACbC,UAAU,CAAE;AAAA,EACZM,gBAAgB,CAAC;AACnB,CAAC;AAMH,MAAME,WAAsB,CAC1B,GAAGN,kBACH,GAAGK,cAAc;AAOZ,MAAME,YAAY;AAAA;AAAA;AAAA;AAAA,EAIvB,OAAOC,kBAA8B;AAC5Bf,WAAAA;AAAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAOgB,gBAAgBhD,IAAkC;AACvD,WAAOgC,WAAWiB,KAAKC,CAAQA,SAAAA,KAAKlD,OAAOA,EAAE;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,OAAOmD,iBAA4B;AAC1BN,WAAAA;AAAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAOO,eAAepD,IAAiC;AACrD,WAAO6C,SAASI,KAAK1D,CAAWA,YAAAA,QAAQS,OAAOA,EAAE;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,OAAOqD,qBAAgC;AAC9Bd,WAAAA;AAAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAOe,mBAA8B;AAC5BV,WAAAA;AAAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAaW,oBAAoBjF,QAMN;AAAA;;AACrB,UAAA;AAEF,cAAMkF,eAAejC;AACrB,YAAI,CAACiC,cAAc;AACX,gBAAA,IAAItF,MAAM,YAAY;AAAA,QAC9B;AAGII,YAAAA,OAAOmF,kBAAkB,UAAU;AACrC,gBAAM5D,WAAWD;AACb,cAAA,EAACC,qCAAUkB,SAAQ;AACf,kBAAA,IAAI7C,MAAM,6BAA6B;AAAA,UAC/C;AAAA,QACF;AAEA,cAAMwF,SAAS3D;AACf,cAAM4D,YAAgC;AAAA,UACpCC,WAAW;AAAA,UACXF;AAAAA,UACAnG,OAAO,UAAUe,OAAOuF,SAAS,KAAKC,QAAQ,CAAC,CAAC;AAAA,UAChDD,QAAQvF,OAAOuF,SAASvF,OAAOyF;AAAAA;AAAAA,UAC/BN,eAAenF,OAAOmF;AAAAA,UACtBO,WAAW;AAAA,YACTC,aAAa;AAAA,YACbC,WAAW5F,OAAO6F;AAAAA;AAAAA,YAClBC,aAAa;AAAA;AAAA,YACbL,UAAUzF,OAAOyF;AAAAA,YACjBM,UAAU;AAAA,YACVC,WAAWhG,OAAOuF;AAAAA;AAAAA,YAClBU,eAAejG,OAAOiG,iBAAiB;AAAA,UACzC;AAAA,QAAA;AAIFzG,gBAAQ0G,IAAI,WAAW;AACfA,gBAAAA,IAAI,cAAcd,MAAM;AAChC5F,gBAAQ0G,IAAI,YAAY;AAAA,UACtBZ,WAAWD,UAAUC;AAAAA,UACrBF,QAAQC,UAAUD;AAAAA,UAClBnG,OAAOoG,UAAUpG;AAAAA,UACjBsG,QAAQ,GAAGF,UAAUE,MAAM,QAAQF,UAAUE,SAAS,KAAKC,QAAQ,CAAC,CAAC;AAAA,UACrEL,eAAeE,UAAUF;AAAAA,UACzBO,WAAWL,UAAUK;AAAAA,QAAAA,CACtB;AAED,cAAMvG,WAAW,MAAMuB,KAAK,kBAAkB2E,WAAW;AAAA,UACvDvG,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAEDS,gBAAQ0G,IAAI,YAAY;AACxB1G,gBAAQ0G,IAAI,YAAY;AAAA,UACtBC,SAAShH,SAASP,KAAKuH;AAAAA,UACvBZ,QAAQ,GAAGpG,SAASP,KAAK2G,MAAM,QAAQpG,SAASP,KAAK2G,SAAS,KAAKC,QAAQ,CAAC,CAAC;AAAA,UAC7EY,eAAejH,SAASP,KAAKwH;AAAAA,UAC7BC,gBAAgB,CAAC,CAAClH,SAASP,KAAK0H;AAAAA,QAAAA,CACjC;AAED,eAAOnH,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,eAAeA,KAAK;AAGlC,cAAMiH,aAAYjH,+BAAOlB,WAAQkB,0CAAOH,aAAPG,mBAAiBV,SAAjBU,mBAAuBlB;AACxD,cAAMuB,iBAAeL,0CAAOH,aAAPG,mBAAiBV,SAAjBU,mBAAuBC,aACvCD,+BAAOC,YACP;AAGLC,gBAAQF,MAAM,YAAY;AAAA,UACxBlB,MAAMmI;AAAAA,UACNhH,SAASI;AAAAA,UACT6G,eAAclH,oCAAOH,aAAPG,mBAAiBV;AAAAA,UAC/B6H,WAAWnH;AAAAA,QAAAA,CACZ;AAGD,YAAIiH,cAAc,MAAM;AAClB5G,cAAAA,aAAapB,SAAS,QAAQ,GAAG;AAC7B,kBAAA,IAAIqB,MAAM,wBAAwB;AAAA,UAC1C;AAAA,QACF;AAEA,YAAI2G,cAAc,MAAM;AAChB,gBAAA,IAAI3G,MAAM,WAAW;AAAA,QAC7B;AAEM,cAAA,IAAIA,MAAMD,YAAY;AAAA,MAC9B;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,OAAa+G,mBAAmB1G,QAIL;AAAA;;AACrB,UAAA;AAEF,cAAMkF,eAAejC;AACrB,YAAI,CAACiC,cAAc;AACX,gBAAA,IAAItF,MAAM,YAAY;AAAA,QAC9B;AAGII,YAAAA,OAAOmF,kBAAkB,UAAU;AACrC,gBAAM5D,WAAWD;AACb,cAAA,EAACC,qCAAUkB,SAAQ;AACf,kBAAA,IAAI7C,MAAM,6BAA6B;AAAA,UAC/C;AAAA,QACF;AAEA,cAAMqB,UAAU,KAAK6D,eAAe9E,OAAO4F,SAAS;AACpD,YAAI,CAAC3E,SAAS;AACN,gBAAA,IAAIrB,MAAM,OAAO;AAAA,QACzB;AAEA,cAAMyF,YAAgC;AAAA,UACpCC,WAAW;AAAA,UACXF,QAAQ3D,iBAAiB;AAAA,UACzBxC,OAAOgC,QAAQ2C;AAAAA,UACf2B,QAAQtE,QAAQiD,QAAQlE,OAAOyF;AAAAA;AAAAA,UAC/BN,eAAenF,OAAOmF;AAAAA,UACtBO,WAAW;AAAA,YACTC,aAAa;AAAA,YACbC,WAAW5F,OAAO4F;AAAAA,YAClBE,aAAa7E,QAAQ2C;AAAAA;AAAAA,YACrB6B,UAAUzF,OAAOyF;AAAAA,YACjBpB,gBAAgBpD,QAAQoD;AAAAA,UAC1B;AAAA,QAAA;AAIF7E,gBAAQ0G,IAAI,WAAW;AACfA,gBAAAA,IAAI,cAAczE,iBAAkB,CAAA;AAC5CjC,gBAAQ0G,IAAI,YAAY;AAAA,UACtBZ,WAAWD,UAAUC;AAAAA,UACrBF,QAAQC,UAAUD;AAAAA,UAClBnG,OAAOoG,UAAUpG;AAAAA,UACjBsG,QAAQ,GAAGF,UAAUE,MAAM,QAAQF,UAAUE,SAAS,KAAKC,QAAQ,CAAC,CAAC;AAAA,UACrEL,eAAeE,UAAUF;AAAAA,UACzBO,WAAWL,UAAUK;AAAAA,QAAAA,CACtB;AAED,cAAMvG,WAAW,MAAMuB,KAAK,kBAAkB2E,WAAW;AAAA,UACvDvG,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAEDS,gBAAQ0G,IAAI,YAAY;AACxB1G,gBAAQ0G,IAAI,YAAY;AAAA,UACtBC,SAAShH,SAASP,KAAKuH;AAAAA,UACvBZ,QAAQ,GAAGpG,SAASP,KAAK2G,MAAM,QAAQpG,SAASP,KAAK2G,SAAS,KAAKC,QAAQ,CAAC,CAAC;AAAA,UAC7EY,eAAejH,SAASP,KAAKwH;AAAAA,UAC7BC,gBAAgB,CAAC,CAAClH,SAASP,KAAK0H;AAAAA,QAAAA,CACjC;AAED,eAAOnH,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,eAAeA,KAAK;AAGlC,cAAMiH,aAAYjH,+BAAOlB,WAAQkB,0CAAOH,aAAPG,mBAAiBV,SAAjBU,mBAAuBlB;AACxD,cAAMuB,iBAAeL,0CAAOH,aAAPG,mBAAiBV,SAAjBU,mBAAuBC,aACvCD,+BAAOC,YACP;AAGLC,gBAAQF,MAAM,YAAY;AAAA,UACxBlB,MAAMmI;AAAAA,UACNhH,SAASI;AAAAA,UACT6G,eAAclH,oCAAOH,aAAPG,mBAAiBV;AAAAA,UAC/B6H,WAAWnH;AAAAA,QAAAA,CACZ;AAGD,YAAIiH,cAAc,MAAM;AAClB5G,cAAAA,aAAapB,SAAS,QAAQ,GAAG;AAC7B,kBAAA,IAAIqB,MAAM,wBAAwB;AAAA,UAC1C;AAAA,QACF;AAEA,YAAI2G,cAAc,MAAM;AAChB,gBAAA,IAAI3G,MAAM,WAAW;AAAA,QAC7B;AAEM,cAAA,IAAIA,MAAMD,YAAY;AAAA,MAC9B;AAAA,IACF;AAAA;AAEF;ACtWagH,MAAAA,oBAAoBA,CAAClI,QAAuD;AAGvF,MAAI,CAACA,KAAK;AACD6B,WAAAA;AAAAA,EACT;AAGI7B,MAAAA,IAAImI,WAAW,UAAU,GAAG;AACvBnI,WAAAA;AAAAA,EACT;AAGIA,MAAAA,IAAImI,WAAW,SAAS,GAAG;AACtBnI,WAAAA,IAAIuD,QAAQ,WAAW,UAAU;AAAA,EAC1C;AAGIvD,MAAAA,IAAImI,WAAW,GAAG,GAAG;AACvB,WAAO,6BAA6BnI,GAAG;AAAA,EACzC;AAGA,SAAO,oCAAoCA,IAAImI,WAAW,GAAG,IAAInI,MAAM,MAAMA,GAAG;AAClF;ACrCA,MAAMoI,aAAa;AAAA;AAAA,EAEXC,gBACJC,UACAC,WACAC,OAAe,GACfC,WAAmB,IACO;AAAA;AACtB,UAAA;AACItI,cAAAA,OAAO,MAAMJ,QAAQ,kBAAkB;AAAA,UAC3CI,MAAM;AAAA,YAAEmI;AAAAA,YAAUC;AAAAA,YAAWC;AAAAA,YAAMC;AAAAA,UAAS;AAAA,QAAA,CAC7C;AAEOhB,gBAAAA,IAAI,kBAAkBtH,IAAI;AAGlC,cAAMuI,mBAAmBvI,KAAKA,KAAKwI,KAAK7G,IAAI,CAAC8G,UAAkB;;AAAA,kDAC1DA,QAD0D;AAAA,YAE7DxD,OAAO8C,kBAAkBU,MAAMxD,KAAK;AAAA,YACpCyD,SAAQD,WAAMC,WAAND,mBAAc9G,IAAIgH,CAAOZ,QAAAA,kBAAkBY,GAAG;AAAA,UACtD;AAAA,SAAA;AAEK,eAAA,iCACF3I,KAAKA,OADH;AAAA,UAELwI,MAAMD;AAAAA,QAAAA;AAAAA,eAED7H,OAAO;AAENA,gBAAAA,MAAM,kBAAkBA,KAAK;AAC/BA,cAAAA;AAAAA,MACR;AAAA,IACF;AAAA;AAAA;AAAA,EAGMkI,eAAeC,SAAiB;AAAA;;AAChC,UAAA;AACF,cAAM7I,OAAO,MAAMJ,QAAQ,WAAWiJ,OAAO,EAAE;AACvCvB,gBAAAA,IAAI,kBAAkBtH,IAAI;AAGlC,YAAIA,6BAAMA,MAAM;AACP,iBAAA,iCACFA,OADE;AAAA,YAELA,MAAM,iCACDA,KAAKA,OADJ;AAAA,cAEJiF,OAAO8C,kBAAkB/H,KAAKA,KAAKiF,KAAK;AAAA,cACxCyD,SAAQ1I,UAAKA,KAAK0I,WAAV1I,mBAAkB2B,IAAI,CAACgH,QAAgBZ,kBAAkBY,GAAG;AAAA,YACtE;AAAA,UAAA;AAAA,QAEJ;AACO3I,eAAAA;AAAAA,eACAU,OAAO;AACN4G,gBAAAA,IAAI,mBAAmB5G,KAAK;AAC7B,eAAA;AAAA,MACT;AAAA,IACF;AAAA;AAAA;AAAA,EAGMoI,aAAaC,SAAiBV,OAAe,GAAGC,WAAmB,IAA8B;AAAA;AACjG,UAAA;AACItI,cAAAA,OAAO,MAAMJ,QAAQ,kBAAkB;AAAA,UAC3CI,MAAM;AAAA,YAAE+I;AAAAA,YAASV;AAAAA,YAAMC;AAAAA,UAAS;AAAA,QAAA,CACjC;AAEOhB,gBAAAA,IAAI,kBAAkBtH,IAAI;AAClC,eAAOA,KAAKA,QAAQ;AAAA,UAAEwI,MAAM,CAAE;AAAA,UAAEQ,OAAO;AAAA,UAAGX,MAAM;AAAA,UAAGC,UAAU;AAAA,UAAIW,SAAS;AAAA,QAAA;AAAA,eACnEvI,OAAO;AACN4G,gBAAAA,IAAI,mBAAmB5G,KAAK;AAC7B,eAAA;AAAA,UAAE8H,MAAM,CAAE;AAAA,UAAEQ,OAAO;AAAA,UAAGX,MAAM;AAAA,UAAGC,UAAU;AAAA,UAAIW,SAAS;AAAA,QAAA;AAAA,MAC/D;AAAA,IACF;AAAA;AAAA;AAAA,EAGMC,kBACJjI,QACAoH,OAAe,GACfC,WAAmB,IACO;AAAA;AACtB,UAAA;AACItI,cAAAA,OAAO,MAAMJ,QAAQ,kBAAkB;AAAA,UAC3CI,MAAM;AAAA,YAAEiB;AAAAA,YAAQoH;AAAAA,YAAMC;AAAAA,UAAS;AAAA,QAAA,CAChC;AAEOhB,gBAAAA,IAAI,kBAAkBtH,IAAI;AAClC,eAAOA,KAAKA,QAAQ;AAAA,UAAEwI,MAAM,CAAE;AAAA,UAAEQ,OAAO;AAAA,UAAGX,MAAM;AAAA,UAAGC,UAAU;AAAA,UAAIW,SAAS;AAAA,QAAA;AAAA,eACnEvI,OAAO;AACN4G,gBAAAA,IAAI,mBAAmB5G,KAAK;AAC7B,eAAA;AAAA,UAAE8H,MAAM,CAAE;AAAA,UAAEQ,OAAO;AAAA,UAAGX,MAAM;AAAA,UAAGC,UAAU;AAAA,UAAIW,SAAS;AAAA,QAAA;AAAA,MAC/D;AAAA,IACF;AAAA;AACF;AAEaE,MAAAA,eAAe,IAAIlB,aAAa;ACzF7C,MAAMmB,gBAAgB;AAAA;AAAA,EAEdC,qBAAwC;AAAA;AACxC,UAAA;AAEIC,cAAAA,aAAa,MAAMlJ,UAAKmJ;AACxBC,cAAAA,eAAcF,yCAAYE,gBAAe;AAE3C,YAAA,CAACA,YAAY,oBAAoB,GAAG;AAEtC,gBAAMpJ,KAAAA,KAAKqJ,UAAU;AAAA,YACnBC,OAAO;AAAA,UAAA,CACR;AAAA,QACH;AAGIC,YAAAA;AACA,YAAA;AACI,gBAAA,MAAMvJ,UAAKwJ,YAAY;AAAA,YAC3B7E,MAAM;AAAA;AAAA,YACN8E,gBAAgB;AAAA,UAAA,CACjB;AAAA,iBACMC,YAAY;AACXjJ,kBAAAA,KAAK,wBAAwBiJ,UAAU;AAEzC,gBAAA,MAAM1J,UAAKwJ,YAAY;AAAA,YAC3B7E,MAAM;AAAA;AAAA,UAAA,CACP;AAAA,QACH;AAEO,eAAA;AAAA,UACLoD,UAAUwB,IAAIxB;AAAAA,UACdC,WAAWuB,IAAIvB;AAAAA,QAAAA;AAAAA,eAEV1H,OAAO;AACNA,gBAAAA,MAAM,WAAWA,KAAK;AAGxBqJ,cAAAA,YAAYrJ,+BAAesJ,WAAU;AAG3C,YAAID,SAASpK,SAAS,WAAW,KAAKoK,SAASpK,SAAS,gBAAgB,GAAG;AACzES,eAAAA,KAAK6J,UAAU;AAAA,YACb5J,OAAO;AAAA,YACP6J,SAAS;AAAA,YACTC,aAAa;AAAA,YACbC,SAAUT,CAAQ,QAAA;AAChB,kBAAIA,IAAIU,SAAS;AACfjK,qBAAAA,KAAKkK,YAAY;AAAA,cACnB;AAAA,YACF;AAAA,UAAA,CACD;AAAA,QACH;AAGA1J,gBAAQ0G,IAAI,cAAc;AACnB,eAAA;AAAA,UACLa,UAAU;AAAA,UACVC,WAAW;AAAA,QAAA;AAAA,MAEf;AAAA,IACF;AAAA;AAAA;AAAA,EAGAmC,kBACEC,MACAC,MACAC,MACAC,MACQ;AACFC,UAAAA,MAAMC,KAAKC,KAAK;AACtB,UAAMC,IAAI;AAEJC,UAAAA,QAAQN,OAAOF,QAAQI;AACvBK,UAAAA,QAAQN,OAAOF,QAAQG;AAE7B,UAAMM,IACJL,KAAKM,IAAIH,OAAO,CAAC,IAAIH,KAAKM,IAAIH,OAAO,CAAC,IACtCH,KAAKO,IAAIZ,OAAOI,GAAG,IAAIC,KAAKO,IAAIV,OAAOE,GAAG,IAC1CC,KAAKM,IAAIF,OAAO,CAAC,IAAIJ,KAAKM,IAAIF,OAAO,CAAC;AAExC,UAAMI,IAAI,IAAIR,KAAKS,MAAMT,KAAKU,KAAKL,CAAC,GAAGL,KAAKU,KAAK,IAAIL,CAAC,CAAC;AAEvD,WAAOM,QAAQT,IAAIM,GAAGzE,QAAQ,CAAC,CAAC;AAAA,EAClC;AAAA;AAAA,EAGA6E,eAAeC,UAA0B;AACvC,QAAIA,WAAW,GAAG;AAChB,aAAO,GAAGb,KAAKc,MAAMD,WAAW,GAAI,CAAC;AAAA,IACvC;AACA,WAAO,GAAGA,QAAQ;AAAA,EACpB;AACF;AAEaE,MAAAA,qBAAqB,IAAIxC,gBAAgB;;AC3EtD,MAAMyC,eAA4CA,CAAC;AAAA,EACjDC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AACF,MAAM;AACJ,QAAM,CAACC,YAAYC,aAAa,IAAIC,cAAS,KAAK;AAClD,QAAM,CAACC,WAAWC,YAAY,IAAIF,cAAS,GAAG;AACxCG,QAAAA,WAAWC,YAAY,IAAI;AAG3BC,QAAAA,qBAAqBZ,MAAMa,OAAO,CAACC,KAAKC,SAASD,MAAMC,KAAKvH,OAAO,CAAC;AACpEwH,QAAAA,qBAAqBhB,MAAMa,OAAO,CAACC,KAAKC,SAASD,OAAOC,KAAKE,iBAAiBF,KAAKvH,QAAQ,CAAC;AAClG,QAAM0H,eAAeN,qBAAqBI;AACpCG,QAAAA,WAAWnB,MAAMoB,SAAS;AAGhCC,OAAAA,UAAU,MAAM;AACd,QAAIF,YAAYd,YAAY;AACjBiB,eAAAA,UAAUC,YAAY,MAAM;AACnCd,qBAAa,CAACe,SAAS;AACrB,cAAIA,QAAQ,GAAG;AACbC,0BAAcf,SAASY,OAAO;AAE9BhN,iBAAAA,KAAKmE,UAAU;AAAA,cACblE,OAAO;AAAA,cACPmE,MAAM;AAAA,YAAA,CACP;AACD4H,0BAAc,KAAK;AACZ,mBAAA;AAAA,UACT;AACA,iBAAOkB,OAAO;AAAA,QAAA,CACf;AAAA,SACA,GAAI;AAAA,IAAA,OACF;AACL,UAAId,SAASY,SAAS;AACpBG,sBAAcf,SAASY,OAAO;AAAA,MAChC;AAAA,IACF;AAEA,WAAO,MAAM;AACX,UAAIZ,SAASY,SAAS;AACpBG,sBAAcf,SAASY,OAAO;AAAA,MAChC;AAAA,IAAA;AAAA,EACF,GACC,CAACH,UAAUd,UAAU,CAAC;AAGnBqB,QAAAA,kBAAkBA,CAACC,YAAoB;AAC3C,UAAMC,OAAO7C,KAAK8C,MAAMF,UAAU,EAAE;AACpC,UAAMG,OAAOH,UAAU;AACvB,WAAO,GAAGC,KAAKG,SAAS,EAAEC,SAAS,GAAG,GAAG,CAAC,IAAIF,KAAKC,SAAS,EAAEC,SAAS,GAAG,GAAG,CAAC;AAAA,EAAA;AAI1EC,QAAAA,aAAaA,CAACC,YAAoB;AAChCC,UAAAA,OAAO,IAAIC,KAAKF,OAAO;AACvBG,UAAAA,4BAAYD;AAClB,UAAME,UAAUH,KAAKI,aAAa,MAAMF,MAAME,aAAa;AAE3D,QAAID,SAAS;AACJ,aAAA;AAAA,IACT;AAEME,UAAAA,QAAQL,KAAKM,SAAAA,IAAa;AAC1BC,UAAAA,MAAMP,KAAKQ;AACV,WAAA,GAAGH,KAAK,IAAIE,GAAG;AAAA,EAAA;AAGxB,QAAME,sBAAsBA,MAAM;AAChC,QAAI,CAACzB,UAAU;AACb7M,WAAAA,KAAKmE,UAAU;AAAA,QACblE,OAAO;AAAA,QACPmE,MAAM;AAAA,MAAA,CACP;AACD;AAAA,IACF;AAEA4H,kBAAc,IAAI;AAAA,EAAA;AAGpB,QAAMuC,kBAAkBA,MAAM;AAE5B,QAAI1C,aAAa;AACH;IACd;AACAG,kBAAc,KAAK;AAAA,EAAA;AAGrB,QAAMwC,wBAAwBA,MAAM;AACvB;EAAA;AAGb,SAGKzC,qBAAAA,KAAAA,eAAAA,EAAAA,UAAAA;AAAAA,IAAAA,cACE0C,qBAAA,IAAAC,WAAA,EAAK,WAAU,aAAY,SAASH,iBAAgB;AAAA,6BAItDG,KAAK,MAAA,EAAA,WAAU,iBACd,UAACC,qBAAA,KAAAD,WAAA,EAAK,WAAU,YACd,UAAA;AAAA,MAAAD,yBAACC,KAAAA,MAAK,EAAA,WAAU,aACb7B,UAAAA,WAEG8B,qBAAA,KAAAC,eAAA,EAAA,UAAA;AAAA,QAACD,qBAAAA,KAAAE,KAAAA,MAAA,EAAK,WAAU,eAAc,UAAA;AAAA,UAAA;AAAA,UAAEnC;AAAAA,QAAAA,GAAmB;AAAA,QAClDE,eAAe,KACb+B,0BAAAE,KAAAA,MAAA,EAAK,WAAU,WAAU,UAAA;AAAA,UAAA;AAAA,UAAKjC;AAAAA,QAAAA,GAAa;AAAA,MAAA,GAEhD,IAEC6B,yBAAAI,KAAAA,MAAA,EAAK,WAAU,cAAa,oBAAO,CAAA,GAExC;AAAA,MAEAJ,qBAAA;AAAA,QAACC,KAAA;AAAA,QAAA;AAAA,UACC,WAAW,gBAAgB,CAAC7B,WAAW,aAAa,EAAE;AAAA,UACtD,SAASyB;AAAAA,UAAoB,UAAA;AAAA,QAAA;AAAA,MAG/B;AAAA,IAAA,EAAA,CACF,EACF,CAAA;AAAA,IAGCvC,cACC4C,qBAAA,KAACD,KAAK,MAAA,EAAA,WAAU,iBACd,UAAA;AAAA,MAACD,qBAAAA,IAAAC,KAAAA,MAAA,EAAK,WAAU,mBACd,UAAAD,qBAAA,IAACI,aAAK,WAAU,SAAQ,kBAAI,EAC9B,CAAA;AAAA,MAGCJ,qBAAA,IAAAC,KAAA,MAAA,EAAK,WAAU,gBACbhD,UAAMnK,MAAAA;AAAAA,QAAI,CAACkL,MAAMqC,WACfH,qBAAA,KAAAD,KAAA,MAAA,EAAiB,WAAU,gBAC1B,UAAA;AAAA,UAAAD,qBAAA;AAAA,YAACM,KAAA;AAAA,YAAA;AAAA,cACC,WAAU;AAAA,cACV,KAAKtC,KAAKuC,oBAAmBrD,uCAAWnI,WAAU;AAAA,YAAA;AAAA,UAAG;AAAA,UAEvDmL,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,gBACd,UAAA;AAAA,YAACC,qBAAAA,KAAAD,KAAAA,MAAA,EAAK,WAAU,eACd,UAAA;AAAA,cAAAD,qBAAA,IAACI,KAAK,MAAA,EAAA,WAAU,kBAAkBpC,UAAAA,KAAKwC,eAAc;AAAA,cACrDN,qBAAAA,KAACE,KAAAA,MAAK,EAAA,WAAU,YAAYpC,UAAAA;AAAAA,gBAAKyC,KAAAA;AAAAA,gBAAS;AAAA,cAAA,GAAE;AAAA,YAAA,GAC9C;AAAA,YACAT,qBAAA,IAACC,KAAK,MAAA,EAAA,WAAU,eACd,UAAAD,qBAAAA,IAACI,KAAAA,QAAK,WAAU,gBAAgBpC,UAAK0C,KAAAA,YAAAA,CAAY,EACnD,CAAA;AAAA,qCACCT,KAAK,MAAA,EAAA,WAAU,aACd,UAACC,qBAAA,KAAAE,WAAA,EAAK,WAAU,aACblB,UAAAA;AAAAA,cAAAA,WAAWlB,KAAKoB,IAAI;AAAA,cAAE;AAAA,cAAEpB,KAAK2C;AAAAA,cAAK;AAAA;AAAA,eAEhC,MAAM;AACC,sBAAA,CAACC,MAAMC,MAAM,IAAI7C,KAAK2C,KAAKG,MAAM,GAAG,EAAEhO,IAAI6J,MAAM;AAChDoE,sBAAAA,YAAYF,SAAS7C,KAAKyC;AAChC,sBAAMO,UAAUJ,OAAO5E,KAAK8C,MAAMiC,YAAY,EAAE;AAChD,sBAAME,cAAcF,YAAY;AACzB,uBAAA,GAAGC,OAAO,IAAIC,YAAYjC,WAAWC,SAAS,GAAG,GAAG,CAAC;AAAA,cAAA,GAC3D;AAAA,YAAA,EAAA,CAEP,EACF,CAAA;AAAA,UAAA,GACF;AAAA,UACAiB,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,gBACd,UAAA;AAAA,YAAAD,qBAAAA,IAACC,aAAK,WAAU,cACd,UAACC,qBAAA,KAAAE,WAAA,EAAK,WAAU,SAAQ,UAAA;AAAA,cAAA;AAAA,cAAEpC,KAAKE,iBAAiBF,KAAKvH;AAAAA,YAAAA,EAAAA,CAAM,EAC7D,CAAA;AAAA,YACC4G,gBACC2C,qBAAA;AAAA,cAACC,KAAA;AAAA,cAAA;AAAA,gBACC,WAAU;AAAA,gBACV,SAAS,MAAM5C,aAAagD,MAAK;AAAA,gBAAE,UAAA;AAAA,cAAA;AAAA,YAGrC;AAAA,UAAA,GAEJ;AAAA,QAAA,EAAA,GAxCSA,MAyCX;AAAA,MAAA,GAEJ;AAAA,MAGAH,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,oBACd,UAAA;AAAA,QAACC,qBAAAA,KAAAD,KAAAA,MAAA,EAAK,WAAU,iBACd,UAAA;AAAA,UAACC,qBAAAA,KAAAD,KAAAA,MAAA,EAAK,WAAU,aACd,UAAA;AAAA,YAACD,qBAAA,IAAAI,KAAA,MAAA,EAAK,WAAU,QAAO,UAAE,MAAA;AAAA,YACxBJ,qBAAA,IAAAC,KAAA,MAAA,EAAK,WAAU,SAAQ,UAAC,KAAA;AAAA,UAAA,GAC3B;AAAA,UACAC,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,gBACd,UAAA;AAAA,YAACC,qBAAAA,KAAAE,KAAAA,MAAA,EAAK,WAAU,eAAc,UAAA;AAAA,cAAA;AAAA,cAAGnC;AAAAA,YAAAA,GAAmB;AAAA,YACnDJ,qBAAqBI,sBACnBiC,0BAAAE,KAAAA,MAAA,EAAK,WAAU,kBAAiB,UAAA;AAAA,cAAA;AAAA,cAAGvC;AAAAA,YAAAA,GAAmB;AAAA,UAAA,GAE3D;AAAA,UACCmC,qBAAA,IAAAI,KAAA,MAAA,EAAK,WAAU,gBAAe,UAAW,eAAA;AAAA,QAAA,GAC5C;AAAA,QAEAF,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,mBACd,UAAA;AAAA,UAACC,qBAAAA,KAAAE,KAAAA,MAAA,EAAK,WAAU,aAAY,UAAA;AAAA,YAAA;AAAA,YAAQzB,gBAAgBlB,SAAS;AAAA,UAAA,GAAE;AAAA,mCAC9DwC,KAAAA,MAAK,EAAA,WAAU,eAAc,SAASF,uBAAsB,UAE7D,OAAA;AAAA,QAAA,GACF;AAAA,MAAA,GACF;AAAA,IAAA,GACF;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC1OO,MAAMmB,oBAAoB,CAC/B;AAAA,EAAEjN,IAAI;AAAA,EAAKkC,MAAM;AAAA,EAAWgL,OAAO;AAAE,GACrC;AAAA,EAAElN,IAAI;AAAA,EAAKkC,MAAM;AAAA,EAAUgL,OAAO;AAAE,GACpC;AAAA,EAAElN,IAAI;AAAA,EAAKkC,MAAM;AAAA,EAAQgL,OAAO;AAAE,GAClC;AAAA,EAAElN,IAAI;AAAA,EAAKkC,MAAM;AAAA,EAAUgL,OAAO;AAAE,GACpC;AAAA,EAAElN,IAAI;AAAA,EAAKkC,MAAM;AAAA,EAAQgL,OAAO;AAAE,GAClC;AAAA,EAAElN,IAAI;AAAA,EAAKkC,MAAM;AAAA,EAAQgL,OAAO;AAAE,GAClC;AAAA,EAAElN,IAAI;AAAA,EAAKkC,MAAM;AAAA,EAAQgL,OAAO;AAAE,CAAC;ACArC,SAASC,sBAAsBjL,MAAsB;AAE/CA,MAAAA,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,KAAK,KAAKqF,KAAKrF,SAAS,IAAI,GAAG;AAC/D,WAAA;AAAA,EAAA,WACEqF,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,KAAK,KAAKqF,KAAKrF,SAAS,MAAM,GAAG;AAC/F,WAAA;AAAA,EAAA,WACEqF,KAAKrF,SAAS,GAAG,KAAKqF,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,GAAG,KAAKqF,KAAKrF,SAAS,IAAI,GAAG;AAC1F,WAAA;AAAA,EAAA,WACEqF,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,IAAI,GAAG;AAC9C,WAAA;AAAA,EAAA,WACEqF,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,IAAI,GAAG;AAC9C,WAAA;AAAA,EAAA,WACEqF,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,IAAI,GAAG;AAC9C,WAAA;AAAA,EAAA,WACEqF,KAAKrF,SAAS,KAAK,KAAKqF,KAAKrF,SAAS,IAAI,GAAG;AAC/C,WAAA;AAAA,EACEqF,WAAAA,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,IAAI,GAAG;AACrE,WAAA;AAAA,EACEqF,WAAAA,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,IAAI,KAAKqF,KAAKrF,SAAS,IAAI,GAAG;AACrE,WAAA;AAAA,EACT;AAEO,SAAA;AACT;AAEO,MAAMuQ,iBAAiB;AAAA;AAAA,EAEtBC,gBAAgB;AAAA;AACb,aAAA;AAAA,QACL3Q,MAAM;AAAA,QACNQ,MAAM+P;AAAAA,QACNpP,SAAS;AAAA,MAAA;AAAA,IAEb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQMyP,4BAA4BC,aAAqB;AAAA;AACrD,UAAI,CAACA,aAAa;AACV,cAAA,IAAIrP,MAAM,WAAW;AAAA,MAC7B;AAEI,UAAA;AAEF,cAAMsP,oBAAoB,MAAM1Q,QAAQ,eAAeyQ,WAAW,EAAE;AACpE,cAAMtE,YAAYuE,kBAAkBtQ;AAEpC,YAAI,CAAC+L,aAAa,CAACA,UAAUlD,SAAS;AAC5BnI,kBAAAA,MAAM,OAAO2P,WAAW,WAAW;AACpC,iBAAA;AAAA,YACL7Q,MAAM;AAAA,YACNQ,MAAM,CAAE;AAAA,YACRW,SAAS;AAAA,UAAA;AAAA,QAEb;AAGA,cAAM4P,YAAY,MAAM3Q,QAAQ,WAAWmM,UAAUlD,OAAO,EAAE;AAC9D,cAAM2H,WAAWD,UAAUvQ,KAAKwQ,YAAY,CAAA;AAG5C,cAAMC,sBAAsBD,SAAS7O,IAAI,CAAC+O,YAAkB,iCACvDA,UADuD;AAAA,UAE1DC,YAAYV,sBAAsBS,QAAQ1L,IAAI;AAAA,UAC9C4L,cAAc;AAAA,UACd1L,aAAawL,QAAQ1L;AAAAA,QACrB,EAAA;AAEFpE,gBAAQ0G,IAAI,WAAW+I,WAAW,cAAcI,oBAAoBvD,MAAM,MAAM;AAEzE,eAAA;AAAA,UACL1N,MAAM;AAAA,UACNQ,MAAMyQ;AAAAA,UACN9P,SAAS;AAAA,QAAA;AAAA,eAEJD,OAAY;AACnBE,gBAAQF,MAAM,WAAW2P,WAAW,WAAW3P,MAAMC,OAAO;AAErD,eAAA;AAAA,UACLnB,MAAM;AAAA,UACNQ,MAAM,CAAE;AAAA,UACRW,SAAS;AAAA,QAAA;AAAA,MAEb;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQMkQ,wBAAwBhI,SAAiB;AAAA;AAC7C,UAAI,CAACA,SAAS;AACN,cAAA,IAAI7H,MAAM,UAAU;AAAA,MAC5B;AAEI,UAAA;AAEF,cAAMuP,YAAY,MAAM3Q,QAAQ,WAAWiJ,OAAO,EAAE;AACpD,cAAM2H,WAAWD,UAAUvQ,KAAKwQ,YAAY,CAAA;AAG5C,cAAMC,sBAAsBD,SAAS7O,IAAI,CAAC+O,YAAkB,iCACvDA,UADuD;AAAA,UAE1DC,YAAYV,sBAAsBS,QAAQ1L,IAAI;AAAA,UAC9C4L,cAAc;AAAA,UACd1L,aAAawL,QAAQ1L;AAAAA,QACrB,EAAA;AAEFpE,gBAAQ0G,IAAI,UAAUuB,OAAO,cAAc4H,oBAAoBvD,MAAM,MAAM;AAEpE,eAAA;AAAA,UACL1N,MAAM;AAAA,UACNQ,MAAMyQ;AAAAA,UACN9P,SAAS;AAAA,QAAA;AAAA,eAEJD,OAAY;AACnBE,gBAAQF,MAAM,UAAUmI,OAAO,WAAWnI,MAAMC,OAAO;AAEhD,eAAA;AAAA,UACLnB,MAAM;AAAA,UACNQ,MAAM,CAAE;AAAA,UACRW,SAAS;AAAA,QAAA;AAAA,MAEb;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASMmQ,sBAAsBT,aAAqBM,YAAoB;AAAA;AACnE,UAAI,CAACN,aAAa;AACV,cAAA,IAAIrP,MAAM,WAAW;AAAA,MAC7B;AAGA,YAAM+P,sBAAsB,MAAM,KAAKX,4BAA4BC,WAAW;AACxEW,YAAAA,cAAcD,oBAAoB/Q,QAAQ;AAGhD,YAAMiR,mBAAmBD,YAAYxP,OAAOkP,CAAWA,YAAAA,QAAQC,eAAeA,UAAU;AAEjF,aAAA;AAAA,QACLnR,MAAM;AAAA,QACNQ,MAAMiR;AAAAA,QACNtQ,SAAS;AAAA,MAAA;AAAA,IAEb;AAAA;AACF;AC/JA,MAAMuQ,iBAAiB;AAAA;AAAA,EAEfC,yBACJ9I,OAAe,GACfC,WAAmB,IACnB8I,cAC8B;AAAA;AAC1B,UAAA;AACIpR,cAAAA,OAAO,MAAMJ,QAAQ,2BAA2B;AAAA,UACpDI,MAAM;AAAA,YAAEqI;AAAAA,YAAMC;AAAAA,YAAUH,UAAUiJ,6CAAcjJ;AAAAA,YAAUC,WAAWgJ,6CAAchJ;AAAAA,UAAU;AAAA,QAAA,CAC9F;AAEOd,gBAAAA,IAAI,mBAAmBtH,IAAI;AACnC,eAAOA,KAAKA,QAAQ;AAAA,UAAEwI,MAAM,CAAE;AAAA,UAAEQ,OAAO;AAAA,UAAGX,MAAM;AAAA,UAAGC,UAAU;AAAA,UAAIW,SAAS;AAAA,QAAA;AAAA,eACnEvI,OAAO;AACN4G,gBAAAA,IAAI,6BAA6B5G,KAAK;AACvC,eAAA;AAAA,UAAE8H,MAAM,CAAE;AAAA,UAAEQ,OAAO;AAAA,UAAGX,MAAM;AAAA,UAAGC,UAAU;AAAA,UAAIW,SAAS;AAAA,QAAA;AAAA,MAC/D;AAAA,IACF;AAAA;AAAA;AAAA,EAGMoI,qCACJhJ,OAAe,GACfC,WAAmB,IACyC;AAAA;;AACxD,UAAA;AAEI8I,cAAAA,eAAe,MAAMxF,mBAAmBvC;AAGxCrJ,cAAAA,OAAO,MAAMJ,QAAQ,2BAA2B;AAAA,UACpDI,MAAM;AAAA,YACJqI;AAAAA,YACAC;AAAAA,YACAH,UAAUiJ,aAAajJ;AAAAA,YACvBC,WAAWgJ,aAAahJ;AAAAA,UAC1B;AAAA,QAAA,CACD;AAEOd,gBAAAA,IAAI,mBAAmBtH,IAAI;AAEnC,cAAMwC,eAAaxC,UAAKA,SAALA,mBAAWwI,SAAQ,CAAA;AAGtC,cAAM8I,uBAAuB9O,WAAWb,IAAI,CAACoK,cAA0B,iCAClEA,YADkE;AAAA,UAErEnI,QAAQmE,kBAAkBgE,UAAUnI,MAAM;AAAA,QAC1C,EAAA;AAGF,cAAM2N,yBAAyB,MAAMC,QAAQC,IAC3CH,qBAAqB3P,IAAI,CAAOoK,cAAyB;AACnD,cAAA;AAEF,kBAAMwE,YAAY,MAAMpH,aAAaP,eAAemD,UAAUlD,OAAO;AAC/DJ,kBAAAA,SAAQ8H,uCAAWvQ,SAAQuQ;AAEjC,gBAAI7E,WAA0B;AAI1BjD,iBAAAA,+BAAON,cAAYM,+BAAOL,YAAW;AAC5BwD,yBAAAA,mBAAmBrB,kBAC5B6G,aAAajJ,UACbiJ,aAAahJ,WACbK,MAAMN,UACNM,MAAML,SACR;AAAA,YACF;AAEO,mBAAA,iCACF2D,YADE;AAAA,cAELL;AAAAA,YAAAA;AAAAA,mBAEKhL,OAAO;AACdE,oBAAQC,KAAK,QAAQkL,UAAUjJ,EAAE,YAAYpC,KAAK;AAC3C,mBAAA,iCACFqL,YADE;AAAA,cAELL,UAAU;AAAA,YAAA;AAAA,UAEd;AAAA,QACD,EAAA,CACH;AAGuBgG,+BAAAA,KAAK,CAACxG,GAAGyG,MAAM;AACpC,cAAIzG,EAAEQ,aAAa,QAAQiG,EAAEjG,aAAa;AAAa,mBAAA;AACvD,cAAIR,EAAEQ,aAAa;AAAa,mBAAA;AAChC,cAAIiG,EAAEjG,aAAa;AAAa,mBAAA;AACzBR,iBAAAA,EAAEQ,WAAWiG,EAAEjG;AAAAA,QAAAA,CACvB;AAEM,eAAA;AAAA,UACLlD,MAAM+I;AAAAA,UACNvI,SAAOhJ,UAAKA,SAALA,mBAAWgJ,UAASuI,uBAAuBrE;AAAAA,UAClD7E,QAAMrI,UAAKA,SAALA,mBAAWqI,SAAQA;AAAAA,UACzBC,YAAUtI,UAAKA,SAALA,mBAAWsI,aAAYA;AAAAA,UACjCW,WAASjJ,UAAKA,SAALA,mBAAWiJ,YAAW;AAAA,QAAA;AAAA,eAE1BvI,OAAO;AACN4G,gBAAAA,IAAI,wBAAwB5G,KAAK;AAClC,eAAA;AAAA,UAAE8H,MAAM,CAAE;AAAA,UAAEQ,OAAO;AAAA,UAAGX,MAAM;AAAA,UAAGC,UAAU;AAAA,UAAIW,SAAS;AAAA,QAAA;AAAA,MAC/D;AAAA,IACF;AAAA;AAAA;AAAA,EAGM2I,qBACJ/I,SACAR,OAAe,GACfC,WAAmB,IACW;AAAA;AAC9B,YAAMtI,OAAO,MAAMJ,QAAQ,WAAWiJ,OAAO,eAAe;AAAA,QAC1D7I,MAAM;AAAA,UAAEqI;AAAAA,UAAMC;AAAAA,QAAS;AAAA,MAAA,CACxB;AAEOhB,cAAAA,IAAI,mBAAmBtH,IAAI;AAG7B6R,YAAAA,iBAAiBC,MAAMC,QAAQ/R,KAAKA,IAAI,IAAIA,KAAKA,OAAO;AACvD,aAAA;AAAA,QACLwI,MAAMqJ;AAAAA,QACN7I,OAAO6I,eAAe3E;AAAAA,QACtB7E,MAAM;AAAA,QACNC,UAAUuJ,eAAe3E;AAAAA,QACzBjE,SAAS;AAAA,MAAA;AAAA,IAEb;AAAA;AAAA;AAAA,EAGM+I,mBAAmB3B,aAAqB;AAAA;AACxC,UAAA;AACF,cAAMrQ,OAAO,MAAMJ,QAAQ,eAAeyQ,WAAW,EAAE;AAC/C/I,gBAAAA,IAAI,mBAAmBtH,IAAI;AAC5BA,eAAAA;AAAAA,eACAU,OAAO;AACN4G,gBAAAA,IAAI,oBAAoB5G,KAAK;AAC/BA,cAAAA;AAAAA,MACR;AAAA,IACF;AAAA;AAAA;AAAA,EAGMuR,yBACJC,WACA7J,OAAe,GACfC,WAAmB,IACW;AAAA;AACxBtI,YAAAA,OAAO,MAAMJ,QAAQ,sBAAsB;AAAA,QAC/CI,MAAM;AAAA,UAAEkS;AAAAA,UAAW7J;AAAAA,UAAMC;AAAAA,QAAS;AAAA,MAAA,CACnC;AAEOhB,cAAAA,IAAI,qBAAqBtH,IAAI;AACrC,aAAOA,KAAKA;AAAAA,IACd;AAAA;AAAA;AAAA,EAGMmS,iBACJpJ,SACAV,OAAe,GACfC,WAAmB,IACW;AAAA;AACxBtI,YAAAA,OAAO,MAAMJ,QAAQ,sBAAsB;AAAA,QAC/CI,MAAM;AAAA,UAAE+I;AAAAA,UAASV;AAAAA,UAAMC;AAAAA,QAAS;AAAA,MAAA,CACjC;AAEOhB,cAAAA,IAAI,mBAAmBtH,IAAI;AACnC,aAAOA,KAAKA;AAAAA,IACd;AAAA;AAAA;AAAA,EAGMoS,kBACJ/B,aACApC,MACAqB,WAAmB,IAYlB;AAAA;AACG,UAAA;AACItP,cAAAA,OAAO,MAAMJ,QAAQ,iCAAiC;AAAA,UAC1DI,MAAM;AAAA,YAAEqQ;AAAAA,YAAapC;AAAAA,YAAMqB;AAAAA,UAAS;AAAA,QAAA,CACrC;AAEOhI,gBAAAA,IAAI,qBAAqBtH,IAAI;AACrC,eAAOA,KAAKA;AAAAA,eACLU,OAAO;AAGNA,gBAAAA,MAAM,qBAAqBA,KAAK;AAClCA,cAAAA;AAAAA,MACR;AAAA,IACF;AAAA;AAAA;AAAA;AAAA,EAIM2R,0BACJxJ,SACAoF,MACAqE,OAAe,GACC;AAAA;AACZ,UAAA;AACF,cAAMtS,OAAO,MAAMJ,QAAQ,WAAWiJ,OAAO,4BAA4B;AAAA,UACvE7I,MAAM;AAAA,YAAEiO;AAAAA,YAAMqE;AAAAA,UAAK;AAAA,QAAA,CACpB;AAEOhL,gBAAAA,IAAI,qBAAqBtH,IAAI;AAGrC,eAAO8R,MAAMC,QAAQ/R,KAAKA,IAAI,IAAIA,KAAKA,OAAO;eACvCU,OAAO;AACNA,gBAAAA,MAAM,qBAAqBA,KAAK;AAExC,eAAO;MACT;AAAA,IACF;AAAA;AACF;AAEa6R,MAAAA,mBAAmB,IAAIrB,iBAAiB;AC9HrD,MAAMsB,aAAa;AAAA;AAAA;AAAA;AAAA,EAITC,cAAc;AACb,WAAA;AAAA,MACLjM,QAAQ3D,iBAAiB;AAAA,MACzB6P,WAAW3P,oBAAoB;AAAA,IAAA;AAAA,EAEnC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ4P,iBAAiB3C,OAA0B;AAE7CA,QAAAA,MAAMxI,kBAAkB,WAAW;AAC9B,aAAA;AAAA,IACT;AAGA,QAAIwI,MAAMxI,kBAAkB,eAAewI,MAAMxI,kBAAkB,YAAY;AAC7E,aAAOwI,MAAMxI;AAAAA,IACf;AAGA,QAAIwI,MAAMxI,kBAAkB,UAAUwI,MAAMtJ,cAAc,WAAW;AAEnE,UAAIsJ,MAAM4C,mBAAmB;AAC3B,gBAAO5C,MAAM4C,mBAAiB;AAAA,UAC5B,KAAK;AACI,mBAAA;AAAA,UACT,KAAK;AACI,mBAAA;AAAA,UACT,KAAK;AACI,mBAAA;AAAA,UACT,KAAK;AAAA,UACL,KAAK;AAAA,UACL;AACS,mBAAA;AAAA,QACX;AAAA,MACF;AAGI5C,UAAAA,MAAM6C,mBAAmB7C,MAAM8C,WAAW;AACtCC,cAAAA,0CAA0B7E,KAAK,GAAG8B,MAAM6C,eAAe,IAAI7C,MAAM8C,SAAS,EAAE;AAC5EE,cAAAA,cAAc,IAAI9E,KAAK6E,oBAAoBE,aAAajD,MAAMV,YAAY,MAAM,GAAK;AACrF4D,cAAAA,0BAAUhF;AAIhB,YAAI8E,cAAcE,KAAK;AAGd,iBAAA;AAAA,QACT;AAAA,MACF;AAAA,IACF;AAGA,WAAOlD,MAAMxI;AAAAA,EACf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOc2L,qCAAqCnD,OAAiC;AAAA;AAC9E,UAAA;AACF,cAAMoD,WAA2B,CAAA;AAGjC,YAAIpD,MAAMnH,WAAW,CAACmH,MAAMqD,WAAW;AAC5BC,mBAAAA,KACPnS,IAAI,WAAW6O,MAAMnH,OAAO,EAAE,EAC3B0K,KAAKC,CAAiB,kBAAA;AACrB,kBAAM/K,QAAQ+K,cAAcxT;AAC5BgQ,kBAAMqD,YAAY5K,MAAMzD;AACxBgL,kBAAMyD,eAAehL,MAAMiL;AAAAA,UAAAA,CAC5B,EACAC,MAAM,CAAOjT,UAAU;AACtBE,oBAAQF,MAAM,sBAAsBsP,MAAMnH,OAAO,MAAMnI,KAAK;AAEtDkT,kBAAAA,eAAe,MAAM,KAAKC;AAChC,gBAAID,cAAc;AACVP,oBAAAA,YAAY,GAAGO,aAAa5O,IAAI;AACtCgL,oBAAMyD,eAAeG,aAAaF;AAAAA,YAAAA,OAC7B;AAEL1D,oBAAMqD,YAAY;AAClBrD,oBAAMyD,eAAe;AAAA,YACvB;AAAA,UACD,EAAA,CACL;AAAA,QACF;AAGA,YAAIzD,MAAMK,eAAe,CAACL,MAAMZ,iBAAiB;AACtCkE,mBAAAA,KACPnS,IAAI,eAAe6O,MAAMK,WAAW,EAAE,EACnCkD,KAAKjD,CAAqB,sBAAA;AACzB,kBAAMvE,YAAYuE,kBAAkBtQ;AACpCgQ,kBAAMZ,kBAAkBrD,UAAUnI;AAE9B,gBAAA,CAACoM,MAAMX,eAAe;AACxBW,oBAAMX,gBAAgBtD,UAAU/G;AAAAA,YAClC;AAAA,UAAA,CACD,EACA2O,MAAMjT,CAAS,UAAA;AACdE,oBAAQF,MAAM,0BAA0BsP,MAAMK,WAAW,MAAM3P,KAAK;AAEhE,gBAAA,CAACsP,MAAMZ,iBAAiB;AAC1BY,oBAAMZ,kBAAkB;AAAA,YAC1B;AAAA,UACD,CAAA,CACL;AAAA,QACF;AAGIgE,YAAAA,SAASlG,SAAS,GAAG;AACjBsE,gBAAAA,QAAQsC,WAAWV,QAAQ;AAAA,QACnC;AAAA,eACO1S,OAAO;AACNA,gBAAAA,MAAM,aAAaA,KAAK;AAAA,MAElC;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMcmT,sBAAyE;AAAA;;AACjF,UAAA;AACItT,cAAAA,WAAW,MAAMY,IAAI,kBAAkB;AAAA,UAAEkH,MAAM;AAAA,UAAGC,UAAU;AAAA,QAAA,CAAG;AACrE,aAAI/H,oBAASP,SAATO,mBAAeiI,SAAfjI,mBAAsB,IAAI;AAC5B,gBAAMkI,QAAQlI,SAASP,KAAKwI,KAAK,CAAC;AAC3B,iBAAA;AAAA,YACLxD,MAAMyD,MAAMzD;AAAAA,YACZ0O,SAASjL,MAAMiL;AAAAA,UAAAA;AAAAA,QAEnB;AAAA,eACOhT,OAAO;AACNA,gBAAAA,MAAM,eAAeA,KAAK;AAAA,MACpC;AACO,aAAA;AAAA,IACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQcqT,yCAAyCC,QAA2C;AAAA;AAC5F,UAAA;AAEIC,cAAAA,+BAAeC;AACfC,cAAAA,mCAAmBD;AAEzBF,eAAOI,QAAQpE,CAAS,UAAA;AACtB,cAAIA,MAAMnH,WAAW,CAACmH,MAAMqD,WAAW;AACrCY,qBAASI,IAAIrE,MAAMnH,QAAQgF,SAAU,CAAA;AAAA,UACvC;AACA,cAAImC,MAAMK,eAAe,CAACL,MAAMZ,iBAAiB;AAC/C+E,yBAAaE,IAAIrE,MAAMK,YAAYxC,SAAU,CAAA;AAAA,UAC/C;AAAA,QAAA,CACD;AAGD,cAAMuF,WAA2B,CAAA;AAC3BkB,cAAAA,+BAAeC;AACfC,cAAAA,mCAAmBD;AACnBE,cAAAA,sCAAsBP;AAG5BpC,cAAM4C,KAAKT,QAAQ,EAAEG,QAAQvL,CAAW,YAAA;AACtCuK,mBAASE,KACPnS,IAAI,WAAW0H,OAAO,EAAE,EACrB0K,KAAKhT,CAAY,aAAA;AACPoU,qBAAAA,IAAI9L,SAAStI,SAASP,IAAI;AAAA,UAAA,CACpC,EACA2T,MAAMjT,CAAS,UAAA;AACdE,oBAAQC,KAAK,2BAA2BgI,OAAO,MAAMnI,MAAMC,OAAO;AAClE8T,4BAAgBJ,IAAIxL,OAAO;AAAA,UAC5B,CAAA,CACL;AAAA,QAAA,CACD;AAGDiJ,cAAM4C,KAAKP,YAAY,EAAEC,QAAQ/D,CAAe,gBAAA;AAC9C+C,mBAASE,KACPnS,IAAI,eAAekP,WAAW,EAAE,EAC7BkD,KAAKhT,CAAY,aAAA;AACHoU,yBAAAA,IAAItE,aAAa9P,SAASP,IAAI;AAAA,UAAA,CAC5C,EACA2T,MAAMjT,CAAS,UAAA;AACdE,oBAAQF,MAAM,4BAA4B2P,WAAW,MAAM3P,KAAK;AAAA,UACjE,CAAA,CACL;AAAA,QAAA,CACD;AAGG0S,YAAAA,SAASlG,SAAS,GAAG;AACjBsE,gBAAAA,QAAQsC,WAAWV,QAAQ;AAAA,QACnC;AAGMwB,cAAAA,cAAcZ,OAAOxS,OAAOwO,CAAS,UAAA;AACrCA,cAAAA,MAAMnH,WAAW4L,gBAAgBI,IAAI7E,MAAMnH,QAAQgF,SAAAA,CAAU,GAAG;AAClEjN,oBAAQC,KAAK,WAAWmP,MAAMzI,OAAO,OAAOyI,MAAMnH,OAAO,OAAO;AACzD,mBAAA;AAAA,UACT;AACO,iBAAA;AAAA,QAAA,CACR;AAGD+L,oBAAYR,QAAQpE,CAAS,UAAA;AAE3B,cAAIA,MAAMnH,WAAW,CAACmH,MAAMqD,WAAW;AACrC,kBAAM5K,QAAQ6L,SAASnT,IAAI6O,MAAMnH,QAAQgF,UAAU;AACnD,gBAAIpF,OAAO;AACTuH,oBAAMqD,YAAY5K,MAAMzD;AACxBgL,oBAAMyD,eAAehL,MAAMiL;AAAAA,YAC7B;AAAA,UACF;AAGA,cAAI1D,MAAMK,eAAe,CAACL,MAAMZ,iBAAiB;AAC/C,kBAAMrD,YAAYyI,aAAarT,IAAI6O,MAAMK,YAAYxC,UAAU;AAC/D,gBAAI9B,WAAW;AACbiE,oBAAMZ,kBAAkBrD,UAAUnI;AAC9B,kBAAA,CAACoM,MAAMX,eAAe;AACxBW,sBAAMX,gBAAgBtD,UAAU/G;AAAAA,cAClC;AAAA,YAAA,OACK;AAELgL,oBAAMZ,kBAAkB;AAAA,YAC1B;AAAA,UACF;AAAA,QAAA,CACD;AAEMwF,eAAAA;AAAAA,eACAlU,OAAO;AACNA,gBAAAA,MAAM,iBAAiBA,KAAK;AAE7BsT,eAAAA;AAAAA,MACT;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMc,uBAAuB1T,QAA2B;AAAA;AAClD,UAAA;AAEF,cAAMkF,eAAejC;AACrB,YAAI,CAACiC,cAAc;AACX,gBAAA,IAAItF,MAAM,MAAM;AAAA,QACxB;AAEM,cAAA;AAAA,UAAEwF;AAAAA,UAAQkM;AAAAA,QAAAA,IAAc,KAAKD;AAG3BnL,gBAAAA,IAAI,gBAAgBlG,MAAM;AAClCR,gBAAQ0G,IAAI,qBAAqB,OAAOlG,OAAOiP,aAAa,MAAMjP,OAAOiP,WAAW;AAEpF,cAAM0E,cAAc;AAAA,UAClB1E,aAAa7E,OAAOpK,OAAOiP,WAAW;AAAA,UACtCxH,SAAS2C,OAAOpK,OAAOyH,OAAO;AAAA,UAC9BrC;AAAAA,UACAkM;AAAAA,UACAG,iBAAiBzR,OAAOyR;AAAAA,UACxBC,WAAW1R,OAAO4T;AAAAA,UAClB1F,UAAUlO,OAAOkO,YAAY;AAAA,UAC7B2F,WAAW7T,OAAO6T;AAAAA,UAClB1F,aAAanO,OAAOmO;AAAAA,UACpBjK,QAAQlE,OAAO2L,iBAAiB3L,OAAOkE,SAAS;AAAA;AAAA,UAChDiB,eAAenF,OAAOmF;AAAAA;AAAAA,QAAAA;AAIhBe,gBAAAA,IAAI,iBAAiByN,WAAW;AAChCzN,gBAAAA,IAAI,uBAAuByN,YAAY1E,aAAa,WAAW6E,MAAMH,YAAY1E,WAAW,CAAC;AAC7F/I,gBAAAA,IAAI,YAAYyN,YAAYxO,aAAa;AAEjD,cAAMhG,WAAW,MAAMuB,KAAK,mCAAmCiT,aAAa;AAAA,UAC1E7U,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAGD,cAAMsG,YAAuB,iCACxBlG,SAASP,KAAKgQ,QADU;AAAA,UAE3BX,eAAejO,OAAOiO;AAAAA,UACtBD,iBAAiBhO,OAAOgO;AAAAA,UACxBG,aAAanO,OAAOmO;AAAAA,UACpBD,UAAUlO,OAAOkO;AAAAA,UACjBuD,iBAAiBzR,OAAOyR;AAAAA,UACxBC,WAAW1R,OAAO4T;AAAAA;AAAAA;AAAAA,QAAAA;AAIb,eAAA;AAAA,UACLhF,OAAOvJ;AAAAA,UACP0O,aAAa5U,SAASP,KAAKmV;AAAAA,QAAAA;AAAAA,eAEtBzU,OAAY;AACXA,gBAAAA,MAAM,WAAWA,KAAK;AAC9B,cAAM,IAAIM,MAAMN,MAAMC,WAAW,QAAQ;AAAA,MAC3C;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMyU,iBAAiB7N,SAA+C;AAAA;;AAChE,UAAA;AAEF,cAAMhH,WAAW,MAAMY,IAAI,WAAWoG,OAAO,iBAAiB;AAEtDD,gBAAAA,IAAI,gBAAgB/G,SAASP,IAAI;AAGrCO,YAAAA,SAASP,KAAK0H,aAAa;AACvB2N,gBAAAA,gBAAgB9U,SAASP,KAAK0H;AAGpC,cAAI,CAAC2N,cAAcC,aAAa/U,SAASP,KAAK2G,QAAQ;AACtC2O,0BAAAA,YAAY/U,SAASP,KAAK2G;AAAAA,UAC1C;AAEA/F,kBAAQ0G,IAAI,iBAAiB;AAAA,YAC3BiO,WAAWF,cAAcE;AAAAA,YACzBC,YAAUH,mBAAcG,aAAdH,mBAAwBI,UAAU,GAAG,MAAK;AAAA,YACpDC,SAASL,cAAcK;AAAAA,YACvBC,UAAUN,cAAcM;AAAAA,YACxBC,WAASP,mBAAcO,YAAdP,mBAAuBI,UAAU,GAAG,OAAM;AAAA,YACnDH,WAAWD,cAAcC;AAAAA,UAAAA,CAC1B;AAEMD,iBAAAA;AAAAA,QACT;AAGAzU,gBAAQ0G,IAAI,oBAAoB;AACzB,eAAA;AAAA,eACA5G,OAAY;AACXA,gBAAAA,MAAM,gBAAgBA,KAAK;AACnCE,gBAAQF,MAAM,YAAY;AAAA,UACxBC,SAASD,MAAMC;AAAAA,UACfJ,WAAUG,WAAMH,aAANG,mBAAgBV;AAAAA,QAAAA,CAC3B;AACK,cAAA,IAAIgB,MAAM,UAAU;AAAA,MAC5B;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQM6U,kBAAkBtO,SAAiBtG,QAAwD;AAAA;AAC3F,UAAA;AAEIV,cAAAA,WAAW,MAAMuB,KAAK,eAAe;AAAA,UACzCyF;AAAAA,UACAhB,eAAe;AAAA,QAAA,CAChB;AAEM,eAAA;AAAA,UACLgB;AAAAA,UACAC,eAAe;AAAA,UACfsO,QAAQvV,SAASP,KAAK8V,WAAc5H,oBAAAA,QAAO6H,YAAY;AAAA,QAAA;AAAA,eAElDrV,OAAY;AACXA,gBAAAA,MAAM,aAAaA,KAAK;AAChC,cAAM,IAAIM,MAAMN,MAAMC,WAAW,MAAM;AAAA,MACzC;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMqV,eAAezO,SAAqC;AAAA;AACpD,UAAA;AAEF,cAAMhH,WAAW,MAAMY,IAAI,WAAWoG,OAAO,EAAE;AAG/C,cAAMyI,QAAQzP,SAASP;AAIvB,YAAIgQ,MAAMlJ,WAAW;AACbmP,gBAAAA,gBAAgBjG,MAAMlJ,UAAUmP;AAChC5F,gBAAAA,cAAcL,MAAMlJ,UAAUuJ;AAC9BhB,gBAAAA,gBAAgBW,MAAMlJ,UAAUuI;AAEtCW,gBAAMZ,kBAAkBrH,kBAAkBiI,MAAMlJ,UAAUsI,eAAe;AACnEvG,gBAAAA,UAAUmH,MAAMlJ,UAAU+B;AAC1BgK,gBAAAA,kBAAkB7C,MAAMlJ,UAAU+L;AAClCC,gBAAAA,YAAY9C,MAAMlJ,UAAUgM;AAC5BxD,gBAAAA,WAAWU,MAAMlJ,UAAUwI;AACjCU,gBAAMT,cAAcS,MAAMlJ,UAAUyI,eAAeS,MAAM3P;AAGnDuS,gBAAAA,oBAAoB5C,MAAMlJ,UAAU8L;AAGpC,gBAAA,KAAKO,qCAAqCnD,KAAK;AAAA,QACvD;AAGMkG,cAAAA,gBAAgB,KAAKvD,iBAAiB3C,KAAK;AAE1CA,eAAAA;AAAAA,eACAtP,OAAY;AACXA,gBAAAA,MAAM,aAAaA,KAAK;AAC1B,cAAA,IAAIM,MAAM,WAAW;AAAA,MAC7B;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUMmV,aACJlV,QACAyF,WACA2B,OAAe,GACfC,WAAmB,IACG;AAAA;AAClB,UAAA;AACI,cAAA;AAAA,UAAE9B;AAAAA,QAAAA,IAAW,KAAKiM;AAExB,cAAMrR,SAAc;AAAA,UAAEoF;AAAAA,UAAQ6B;AAAAA,UAAMC;AAAAA,QAAAA;AAChCrH,YAAAA;AAAQG,iBAAOH,SAASA;AACxByF,YAAAA;AAAWtF,iBAAOsF,YAAYA;AAElC,cAAMnG,WAAW,MAAMY,IAAuB,WAAWC,MAAM;AAG/D,cAAM4S,SAASzT,SAASP,KAAKwI,KAAK7G,IAAIqO,CAAS,UAAA;AAK7C,cAAIA,MAAMlJ,WAAW;AACbmP,kBAAAA,gBAAgBjG,MAAMlJ,UAAUmP;AAChC5F,kBAAAA,cAAcL,MAAMlJ,UAAUuJ;AAC9BhB,kBAAAA,gBAAgBW,MAAMlJ,UAAUuI;AAEtCW,kBAAMZ,kBAAkBrH,kBAAkBiI,MAAMlJ,UAAUsI,eAAe;AACnEvG,kBAAAA,UAAUmH,MAAMlJ,UAAU+B;AAC1BwK,kBAAAA,YAAYrD,MAAMlJ,UAAUuM;AAC5BI,kBAAAA,eAAezD,MAAMlJ,UAAU2M;AAC/BZ,kBAAAA,kBAAkB7C,MAAMlJ,UAAU+L;AAClCC,kBAAAA,YAAY9C,MAAMlJ,UAAUgM;AAC5BxD,kBAAAA,WAAWU,MAAMlJ,UAAUwI;AACjCU,kBAAMT,cAAcS,MAAMlJ,UAAUyI,eAAeS,MAAM3P;AAGnDuS,kBAAAA,oBAAoB5C,MAAMlJ,UAAU8L;AAAAA,UAC5C;AAGMsD,gBAAAA,gBAAgB,KAAKvD,iBAAiB3C,KAAK;AAE1CA,iBAAAA;AAAAA,QAAAA,CACR;AAGD,cAAM4E,cAAc,MAAM,KAAKb,yCAAyCC,MAAM;AAEvEY,eAAAA;AAAAA,eACAlU,OAAY;AACXA,gBAAAA,MAAM,aAAaA,KAAK;AAChC,eAAO;MACT;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQM0V,YAAY7O,SAAiB8O,SAAiB,QAAsC;AAAA;AACpF,UAAA;AACI,cAAA;AAAA,UAAE7P;AAAAA,QAAAA,IAAW,KAAKiM;AAElBlS,cAAAA,WAAW,MAAMuB,KAA0B,kBAAkB;AAAA,UACjEyF;AAAAA,UACAf;AAAAA,UACA6P;AAAAA,QAAAA,GACC;AAAA,UACDnW,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAED,eAAOI,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,WAAWA,KAAK;AAC9B,cAAM,IAAIM,MAAMN,MAAMC,WAAW,QAAQ;AAAA,MAC3C;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQM2V,cAAc/O,SAAiB8O,QAA+B;AAAA;AAC9D,UAAA;AACI,cAAA;AAAA,UAAE7P;AAAAA,QAAAA,IAAW,KAAKiM;AAExB,cAAMlS,WAAW,MAAMuB,KAAK,WAAWyF,OAAO,WAAW;AAAA,UACvDf;AAAAA,UACA6P,QAAQA,UAAU;AAAA,QAAA,GACjB;AAAA,UACDnW,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAED,eAAOI,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,WAAWA,KAAK;AAC9B,cAAM,IAAIM,MAAMN,MAAMC,WAAW,QAAQ;AAAA,MAC3C;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOM4V,gBAAgBC,UAAgC;AAAA;AAChD,UAAA;AACF,cAAMjW,WAAW,MAAMY,IAAI,YAAYqV,QAAQ,EAAE;AACjD,eAAOjW,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,aAAaA,KAAK;AAC1B,cAAA,IAAIM,MAAM,YAAY;AAAA,MAC9B;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMyV,YAAYlP,SAAmC;AAAA;AAC/C,UAAA;AAEF,cAAMmP,gBAAgB,MAAM,KAAKV,eAAezO,OAAO;AAGvDnH,aAAAA,KAAK8C,eAAe,mBAAmB;AAAA,UACrCmN,aAAaqG,cAAcrG;AAAAA,UAC3BhB,eAAeqH,cAAcrH;AAAAA,UAC7BxG,SAAS6N,cAAc7N;AAAAA,UACvBwK,WAAWqD,cAAcrD;AAAAA,UACzB4B,WAAWyB,cAAczB;AAAAA,UACzB1F,aAAamH,cAAcnH;AAAAA,UAC3BD,UAAUoH,cAAcpH;AAAAA,QAAAA,CACzB;AAEM,eAAA;AAAA,eACA5O,OAAO;AACNA,gBAAAA,MAAM,WAAWA,KAAK;AACvB,eAAA;AAAA,MACT;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMMiW,qBAAqB;AAAA;AACrB,UAAA;AACI,cAAA;AAAA,UAAEnQ;AAAAA,QAAAA,IAAW,KAAKiM;AAClBlS,cAAAA,WAAW,MAAMY,IAAI,WAAW;AAAA,UAAEqF;AAAAA,UAAQ6B,MAAM;AAAA,UAAGC,UAAU;AAAA,QAAA,CAAK;AAElE0L,cAAAA,SAASzT,SAASP,KAAKwI;AAEtB,eAAA;AAAA,UACLQ,OAAOgL,OAAO9G;AAAAA,UACd0J,gBAAgB5C,OAAOxS,OAAO,CAACqV,MAAiBA,EAAErP,kBAAkB,SAAS,EAAE0F;AAAAA,UAC/E4J,MAAM9C,OAAOxS,OAAO,CAACqV,MAAiBA,EAAErP,kBAAkB,MAAM,EAAE0F;AAAAA,UAClE6J,WAAW/C,OAAOxS,OAAO,CAACqV,MAAiBA,EAAErP,kBAAkB,UAC7D,oBAAI0G,KAAK2I,EAAEhE,kBAAkB,MAAMgE,EAAE/D,SAAS,IAAQ5E,oBAAAA,KAAM,CAAA,EAAEhB;AAAAA;AAAAA,UAChE8J,WAAWhD,OAAOxS,OAAO,CAACqV,MAAiBA,EAAErP,kBAAkB,WAAW,EAAE0F;AAAAA,QAAAA;AAAAA,eAEvExM,OAAO;AACNA,gBAAAA,MAAM,aAAaA,KAAK;AACzB,eAAA;AAAA,UACLsI,OAAO;AAAA,UACP4N,gBAAgB;AAAA,UAChBE,MAAM;AAAA,UACNC,WAAW;AAAA,UACXC,WAAW;AAAA,QAAA;AAAA,MAEf;AAAA,IACF;AAAA;AACF;AAGaC,MAAAA,eAAe,IAAIzE,aAAa;ACnsBtC,SAAS0E,YAAYC,eAAkD;AACxE,MAAA,CAACA,iBAAiBA,kBAAkB;AAAU,WAAA;AAC3CtM,SAAAA,KAAKc,MAAMwL,aAAa,IAAI;AACrC;AAkBgBC,SAAAA,aACdD,eACArX,SAKQ;AACF,QAAA;AAAA,IACJuX,SAAS;AAAA,IACTC,SAAS;AAAA,IACTC,YAAY;AAAA,EAAA,IACVzX,WAAW,CAAA;AAGXqX,MAAAA,kBAAkBzV,UAAayV,kBAAkB,MAAM;AAClD,WAAA,GAAGE,MAAM,OAAOC,MAAM;AAAA,EAC/B;AAGA,MAAI,OAAOH,kBAAkB,YAAYjC,MAAMiC,aAAa,GAAG;AAC7DvW,YAAQC,KAAK,4BAA4B;AAAA,MAAEsW;AAAAA,MAAepS,MAAM,OAAOoS;AAAAA,IAAAA,CAAe;AAC/E,WAAA,GAAGE,MAAM,OAAOC,MAAM;AAAA,EAC/B;AAEME,QAAAA,OAAON,YAAYC,aAAa;AAGlCjC,MAAAA,MAAMsC,IAAI,GAAG;AACf5W,YAAQF,MAAM,8BAA8B;AAAA,MAAEyW;AAAAA,MAAeK;AAAAA,IAAAA,CAAM;AAC5D,WAAA,GAAGH,MAAM,OAAOC,MAAM;AAAA,EAC/B;AAEO,SAAA,GAAGD,MAAM,GAAGG,KAAK5Q,QAAQ2Q,SAAS,CAAC,GAAGD,MAAM;AACrD;ACrDA,MAAMG,eAAe;AAAA,EAAAC,cAAA;AAAA,SACXC,SAAwB;AAAA;AAAA,MAE9BC,gBAAgB;AAAA;AAAA,MAChBC,sBAAsB;AAAA,MACtBC,qBAAqB;AAAA;AAAA,IAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKKC,IAAIjY,SAA2C;AAAA;AAC7C,YAAA;AAAA,QAAEyG;AAAAA,MAAkBzG,IAAAA;AAG1B,UAAIyG,kBAAkB,WAAW;AACxB,eAAA,KAAKyR,eAAelY,OAAO;AAAA,MACpC;AAGA,UAAIyG,kBAAkB,UAAU;AACvB,eAAA,KAAK0R,cAAcnY,OAAO;AAAA,MACnC;AAEM,YAAA,IAAIkB,MAAM,UAAU;AAAA,IAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAKcgX,eAAelY,SAA2C;AAAA;AAClE,UAAA;AAEF,cAAM0G,SAASnC;AACf,YAAI,CAACmC,QAAQ;AACXpG,eAAAA,KAAKmE,UAAU;AAAA,YAAElE,OAAO;AAAA,YAAQmE,MAAM;AAAA,UAAA,CAAQ;AACvC,iBAAA;AAAA,QACT;AAEApE,aAAAA,KAAKF,YAAY;AAAA,UAAEG,OAAO;AAAA,QAAA,CAAU;AAEpCO,gBAAQ0G,IAAI,gBAAgB;AAAA,UAC1BC,SAASzH,QAAQyH;AAAAA,UACjBhB,eAAe;AAAA,QAAA,CAChB;AAGKhG,cAAAA,WAAW,MAAMuB,KAAK,eAAe;AAAA,UACzCyF,SAASzH,QAAQyH;AAAAA,UACjBhB,eAAe;AAAA,QAAA,CAChB;AAEOe,gBAAAA,IAAI,cAAc/G,QAAQ;AAElCH,aAAAA,KAAKI,YAAY;AAEbD,YAAAA,SAASf,SAAS,GAAG;AAGvB,gBAAM0Y,iBAAiB3X,SAASP,KAAKgE,WAAW,KAAK;AACrD5D,eAAAA,KAAKmE,UAAU;AAAA,YACblE,OAAO;AAAA,MAAa6X,cAActR,QAAQ,CAAC,CAAC;AAAA,YAC5CpC,MAAM;AAAA,YACN8K,UAAU;AAAA,UAAA,CACX;AACM,iBAAA;AAAA,QAAA,OACF;AACL,gBAAM,IAAItO,MAAMT,SAASI,WAAW,MAAM;AAAA,QAC5C;AAAA,eACOD,OAAY;AACXA,gBAAAA,MAAM,cAAcA,KAAK;AACjCE,gBAAQF,MAAM,YAAYA,MAAMH,YAAYG,MAAMC,OAAO;AACzDP,aAAAA,KAAKI,YAAY;AACjBJ,aAAAA,KAAKmE,UAAU;AAAA,UACblE,OAAOK,MAAMC,WAAW;AAAA,UACxB6D,MAAM;AAAA,QAAA,CACP;AACM,eAAA;AAAA,MACT;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMcyT,cAAcnY,SAA2C;AAAA;;AACjE,UAAA;AACMwH,gBAAAA,IAAI,oBAAoBxH,QAAQyH,OAAO;AAK/C,cAAMG,cAAe5H,QAAgB4H;AAErC,YAAI,CAACA,aAAa;AACV,gBAAA,IAAI1G,MAAM,iBAAiB;AAAA,QACnC;AAGA,cAAMmX,iBAAiB,CAAC,aAAa,YAAY,WAAW,YAAY,SAAS;AACjF,cAAMC,gBAAgBD,eAAe3W,OAAO6W,WAAS,CAAC3Q,YAAY2Q,KAAK,CAAC;AAEpED,YAAAA,cAAclL,SAAS,GAAG;AACpBxM,kBAAAA,MAAM,qBAAqB0X,aAAa;AAChD,gBAAM,IAAIpX,MAAM,aAAaoX,cAAcvW,KAAK,IAAI,CAAC,EAAE;AAAA,QACzD;AAEAjB,gBAAQ0G,IAAI,cAAc;AAAA,UACxBiO,WAAW7N,YAAY6N;AAAAA,UACvBC,YAAU9N,iBAAY8N,aAAZ9N,mBAAsB+N,UAAU,GAAG,MAAK;AAAA,UAClDC,SAAShO,YAAYgO;AAAAA,UACrBC,UAAUjO,YAAYiO;AAAAA,UACtBC,WAASlO,iBAAYkO,YAAZlO,mBAAqB+N,UAAU,GAAG,OAAM;AAAA,QAAA,CAClD;AAGD,cAAMrV,KAAAA,KAAKkY,eAAe;AAAA,UACxB/C,WAAW7N,YAAY6N;AAAAA,UACvBC,UAAU9N,YAAY8N;AAAAA,UACtBE,SAAShO,YAAYgO;AAAAA,UACrBC,UAAUjO,YAAYiO;AAAAA,UACtBC,SAASlO,YAAYkO;AAAAA,QAAAA,CACtB;AAEDhV,gBAAQ0G,IAAI,0BAA0B;AAEtClH,aAAAA,KAAKmE,UAAU;AAAA,UACblE,OAAO;AAAA,UACPmE,MAAM;AAAA,QAAA,CACP;AAEM,eAAA;AAAA,eACA9D,OAAY;AACfA,YAAAA,MAAMsJ,WAAW,8BAA8B;AACjDpJ,kBAAQ0G,IAAI,WAAW;AAChB,iBAAA;AAAA,QACT;AAEQ5G,gBAAAA,MAAM,cAAcA,KAAK;AACjCE,gBAAQF,MAAM,YAAY;AAAA,UACxBsJ,QAAQtJ,MAAMsJ;AAAAA,UACduO,SAAS7X,MAAM6X;AAAAA,UACf5X,SAASD,MAAMC;AAAAA,QAAAA,CAChB;AAEDP,aAAAA,KAAKmE,UAAU;AAAA,UACblE,OAAOK,MAAMsJ,UAAUtJ,MAAMC,WAAW;AAAA,UACxC6D,MAAM;AAAA,UACN8K,UAAU;AAAA,QAAA,CACX;AACK5O,cAAAA;AAAAA,MACR;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAKM8X,0BAIH;AAAA;AACM,aAAA;AAAA,QACLC,iBAAiB,KAAKd,OAAOG;AAAAA,QAC7BY,eAAe,KAAKf,OAAOE;AAAAA,QAC3BlX,SAAS;AAAA,MAAA;AAAA,IAEb;AAAA;AAAA;AAAA;AAAA;AAAA,EAKMgY,qBAAqBhS,QAIxB;AAAA;AACKpG,YAAAA,WAAW,MAAMuB,KAAK,2BAA2B;AAAA,QAAE6E;AAAAA,MAAAA,CAAQ;AACjE,aAAOpG,SAASP;AAAAA,IAClB;AAAA;AAAA;AAAA;AAAA;AAAA,EAKQ4Y,MAAMC,IAA2B;AACvC,WAAO,IAAIrH,QAAQsH,CAAAA,YAAWrU,WAAWqU,SAASD,EAAE,CAAC;AAAA,EACvD;AACF;AAGaE,MAAAA,iBAAiB,IAAItB,eAAe;AC1JjD,MAAMuB,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA,EAKVnW,mBAA2B;AACjC,WAAOA,iBAAiB;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMoW,aAA8B;AAAA;AAC9B,UAAA;AAEF,cAAM3S,eAAejC;AACrB,YAAI,CAACiC,cAAc;AACX,gBAAA,IAAItF,MAAM,MAAM;AAAA,QACxB;AAEMwF,cAAAA,SAAS,KAAK3D;AACdtC,cAAAA,WAAW,MAAMY,IAAqB,yBAAyB;AAAA,UAAEqF;AAAAA,QAAAA,CAAQ;AAGzE0S,cAAAA,iBAAiB3Y,SAASP,KAAKgE,WAAW;AAChDpD,gBAAQ0G,IAAI,YAAY;AAAA,UACtB6R,GAAGD;AAAAA,UACHE,IAAIF,iBAAiB,KAAKtS,QAAQ,CAAC;AAAA,QAAA,CACpC;AACMsS,eAAAA;AAAAA,eACAxY,OAAO;AACNA,gBAAAA,MAAM,WAAWA,KAAK;AACxB,cAAA,IAAIM,MAAM,YAAY;AAAA,MAC9B;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMqY,oBAA8C;AAAA;AAC9C,UAAA;AACI7S,cAAAA,SAAS,KAAK3D;AACdtC,cAAAA,WAAW,MAAMY,IAAqB,yBAAyB;AAAA,UAAEqF;AAAAA,QAAAA,CAAQ;AAE/E,eAAOjG,SAASP;AAAAA,eACTU,OAAO;AACNA,gBAAAA,MAAM,aAAaA,KAAK;AAC1B,cAAA,IAAIM,MAAM,cAAc;AAAA,MAChC;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMsY,qBAAgD;AAAA;AAChD,UAAA;AACI/Y,cAAAA,WAAW,MAAMY,IAAsB,mBAAmB;AAGhE,eAAOZ,SAASP;AAAAA,eACTU,OAAO;AACNA,gBAAAA,MAAM,aAAaA,KAAK;AAEhC,eAAO,KAAK6Y;MACd;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQA,4BAA8C;AAC7C,WAAA;AAAA,MACL;AAAA,QAAEzW,IAAI;AAAA,QAAG6D,QAAQ;AAAA,QAAO6S,OAAO;AAAA,QAAGC,OAAO;AAAA,QAAQC,WAAW;AAAA,MAAE;AAAA;AAAA,MAC9D;AAAA,QAAE5W,IAAI;AAAA,QAAG6D,QAAQ;AAAA,QAAO6S,OAAO;AAAA,QAAGC,OAAO;AAAA,QAAQC,WAAW;AAAA,MAAE;AAAA;AAAA,MAC9D;AAAA,QAAE5W,IAAI;AAAA,QAAG6D,QAAQ;AAAA,QAAO6S,OAAO;AAAA,QAAMC,OAAO;AAAA,QAAQC,WAAW;AAAA,QAAGC,cAAc;AAAA,MAAO;AAAA;AAAA,MACvF;AAAA,QAAE7W,IAAI;AAAA,QAAG6D,QAAQ;AAAA,QAAQ6S,OAAO;AAAA,QAAOC,OAAO;AAAA,QAASC,WAAW;AAAA,QAAGC,cAAc;AAAA,MAAQ;AAAA;AAAA,MAC3F;AAAA,QAAE7W,IAAI;AAAA,QAAG6D,QAAQ;AAAA,QAAQ6S,OAAO;AAAA,QAAOC,OAAO;AAAA,QAASC,WAAW;AAAA,QAAGC,cAAc;AAAA,MAAQ;AAAA;AAAA,MAC3F;AAAA,QAAE7W,IAAI;AAAA,QAAG6D,QAAQ;AAAA,QAAQ6S,OAAO;AAAA,QAAQC,OAAO;AAAA,QAASC,WAAW;AAAA,QAAGC,cAAc;AAAA,QAAUC,eAAe;AAAA,MAAK;AAAA;AAAA,IAAA;AAAA,EAEtH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQMC,oBAAoBlT,QAAgB6S,QAAgB,GAAG;AAAA;;AACvD,UAAA;AAEF,cAAMlT,eAAejC;AACrB,YAAI,CAACiC,cAAc;AACX,gBAAA,IAAItF,MAAM,UAAU;AAAA,QAC5B;AAGA,cAAM2B,WAAWD;AACb,YAAA,EAACC,qCAAUkB,SAAQ;AACf,gBAAA,IAAI7C,MAAM,6BAA6B;AAAA,QAC/C;AAEMwF,cAAAA,SAAS,KAAK3D;AACpB,cAAM6P,YAAY3P;AAElB,cAAMoU,gBAAgBxQ,SAAS;AAE/B,cAAMF,YAAY;AAAA,UAChBC,WAAW;AAAA,UACXF;AAAAA,UACAkM;AAAAA,UACArS,OAAOmZ,QAAQ,IAAI,KAAK7S,MAAM,OAAO6S,KAAK,MAAM,KAAK7S,MAAM;AAAA,UAC3DA,QAAQwQ;AAAAA;AAAAA,UACR5Q,eAAe;AAAA,UACfO,WAAW;AAAA,YACTgT,gBAAgBnT,SAAS;AAAA;AAAA,YACzB6S,OAAOA,QAAQ;AAAA;AAAA,YACfO,eAAepT,SAAS6S,SAAS;AAAA;AAAA,UACnC;AAAA,QAAA;AAIF5Y,gBAAQ0G,IAAI,WAAW;AACfA,gBAAAA,IAAI,cAAcd,MAAM;AACxBc,gBAAAA,IAAI,aAAaoL,SAAS;AAClC9R,gBAAQ0G,IAAI,YAAY;AAAA,UACtBZ,WAAWD,UAAUC;AAAAA,UACrBF,QAAQC,UAAUD;AAAAA,UAClBnG,OAAOoG,UAAUpG;AAAAA,UACjBsG,QAAQ,GAAGF,UAAUE,MAAM,QAAQF,UAAUE,SAAS,KAAKC,QAAQ,CAAC,CAAC;AAAA,UACrEL,eAAeE,UAAUF;AAAAA,UACzBO,WAAWL,UAAUK;AAAAA,QAAAA,CACtB;AAED,cAAMvG,WAAW,MAAMuB,KAAK,kBAAkB2E,WAAW;AAAA,UACvDvG,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAEDS,gBAAQ0G,IAAI,YAAY;AACxB1G,gBAAQ0G,IAAI,YAAY;AAAA,UACtBC,SAAShH,SAASP,KAAKuH;AAAAA,UACvBZ,QAAQ,GAAGpG,SAASP,KAAK2G,MAAM,QAAQpG,SAASP,KAAK2G,SAAS,KAAKC,QAAQ,CAAC,CAAC;AAAA,UAC7EY,eAAejH,SAASP,KAAKwH;AAAAA,UAC7BC,gBAAgB,CAAC,CAAClH,SAASP,KAAK0H;AAAAA,QAAAA,CACjC;AAED,eAAOnH,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,eAAeA,KAAK;AAGlC,cAAMiH,aAAYjH,+BAAOlB,WAAQkB,0CAAOH,aAAPG,mBAAiBV,SAAjBU,mBAAuBlB;AACxD,cAAMuB,iBAAeL,0CAAOH,aAAPG,mBAAiBV,SAAjBU,mBAAuBC,aACvCD,+BAAOC,YACP;AAGLC,gBAAQF,MAAM,YAAY;AAAA,UACxBlB,MAAMmI;AAAAA,UACNhH,SAASI;AAAAA,UACT6G,eAAclH,oCAAOH,aAAPG,mBAAiBV;AAAAA,UAC/B6H,WAAWnH;AAAAA,QAAAA,CACZ;AAGD,YAAIiH,cAAc,MAAM;AAClB5G,cAAAA,aAAapB,SAAS,QAAQ,GAAG;AAC7B,kBAAA,IAAIqB,MAAM,wBAAwB;AAAA,UAC1C;AAAA,QACF;AAEM,cAAA,IAAIA,MAAMD,YAAY;AAAA,MAC9B;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUMiZ,gBACJ3R,OAAe,GACfC,WAAmB,IACnBvD,MACwB;AAAA;AACpB,UAAA;AACIyB,cAAAA,SAAS,KAAK3D;AACpB,cAAMzB,SAAc;AAAA,UAAEoF;AAAAA,UAAQ6B;AAAAA,UAAMC;AAAAA,QAAAA;AAChCvD,YAAAA;AAAM3D,iBAAO2D,OAAOA;AAExB,cAAMxE,WAAW,MAAMY,IAA0B,8BAA8BC,MAAM;AAGrF,eAAOb,SAASP,KAAKwI;AAAAA,eACd9H,OAAO;AACNA,gBAAAA,MAAM,aAAaA,KAAK;AAChC,eAAO;MACT;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQMsX,eAAezQ,SAAiBZ,QAAgB;AAAA;AAChD,UAAA;AACIpG,cAAAA,WAAW,MAAMuB,KAAK,eAAe;AAAA,UACzCyF;AAAAA,UACAhB,eAAe;AAAA,QAAA,GACd;AAAA,UACDrG,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAEM,eAAA;AAAA,UACLiK,SAAS;AAAA,UACTpG,SAASzD,SAASP,KAAKgE;AAAAA;AAAAA,UACvBrD,SAAS;AAAA,QAAA;AAAA,eAEJD,OAAY;AACXA,gBAAAA,MAAM,WAAWA,KAAK;AAC9B,cAAM,IAAIM,MAAMN,MAAMC,WAAW,WAAW;AAAA,MAC9C;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASMsZ,gBAAgB1S,SAAiBZ,QAAgB0P,SAAiB,QAAQ;AAAA;AAC1E,UAAA;AACI9V,cAAAA,WAAW,MAAMuB,KAAK,wBAAwB;AAAA,UAClDkB,OAAOD,oBAAoB;AAAA,UAC3B4D;AAAAA;AAAAA,UACAY;AAAAA,UACArC,aAAamR;AAAAA,QAAAA,GACZ;AAAA,UACDnW,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAEM,eAAA;AAAA,UACLiK,SAAS;AAAA,UACTpG,SAASzD,SAASP,KAAKgE;AAAAA;AAAAA,UACvBkW,eAAe3Z,SAASP,KAAKka;AAAAA,UAC7BvZ,SAAS;AAAA,QAAA;AAAA,eAEJD,OAAY;AACXA,gBAAAA,MAAM,SAASA,KAAK;AAC5B,cAAM,IAAIM,MAAMN,MAAMC,WAAW,MAAM;AAAA,MACzC;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAKAwZ,aAAmB;AACb,QAAA;AACF/Z,gBAAKU,kBAAkB,UAAU;AACjCV,gBAAKU,kBAAkB,aAAa;AACpCF,cAAQ0G,IAAI,SAAS;AAAA,aACd5G,OAAO;AACNA,cAAAA,MAAM,WAAWA,KAAK;AAAA,IAChC;AAAA,EACF;AACF;AAGa0Z,MAAAA,gBAAgB,IAAIpB,cAAc;AC5T/BqB,SAAAA,gCAAgClW,cAAsBqC,QAAgC;AAChG,MAAA,CAACrC,gBAAgBA,gBAAgB,GAAG;AAC/B,WAAA;AAAA,EACT;AAEA,QAAMmW,qBAAqBzP,KAAKc,OAAO,IAAIxH,gBAAgB,GAAG;AACxD+O,QAAAA,0BAAUhF;AACVqM,QAAAA,eAAe,IAAIrM,KAAKgF,IAAID,QAAAA,IAAY,MAAM,KAAK,KAAK,KAAK,GAAI;AAEhE,SAAA;AAAA,IACLnQ,IAAI,WAAW0D,MAAM;AAAA,IACrBA,QAAQA,OAAOqH,SAAS;AAAA,IACxB9I,MAAM;AAAA,IACNC,MAAMsV,sBAAsB,KAAK,UAAU;AAAA,IAC3CpV,aAAa,OAAO2F,KAAKc,MAAMxH,eAAe,GAAG,CAAC;AAAA,IAClDA;AAAAA,IACAmW;AAAAA,IACAE,WAAWtH,IAAI6C,YAAY;AAAA,IAC3B0E,SAASF,aAAaxE,YAAY;AAAA,IAClC9U,QAAQ;AAAA,IACRyZ,aAAa;AAAA,EAAA;AAEjB;AAKgBC,SAAAA,uBAAuBpV,eAAuBpB,cAK5D;AACA,QAAMyW,aAAa/P,KAAKc,MAAMpG,gBAAgBpB,YAAY;AAC1D,QAAM0W,cAActV,gBAAgBqV;AACpC,QAAMN,qBAAqBzP,KAAKc,MAAMxH,eAAe,GAAG;AAEjD,SAAA;AAAA,IACLoB;AAAAA,IACAqV;AAAAA,IACAC;AAAAA,IACAC,iBAAiB,GAAGR,kBAAkB;AAAA,EAAA;AAE1C;AC7DA,MAAMS,eAAe;AAAA,EAAArD,cAAA;AAAA,SACXsD,WAAsB;AAAE,SACxBC,iBAAiC;AAAA,EAAI;AAAA;AAAA;AAAA;AAAA,EAKvCC,gBAAoC;AAAA;AACxC,YAAMvY,WAAWD;AACjB,UAAI,CAACC,UAAU;AACb,eAAO;MACT;AAGA,UAAIA,SAASwB,gBAAgBxB,SAASwB,eAAe,GAAG;AACtD,cAAMgX,UAAUd,gCAAgC1X,SAASwB,cAAcxB,SAASG,GAAG+K,UAAU;AAC7F,YAAIsN,SAAS;AACNH,eAAAA,WAAW,CAACG,OAAO;AACxB,iBAAO,CAACA,OAAO;AAAA,QACjB;AAAA,MACF;AAEA,aAAO;IACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAKMC,qBAAqBC,aAAyC;AAAA;AAC5DC,YAAAA,cAAc,MAAM,KAAKJ;AACzBhI,YAAAA,0BAAUhF;AAEToN,aAAAA,YAAY9Z,OAAO2Z,CAAW,YAAA;AAEnC,YAAIA,QAAQla,WAAW;AAAiB,iBAAA;AAGxC,cAAMuZ,YAAY,IAAItM,KAAKiN,QAAQX,SAAS;AAC5C,cAAMC,UAAU,IAAIvM,KAAKiN,QAAQV,OAAO;AACpCvH,YAAAA,MAAMsH,aAAatH,MAAMuH;AAAgB,iBAAA;AAGzCU,YAAAA,QAAQI,aAAaF,cAAcF,QAAQI;AAAkB,iBAAA;AAE1D,eAAA;AAAA,MAAA,CACR;AAAA,IACH;AAAA;AAAA;AAAA;AAAA;AAAA,EAKAC,kBAAkBL,SAAyB;AACzC,SAAKF,iBAAiBE;AAEtB,QAAIA,SAAS;AACNjY,WAAAA,KAAAA,eAAe,mBAAmBiY,OAAO;AAAA,IAAA,OACzC;AACL/a,gBAAKU,kBAAkB,iBAAiB;AAAA,IAC1C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA2a,oBAAoC;AAC9B,QAAA,CAAC,KAAKR,gBAAgB;AAEpB,UAAA;AACGA,aAAAA,iBAAiB7a,KAAAA,KAAKwC,eAAe,iBAAiB;AAAA,eACpD8Y,GAAG;AACFhb,gBAAAA,MAAM,aAAagb,CAAC;AAAA,MAC9B;AAAA,IACF;AACA,WAAO,KAAKT;AAAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKAU,kBAAkBC,WAAmBrU,SAAiB;AACpD,UAAM4T,UAAU,KAAKH,SAASjV,KAAK8V,CAAKA,MAAAA,EAAE/Y,OAAO8Y,SAAS;AAC1D,QAAIT,SAAS;AACXA,cAAQla,SAAS;AACjBka,cAAQW,UAAS,oBAAI5N,KAAK,GAAE6H,YAAY;AACxCoF,cAAQ5T,UAAUA;AAAAA,IACpB;AAEA,SAAKiU,kBAAkB,IAAI;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKAO,YAAqB;AACnB,UAAMpZ,WAAWD;AACb,QAAA,CAACC,YAAY,CAACA,SAASwB;AAAqB,aAAA;AAGhD,UAAMmW,qBAAqBzP,KAAKc,OAAO,IAAIhJ,SAASwB,gBAAgB,GAAG;AACvE,WAAOmW,sBAAsB;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA0B,wBAIE;AACA,UAAMrZ,WAAWD;AACjB,QAAI,CAACC,YAAY,CAACA,SAASwB,gBAAgBxB,SAASwB,gBAAgB,GAAG;AAC9D,aAAA;AAAA,QAAE8X,YAAY;AAAA,MAAA;AAAA,IACvB;AAEA,UAAM3B,qBAAqBzP,KAAKc,OAAO,IAAIhJ,SAASwB,gBAAgB,GAAG;AAChE,WAAA;AAAA,MACL8X,YAAY;AAAA,MACZ3B;AAAAA,MACApV,aAAa,WAAWoV,kBAAkB;AAAA,IAAA;AAAA,EAE9C;AACF;AAEa4B,MAAAA,iBAAiB,IAAInB,eAAe;AChEjD,MAAMoB,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMZC,aAAahb,QAAiD;AAAA;AAE9DA,UAAAA,OAAO8I,QAAQgD,SAAS,GAAG;AACvB,cAAA,IAAIlM,MAAM,UAAU;AAAA,MAC5B;AAEII,UAAAA,OAAO8I,QAAQgD,SAAS,KAAK;AACzB,cAAA,IAAIlM,MAAM,cAAc;AAAA,MAChC;AAEA,UAAII,OAAOib,SAAS,KAAKjb,OAAOib,SAAS,GAAG;AACpC,cAAA,IAAIrb,MAAM,YAAY;AAAA,MAC9B;AAEI,UAAA;AACF,cAAMT,WAAW,MAAMuB,KAAK,YAAYV,QAAQ;AAAA,UAC9ClB,aAAa;AAAA,UACbC,cAAc;AAAA,QAAA,CACf;AAGDC,aAAAA,KAAKkc,YAAYC,QAAQ,kBAAkBhc,SAASP,IAAI;AAExD,eAAOO,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,WAAWA,KAAK;AAC9B,cAAM,IAAIM,MAAMN,MAAMC,WAAW,QAAQ;AAAA,MAC3C;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUM6b,oBACJnM,aACAhI,OAAe,GACfC,WAAmB,IACnB+T,QAC6B;AAAA;AACzB,UAAA;AACF,cAAMjb,SAAc;AAAA,UAAEiH;AAAAA,UAAMC;AAAAA,QAAAA;AAC5B,YAAI+T,QAAQ;AACVjb,iBAAOib,SAASA;AAAAA,QAClB;AAEA,cAAM9b,WAAW,MAAMY,IAAI,eAAekP,WAAW,YAAYjP,MAAM;AACvE,eAAOb,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,cAAcA,KAAK;AAC1B,eAAA;AAAA,UACL8H,MAAM,CAAE;AAAA,UACRQ,OAAO;AAAA,UACPX;AAAAA,UACAC;AAAAA,UACAW,SAAS;AAAA,QAAA;AAAA,MAEb;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASMwT,eACJjW,QACA6B,OAAe,GACfC,WAAmB,IACU;AAAA;AACzB,UAAA;AACF,cAAM/H,WAAW,MAAMY,IAAI,UAAUqF,MAAM,YAAY;AAAA,UACrD6B;AAAAA,UACAC;AAAAA,QAAAA,CACD;AACD,eAAO/H,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,aAAaA,KAAK;AACzB,eAAA;AAAA,UACL8H,MAAM,CAAE;AAAA,UACRQ,OAAO;AAAA,UACPX;AAAAA,UACAC;AAAAA,UACAW,SAAS;AAAA,QAAA;AAAA,MAEb;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMyT,gBAAgBC,UAAgD;AAAA;AAChE,UAAA;AACF,cAAMpc,WAAW,MAAMY,IAAI,YAAYwb,QAAQ,EAAE;AACjD,eAAOpc,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,aAAaA,KAAK;AAChC,cAAM,IAAIM,MAAMN,MAAMC,WAAW,OAAO;AAAA,MAC1C;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMic,eAAevM,aAAoD;AAAA;AACnE,UAAA;AACF,cAAM9P,WAAW,MAAMY,IAAI,eAAekP,WAAW,eAAe;AACpE,eAAO9P,SAASP;AAAAA,eACTU,OAAY;AACXA,gBAAAA,MAAM,aAAaA,KAAK;AAEzB,eAAA;AAAA,UACLmc,YAAY;AAAA,UACZC,eAAe;AAAA,UACfC,iBAAiB;AAAA,YACf,KAAK;AAAA,YACL,KAAK;AAAA,YACL,KAAK;AAAA,YACL,KAAK;AAAA,YACL,KAAK;AAAA,UACP;AAAA,QAAA;AAAA,MAEJ;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMC,eAAe/G,eAAyC;AAAA;;AACxD,UAAA;AAEI1V,cAAAA,WAAW,MAAMH,KAAAA,KAAKR,QAAQ;AAAA,UAClCC,KAAK,GAAGpC,WAAWC,OAAO,YAAYuY,aAAa;AAAA,UACnDlW,QAAQ;AAAA,UACRE,QAAQ;AAAA,YACN,gBAAgB;AAAA,UAClB;AAAA,UACAtC,SAASF,WAAWE;AAAAA,QAAAA,CACrB;AAED,cAAM8C,SAASF,SAASP;AAGpBS,YAAAA,OAAOjB,SAAS,MAAM;AACxBoB,kBAAQ0G,IAAI,cAAc;AACnB,iBAAA;AAAA,QACT;AAGA,YAAI7G,OAAOjB,SAAS,OAAKiB,YAAOT,SAAPS,mBAAakc,WAAU;AAC9C/b,kBAAQ0G,IAAI,aAAa;AAClB,iBAAA;AAAA,QACT;AAGO,eAAA;AAAA,eACA5G,OAAY;AAEnBE,gBAAQC,KAAK,oBAAoB;AAC1B,eAAA;AAAA,MACT;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOMoc,uBACJC,gBACkC;AAAA;AAClC,YAAMzc,SAAkC,CAAA;AAGxC,YAAM2S,WAAW8J,eAAevb,IAAI,CAAOmB,OAAO;AAChD,cAAMqa,YAAY,MAAM,KAAKH,eAAela,EAAE;AAC9CrC,eAAOqC,EAAE,IAAIqa;AAAAA,MAAAA,EACd;AAEK3L,YAAAA,QAAQsC,WAAWV,QAAQ;AAC1B3S,aAAAA;AAAAA,IACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA0Z,aAAa;AACP,QAAA;AAEI5Y,YAAAA,OAAOnB,KAAAA,KAAKgd,mBAAAA,EAAqB7b;AACvCA,WAAK6S,QAAQ3S,CAAO,QAAA;AACdA,YAAAA,IAAIuG,WAAW,eAAe,GAAG;AACnC5H,oBAAKU,kBAAkBW,GAAG;AAAA,QAC5B;AAAA,MAAA,CACD;AAAA,aACMf,OAAO;AACNA,cAAAA,MAAM,aAAaA,KAAK;AAAA,IAClC;AAAA,EACF;AACF;AAGa2c,MAAAA,gBAAgB,IAAIlB,cAAc;;ACrR/C,MAAMmB,gBAA8CA,CAAC;AAAA,EACnDC,OAAO;AAAA,EACPC,OAAO;AACT,MAAM;AAEF,SAAA3O,qBAAA;AAAA,IAACC,KAAA;AAAA,IAAA;AAAA,MACC,WAAW,iCAAiCyO,IAAI;AAAA,MAEhD,UAAC1O,qBAAA,IAAAI,WAAA,EAAK,WAAU,eAAeuO,UAAK,MAAA;AAAA,IAAA;AAAA,EAAA;AAG1C;;;;;;;;;;;;;;;;;;;;;;;;"}