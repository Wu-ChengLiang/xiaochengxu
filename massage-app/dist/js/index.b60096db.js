var e=(e,s,t)=>new Promise((a,r)=>{var n=e=>{try{c(t.next(e))}catch(s){r(s)}},i=e=>{try{c(t.throw(e))}catch(s){r(s)}},c=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,i);c((t=t.apply(e,s)).next())});import{n as s,t,X as a,j as r,V as n,Y as i,Z as c,U as l,T as o,I as d,C as m,s as u,k as p}from"./vendors.fcaa4701.js";import{o as h,q as x,u as N}from"./common.326c60a3.js";const j=()=>{const[j,y]=s.useState(0),[g,v]=s.useState([]),[f,S]=s.useState(!0),[T,b]=s.useState(!1),[k,w]=s.useState(1),$=[{title:"\u5168\u90e8"},{title:"\u5f85\u652f\u4ed8"},{title:"\u5f85\u670d\u52a1"},{title:"\u5df2\u5b8c\u6210"}],C={0:void 0,1:"pending",2:"paid",3:"completed"};t.useDidShow(()=>{w(1),A(1)}),s.useEffect(()=>{w(1),A(1)},[j]),t.usePullDownRefresh(()=>e(void 0,null,function*(){yield A(1),a()}));const A=(...s)=>e(void 0,[...s],function*(e=k){try{S(!0);const s=C[j];let t=yield h.getOrderList(void 0,void 0,e,100);s&&(t=t.filter(e=>{const t=e.displayStatus||e.paymentStatus;return"completed"===s?"completed"===t:"paid"===s?"paid"===t:"pending"===s?"pending"===t:t===s}));const a=t.slice(0,20);v(1===e?a:e=>[...e,...a]),w(e),b(20===a.length)}catch(s){console.error("\u83b7\u53d6\u8ba2\u5355\u5931\u8d25:",s),1===e&&v([])}finally{S(!1)}}),D=e=>{y(e)},P=e=>{t.navigateTo({url:`/pages/order/detail/index?orderNo=${e}`})},q=(e,s)=>{e.stopPropagation(),t.navigateTo({url:`/pages/booking/confirm/index?orderNo=${s.orderNo}`})},F=(s,t)=>e(void 0,null,function*(){s.stopPropagation(),u({title:"\u53d6\u6d88\u8ba2\u5355",content:"\u786e\u5b9a\u8981\u53d6\u6d88\u8be5\u8ba2\u5355\u5417\uff1f",success:s=>e(void 0,null,function*(){if(s.confirm)try{const e=yield h.cancelOrder(t.orderNo);"pending"===t.paymentStatus?p({title:"\u53d6\u6d88\u8ba2\u5355",icon:"success"}):"paid"===t.paymentStatus&&e.refundAmount&&e.refundAmount>0?(p({title:"\u53d6\u6d88\u8ba2\u5355",icon:"success"}),setTimeout(()=>{p({title:`\u9000\u6b3e\uffe5${(e.refundAmount/100).toFixed(2)}`,icon:"success",duration:2500})},500)):p({title:"\u53d6\u6d88\u8ba2\u5355",icon:"success"}),A(1)}catch(e){p({title:e.message||"\u53d6\u6d88\u5931\u8d25",icon:"none"})}})})}),L=(e,s)=>{e.stopPropagation(),t.switchTab({url:"/pages/appointment/index"})},M=e=>{const s=e.displayStatus||e.paymentStatus,t={pending:"\u5f85\u652f\u4ed8",paid:"\u5f85\u670d\u52a1",serving:"\u670d\u52a1\u4e2d",completed:"\u5df2\u5b8c\u6210",cancelled:"\u5df2\u53d6\u6d88",refunded:"\u5df2\u9000\u6b3e"};return t[s]||s},O=e=>{const s=e.displayStatus||e.paymentStatus,t={pending:"status-pending",paid:"status-paid",serving:"status-serving",completed:"status-completed",cancelled:"status-cancelled",refunded:"status-refunded"};return t[s]||""},Y=e=>{const s=N(e);if(!s)return"";const t=s.getMonth()+1,a=s.getDate(),r=s.getHours(),n=s.getMinutes();return`${t}\u6708${a}\u65e5 ${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},z=e=>{var s;return r.jsxs(n,{className:"order-item",onClick:()=>P(e.orderNo),children:[r.jsxs(n,{className:"order-header",children:["service"===e.orderType&&r.jsx(o,{className:"store-name",children:e.storeName}),"product"===e.orderType&&r.jsx(o,{className:"store-name",children:e.title}),r.jsx(o,{className:`order-status ${O(e)}`,children:M(e)})]}),r.jsxs(n,{className:"order-content",children:["service"===e.orderType&&e.therapistAvatar&&r.jsx(d,{className:"therapist-avatar",src:e.therapistAvatar}),r.jsxs(n,{className:"order-info "+(e.therapistAvatar||"service"!==e.orderType?"":"no-image"),children:["service"===e.orderType&&r.jsxs(r.Fragment,{children:[r.jsxs(n,{className:"info-row",children:[r.jsx(o,{className:"therapist-name",children:e.therapistName}),r.jsx(o,{className:"service-name",children:e.serviceName})]}),r.jsx(n,{className:"info-row",children:r.jsxs(o,{className:"appointment-time",children:["\u9884\u7ea6\u65f6\u95f4\uff1a",Y(`${e.appointmentDate} ${e.startTime}`),"  "]})})]}),"product"===e.orderType&&r.jsxs(r.Fragment,{children:[r.jsxs(n,{className:"info-row",children:[r.jsx(o,{className:"service-name",children:e.title}),(null==(s=e.extraData)?void 0:s.quantity)&&r.jsxs(o,{className:"quantity",children:["\xd7",e.extraData.quantity]})]}),r.jsx(n,{className:"info-row",children:r.jsxs(o,{className:"appointment-time",children:["\u8d2d\u4e70\u65f6\u95f4\uff1a",Y(e.createdAt)]})})]}),r.jsx(n,{className:"info-row",children:r.jsxs(o,{className:"order-no",children:["\u8ba2\u5355\u53f7\uff1a",e.orderNo]})})]})]}),r.jsxs(n,{className:"order-footer",children:[r.jsxs(n,{className:"price-info",children:[r.jsx(o,{className:"label",children:"\u5b9e\u4ed8\uff1a"}),r.jsx(o,{className:"price",children:x(e.amount)}),"  "]}),r.jsxs(n,{className:"action-buttons",children:["pending"===(e.displayStatus||e.paymentStatus)&&r.jsxs(r.Fragment,{children:[r.jsx(n,{className:"button cancel",onClick:s=>F(s,e),children:"\u53d6\u6d88\u8ba2\u5355"}),r.jsx(n,{className:"button pay",onClick:s=>q(s,e),children:"\u53bb\u652f\u4ed8"})]}),"paid"===(e.displayStatus||e.paymentStatus)&&"service"===e.orderType&&r.jsx(n,{className:"button cancel",onClick:s=>F(s,e),children:"\u53d6\u6d88\u8ba2\u5355"}),"serving"===(e.displayStatus||e.paymentStatus)&&null,"completed"===e.displayStatus&&"service"===e.orderType&&r.jsx(n,{className:"button rebook",onClick:e=>L(e),children:"\u518d\u6b21\u9884\u7ea6"}),["cancelled","refunded"].includes(e.displayStatus||e.paymentStatus)&&"service"===e.orderType&&r.jsx(n,{className:"button rebook",onClick:e=>L(e),children:"\u518d\u6b21\u9884\u7ea6"})]})]})]},e.orderNo)},E=()=>r.jsxs(n,{className:"empty-state",children:[r.jsx(m,{value:"file-generic",size:"60",color:"#ccc"}),r.jsx(o,{className:"empty-text",children:"\u6682\u65e0\u8ba2\u5355"})]}),H=()=>r.jsx(n,{className:"loading-state",children:r.jsx(o,{children:"\u52a0\u8f7d\u4e2d..."})});return r.jsx(n,{className:"order-list-page",children:r.jsx(i,{current:j,tabList:$,onClick:D,className:"order-tabs",children:$.map((e,s)=>r.jsx(c,{current:j,index:s,children:r.jsx(l,{scrollY:!0,className:"order-list",children:f?H():g.length>0?g.map(z):E()})},s))})})};export{j as default};
