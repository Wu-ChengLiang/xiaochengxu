var e=(e,s,a)=>new Promise((t,c)=>{var n=e=>{try{l(a.next(e))}catch(s){c(s)}},r=e=>{try{l(a.throw(e))}catch(s){c(s)}},l=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,r);l((a=a.apply(e,s)).next())});import{n as s,H as a,t,k as c,j as n,V as r,T as l,C as i,U as o}from"./vendors.fcaa4701.js";import{w as d}from"./common.326c60a3.js";const m=()=>{const[m,u]=s.useState(0),[h,x]=s.useState([]),[j,N]=s.useState(!1),[g,f]=s.useState(1),[p,y]=s.useState(!0),v=a.useRef(!1);s.useEffect(()=>{v.current||(v.current=!0,S(),w())},[]),t.useReachBottom(()=>{p&&!j&&w(g+1)});const S=()=>e(void 0,null,function*(){const e=yield d.getBalance();u(e/100)}),w=(s=1)=>e(void 0,null,function*(){if(!j){N(!0);try{const e=yield d.getTransactions(s,20);x(1===s?e:s=>[...s,...e]),f(s),y(20===e.length)}catch(e){c({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{N(!1)}}}),b=()=>{t.navigateTo({url:"/pages/mine/recharge/index"})},$=e=>{const s=new Date(e),a=s.getMonth()+1,t=s.getDate(),c=s.getHours(),n=s.getMinutes(),r=new Date,l=s.toDateString()===r.toDateString(),i=l?"\u4eca\u5929":`${a}\u6708${t}\u65e5`,o=`${c.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`;return`${i} ${o}`},D=e=>{switch(e){case"recharge":return"add-circle";case"consume":return"subtract-circle";case"refund":return"reload";default:return"money"}},F=e=>{switch(e){case"recharge":case"refund":return"#52c41a";case"consume":return"#333";default:return"#999"}},z=e=>{const s=e/100;return s>0?`+${s.toFixed(2)}`:s.toFixed(2)};return n.jsxs(r,{className:"balance-page",children:[n.jsx(r,{className:"balance-card",children:n.jsxs(r,{className:"card-content",children:[n.jsx(l,{className:"label",children:"\u5f53\u524d\u4f59\u989d"}),n.jsxs(r,{className:"amount-wrapper",children:[n.jsx(l,{className:"currency",children:"\xa5"}),n.jsx(l,{className:"amount",children:m.toFixed(2)})]}),n.jsxs(r,{className:"action-btn",onClick:b,children:[n.jsx(i,{value:"add",size:"16",color:"#fff"}),n.jsx(l,{children:"\u5145\u503c"})]})]})}),n.jsxs(r,{className:"transaction-section",children:[n.jsx(l,{className:"section-title",children:"\u4ea4\u6613\u8bb0\u5f55"}),0===h.length?n.jsxs(r,{className:"empty",children:[n.jsx(i,{value:"file-generic",size:"48",color:"#ccc"}),n.jsx(l,{className:"empty-text",children:"\u6682\u65e0\u4ea4\u6613\u8bb0\u5f55"})]}):n.jsxs(o,{className:"transaction-list",scrollY:!0,children:[h.map(e=>n.jsxs(r,{className:"transaction-item",children:[n.jsxs(r,{className:"left",children:[n.jsx(i,{value:D(e.type),size:"32",color:F(e.type)}),n.jsxs(r,{className:"info",children:[n.jsx(l,{className:"description",children:e.description}),n.jsx(l,{className:"time",children:$(e.createdAt)})]})]}),n.jsxs(r,{className:"right",children:[n.jsx(l,{className:"amount "+(e.amount>0?"income":"expense"),children:z(e.amount)}),n.jsxs(l,{className:"balance",children:["\u4f59\u989d: ",(e.balance/100).toFixed(2)]})]})]},e.id)),j&&n.jsx(r,{className:"loading",children:n.jsx(l,{children:"\u52a0\u8f7d\u4e2d..."})}),!p&&h.length>0&&n.jsx(r,{className:"no-more",children:n.jsx(l,{children:"\u6ca1\u6709\u66f4\u591a\u4e86"})})]})]})]})};export{m as default};
