var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,c=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,o=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&c(e,s,t[s]);if(a)for(var s of a(t))r.call(t,s)&&c(e,s,t[s]);return e},i=(e,a)=>t(e,s(a)),l=(e,t,s)=>new Promise((a,n)=>{var r=e=>{try{o(s.next(e))}catch(t){n(t)}},c=e=>{try{o(s.throw(e))}catch(t){n(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,c);o((s=s.apply(e,t)).next())});import{a as d,w as m,L as p,q as u,j as h,V as j,F as x,G as N,D as f,T as g,I as y,A as v,K as b,o as P}from"./vendors.b1a33877.js";import{o as w}from"./common.d37aa707.js";const O=()=>{const[e,t]=d.useState(0),[s,a]=d.useState([]),[n,r]=d.useState(!0),c=[{title:"\u5168\u90e8"},{title:"\u5f85\u652f\u4ed8"},{title:"\u5f85\u670d\u52a1"},{title:"\u5df2\u5b8c\u6210"}],O={0:void 0,1:"pending_payment",2:"paid",3:"completed"};m.useDidShow(()=>{S()}),d.useEffect(()=>{S()},[e]),m.usePullDownRefresh(()=>l(void 0,null,function*(){yield S(),p()}));const S=()=>l(void 0,null,function*(){try{r(!0);const t=O[e],s=yield w.getOrderList(t);a(s)}catch(t){u({title:"\u83b7\u53d6\u8ba2\u5355\u5931\u8d25",icon:"none"})}finally{r(!1)}}),$=e=>{t(e)},k=e=>{m.navigateTo({url:`/pages/order/detail/index?orderNo=${e}`})},D=(e,t)=>l(void 0,null,function*(){e.stopPropagation();try{const e=yield w.getPaymentParams(t.orderNo);b(i(o({},e),{success:()=>l(void 0,null,function*(){yield w.updateOrderStatus(t.orderNo,"paid"),u({title:"\u652f\u4ed8\u6210\u529f",icon:"success"}),S()}),fail:e=>{"requestPayment:fail cancel"!==e.errMsg&&u({title:"\u652f\u4ed8\u5931\u8d25",icon:"none"})}}))}catch(s){u({title:"\u83b7\u53d6\u652f\u4ed8\u53c2\u6570\u5931\u8d25",icon:"none"})}}),C=(e,t)=>l(void 0,null,function*(){e.stopPropagation(),P({title:"\u53d6\u6d88\u8ba2\u5355",content:"\u786e\u5b9a\u8981\u53d6\u6d88\u8be5\u8ba2\u5355\u5417\uff1f",success:e=>l(void 0,null,function*(){if(e.confirm)try{yield w.cancelOrder(t.orderNo),u({title:"\u8ba2\u5355\u5df2\u53d6\u6d88",icon:"success"}),S()}catch(s){u({title:"\u53d6\u6d88\u5931\u8d25",icon:"none"})}})})}),I=(e,t)=>{e.stopPropagation(),m.navigateTo({url:`/pages/appointment/therapist/index?therapistId=${t.therapistId}&storeId=${t.storeId}`})},T=e=>{const t={pending_payment:"\u5f85\u652f\u4ed8",paid:"\u5f85\u670d\u52a1",serving:"\u670d\u52a1\u4e2d",completed:"\u5df2\u5b8c\u6210",cancelled:"\u5df2\u53d6\u6d88",refunded:"\u5df2\u9000\u6b3e"};return t[e]||e},_=e=>{const t={pending_payment:"status-pending",paid:"status-paid",serving:"status-serving",completed:"status-completed",cancelled:"status-cancelled",refunded:"status-refunded"};return t[e]||""},A=e=>{const t=new Date(e),s=t.getMonth()+1,a=t.getDate(),n=t.getHours(),r=t.getMinutes();return`${s}\u6708${a}\u65e5 ${n.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},L=e=>h.jsxs(j,{className:"order-item",onClick:()=>k(e.orderNo),children:[h.jsxs(j,{className:"order-header",children:[h.jsx(g,{className:"store-name",children:e.storeName}),h.jsx(g,{className:`order-status ${_(e.status)}`,children:T(e.status)})]}),h.jsxs(j,{className:"order-content",children:[h.jsx(y,{className:"therapist-avatar",src:e.therapistAvatar||"https://img.yzcdn.cn/vant/cat.jpeg"}),h.jsxs(j,{className:"order-info",children:[h.jsxs(j,{className:"info-row",children:[h.jsx(g,{className:"therapist-name",children:e.therapistName}),h.jsx(g,{className:"service-name",children:e.serviceName})]}),h.jsx(j,{className:"info-row",children:h.jsxs(g,{className:"appointment-time",children:["\u9884\u7ea6\u65f6\u95f4\uff1a",A(`${e.appointmentDate} ${e.appointmentTime}`)]})}),h.jsx(j,{className:"info-row",children:h.jsxs(g,{className:"order-no",children:["\u8ba2\u5355\u53f7\uff1a",e.orderNo]})})]})]}),h.jsxs(j,{className:"order-footer",children:[h.jsxs(j,{className:"price-info",children:[h.jsx(g,{className:"label",children:"\u5b9e\u4ed8\uff1a"}),h.jsxs(g,{className:"price",children:["\xa5",e.totalAmount]})]}),h.jsxs(j,{className:"action-buttons",children:["pending_payment"===e.status&&h.jsxs(h.Fragment,{children:[h.jsx(j,{className:"button cancel",onClick:t=>C(t,e),children:"\u53d6\u6d88\u8ba2\u5355"}),h.jsx(j,{className:"button pay",onClick:t=>D(t,e),children:"\u53bb\u652f\u4ed8"})]}),"paid"===e.status&&h.jsx(j,{className:"button cancel",onClick:t=>C(t,e),children:"\u53d6\u6d88\u8ba2\u5355"}),("completed"===e.status||"cancelled"===e.status)&&h.jsx(j,{className:"button rebook",onClick:t=>I(t,e),children:"\u518d\u6b21\u9884\u7ea6"})]})]})]},e.orderNo),M=()=>h.jsxs(j,{className:"empty-state",children:[h.jsx(v,{value:"file-generic",size:"60",color:"#ccc"}),h.jsx(g,{className:"empty-text",children:"\u6682\u65e0\u8ba2\u5355"})]}),q=()=>h.jsx(j,{className:"loading-state",children:h.jsx(g,{children:"\u52a0\u8f7d\u4e2d..."})});return h.jsx(j,{className:"order-list-page",children:h.jsx(x,{current:e,tabList:c,onClick:$,className:"order-tabs",children:c.map((t,a)=>h.jsx(N,{current:e,index:a,children:h.jsx(f,{scrollY:!0,className:"order-list",children:n?q():s.length>0?s.map(L):M()})},a))})})};export{O as default};
