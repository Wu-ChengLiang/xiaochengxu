var e=(e,s,c)=>new Promise((a,t)=>{var n=e=>{try{r(c.next(e))}catch(s){t(s)}},l=e=>{try{r(c.throw(e))}catch(s){t(s)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,l);r((c=c.apply(e,s)).next())});import{n as s,k as c,j as a,V as t,Y as n,Z as l,U as r,T as i,C as d,t as o}from"./vendors.fcaa4701.js";import{v as u}from"./common.326c60a3.js";const h=()=>{const[h,m]=s.useState(0),[x,j]=s.useState([]),[N,v]=s.useState(!0),p=[{title:"\u53ef\u7528\u5238"},{title:"\u5df2\u4f7f\u7528"},{title:"\u5df2\u8fc7\u671f"}];s.useEffect(()=>{g()},[]);const g=()=>e(void 0,null,function*(){v(!0);try{const e=yield u.getMyVouchers();j(e)}catch(e){console.error("\u52a0\u8f7d\u793c\u5238\u5931\u8d25:",e),c({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{v(!1)}}),y=e=>{const s=new Date;return x.filter(c=>{if("expired"===e){const e=new Date(c.validTo);return e<s&&"used"!==c.status}return c.status===e})},f=e=>{const s=new Date(e),c=s.getFullYear(),a=s.getMonth()+1,t=s.getDate();return`${c}.${a.toString().padStart(2,"0")}.${t.toString().padStart(2,"0")}`},w=e=>{const s=new Date(e.validTo)<new Date,c="used"===e.status;return a.jsxs(t,{className:`voucher-card ${c?"used":""} ${s?"expired":""}`,children:[a.jsxs(t,{className:"voucher-left",children:[a.jsxs(t,{className:"discount-value",children:["discount"===e.type&&e.discountPercentage&&a.jsxs(a.Fragment,{children:[a.jsx(i,{className:"discount-number",children:e.discountPercentage}),a.jsx(i,{className:"discount-unit",children:"%"})]}),"cash"===e.type&&e.cashValue&&a.jsxs(a.Fragment,{children:[a.jsx(i,{className:"discount-unit",children:"\xa5"}),a.jsx(i,{className:"discount-number",children:(e.cashValue/100).toFixed(0)})]})]}),a.jsx(i,{className:"discount-type",children:"\u4f18\u60e0\u5238"})]}),a.jsxs(t,{className:"voucher-right",children:[a.jsxs(t,{className:"voucher-info",children:[a.jsx(i,{className:"voucher-name",children:e.name}),a.jsx(i,{className:"voucher-desc",children:e.description}),e.minAmount&&e.minAmount>0&&a.jsxs(i,{className:"voucher-condition",children:["\u6ee1",(e.minAmount/100).toFixed(0),"\u5143\u53ef\u7528"]}),a.jsxs(i,{className:"voucher-validity",children:["\u6709\u6548\u671f\u81f3 ",f(e.validTo)]})]}),a.jsxs(t,{className:"voucher-status",children:[c&&a.jsxs(t,{className:"status-tag used",children:[a.jsx(d,{value:"check-circle",size:"14"}),a.jsx(i,{children:"\u5df2\u4f7f\u7528"})]}),s&&!c&&a.jsxs(t,{className:"status-tag expired",children:[a.jsx(d,{value:"clock",size:"14"}),a.jsx(i,{children:"\u5df2\u8fc7\u671f"})]}),!c&&!s&&a.jsx(t,{className:"use-btn",onClick:()=>{o.navigateTo({url:"/pages/appointment/index"})},children:"\u7acb\u5373\u4f7f\u7528"})]})]})]},e.id)},S=e=>a.jsxs(t,{className:"empty-state",children:[a.jsx(d,{value:"tag",size:"60",color:"#ccc"}),a.jsxs(i,{className:"empty-text",children:["\u6682\u65e0",e]}),"\u53ef\u7528\u5238"===e&&a.jsx(t,{className:"go-shop-btn",onClick:()=>{o.switchTab({url:"/pages/appointment/index"})},children:"\u53bb\u9884\u7ea6\u670d\u52a1"})]});if(N)return a.jsx(t,{className:"vouchers-page",children:a.jsx(t,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})});const b=y("unused"),k=y("used"),D=y("expired");return a.jsxs(t,{className:"vouchers-page",children:[a.jsxs(n,{current:h,tabList:p,onClick:m,children:[a.jsx(l,{current:h,index:0,children:a.jsx(r,{scrollY:!0,className:"voucher-list",children:b.length>0?b.map(w):S("\u53ef\u7528\u5238")})}),a.jsx(l,{current:h,index:1,children:a.jsx(r,{scrollY:!0,className:"voucher-list",children:k.length>0?k.map(w):S("\u5df2\u4f7f\u7528\u7684\u5238")})}),a.jsx(l,{current:h,index:2,children:a.jsx(r,{scrollY:!0,className:"voucher-list",children:D.length>0?D.map(w):S("\u5df2\u8fc7\u671f\u7684\u5238")})})]}),a.jsxs(t,{className:"rules-section",children:[a.jsx(t,{className:"rules-title",children:"\u4f7f\u7528\u89c4\u5219"}),a.jsxs(t,{className:"rules-content",children:[a.jsx(t,{className:"rule-item",children:"1. \u4f18\u60e0\u5238\u5728\u6709\u6548\u671f\u5185\u53ef\u7528\u4e8e\u9884\u7ea6\u670d\u52a1"}),a.jsx(t,{className:"rule-item",children:"2. \u6bcf\u6b21\u9884\u7ea6\u4ec5\u53ef\u4f7f\u7528\u4e00\u5f20\u4f18\u60e0\u5238"}),a.jsx(t,{className:"rule-item",children:"3. \u4f18\u60e0\u5238\u4e0d\u53ef\u5151\u73b0\u3001\u4e0d\u53ef\u8f6c\u8ba9"}),a.jsx(t,{className:"rule-item",children:"4. \u6700\u7ec8\u89e3\u91ca\u6743\u5f52\u540d\u533b\u5802\u6240\u6709"})]})]})]})};export{h as default};
