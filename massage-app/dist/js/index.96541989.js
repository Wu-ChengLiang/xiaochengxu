var e=(e,s,a)=>new Promise((t,c)=>{var r=e=>{try{i(a.next(e))}catch(s){c(s)}},n=e=>{try{i(a.throw(e))}catch(s){c(s)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);i((a=a.apply(e,s)).next())});import{w as s,a,q as t,j as c,V as r,A as n,T as i,M as l,I as d,B as o,o as m,C as h}from"./vendors.b1a33877.js";import{o as u}from"./common.d37aa707.js";const p=()=>{const p=s.useRouter(),{orderNo:x}=p.params,[j,N]=a.useState(null),[g,v]=a.useState(!0);a.useEffect(()=>{f()},[x]);const f=()=>e(void 0,null,function*(){if(!x)return t({title:"\u8ba2\u5355\u53f7\u7f3a\u5931",icon:"none"}),void setTimeout(()=>{s.navigateBack()},1500);try{const e=yield u.getOrderDetail(x);N(e),v(!1)}catch(e){v(!1),t({title:"\u83b7\u53d6\u8ba2\u5355\u5931\u8d25",icon:"none"})}}),y=()=>{o({phoneNumber:"4008888888"})},b=()=>e(void 0,null,function*(){m({title:"\u53d6\u6d88\u8ba2\u5355",content:"\u786e\u5b9a\u8981\u53d6\u6d88\u8be5\u8ba2\u5355\u5417\uff1f",success:s=>e(void 0,null,function*(){if(s.confirm)try{yield u.cancelOrder(x),t({title:"\u8ba2\u5355\u5df2\u53d6\u6d88",icon:"success"}),setTimeout(()=>{f()},1500)}catch(e){t({title:"\u53d6\u6d88\u5931\u8d25",icon:"none"})}})})}),k=()=>{j&&s.navigateTo({url:`/pages/appointment/therapist/index?therapistId=${j.therapistId}&storeId=${j.storeId}`})},S=()=>{j&&h({latitude:31.189,longitude:121.43,name:j.storeName,address:j.storeAddress})},q=e=>`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${e}`,A=e=>{const s={pending_payment:"\u5f85\u652f\u4ed8",paid:"\u5f85\u670d\u52a1",serving:"\u670d\u52a1\u4e2d",completed:"\u5df2\u5b8c\u6210",cancelled:"\u5df2\u53d6\u6d88",refunded:"\u5df2\u9000\u6b3e"};return s[e]||e},$=e=>{const s=["\u4e0b\u5355","\u652f\u4ed8","\u5230\u5e97\u670d\u52a1","\u5b8c\u6210"];let a=0;switch(e){case"pending_payment":a=0;break;case"paid":a=1;break;case"serving":a=2;break;case"completed":a=3;break;case"cancelled":case"refunded":return{steps:["\u5df2\u53d6\u6d88"],current:0}}return{steps:s,current:a}},w=e=>{const s=new Date(e),a=s.getFullYear(),t=s.getMonth()+1,c=s.getDate(),r=s.getHours(),n=s.getMinutes();return`${a}-${t.toString().padStart(2,"0")}-${c.toString().padStart(2,"0")} ${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`};if(g)return c.jsx(r,{className:"order-detail-page",children:c.jsx(r,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})});if(!j)return c.jsx(r,{className:"order-detail-page",children:c.jsx(r,{className:"empty",children:"\u8ba2\u5355\u4e0d\u5b58\u5728"})});const{steps:z,current:C}=$(j.status);return c.jsxs(r,{className:"order-detail-page",children:[c.jsxs(r,{className:"status-section",children:[c.jsxs(r,{className:"status-header",children:[c.jsx(n,{value:"paid"===j.status?"check-circle":"clock",size:"40",color:"#fff"}),c.jsx(i,{className:"status-text",children:A(j.status)})]}),"cancelled"!==j.status&&"refunded"!==j.status&&c.jsx(r,{className:"steps-container",children:c.jsx(l,{items:z.map(e=>({title:e})),current:C,className:"order-steps"})})]}),"paid"===j.status&&c.jsxs(r,{className:"qrcode-section",children:[c.jsx(i,{className:"section-title",children:"\u5230\u5e97\u6838\u9500\u7801"}),c.jsxs(r,{className:"qrcode-card",children:[c.jsx(d,{className:"qrcode-image",src:q(j.orderNo),mode:"aspectFit"}),c.jsx(i,{className:"qrcode-no",children:j.orderNo}),c.jsx(i,{className:"qrcode-tip",children:"\u8bf7\u5411\u95e8\u5e97\u5de5\u4f5c\u4eba\u5458\u51fa\u793a\u6b64\u4e8c\u7ef4\u7801"})]})]}),c.jsxs(r,{className:"info-section",children:[c.jsx(i,{className:"section-title",children:"\u8ba2\u5355\u4fe1\u606f"}),c.jsxs(r,{className:"info-card",children:[c.jsxs(r,{className:"info-item",children:[c.jsx(i,{className:"label",children:"\u8ba2\u5355\u7f16\u53f7"}),c.jsx(i,{className:"value",children:j.orderNo})]}),c.jsxs(r,{className:"info-item",children:[c.jsx(i,{className:"label",children:"\u4e0b\u5355\u65f6\u95f4"}),c.jsx(i,{className:"value",children:w(j.createdAt)})]}),j.paidAt&&c.jsxs(r,{className:"info-item",children:[c.jsx(i,{className:"label",children:"\u652f\u4ed8\u65f6\u95f4"}),c.jsx(i,{className:"value",children:w(j.paidAt)})]}),c.jsxs(r,{className:"info-item",children:[c.jsx(i,{className:"label",children:"\u9884\u7ea6\u65f6\u95f4"}),c.jsxs(i,{className:"value highlight",children:[j.appointmentDate," ",j.appointmentTime]})]})]})]}),c.jsxs(r,{className:"store-section",children:[c.jsx(i,{className:"section-title",children:"\u95e8\u5e97\u4fe1\u606f"}),c.jsxs(r,{className:"store-card",onClick:S,children:[c.jsxs(r,{className:"store-info",children:[c.jsx(i,{className:"store-name",children:j.storeName}),c.jsx(i,{className:"store-address",children:j.storeAddress})]}),c.jsx(n,{value:"map-pin",size:"20",color:"#a40035"})]})]}),c.jsxs(r,{className:"therapist-section",children:[c.jsx(i,{className:"section-title",children:"\u63a8\u62ff\u5e08\u4fe1\u606f"}),c.jsxs(r,{className:"therapist-card",children:[c.jsx(d,{className:"therapist-avatar",src:j.therapistAvatar||"https://img.yzcdn.cn/vant/cat.jpeg"}),c.jsxs(r,{className:"therapist-info",children:[c.jsx(i,{className:"therapist-name",children:j.therapistName}),c.jsx(i,{className:"service-name",children:j.serviceName}),c.jsxs(i,{className:"service-duration",children:["\u670d\u52a1\u65f6\u957f\uff1a",j.duration,"\u5206\u949f"]})]}),c.jsxs(i,{className:"price",children:["\xa5",j.totalAmount]})]})]}),c.jsxs(r,{className:"action-section",children:["paid"===j.status&&c.jsxs(c.Fragment,{children:[c.jsxs(r,{className:"button secondary",onClick:y,children:[c.jsx(n,{value:"phone",size:"18"}),c.jsx(i,{children:"\u8054\u7cfb\u95e8\u5e97"})]}),c.jsx(r,{className:"button danger",onClick:b,children:"\u53d6\u6d88\u8ba2\u5355"})]}),("completed"===j.status||"cancelled"===j.status)&&c.jsx(r,{className:"button primary",onClick:k,children:"\u518d\u6b21\u9884\u7ea6"})]})]})};export{p as default};
