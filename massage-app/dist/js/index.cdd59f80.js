var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,i=(e,s)=>{for(var t in s||(s={}))n.call(s,t)&&r(e,t,s[t]);if(a)for(var t of a(s))l.call(s,t)&&r(e,t,s[t]);return e},c=(e,a)=>s(e,t(a)),o=(e,s,t)=>new Promise((a,n)=>{var l=e=>{try{i(t.next(e))}catch(s){n(s)}},r=e=>{try{i(t.throw(e))}catch(s){n(s)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,r);i((t=t.apply(e,s)).next())});import{n as d,L as u,j as m,V as h,P as p,M as j,T as x,t as f,k as N,I as g,N as b,O as y,Q as v}from"./vendors.fcaa4701.js";import{e as k,s as w,g as S,n as $}from"./common.326c60a3.js";const O=({onTimeChange:e,defaultValue:s})=>{const[t,a]=d.useState([]),[n,l]=d.useState([]),[r,i]=d.useState([]),[c,o]=d.useState(()=>{const e=new Date,s=e.getHours(),t=s+1;let a=0;return t>=9&&t<=21?a=t-9:t>21&&(a=0),[2,a,0]});d.useEffect(()=>{f()},[]),d.useEffect(()=>{if(t.length>0&&n.length>0&&r.length>0){const s=t[c[0]],a=n[c[1]],l=r[c[2]];e(s.fullDate,a,l)}},[c,t,n,r]);const f=()=>{const e=[],t=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"];for(let s=-2;s<=2;s++){const a=u().add(s,"day"),n=0===s;e.push({date:n?"\u4eca\u5929":`${a.month()+1}\u6708${a.date()}\u65e5`,weekday:n?"":t[a.day()],fullDate:a.format("YYYY-MM-DD"),dateObj:a.toDate()})}a(e);const n=[];for(let s=9;s<=21;s++)n.push(`${s}\u70b9`);l(n);const r=[];for(let s=0;s<60;s+=10)r.push(`${s.toString().padStart(2,"0")}\u5206`);i(r);const c=u(),d=c.hour(),m=d+1;let h=2,p=1,j=0;m>=9&&m<=21?p=m-9:m>21?(h=3,p=0):p=0;const x=s?[s.date,s.hour,s.minute]:[h,p,j];o(x)},N=e=>{const{value:s}=e.detail;o(s)};return m.jsx(h,{className:"time-picker-scroller",children:m.jsxs(p,{indicatorStyle:"height: 50px; background-color: rgba(0,0,0,0.05);",style:{width:"100%",height:"200px"},value:c,onChange:N,children:[m.jsx(j,{children:t.map((e,s)=>m.jsxs(h,{className:"picker-item date-item",children:[m.jsx(x,{className:"date-text "+("\u4eca\u5929"===e.date?"today":""),children:e.date}),e.weekday&&m.jsx(x,{className:"weekday-text",children:e.weekday})]},s))}),m.jsx(j,{children:n.map((e,s)=>m.jsx(h,{className:"picker-item hour-item",children:m.jsx(x,{className:"hour-text",children:e})},s))}),m.jsx(j,{children:r.map((e,s)=>m.jsx(h,{className:"picker-item minute-item",children:m.jsx(x,{className:"minute-text",children:e})},s))})]})})},D=()=>{var e;const s=f.useRouter(),{id:t}=s.params,[a,n]=d.useState(null),[l,r]=d.useState(k()),[u,p]=d.useState("10\u70b9"),[j,D]=d.useState("00\u5206"),[P,C]=d.useState(!0);d.useEffect(()=>{T()},[t]);const T=()=>o(void 0,null,function*(){try{const[e,s]=yield Promise.all([w.getStoreDetail(t),S.getCurrentLocation()]),a=e.data;let l=i({},a);if((null==a?void 0:a.latitude)&&(null==a?void 0:a.longitude)){const e=S.calculateDistance(s.latitude,s.longitude,a.latitude,a.longitude);l=c(i({},a),{distance:e})}n(l)}catch(e){N({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{C(!1)}}),E=(e,s,t)=>{r(e),p(s),D(t)},I=()=>{(null==a?void 0:a.phone)&&y({phoneNumber:a.phone})},Y=()=>{(null==a?void 0:a.latitude)&&(null==a?void 0:a.longitude)&&v({latitude:a.latitude,longitude:a.longitude,name:a.name,address:a.address})},M=()=>{if(!u||!j)return void N({title:"\u8bf7\u9009\u62e9\u9884\u7ea6\u65f6\u95f4",icon:"none"});const e=`${u.replace("\u70b9","")}:${j.replace("\u5206","")}`,s={storeId:t,storeName:(null==a?void 0:a.name)||"",selectedDate:l,selectedTime:e,from:"store"};f.navigateTo({url:`/pages/appointment/symptom/index?${Object.entries(s).map(([e,s])=>`${e}=${encodeURIComponent(s)}`).join("&")}`})},H=()=>{if(!l||!u||!j)return"\u8bf7\u9009\u62e9\u65f6\u95f4";const e=l===k()?"\u4eca\u5929":l,s=u.replace("\u70b9",""),t=j.replace("\u5206","");return`${e} ${s}:${t}`};return a?m.jsxs(h,{className:"store-appointment-page",children:[m.jsx(h,{className:"store-header",children:m.jsx(g,{className:"store-image",src:$((null==(e=a.images)?void 0:e[0])||a.image),mode:"aspectFill"})}),m.jsx(h,{className:"store-info",children:m.jsxs(h,{className:"info-header",children:[m.jsxs(h,{className:"store-details",children:[m.jsxs(h,{className:"name-row",children:[m.jsx(x,{className:"store-name",children:a.name}),void 0!==a.distance&&null!==a.distance&&m.jsxs(x,{className:"distance",children:[a.distance,"km"]})]}),m.jsxs(h,{className:"hours-row",children:[m.jsx(x,{className:"business-hours",children:a.businessHours}),m.jsxs(h,{className:`status ${a.status}`,children:["normal"===a.status&&"\u5c31\u8fd1","busy"===a.status&&"\u7e41\u5fd9","full"===a.status&&"\u7206\u6ee1"]})]}),m.jsx(x,{className:"address",children:a.address})]}),m.jsxs(h,{className:"action-buttons",children:[m.jsx(h,{className:"action-btn",onClick:I,children:"\ud83d\udcde"}),m.jsx(h,{className:"action-btn",onClick:Y,children:"\ud83d\udccd"})]})]})}),m.jsxs(h,{className:"appointment-section",children:[m.jsx(x,{className:"section-title",children:"\u9884\u7ea6\u65f6\u95f4"}),m.jsx(O,{onTimeChange:E})]}),m.jsxs(h,{className:"bottom-bar",children:[m.jsxs(x,{className:"selected-time",children:["\u9884\u7ea6\u65f6\u95f4: ",H()]}),m.jsx(b,{className:"submit-btn",type:"primary",onClick:M,disabled:!u||!j,children:"\u9009\u75c7\u72b6"})]})]}):null};export{D as default};
