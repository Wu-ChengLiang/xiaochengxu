var e=(e,s,a)=>new Promise((c,l)=>{var n=e=>{try{o(a.next(e))}catch(s){l(s)}},t=e=>{try{o(a.throw(e))}catch(s){l(s)}},o=e=>e.done?c(e.value):Promise.resolve(e.value).then(n,t);o((a=a.apply(e,s)).next())});import{t as s,n as a,j as c,V as l,T as n,I as t,C as o,E as i,k as r,h as m,s as d}from"./vendors.fcaa4701.js";import{w as h,k as x}from"./common.326c60a3.js";const u=()=>{const u=s.useRouter(),{orderNo:j,amount:N,quantity:y}=u.params,[f,p]=a.useState("wechat"),[b,v]=a.useState(0),[g,w]=a.useState(!1),k=Number(N)*Number(y);a.useEffect(()=>{z()},[]);const z=()=>e(void 0,null,function*(){try{w(!0);const e=yield h.getBalance();v(e),e>=k&&p("balance")}catch(e){console.error("\u83b7\u53d6\u4f59\u989d\u5931\u8d25:",e),v(0)}finally{w(!1)}}),C=()=>b>=k,$=e=>{"balance"!==e||C()?p(e):r({title:"\u4f59\u989d\u4e0d\u8db3\uff0c\u8bf7\u5145\u503c\u6216\u4f7f\u7528\u5176\u4ed6\u652f\u4ed8\u65b9\u5f0f",icon:"none",duration:2e3})},F=()=>e(void 0,null,function*(){if(j)if("balance"!==f||C())try{console.log("\ud83c\udf81 \u5f00\u59cb\u793c\u5361\u8ba2\u5355\u652f\u4ed8:",{orderNo:j,paymentMethod:f,totalAmount:k});const e=yield x.pay({orderNo:j,amount:100*k,paymentMethod:f,title:`\u7535\u5b50\u793c\u5361 \xa5${N} \xd7 ${y}`});e&&("balance"===f&&(yield z()),setTimeout(()=>{s.navigateBack({delta:2})},1500))}catch(e){console.error("\u274c \u793c\u5361\u652f\u4ed8\u6d41\u7a0b\u9519\u8bef:",e),m();const s=e.message||e.errMsg||"\u652f\u4ed8\u5931\u8d25";d({title:"\u652f\u4ed8\u5931\u8d25",content:s,showCancel:!1,confirmText:"\u77e5\u9053\u4e86"})}else r({title:"\u4f59\u989d\u4e0d\u8db3\uff0c\u8bf7\u5145\u503c\u6216\u4f7f\u7528\u5176\u4ed6\u652f\u4ed8\u65b9\u5f0f",icon:"none",duration:2e3});else r({title:"\u8ba2\u5355\u4fe1\u606f\u9519\u8bef",icon:"none"})});return c.jsxs(l,{className:"order-confirm",children:[c.jsxs(l,{className:"order-info",children:[c.jsx(n,{className:"section-title",children:"\u7535\u5b50\u793c\u5361"}),c.jsxs(l,{className:"card-item",children:[c.jsxs(l,{className:"card-preview",children:[c.jsx(t,{className:"card-thumb",src:"https://mingyitang1024.com/static/card/gift-card.png",mode:"aspectFill"}),c.jsxs(l,{className:"card-badge",children:[c.jsx(o,{value:"tag",size:"12",color:"#fff"}),c.jsx(n,{children:"\u4e16\u754c\u4e0a\u6700\u597d\u7684\u7238\u7238"})]})]}),c.jsxs(l,{className:"card-details",children:[c.jsx(n,{className:"card-name",children:"\u7535\u5b50\u793c\u5361"}),c.jsxs(l,{className:"price-quantity",children:[c.jsxs(n,{className:"price",children:["\xa5 ",N]}),c.jsxs(n,{className:"quantity",children:["\xd7",y]})]})]})]})]}),c.jsxs(l,{className:"payment-section",children:[c.jsx(n,{className:"section-title",children:"\u652f\u4ed8\u65b9\u5f0f"}),c.jsxs(l,{className:`payment-method ${"balance"===f?"selected":""} ${C()?"":"disabled"}`,onClick:()=>$("balance"),children:[c.jsxs(l,{className:"method-info",children:[c.jsx(o,{value:"money",size:"20",color:"#FF6B00"}),c.jsx(n,{className:"method-name",children:"\u4f59\u989d\u652f\u4ed8"}),c.jsxs(n,{className:"balance-amount",children:[g?"\u52a0\u8f7d\u4e2d...":`\xa5${b.toFixed(2)}`,!C()&&!g&&c.jsx(n,{className:"insufficient",children:" (\u4f59\u989d\u4e0d\u8db3)"})]})]}),c.jsx(o,{value:"balance"===f?"check-circle":"circle",size:"20",color:"balance"===f?"#a40035":"#999"})]}),c.jsxs(l,{className:"payment-method "+("wechat"===f?"selected":""),onClick:()=>$("wechat"),children:[c.jsxs(l,{className:"method-info",children:[c.jsx(o,{value:"sketch",size:"20",color:"#1AAD19"}),c.jsx(n,{className:"method-name",children:"\u5fae\u4fe1\u652f\u4ed8"})]}),c.jsx(o,{value:"wechat"===f?"check-circle":"circle",size:"20",color:"wechat"===f?"#a40035":"#999"})]})]}),c.jsxs(l,{className:"payment-bar",children:[c.jsxs(l,{className:"total-amount",children:[c.jsx(n,{className:"amount-symbol",children:"\xa5"}),c.jsx(n,{className:"amount-value",children:k})]}),c.jsx(i,{className:"pay-btn",onClick:F,children:"\u53bb\u652f\u4ed8"})]})]})};export{u as default};
