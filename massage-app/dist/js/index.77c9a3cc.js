var e=(e,s,a)=>new Promise((c,t)=>{var i=e=>{try{l(a.next(e))}catch(s){t(s)}},r=e=>{try{l(a.throw(e))}catch(s){t(s)}},l=e=>e.done?c(e.value):Promise.resolve(e.value).then(i,r);l((a=a.apply(e,s)).next())});import{n as s,j as a,V as c,I as t,T as i,C as r,E as l,c as n,h as o,k as d,t as m,s as h}from"./vendors.fcaa4701.js";import{G as u,k as x}from"./common.326c60a3.js";const p=()=>{const[p,j]=s.useState([]),[N,g]=s.useState(null),[y,v]=s.useState(1);s.useEffect(()=>{const e=u.getNuantieProducts();j(e),e.length>0&&g(e[0])},[]);const f=e=>{g(e),v(1)},k=e=>{"increase"===e?v(y+1):"decrease"===e&&y>1&&v(y-1)},P=()=>e(void 0,null,function*(){if(N)try{n({title:"\u521b\u5efa\u8ba2\u5355..."});const e=yield u.createProductOrder({productId:N.id,quantity:y,paymentMethod:"wechat"});o();const s=yield x.pay({orderNo:e.orderNo,amount:N.price*y,paymentMethod:"wechat",title:N.name,wxPayParams:e.wxPayParams});s&&(d({title:"\u8d2d\u4e70\u6210\u529f",icon:"success",duration:1500}),setTimeout(()=>{m.navigateBack()},1500))}catch(e){o();const s=e.message||e.errMsg||"\u8d2d\u4e70\u5931\u8d25";h({title:"\u8d2d\u4e70\u5931\u8d25",content:s,showCancel:!1,confirmText:"\u77e5\u9053\u4e86"})}}),b=()=>N?(N.price/100*y).toFixed(0):"0";return N?a.jsxs(c,{className:"nuantie-page",children:[a.jsxs(c,{className:"product-info-section",children:[a.jsx(c,{className:"product-image",children:a.jsx(t,{className:"product-pic",src:N.image,mode:"aspectFill"})}),a.jsx(i,{className:"product-name",children:N.name}),a.jsx(i,{className:"product-desc",children:N.description})]}),a.jsxs(c,{className:"product-section",children:[a.jsx(i,{className:"section-title",children:"\u9009\u62e9\u4ea7\u54c1"}),a.jsx(c,{className:"product-grid",children:p.map(e=>a.jsxs(c,{className:"product-card "+(N.id===e.id?"active":""),onClick:()=>f(e),children:[a.jsxs(c,{className:"product-header",children:[a.jsxs(c,{className:"header-left",children:[a.jsx(i,{className:"name",children:e.name}),a.jsxs(i,{className:"price",children:["\xa5",(e.price/100).toFixed(0)]})]}),N.id===e.id&&a.jsxs(c,{className:"header-right",onClick:e=>e.stopPropagation(),children:[a.jsx(c,{className:"quantity-btn",onClick:()=>k("decrease"),children:a.jsx(r,{value:"subtract-circle",size:"18",color:1===y?"#ccc":"#a40035"})}),a.jsx(i,{className:"quantity-value",children:y}),a.jsx(c,{className:"quantity-btn",onClick:()=>k("increase"),children:a.jsx(r,{value:"add-circle",size:"18",color:"#a40035"})})]})]}),a.jsx(i,{className:"desc",children:e.description}),N.id===e.id&&a.jsx(r,{value:"check-circle",size:"24",color:"#a40035",className:"check-icon"})]},e.id))})]}),a.jsxs(c,{className:"purchase-bar",children:[a.jsxs(c,{className:"price-info",children:[a.jsx(r,{value:"shopping-bag-2",size:"24",color:"#a40035"}),a.jsxs(i,{className:"total-price",children:["\xa5 ",b()]}),a.jsx(c,{className:"quantity-badge",children:y})]}),a.jsx(l,{className:"purchase-btn",onClick:P,children:"\u53bb\u7ed3\u7b97"})]})]}):a.jsx(c,{className:"nuantie-page",children:a.jsx(c,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})})};export{p as default};
