var e=(e,s,a)=>new Promise((c,t)=>{var l=e=>{try{r(a.next(e))}catch(s){t(s)}},i=e=>{try{r(a.throw(e))}catch(s){t(s)}},r=e=>e.done?c(e.value):Promise.resolve(e.value).then(l,i);r((a=a.apply(e,s)).next())});import{t as s,n as a,j as c,V as t,T as l,I as i,E as r,c as n,h as d,k as o,s as m}from"./vendors.fcaa4701.js";import{G as h,k as x}from"./common.326c60a3.js";const j=()=>{const j=s.useRouter(),{id:u}=j.params,[N,p]=a.useState(null),[b,y]=a.useState(!0),[f,g]=a.useState(1),[v,k]=a.useState(0);a.useEffect(()=>{if(u){const e=h.getProductById(u);e&&p(e),y(!1)}},[u]);const P=e=>{"increase"===e?g(f+1):"decrease"===e&&f>1&&g(f-1)},w=()=>e(void 0,null,function*(){if(N)try{n({title:"\u521b\u5efa\u8ba2\u5355..."});const e=yield h.createProductOrder({productId:N.id,quantity:f,paymentMethod:"wechat"});d();const a=yield x.pay({orderNo:e.orderNo,amount:100*N.price*f,paymentMethod:"wechat",title:N.name,wxPayParams:e.wxPayParams});a&&(o({title:"\u8d2d\u4e70\u6210\u529f",icon:"success",duration:1500}),setTimeout(()=>{s.navigateBack()},1500))}catch(e){d();const s=e.message||e.errMsg||"\u8d2d\u4e70\u5931\u8d25";m({title:"\u8d2d\u4e70\u5931\u8d25",content:s,showCancel:!1,confirmText:"\u77e5\u9053\u4e86"})}}),q=e=>{k(e.detail.scrollTop)},C=((null==N?void 0:N.price)||0)*f;return b?c.jsx(t,{className:"product-detail-page",children:c.jsx(t,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})}):N?c.jsxs(t,{className:"product-detail-page",children:[c.jsx(t,{className:"navbar "+(v>20?"shadow":""),children:c.jsxs(t,{className:"navbar-content",children:[c.jsx(t,{className:"navbar-back",onClick:()=>s.navigateBack(),children:c.jsx(t,{className:"back-icon",children:"\u2039"})}),c.jsx(l,{className:"navbar-title",children:"\u5546\u54c1\u8be6\u60c5"})]})}),c.jsxs(t,{className:"page-content",onScroll:q,scrollY:!0,children:[c.jsxs(t,{className:"product-image-container",children:[c.jsx(i,{className:"product-image",src:N.image,mode:"aspectFill"}),c.jsx(t,{className:"image-badge",children:N.unit})]}),c.jsxs(t,{className:"product-info-card",children:[c.jsxs(t,{className:"price-section",children:[c.jsxs(t,{className:"current-price",children:[c.jsx(l,{className:"currency",children:"\xa5"}),c.jsx(l,{className:"price-value",children:(N.price/100).toFixed(0)})]}),N.originalPrice&&N.originalPrice>N.price&&c.jsxs(l,{className:"original-price",children:["\xa5",(N.originalPrice/100).toFixed(0)]})]}),c.jsxs(t,{className:"product-title-section",children:[c.jsx(l,{className:"product-name",children:N.name}),c.jsx(l,{className:"product-description",children:N.description})]})]}),N.features&&N.features.length>0&&c.jsxs(t,{className:"features-card",children:[c.jsx(l,{className:"card-title",children:"\u4ea7\u54c1\u7279\u8272"}),c.jsx(t,{className:"features-list",children:N.features.map((e,s)=>c.jsxs(t,{className:"feature-item",children:[c.jsx(t,{className:"feature-icon",children:"\u2713"}),c.jsx(l,{className:"feature-text",children:e})]},s))})]}),N.specifications&&Object.keys(N.specifications).length>0&&c.jsxs(t,{className:"specs-card",children:[c.jsx(l,{className:"card-title",children:"\u89c4\u683c\u53c2\u6570"}),c.jsx(t,{className:"specs-list",children:Object.entries(N.specifications).map(([e,s],a)=>c.jsxs(t,{className:"spec-item "+(a!==Object.entries(N.specifications).length-1?"has-border":""),children:[c.jsx(l,{className:"spec-label",children:e}),c.jsx(l,{className:"spec-value",children:s})]},a))})]}),c.jsx(t,{className:"bottom-spacer"})]}),c.jsxs(t,{className:"bottom-bar",children:[c.jsxs(t,{className:"quantity-container",children:[c.jsx(l,{className:"quantity-label",children:"\u6570\u91cf"}),c.jsxs(t,{className:"quantity-selector",children:[c.jsx(t,{className:"quantity-btn",onClick:()=>P("decrease"),children:"\u2212"}),c.jsx(l,{className:"quantity-value",children:f}),c.jsx(t,{className:"quantity-btn",onClick:()=>P("increase"),children:"+"})]})]}),c.jsx(t,{className:"action-buttons",children:c.jsx(r,{className:"buy-btn",onClick:w,children:c.jsxs(t,{className:"btn-content",children:[c.jsx(l,{className:"btn-label",children:"\u7acb\u5373\u8d2d\u4e70"}),c.jsxs(l,{className:"btn-price",children:["\xa5",(C/100).toFixed(0)]})]})})})]})]}):c.jsx(t,{className:"product-detail-page",children:c.jsx(t,{className:"empty",children:"\u5546\u54c1\u4e0d\u5b58\u5728"})})};export{j as default};
