var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,i=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&s(e,r,t[r]);if(a)for(var r of a(t))o.call(t,r)&&s(e,r,t[r]);return e},c=(e,a)=>t(e,r(a)),l=(e,t,r)=>new Promise((a,n)=>{var o=e=>{try{i(r.next(e))}catch(t){n(t)}},s=e=>{try{i(r.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,s);i((r=r.apply(e,t)).next())});import{g as d,a as u,b as h,s as p,o as m,c as g,r as y,h as f,d as I,j as w,V as v,T as S,e as N,f as E,i as A,l as D,k as T,t as x,m as P,n as b,I as R,p as $}from"./vendors.fcaa4701.js";class O{getCurrentLocation(){return l(this,null,function*(){try{const t=yield d(),r=(null==t?void 0:t.authSetting)||{};let a;r["scope.userLocation"]||(yield u({scope:"scope.userLocation"}));try{a=yield h({type:"gcj02",isHighAccuracy:!0})}catch(e){console.warn("gcj02\u5750\u6807\u7cfb\u4e0d\u652f\u6301\uff0c\u5c1d\u8bd5wgs84:",e),a=yield h({type:"wgs84"})}return{latitude:a.latitude,longitude:a.longitude}}catch(t){console.error("\u83b7\u53d6\u4f4d\u7f6e\u5931\u8d25:",t);const e=(null==t?void 0:t.errMsg)||"";return(e.includes("auth deny")||e.includes("authorize:fail"))&&p({title:"\u63d0\u793a",content:"\u9700\u8981\u83b7\u53d6\u60a8\u7684\u4f4d\u7f6e\u4fe1\u606f\u6765\u63a8\u8350\u9644\u8fd1\u95e8\u5e97",confirmText:"\u53bb\u8bbe\u7f6e",success:e=>{e.confirm&&m()}}),console.log("\u4f7f\u7528\u9ed8\u8ba4\u4f4d\u7f6e\uff1a\u4e0a\u6d77\u5e02\u4e2d\u5fc3"),{latitude:31.2304,longitude:121.4737}}})}calculateDistance(e,t,r,a){const n=Math.PI/180,o=6371,s=(r-e)*n,i=(a-t)*n,c=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e*n)*Math.cos(r*n)*Math.sin(i/2)*Math.sin(i/2),l=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return Number((o*l).toFixed(1))}formatDistance(e){return e<1?`${Math.round(1e3*e)}m`:`${e}km`}}const M=new O,j={baseURL:"https://mingyitang1024.com/api/v2",timeout:1e4,retry:3},C={SUCCESS:0,PARAM_ERROR:1001,INVALID_INPUT:1002,NOT_FOUND:1003,DUPLICATE:1004,INVALID_STATE:1005,OPERATION_FAILED:1006,INSUFFICIENT_BALANCE:1007,QUOTA_EXCEEDED:1008,INVALID_PHONE:1009,USER_NOT_FOUND:1010,UNAUTHORIZED:2001,FORBIDDEN:2002,TOKEN_EXPIRED:2003,INVALID_TOKEN:2004,SESSION_EXPIRED:2005,INTERNAL_ERROR:3001,SERVICE_UNAVAILABLE:3002,DATABASE_ERROR:3003,EXTERNAL_API_ERROR:3004,PAYMENT_ERROR:4001,PAYMENT_TIMEOUT:4002,SMS_ERROR:4003,WECHAT_ERROR:4004},_={[C.SUCCESS]:"\u64cd\u4f5c\u6210\u529f",[C.PARAM_ERROR]:"\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u8f93\u5165",[C.INVALID_INPUT]:"\u8f93\u5165\u683c\u5f0f\u4e0d\u6b63\u786e",[C.NOT_FOUND]:"\u8bf7\u6c42\u7684\u8d44\u6e90\u4e0d\u5b58\u5728",[C.DUPLICATE]:"\u64cd\u4f5c\u91cd\u590d\uff0c\u8bf7\u52ff\u91cd\u590d\u63d0\u4ea4",[C.INVALID_STATE]:"\u5f53\u524d\u72b6\u6001\u4e0d\u5141\u8bb8\u6b64\u64cd\u4f5c",[C.OPERATION_FAILED]:"\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",[C.INSUFFICIENT_BALANCE]:"\u4f59\u989d\u4e0d\u8db3\uff0c\u8bf7\u5145\u503c",[C.QUOTA_EXCEEDED]:"\u8d85\u51fa\u914d\u989d\u9650\u5236",[C.INVALID_PHONE]:"\u624b\u673a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e",[C.USER_NOT_FOUND]:"\u7528\u6237\u4e0d\u5b58\u5728",[C.UNAUTHORIZED]:"\u8bf7\u5148\u767b\u5f55",[C.FORBIDDEN]:"\u60a8\u65e0\u6743\u6267\u884c\u6b64\u64cd\u4f5c",[C.TOKEN_EXPIRED]:"\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55",[C.INVALID_TOKEN]:"\u65e0\u6548\u7684\u767b\u5f55\u72b6\u6001",[C.SESSION_EXPIRED]:"\u4f1a\u8bdd\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55",[C.INTERNAL_ERROR]:"\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",[C.SERVICE_UNAVAILABLE]:"\u670d\u52a1\u7ef4\u62a4\u4e2d\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",[C.DATABASE_ERROR]:"\u6570\u636e\u5e93\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",[C.EXTERNAL_API_ERROR]:"\u7b2c\u4e09\u65b9\u670d\u52a1\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",[C.PAYMENT_ERROR]:"\u652f\u4ed8\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",[C.PAYMENT_TIMEOUT]:"\u652f\u4ed8\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u652f\u4ed8",[C.SMS_ERROR]:"\u77ed\u4fe1\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",[C.WECHAT_ERROR]:"\u5fae\u4fe1\u63a5\u53e3\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"};function U(e,t){return _[e]||t||"\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"}function L(e){return[C.UNAUTHORIZED,C.TOKEN_EXPIRED,C.INVALID_TOKEN,C.SESSION_EXPIRED].includes(e)}function k(e){return l(this,arguments,function*(e,t={}){const{method:r="GET",data:a,header:n={},showLoading:o=!1,loadingTitle:s="\u52a0\u8f7d\u4e2d..."}=t;o&&g({title:s,mask:!0});try{const t=yield y({url:`${j.baseURL}${e}`,method:r,data:a,header:i({"Content-Type":"application/json"},n),timeout:j.timeout});o&&f();const s=t.data;if(s.code!==C.SUCCESS){console.error(`API\u4e1a\u52a1\u9519\u8bef: ${e}`,{code:s.code,message:s.message,data:s}),L(s.code)&&(console.warn("\u8ba4\u8bc1\u8fc7\u671f\uff0c\u8df3\u8f6c\u5230\u767b\u5f55\u9875"),I("userInfo"),I("userToken"));const r=U(s.code,s.message),a=new Error(r);throw a.code=s.code,a.response={status:t.statusCode,data:s},a}return s}catch(c){throw o&&f(),console.error(`API\u7f51\u7edc\u9519\u8bef: ${e}`,c),c}})}const V=(e,t,r)=>{const a=t?"?"+Object.keys(t).filter(e=>void 0!==t[e]&&null!==t[e]).map(e=>`${e}=${encodeURIComponent(t[e])}`).join("&"):"";return k(e+a,c(i({},r),{method:"GET"}))},z=(e,t,r)=>k(e,c(i({},r),{method:"POST",data:t})),B=e=>{if(e)return e.startsWith("https://")?e:e.startsWith("http://")?e.replace("http://","https://"):e.startsWith("/")?`https://mingyitang1024.com${e}`:`https://mingyitang1024.com/static${e.startsWith("/")?e:"/"+e}`};class F{getNearbyStores(e,t,r=1,a=10){return l(this,null,function*(){try{const n=yield k("/stores/nearby",{data:{latitude:e,longitude:t,page:r,pageSize:a}});console.log("\u2705 \u95e8\u5e97\u5217\u8868API\u8c03\u7528\u6210\u529f:",n);const o=n.data.list.map(e=>{var t;return c(i({},e),{image:B(e.image),images:null==(t=e.images)?void 0:t.map(e=>B(e))})});return c(i({},n.data),{list:o})}catch(n){throw console.error("\u274c \u95e8\u5e97\u5217\u8868API\u8c03\u7528\u5931\u8d25:",n),n}})}getStoreDetail(e){return l(this,null,function*(){var t;try{const r=yield k(`/stores/${e}`);return console.log("\u2705 \u95e8\u5e97\u8be6\u60c5API\u8c03\u7528\u6210\u529f:",r),(null==r?void 0:r.data)?c(i({},r),{data:c(i({},r.data),{image:B(r.data.image),images:null==(t=r.data.images)?void 0:t.map(e=>B(e))})}):r}catch(r){return console.log("\u26a0\ufe0f \u95e8\u5e97\u8be6\u60c5API\u8c03\u7528\u5931\u8d25:",r),null}})}searchStores(e,t=1,r=10){return l(this,null,function*(){try{const a=yield k("/stores/search",{data:{keyword:e,page:t,pageSize:r}});return console.log("\u2705 \u95e8\u5e97\u641c\u7d22API\u8c03\u7528\u6210\u529f:",a),a.data||{list:[],total:0,page:1,pageSize:10,hasMore:!1}}catch(a){return console.log("\u26a0\ufe0f \u95e8\u5e97\u641c\u7d22API\u8c03\u7528\u5931\u8d25:",a),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}getStoresByStatus(e,t=1,r=10){return l(this,null,function*(){try{const a=yield k("/stores/filter",{data:{status:e,page:t,pageSize:r}});return console.log("\u2705 \u95e8\u5e97\u7b5b\u9009API\u8c03\u7528\u6210\u529f:",a),a.data||{list:[],total:0,page:1,pageSize:10,hasMore:!1}}catch(a){return console.log("\u26a0\ufe0f \u95e8\u5e97\u7b5b\u9009API\u8c03\u7528\u5931\u8d25:",a),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}}const W=new F;class q{getRecommendedTherapists(e=1,t=10,r){return l(this,null,function*(){try{const a=yield k("/therapists/recommended",{data:{page:e,pageSize:t,latitude:null==r?void 0:r.latitude,longitude:null==r?void 0:r.longitude}});return console.log("\u2705 \u63a8\u8350\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",a),a.data||{list:[],total:0,page:1,pageSize:10,hasMore:!1}}catch(a){return console.log("\u26a0\ufe0f \u63a8\u8350\u63a8\u62ff\u5e08API\u8c03\u7528\u5931\u8d25\uff0c\u4f7f\u7528mock\u6570\u636e:",a),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}getRecommendedTherapistsWithDistance(e=1,t=10){return l(this,null,function*(){var r,a,n,o,s;try{const d=yield M.getCurrentLocation(),u=yield k("/therapists/recommended",{data:{page:e,pageSize:t,latitude:d.latitude,longitude:d.longitude}});console.log("\u2705 \u63a8\u8350\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",u);const h=(null==(r=u.data)?void 0:r.list)||[],p=h.map(e=>c(i({},e),{avatar:B(e.avatar)})),m=yield Promise.all(p.map(e=>l(this,null,function*(){try{const t=yield W.getStoreDetail(e.storeId),r=(null==t?void 0:t.data)||t;let a=null;return(null==r?void 0:r.latitude)&&(null==r?void 0:r.longitude)&&(a=M.calculateDistance(d.latitude,d.longitude,r.latitude,r.longitude)),c(i({},e),{distance:a})}catch(t){return console.warn(`\u83b7\u53d6\u6280\u5e08 ${e.id} \u95e8\u5e97\u4fe1\u606f\u5931\u8d25:`,t),c(i({},e),{distance:null})}})));return m.sort((e,t)=>null===e.distance&&null===t.distance?0:null===e.distance?1:null===t.distance?-1:e.distance-t.distance),{list:m,total:(null==(a=u.data)?void 0:a.total)||m.length,page:(null==(n=u.data)?void 0:n.page)||e,pageSize:(null==(o=u.data)?void 0:o.pageSize)||t,hasMore:(null==(s=u.data)?void 0:s.hasMore)||!1}}catch(d){return console.log("\u26a0\ufe0f \u63a8\u8350\u63a8\u62ff\u5e08\u8ddd\u79bb\u8ba1\u7b97API\u8c03\u7528\u5931\u8d25:",d),{list:[],total:0,page:1,pageSize:10,hasMore:!1}}})}getTherapistsByStore(e,t=1,r=10){return l(this,null,function*(){const a=yield k(`/stores/${e}/therapists`,{data:{page:t,pageSize:r}});console.log("\u2705 \u95e8\u5e97\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",a);const n=Array.isArray(a.data)?a.data:[];return{list:n,total:n.length,page:1,pageSize:n.length,hasMore:!1}})}getTherapistDetail(e){return l(this,null,function*(){try{const t=yield k(`/therapists/${e}`);return console.log("\u2705 \u63a8\u62ff\u5e08\u8be6\u60c5API\u8c03\u7528\u6210\u529f:",t),t}catch(t){throw console.log("\u26a0\ufe0f \u63a8\u62ff\u5e08\u8be6\u60c5API\u8c03\u7528\u5931\u8d25:",t),t}})}getTherapistsByExpertise(e,t=1,r=10){return l(this,null,function*(){const a=yield k("/therapists/search",{data:{expertise:e,page:t,pageSize:r}});return console.log("\u2705 \u4e13\u957f\u7b5b\u9009\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",a),a.data})}searchTherapists(e,t=1,r=10){return l(this,null,function*(){const a=yield k("/therapists/search",{data:{keyword:e,page:t,pageSize:r}});return console.log("\u2705 \u641c\u7d22\u63a8\u62ff\u5e08API\u8c03\u7528\u6210\u529f:",a),a.data})}getAvailableSlots(e,t,r=60){return l(this,null,function*(){try{const a=yield k("/appointments/available-slots",{data:{therapistId:e,date:t,duration:r}});return console.log("\u2705 \u83b7\u53d6\u53ef\u9884\u7ea6\u65f6\u6bb5API\u8c03\u7528\u6210\u529f:",a),a.data}catch(a){throw console.error("\u274c \u83b7\u53d6\u53ef\u9884\u7ea6\u65f6\u6bb5API\u8c03\u7528\u5931\u8d25:",a),a}})}getTherapistsAvailability(e,t,r=3){return l(this,null,function*(){try{const a=yield k(`/stores/${e}/therapists/availability`,{data:{date:t,days:r}});return console.log("\u2705 \u95e8\u5e97\u63a8\u62ff\u5e08\u6392\u73edAPI\u8c03\u7528\u6210\u529f:",a),Array.isArray(a.data)?a.data:[]}catch(a){return console.error("\u274c \u95e8\u5e97\u63a8\u62ff\u5e08\u6392\u73edAPI\u8c03\u7528\u5931\u8d25:",a),[]}})}}const X=new q,H=({size:e="medium",text:t="\u9884\u7ea6"})=>w.jsx(v,{className:`booking-button booking-button-${e}`,children:w.jsx(S,{className:"button-text",children:t})});class G{createReview(e){return l(this,null,function*(){if(e.content.length<1)throw new Error("\u8bc4\u4ef7\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a");if(e.content.length>500)throw new Error("\u8bc4\u4ef7\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7500\u5b57");if(e.rating<1||e.rating>5)throw new Error("\u8bc4\u5206\u5fc5\u987b\u57281-5\u4e4b\u95f4");try{const t=yield z("/reviews",e,{showLoading:!0,loadingTitle:"\u63d0\u4ea4\u8bc4\u4ef7\u4e2d..."});return N.trigger("review:created",t.data),t.data}catch(t){throw console.error("\u521b\u5efa\u8bc4\u4ef7\u5931\u8d25:",t),new Error(t.message||"\u521b\u5efa\u8bc4\u4ef7\u5931\u8d25")}})}getTherapistReviews(e,t=1,r=10,a){return l(this,null,function*(){try{const n={page:t,pageSize:r};a&&(n.rating=a);const o=yield V(`/therapists/${e}/reviews`,n);return o.data}catch(n){return console.error("\u83b7\u53d6\u63a8\u62ff\u5e08\u8bc4\u4ef7\u5931\u8d25:",n),{list:[],total:0,page:t,pageSize:r,hasMore:!1}}})}getUserReviews(e,t=1,r=10){return l(this,null,function*(){try{const a=yield V(`/users/${e}/reviews`,{page:t,pageSize:r});return a.data}catch(a){return console.error("\u83b7\u53d6\u7528\u6237\u8bc4\u4ef7\u5931\u8d25:",a),{list:[],total:0,page:t,pageSize:r,hasMore:!1}}})}getReviewDetail(e){return l(this,null,function*(){try{const t=yield V(`/reviews/${e}`);return t.data}catch(t){throw console.error("\u83b7\u53d6\u8bc4\u4ef7\u8be6\u60c5\u5931\u8d25:",t),new Error(t.message||"\u8bc4\u4ef7\u4e0d\u5b58\u5728")}})}getReviewStats(e){return l(this,null,function*(){try{const t=yield V(`/therapists/${e}/review-stats`);return t.data}catch(t){return console.error("\u83b7\u53d6\u8bc4\u4ef7\u7edf\u8ba1\u5931\u8d25:",t),{totalCount:0,averageRating:0,ratingBreakdown:{1:0,2:0,3:0,4:0,5:0}}}})}checkCanReview(e){return l(this,null,function*(){var t;try{const r=yield y({url:`${j.baseURL}/reviews/${e}`,method:"GET",header:{"Content-Type":"application/json"},timeout:j.timeout}),a=r.data;return 1002===a.code?(console.log("\u8bc4\u4ef7\u4e0d\u5b58\u5728\uff0c\u53ef\u4ee5\u521b\u5efa\u8bc4\u4ef7"),!0):0!==a.code||!(null==(t=a.data)?void 0:t.reviewId)||(console.log("\u8bc4\u4ef7\u5df2\u5b58\u5728\uff0c\u4e0d\u80fd\u518d\u8bc4\u4ef7"),!1)}catch(r){return console.warn("\u68c0\u67e5\u8bc4\u4ef7\u72b6\u6001\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u9ed8\u8ba4\u5141\u8bb8\u8bc4\u4ef7"),!0}})}batchCheckReviewStatus(e){return l(this,null,function*(){const t={},r=e.map(e=>l(this,null,function*(){const r=yield this.checkCanReview(e);t[e]=r}));return yield Promise.allSettled(r),t})}clearCache(){try{const e=E().keys;e.forEach(e=>{e.startsWith("review_cache_")&&I(e)})}catch(e){console.error("\u6e05\u9664\u8bc4\u4ef7\u7f13\u5b58\u5931\u8d25:",e)}}}const K=new G,Y="https://mingyitang1024.com/static",Z={baseUrl:Y,giftCard:{member:`${Y}/card/member-card.png`,electronic:`${Y}/card/gift-card.png`},product:{},banners:{goodnight:""},therapists:{baseUrl:`${Y}/therapists/\u8001\u5e08\u6536\u96c6\u4e2d\u6587\u539f\u7248`},default:`${Y}/default.png`},Q=()=>{try{const e=A("userInfo");return e||null}catch(e){return console.error("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25:",e),null}},J=()=>{const e=Q();return(null==e?void 0:e.id)||1},ee=()=>{const e=Q();return(null==e?void 0:e.phone)||"13800138000"},te=e=>{try{P("userInfo",e)}catch(t){console.error("\u8bbe\u7f6e\u7528\u6237\u4fe1\u606f\u5931\u8d25:",t)}},re=e=>e?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"\u672a\u8bbe\u7f6e",ae=()=>l(void 0,null,function*(){try{const{code:e}=yield D(),t=yield z("/users/wechat-login",{code:e});if(t.data)return t.data.userInfo&&!t.data.needBindPhone&&te(t.data.userInfo),t.data;throw new Error("\u5fae\u4fe1\u767b\u5f55\u5931\u8d25\uff1a\u8fd4\u56de\u6570\u636e\u5f02\u5e38")}catch(e){throw console.error("\u5fae\u4fe1\u767b\u5f55\u5931\u8d25:",e),e}}),ne=e=>l(void 0,null,function*(){try{if(!e){const t=Q();e=null==t?void 0:t.phone}if(!e)return console.warn("\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff1a\u7f3a\u5c11\u624b\u673a\u53f7"),null;const t=yield V(`/users/info?phone=${e}`);if(t.data){const e={id:t.data.id,phone:t.data.phone,username:t.data.username,nickname:t.data.nickname,avatar:t.data.avatar,openid:t.data.openid,membershipNumber:t.data.membershipNumber,memberLevel:t.data.memberLevel,balance:t.data.balance,totalSpent:t.data.totalSpent,totalVisits:t.data.totalVisits,discountRate:t.data.discount_rate||t.data.discountRate};return te(e),e}return null}catch(t){return console.error("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25:",t),null}}),oe=()=>{const e=Q();return e&&e.id?e.id:null},se=()=>l(void 0,null,function*(){const e=Q();return!(!e||!e.phone)||(console.warn("\u26a0\ufe0f \u7528\u6237\u672a\u767b\u5f55\uff0c\u8df3\u8f6c\u5230\u767b\u5f55"),T({title:"\u8bf7\u5148\u767b\u5f55",icon:"none"}),setTimeout(()=>{x.redirectTo({url:"/pages/mine/index"})},1500),!1)}),ie=()=>l(void 0,null,function*(){try{const e=Q();if(e&&e.phone){const t=yield ne(e.phone);return t||e}const t=yield ae();return!t.needBindPhone&&t.userInfo?t.userInfo:null}catch(e){return console.error("\u81ea\u52a8\u767b\u5f55\u5931\u8d25:",e),null}}),ce=[{id:"member-card",type:"member",name:"\u4f1a\u5458\u793c\u5361",image:Z.giftCard.member,description:"\u5c0a\u4eab\u4f1a\u5458\u4e13\u5c5e\u4f18\u60e0",features:["\u5168\u95e8\u5e97\u901a\u7528","\u957f\u671f\u6709\u6548","\u53ef\u7d2f\u8ba1\u79ef\u5206","\u4eab\u53d7\u4f1a\u5458\u4ef7"],terms:"\u672c\u5361\u4e3a\u4e0d\u8bb0\u540d\u5361\u7247\uff0c\u8bf7\u59a5\u5584\u4fdd\u7ba1"},{id:"electronic-card",type:"electronic",name:"\u7535\u5b50\u793c\u5361",image:Z.giftCard.electronic,description:"\u4fbf\u6377\u7684\u7535\u5b50\u793c\u54c1\u5361",features:["\u5373\u4e70\u5373\u7528","\u53ef\u8f6c\u8d60\u597d\u53cb","\u7ebf\u4e0a\u8d2d\u4e70","\u626b\u7801\u4f7f\u7528"],terms:"\u7535\u5b50\u5361\u6709\u6548\u671f\u4e3a\u8d2d\u4e70\u4e4b\u65e5\u8d77\u4e00\u5e74\u5185"}],le=[{id:"nuantie-waist",name:"\u8572\u827e\u8170\u8179\u6696\u8d34",image:"https://mingyitang1024.com/static/gift/product/nuantie/yaofu.jpg",price:9900,originalPrice:9900,unit:"\u8d34",description:"\u81ea\u53d1\u70ed\u827e\u8349\u6696\u62a4\u8170\u8d34",features:[],specifications:{}},{id:"nuantie-knee",name:"\u8572\u827e\u62a4\u819d\u6696\u8d34",image:"https://mingyitang1024.com/static/gift/product/nuantie/huxi.jpg",price:9900,originalPrice:9900,unit:"\u8d34",description:"\u81ea\u53d1\u70ed\u827e\u8349\u62a4\u819d \u9a71\u5bd2\u4fdd\u6696",features:[],specifications:{}},{id:"nuantie-moxa",name:"\u8572\u827e\u7078\u8d34",image:"https://mingyitang1024.com/static/gift/product/nuantie/xinai.jpg",price:9900,originalPrice:9900,unit:"\u8d34",description:"\u81ea\u53d1\u70ed\u827e\u8349\u7cbe\u6cb9\u7a74\u4f4d\u7078\u8d34",features:[],specifications:{}}],de=[{id:"aijiu-stick",name:"\u8572\u827e\u6761",image:"https://mingyitang1024.com/static/gift/product/aijiu/xinaitiao.jpg",price:9900,originalPrice:9900,unit:"\u6761",description:"\u827e\u7078\u827e\u6761 3\u5e74\u9648\u827e",features:[],specifications:{}},{id:"aijiu-moxa-ball",name:"\u8572\u827e\u997c",image:"https://mingyitang1024.com/static/gift/product/aijiu/xinaibing.jpg",price:9900,originalPrice:9900,unit:"\u997c",description:"\u9053\u5730\u8572\u827e\u6ce1\u811a\u6ce1\u6fa1\u827e\u8349\u997c",features:[],specifications:{}},{id:"aijiu-column",name:"\u65b0\u827e\u67f1",image:"https://mingyitang1024.com/static/gift/product/aijiu/xinaizhu.jpg",price:9900,originalPrice:9900,unit:"\u67f1",description:"\u674e\u65f6\u73cd\u6545\u91cc\u7279\u4ea7\u65b0\u827e\u67f1",features:[],specifications:{}}],ue=[...le,...de];class he{static getAllGiftCards(){return ce}static getGiftCardById(e){return ce.find(t=>t.id===e)}static getAllProducts(){return ue}static getProductById(e){return ue.find(t=>t.id===e)}static getNuantieProducts(){return le}static getAijiuProducts(){return de}static createGiftCardOrder(e){return l(this,null,function*(){var t,r,a,n,o;try{const t=oe();if(!t)throw new Error("\u8bf7\u5148\u767b\u5f55\u540e\u518d\u8d2d\u4e70\u793c\u5361");if("wechat"===e.paymentMethod){const e=Q();if(!(null==e?void 0:e.openid))throw new Error('\u5fae\u4fe1\u652f\u4ed8\u9700\u8981\u5148\u5b8c\u6210\u5fae\u4fe1\u767b\u5f55\u6388\u6743\uff0c\u8bf7\u524d\u5f80"\u6211\u7684"\u9875\u9762\u767b\u5f55')}const r=J(),a={orderType:"product",userId:r,title:`\u7535\u5b50\u793c\u5361 \xa5${(e.amount/100).toFixed(2)}`,amount:e.amount*e.quantity,paymentMethod:e.paymentMethod,extraData:{productType:"gift_card",productId:e.cardId,productName:"\u7535\u5b50\u793c\u5361",quantity:e.quantity,cardType:"electronic",faceValue:e.amount,customMessage:e.customMessage||"\u4e16\u754c\u4e0a\u6700\u597d\u7684\u7238\u7238"}};console.log("\ud83c\udf81 \u521b\u5efa\u793c\u5361\u8ba2\u5355"),console.log("\ud83d\udc64 \u5f53\u524d\u7528\u6237ID:",r),console.log("\ud83d\udce6 \u8ba2\u5355\u6570\u636e:",{orderType:a.orderType,userId:a.userId,title:a.title,amount:`${a.amount}\u5206 (\xa5${(a.amount/100).toFixed(2)})`,paymentMethod:a.paymentMethod,extraData:a.extraData});const n=yield z("/orders/create",a,{showLoading:!0,loadingTitle:"\u521b\u5efa\u8ba2\u5355\u4e2d..."});return console.log("\u2705 \u793c\u5361\u8ba2\u5355\u521b\u5efa\u6210\u529f"),console.log("\ud83d\udccb \u8ba2\u5355\u54cd\u5e94:",{orderNo:n.data.orderNo,amount:`${n.data.amount}\u5206 (\xa5${(n.data.amount/100).toFixed(2)})`,paymentStatus:n.data.paymentStatus,hasWxPayParams:!!n.data.wxPayParams}),n.data}catch(s){console.error("\u274c \u521b\u5efa\u793c\u5361\u8ba2\u5355\u5931\u8d25:",s);const e=(null==s?void 0:s.code)||(null==(r=null==(t=null==s?void 0:s.response)?void 0:t.data)?void 0:r.code),i=(null==(n=null==(a=null==s?void 0:s.response)?void 0:a.data)?void 0:n.message)||(null==s?void 0:s.message)||"\u521b\u5efa\u793c\u5361\u8ba2\u5355\u5931\u8d25";if(console.error("\ud83d\udccb \u9519\u8bef\u8be6\u60c5:",{code:e,message:i,responseData:null==(o=null==s?void 0:s.response)?void 0:o.data,fullError:s}),1003===e&&i.includes("openid"))throw new Error('\u5fae\u4fe1\u652f\u4ed8\u6388\u6743\u5931\u8d25\uff0c\u8bf7\u524d\u5f80"\u6211\u7684"\u9875\u9762\u91cd\u65b0\u767b\u5f55');if(1007===e)throw new Error("\u4f59\u989d\u4e0d\u8db3\uff0c\u8bf7\u5148\u5145\u503c");throw new Error(i)}})}static createProductOrder(e){return l(this,null,function*(){var t,r,a,n,o;try{const t=oe();if(!t)throw new Error("\u8bf7\u5148\u767b\u5f55\u540e\u518d\u8d2d\u4e70\u5546\u54c1");if("wechat"===e.paymentMethod){const e=Q();if(!(null==e?void 0:e.openid))throw new Error('\u5fae\u4fe1\u652f\u4ed8\u9700\u8981\u5148\u5b8c\u6210\u5fae\u4fe1\u767b\u5f55\u6388\u6743\uff0c\u8bf7\u524d\u5f80"\u6211\u7684"\u9875\u9762\u767b\u5f55')}const r=this.getProductById(e.productId);if(!r)throw new Error("\u5546\u54c1\u4e0d\u5b58\u5728");const a={orderType:"product",userId:J(),title:r.name,amount:r.price*e.quantity,paymentMethod:e.paymentMethod,extraData:{productType:"merchandise",productId:e.productId,productName:r.name,quantity:e.quantity,specifications:r.specifications}};console.log("\ud83d\udce6 \u521b\u5efa\u5546\u54c1\u8ba2\u5355"),console.log("\ud83d\udc64 \u5f53\u524d\u7528\u6237ID:",J()),console.log("\ud83d\udccb \u8ba2\u5355\u6570\u636e:",{orderType:a.orderType,userId:a.userId,title:a.title,amount:`${a.amount}\u5206 (\xa5${(a.amount/100).toFixed(2)})`,paymentMethod:a.paymentMethod,extraData:a.extraData});const n=yield z("/orders/create",a,{showLoading:!0,loadingTitle:"\u521b\u5efa\u8ba2\u5355\u4e2d..."});return console.log("\u2705 \u5546\u54c1\u8ba2\u5355\u521b\u5efa\u6210\u529f"),console.log("\ud83d\udccb \u8ba2\u5355\u54cd\u5e94:",{orderNo:n.data.orderNo,amount:`${n.data.amount}\u5206 (\xa5${(n.data.amount/100).toFixed(2)})`,paymentStatus:n.data.paymentStatus,hasWxPayParams:!!n.data.wxPayParams}),n.data}catch(s){console.error("\u274c \u521b\u5efa\u5546\u54c1\u8ba2\u5355\u5931\u8d25:",s);const e=(null==s?void 0:s.code)||(null==(r=null==(t=null==s?void 0:s.response)?void 0:t.data)?void 0:r.code),i=(null==(n=null==(a=null==s?void 0:s.response)?void 0:a.data)?void 0:n.message)||(null==s?void 0:s.message)||"\u521b\u5efa\u5546\u54c1\u8ba2\u5355\u5931\u8d25";if(console.error("\ud83d\udccb \u9519\u8bef\u8be6\u60c5:",{code:e,message:i,responseData:null==(o=null==s?void 0:s.response)?void 0:o.data,fullError:s}),1003===e&&i.includes("openid"))throw new Error('\u5fae\u4fe1\u652f\u4ed8\u6388\u6743\u5931\u8d25\uff0c\u8bf7\u524d\u5f80"\u6211\u7684"\u9875\u9762\u91cd\u65b0\u767b\u5f55');if(1007===e)throw new Error("\u4f59\u989d\u4e0d\u8db3\uff0c\u8bf7\u5148\u5145\u503c");throw new Error(i)}})}}class pe{getCurrentUserId(){return J()}getBalance(){return l(this,null,function*(){try{const e=oe();if(!e)throw new Error("\u8bf7\u5148\u767b\u5f55");const t=this.getCurrentUserId(),r=yield V("/users/wallet/balance",{userId:t}),a=r.data.balance||0;return console.log("\ud83d\udcb0 \u4f59\u989d\u67e5\u8be2:",{"\u5206":a,"\u5143":(a/100).toFixed(2)}),a}catch(e){throw console.error("\u83b7\u53d6\u4f59\u989d\u5931\u8d25:",e),new Error("\u83b7\u53d6\u4f59\u989d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})}getBalanceDetails(){return l(this,null,function*(){try{const e=this.getCurrentUserId(),t=yield V("/users/wallet/balance",{userId:e});return t.data}catch(e){throw console.error("\u83b7\u53d6\u4f59\u989d\u8be6\u60c5\u5931\u8d25:",e),new Error("\u83b7\u53d6\u4f59\u989d\u8be6\u60c5\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})}getRechargeOptions(){return l(this,null,function*(){try{const e=yield V("/recharge/configs");return e.data}catch(e){return console.error("\u83b7\u53d6\u5145\u503c\u914d\u7f6e\u5931\u8d25:",e),this.getDefaultRechargeOptions()}})}getDefaultRechargeOptions(){return[{id:1,amount:1e4,bonus:0,label:"100\u5143",sortOrder:1},{id:2,amount:2e4,bonus:0,label:"200\u5143",sortOrder:2},{id:3,amount:5e4,bonus:5e3,label:"500\u5143",sortOrder:3,promotionTag:"\u8d6050\u5143"},{id:4,amount:1e5,bonus:1e4,label:"1000\u5143",sortOrder:4,promotionTag:"\u8d60100\u5143"},{id:5,amount:2e5,bonus:3e4,label:"2000\u5143",sortOrder:5,promotionTag:"\u8d60300\u5143"},{id:6,amount:5e5,bonus:1e5,label:"5000\u5143",sortOrder:6,promotionTag:"\u8d601000\u5143",isRecommended:!0}]}createRechargeOrder(e,t=0){return l(this,null,function*(){var r,a,n,o,s;try{const r=oe();if(!r)throw new Error("\u8bf7\u5148\u767b\u5f55\u540e\u518d\u5145\u503c");const a=Q();if(!(null==a?void 0:a.openid))throw new Error('\u5fae\u4fe1\u652f\u4ed8\u9700\u8981\u5148\u5b8c\u6210\u5fae\u4fe1\u767b\u5f55\u6388\u6743\uff0c\u8bf7\u524d\u5f80"\u6211\u7684"\u9875\u9762\u767b\u5f55');const n=this.getCurrentUserId(),o=ee(),s=100*e,i={orderType:"recharge",userId:n,userPhone:o,title:t>0?`\u5145\u503c${e}\u5143\uff0c\u8d60\u9001${t}\u5143`:`\u5145\u503c${e}\u5143`,amount:s,paymentMethod:"wechat",extraData:{rechargeAmount:100*e,bonus:100*t,actualAmount:100*(e+t)}};console.log("\ud83d\udcb0 \u521b\u5efa\u5145\u503c\u8ba2\u5355"),console.log("\ud83d\udc64 \u5f53\u524d\u7528\u6237ID:",n),console.log("\ud83d\udcde \u7528\u6237\u624b\u673a\u53f7:",o),console.log("\ud83d\udce6 \u8ba2\u5355\u6570\u636e:",{orderType:i.orderType,userId:i.userId,title:i.title,amount:`${i.amount}\u5206 (\xa5${(i.amount/100).toFixed(2)})`,paymentMethod:i.paymentMethod,extraData:i.extraData});const c=yield z("/orders/create",i,{showLoading:!0,loadingTitle:"\u521b\u5efa\u8ba2\u5355\u4e2d..."});return console.log("\u2705 \u5145\u503c\u8ba2\u5355\u521b\u5efa\u6210\u529f"),console.log("\ud83d\udccb \u8ba2\u5355\u54cd\u5e94:",{orderNo:c.data.orderNo,amount:`${c.data.amount}\u5206 (\xa5${(c.data.amount/100).toFixed(2)})`,paymentStatus:c.data.paymentStatus,hasWxPayParams:!!c.data.wxPayParams}),c.data}catch(i){console.error("\u274c \u521b\u5efa\u5145\u503c\u8ba2\u5355\u5931\u8d25:",i);const e=(null==i?void 0:i.code)||(null==(a=null==(r=null==i?void 0:i.response)?void 0:r.data)?void 0:a.code),t=(null==(o=null==(n=null==i?void 0:i.response)?void 0:n.data)?void 0:o.message)||(null==i?void 0:i.message)||"\u521b\u5efa\u5145\u503c\u8ba2\u5355\u5931\u8d25";if(console.error("\ud83d\udccb \u9519\u8bef\u8be6\u60c5:",{code:e,message:t,responseData:null==(s=null==i?void 0:i.response)?void 0:s.data,fullError:i}),1003===e&&t.includes("openid"))throw new Error('\u5fae\u4fe1\u652f\u4ed8\u6388\u6743\u5931\u8d25\uff0c\u8bf7\u524d\u5f80"\u6211\u7684"\u9875\u9762\u91cd\u65b0\u767b\u5f55');throw new Error(t)}})}getTransactions(e=1,t=20,r){return l(this,null,function*(){try{const a=this.getCurrentUserId(),n={userId:a,page:e,pageSize:t};r&&(n.type=r);const o=yield V("/users/wallet/transactions",n);return o.data.list}catch(a){return console.error("\u83b7\u53d6\u4ea4\u6613\u8bb0\u5f55\u5931\u8d25:",a),[]}})}payWithBalance(e,t){return l(this,null,function*(){try{const t=yield z("/orders/pay",{orderNo:e,paymentMethod:"balance"},{showLoading:!0,loadingTitle:"\u652f\u4ed8\u4e2d..."});return{success:!0,balance:t.data.balance,message:"\u652f\u4ed8\u6210\u529f"}}catch(t){throw console.error("\u4f59\u989d\u652f\u4ed8\u5931\u8d25:",t),new Error(t.message||"\u4f59\u989d\u4e0d\u8db3\u6216\u652f\u4ed8\u5931\u8d25")}})}refundToBalance(e,t,r="\u8ba2\u5355\u9000\u6b3e"){return l(this,null,function*(){try{const a=yield z("/users/wallet/refund",{phone:ee(),amount:t,orderNo:e,description:r},{showLoading:!0,loadingTitle:"\u9000\u6b3e\u4e2d..."});return{success:!0,balance:a.data.balance,transactionId:a.data.transactionId,message:"\u9000\u6b3e\u6210\u529f"}}catch(a){throw console.error("\u9000\u6b3e\u5931\u8d25:",a),new Error(a.message||"\u9000\u6b3e\u5931\u8d25")}})}clearCache(){try{I("userInfo"),I("walletCache"),console.log("\u94b1\u5305\u7f13\u5b58\u5df2\u6e05\u7a7a")}catch(e){console.error("\u6e05\u7a7a\u7f13\u5b58\u5931\u8d25:",e)}}}const me=new pe;function ge(e,t){if(!e||e>=1)return null;const r=Math.round(100*(1-e)),a=new Date,n=new Date(a.getTime()+31536e6);return{id:`virtual_${t}_discount`,userId:t.toString(),type:"discount",name:r>=30?"\u65b0\u4eba\u4e13\u4eab\u5238":"\u4f1a\u5458\u6298\u6263\u5238",description:`\u5168\u573a\u670d\u52a1${Math.round(100*e)}\u6298`,discountRate:e,discountPercentage:r,validFrom:a.toISOString(),validTo:n.toISOString(),status:"unused",isAutoApply:!0}}function ye(e,t){const r=Math.round(e*t),a=e-r,n=Math.round(100*t);return{originalPrice:e,finalPrice:r,savedAmount:a,discountDisplay:`${n}\u6298`}}class fe{constructor(){this.vouchers=[],this.currentVoucher=null}getMyVouchers(){return l(this,null,function*(){const e=Q();if(!e)return[];if(e.discountRate&&e.discountRate<1){const t=ge(e.discountRate,e.id.toString());if(t)return this.vouchers=[t],[t]}return[]})}getAvailableVouchers(e){return l(this,null,function*(){const t=yield this.getMyVouchers(),r=new Date;return t.filter(t=>{if("unused"!==t.status)return!1;const a=new Date(t.validFrom),n=new Date(t.validTo);return!(r<a||r>n)&&!(t.minAmount&&e<t.minAmount)})})}setCurrentVoucher(e){this.currentVoucher=e,e?P("selectedVoucher",e):I("selectedVoucher")}getCurrentVoucher(){if(!this.currentVoucher)try{this.currentVoucher=A("selectedVoucher")}catch(e){console.error("\u83b7\u53d6\u9009\u4e2d\u793c\u5238\u5931\u8d25:",e)}return this.currentVoucher}markVoucherAsUsed(e,t){const r=this.vouchers.find(t=>t.id===e);r&&(r.status="used",r.usedAt=(new Date).toISOString(),r.orderNo=t),this.setCurrentVoucher(null)}isNewUser(){const e=Q();if(!e||!e.discountRate)return!1;const t=Math.round(100*(1-e.discountRate));return t>=30}getNewUserVoucherInfo(){const e=Q();if(!e||!e.discountRate||e.discountRate>=1)return{hasVoucher:!1};const t=Math.round(100*(1-e.discountRate));return{hasVoucher:!0,discountPercentage:t,description:`\u606d\u559c\u83b7\u5f97\u65b0\u4eba\u4e13\u4eab${t}%\u4f18\u60e0\u5238\uff01`}}}const Ie=new fe,we=e=>e?e.includes("T")?e:e.replace(" ","T"):null,ve=e=>{if(!e)return null;const t=we(e);if(!t)return null;const r=new Date(t);return isNaN(r.getTime())?(console.warn("\u26a0\ufe0f \u65e0\u6548\u7684\u65e5\u671f\u683c\u5f0f:",e),null):r},Se=(e=new Date)=>{const t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${a}`},Ne=()=>Se(),Ee=[{id:"1",name:"\u9888\u80a9\u8170\u817f\u75db\u8c03\u7406",order:1},{id:"2",name:"\u809d\u80c6\u813e\u80c3\u8c03\u7406",order:2},{id:"3",name:"\u5931\u7720\u8c03\u7406",order:3},{id:"4",name:"\u5bab\u5bd2\u75db\u7ecf\u8c03\u7406",order:4},{id:"5",name:"\u8159\u7b4b\u6839\u9ab6",order:5},{id:"6",name:"\u8fd0\u52a8\u62c9\u4f38",order:6},{id:"7",name:"\u4f53\u6001\u8c03\u7406",order:7}];function Ae(e){return e.includes("\u7cbe\u6cb9")||e.includes("SPA")||e.includes("\u82b3\u9999")?"7":e.includes("\u9888\u80a9")||e.includes("\u8170\u80cc")||e.includes("\u8170\u817f\u75db")||e.includes("\u7279\u8272\u8c03\u7406")?"1":e.includes("\u809d")||e.includes("\u8212\u809d")||e.includes("\u80ba")||e.includes("\u813e\u80c3")?"2":e.includes("\u94fa\u59dc")||e.includes("\u5bab\u5bd2")?"4":e.includes("\u62d4\u7f50")||e.includes("\u522e\u75e7")?"5":e.includes("\u6574\u810a")||e.includes("\u4f53\u6001")?"7":e.includes("\u5173\u5143\u7078")||e.includes("\u60ac\u7078")?"2":e.includes("\u5168\u8eab")||e.includes("\u653e\u677e")||e.includes("\u6df1\u5ea6")?"3":e.includes("\u808c\u8089")||e.includes("\u758f\u901a")||e.includes("\u62c9\u4f38")?"6":"1"}const De={getCategories(){return l(this,null,function*(){return{code:200,data:Ee,message:"success"}})},getTherapistSymptomServices(e){return l(this,null,function*(){if(!e)throw new Error("\u63a8\u62ff\u5e08ID\u4e0d\u80fd\u4e3a\u7a7a");try{const t=yield k(`/therapists/${e}`),r=t.data;if(!r||!r.storeId)return console.error(`\u63a8\u62ff\u5e08 ${e} \u7684\u95e8\u5e97\u4fe1\u606f\u4e0d\u5b58\u5728`),{code:200,data:[],message:"success"};const a=yield k(`/stores/${r.storeId}`),n=a.data.services||[],o=n.map(e=>c(i({},e),{categoryId:Ae(e.name),availability:"available",description:e.name}));return console.log(`\u2705 \u83b7\u53d6\u63a8\u62ff\u5e08 ${e} \u7684\u670d\u52a1\u5217\u8868\u6210\u529f\uff0c\u5171 ${o.length} \u4e2a\u670d\u52a1`),{code:200,data:o,message:"success"}}catch(t){return console.error(`\u274c \u83b7\u53d6\u63a8\u62ff\u5e08 ${e} \u7684\u670d\u52a1\u5931\u8d25:`,t.message),{code:200,data:[],message:"success"}}})},getStoreSymptomServices(e){return l(this,null,function*(){if(!e)throw new Error("\u95e8\u5e97ID\u4e0d\u80fd\u4e3a\u7a7a");try{const t=yield k(`/stores/${e}`),r=t.data.services||[],a=r.map(e=>c(i({},e),{categoryId:Ae(e.name),availability:"available",description:e.name}));return console.log(`\u2705 \u83b7\u53d6\u95e8\u5e97 ${e} \u7684\u670d\u52a1\u5217\u8868\u6210\u529f\uff0c\u5171 ${a.length} \u4e2a\u670d\u52a1`),{code:200,data:a,message:"success"}}catch(t){return console.error(`\u274c \u83b7\u53d6\u95e8\u5e97 ${e} \u7684\u670d\u52a1\u5931\u8d25:`,t.message),{code:200,data:[],message:"success"}}})},getServicesByCategory(e,t){return l(this,null,function*(){if(!e)throw new Error("\u63a8\u62ff\u5e08ID\u4e0d\u80fd\u4e3a\u7a7a");const r=yield this.getTherapistSymptomServices(e),a=r.data||[],n=a.filter(e=>e.categoryId===t);return{code:200,data:n,message:"success"}})}},Te=({items:e,therapist:t,onCheckout:r,onMaskClick:a,onRemoveItem:n})=>{const[o,s]=b.useState(!1),[i,c]=b.useState(180),l=b.useRef(null),d=e.reduce((e,t)=>e+t.price,0),u=e.reduce((e,t)=>e+(t.discountPrice||t.price),0),h=d-u,p=e.length>0;b.useEffect(()=>(p&&o?l.current=setInterval(()=>{c(e=>e<=1?(clearInterval(l.current),T({title:"\u652f\u4ed8\u8d85\u65f6\u4e86\u5466\uff0c\u5feb\u5feb\u91cd\u65b0\u4e0b\u5355\u5427~",icon:"none"}),s(!1),180):e-1)},1e3):l.current&&clearInterval(l.current),()=>{l.current&&clearInterval(l.current)}),[p,o]);const m=e=>{const t=Math.floor(e/60),r=e%60;return`${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},g=e=>{const t=new Date(e),r=new Date,a=t.toDateString()===r.toDateString();if(a)return"\u4eca\u5929";const n=t.getMonth()+1,o=t.getDate();return`${n}\u6708${o}\u65e5`},y=()=>{p?s(!0):T({title:"\u8bf7\u5148\u9009\u62e9\u670d\u52a1",icon:"none"})},f=()=>{a&&a(),s(!1)},I=()=>{r()};return w.jsxs(w.Fragment,{children:[o&&w.jsx(v,{className:"cart-mask",onClick:f}),w.jsx(v,{className:"shopping-cart",children:w.jsxs(v,{className:"cart-bar",children:[w.jsx(v,{className:"cart-info",children:p?w.jsxs(w.Fragment,{children:[w.jsxs(S,{className:"total-price",children:["\xa5",u]}),h>0&&w.jsxs(S,{className:"savings",children:["\u5df2\u4f18\u60e0\xa5",h]})]}):w.jsx(S,{className:"empty-text",children:"\u8bf7\u9009\u62e9\u670d\u52a1\u9879\u76ee"})}),w.jsx(v,{className:"checkout-btn "+(p?"":"disabled"),onClick:y,children:"\u53bb\u7ed3\u7b97"})]})}),o&&w.jsxs(v,{className:"cart-expanded",children:[w.jsx(v,{className:"expanded-header",children:w.jsx(S,{className:"title",children:"\u9884\u7ea6\u8be6\u60c5"})}),w.jsx(v,{className:"service-list",children:e.map((e,r)=>w.jsxs(v,{className:"service-item",children:[w.jsx(R,{className:"therapist-avatar",src:e.therapistAvatar||(null==t?void 0:t.avatar)||""}),w.jsxs(v,{className:"service-info",children:[w.jsxs(v,{className:"info-header",children:[w.jsx(S,{className:"therapist-name",children:e.therapistName}),w.jsxs(S,{className:"duration",children:[e.duration,"\u5206\u949f"]})]}),w.jsx(v,{className:"info-detail",children:w.jsx(S,{className:"service-name",children:e.serviceName})}),w.jsx(v,{className:"info-time",children:w.jsxs(S,{className:"time-text",children:[g(e.date)," ",e.time," \u81f3 ",(()=>{const[t,r]=e.time.split(":").map(Number),a=r+e.duration,n=t+Math.floor(a/60),o=a%60;return`${n}:${o.toString().padStart(2,"0")}`})()]})})]}),w.jsxs(v,{className:"item-actions",children:[w.jsx(v,{className:"price-info",children:w.jsxs(S,{className:"price",children:["\xa5",e.discountPrice||e.price]})}),n&&w.jsx(v,{className:"remove-btn",onClick:()=>n(r),children:"\u2715"})]})]},r))}),w.jsxs(v,{className:"checkout-section",children:[w.jsxs(v,{className:"price-summary",children:[w.jsxs(v,{className:"cart-icon",children:[w.jsx(S,{className:"icon",children:"\ud83d\uded2"}),w.jsx(v,{className:"badge",children:"1"})]}),w.jsxs(v,{className:"price-detail",children:[w.jsxs(S,{className:"final-price",children:["\xa5 ",u]}),d>u&&w.jsxs(S,{className:"original-price",children:["\xa5 ",d]})]}),w.jsx(S,{className:"discount-tip",children:"\u5df2\u4eab\u53d7\u6700\u5927\u4f18\u60e0\u51cf20\u5143"})]}),w.jsxs(v,{className:"checkout-footer",children:[w.jsxs(S,{className:"countdown",children:["\u652f\u4ed8\u5012\u8ba1\u65f6: ",m(i)]}),w.jsx(v,{className:"confirm-btn",onClick:I,children:"\u53bb\u7ed3\u7b97"})]})]})]})]})};class xe{getUserInfo(){return{userId:J(),userPhone:ee()}}getDisplayStatus(e){if("pending"===e.paymentStatus)return"pending";if("cancelled"===e.paymentStatus||"refunded"===e.paymentStatus)return e.paymentStatus;if("paid"===e.paymentStatus&&"service"===e.orderType){if(e.appointmentStatus)switch(e.appointmentStatus){case"completed":return"completed";case"serving":return"serving";case"cancelled":return"cancelled";case"pending":case"confirmed":default:return"paid"}if(e.appointmentDate&&e.startTime){const t=new Date(`${e.appointmentDate} ${e.startTime}`),r=new Date(t.getTime()+6e4*(e.duration||60)),a=new Date;if(r<a)return"paid"}}return e.paymentStatus}enrichOrderWithStoreAndTherapistInfo(e){return l(this,null,function*(){try{const t=[];e.storeId&&!e.storeName&&t.push(V(`/stores/${e.storeId}`).then(t=>{const r=t.data;e.storeName=r.name,e.storeAddress=r.address}).catch(t=>l(this,null,function*(){console.error(`\u83b7\u53d6\u95e8\u5e97\u4fe1\u606f\u5931\u8d25 (storeId: ${e.storeId}):`,t);const r=yield this.getDefaultStoreInfo();r?(e.storeName=`${r.name}\uff08\u66ff\u4ee3\u663e\u793a\uff09`,e.storeAddress=r.address):(e.storeName="\u95e8\u5e97\u4fe1\u606f\u6682\u65f6\u65e0\u6cd5\u83b7\u53d6",e.storeAddress="\u8bf7\u8054\u7cfb\u5ba2\u670d\u83b7\u53d6\u8be6\u60c5")}))),e.therapistId&&!e.therapistAvatar&&t.push(V(`/therapists/${e.therapistId}`).then(t=>{const r=t.data;e.therapistAvatar=r.avatar,e.therapistName||(e.therapistName=r.name)}).catch(t=>{console.error(`\u83b7\u53d6\u6280\u5e08\u4fe1\u606f\u5931\u8d25 (therapistId: ${e.therapistId}):`,t),e.therapistAvatar||(e.therapistAvatar="https://img.yzcdn.cn/vant/cat.jpeg")})),t.length>0&&(yield Promise.allSettled(t))}catch(t){console.error("\u8865\u5168\u8ba2\u5355\u4fe1\u606f\u5931\u8d25:",t)}})}getDefaultStoreInfo(){return l(this,null,function*(){var e,t;try{const r=yield V("/stores/nearby",{page:1,pageSize:1});if(null==(t=null==(e=r.data)?void 0:e.list)?void 0:t[0]){const e=r.data.list[0];return{name:e.name,address:e.address}}}catch(r){console.error("\u83b7\u53d6\u9ed8\u8ba4\u95e8\u5e97\u4fe1\u606f\u5931\u8d25:",r)}return null})}enrichOrderListWithStoreAndTherapistInfo(e){return l(this,null,function*(){try{const t=new Set,r=new Set;e.forEach(e=>{e.storeId&&!e.storeName&&t.add(e.storeId.toString()),e.therapistId&&!e.therapistAvatar&&r.add(e.therapistId.toString())});const a=[],n=new Map,o=new Map,s=new Set;Array.from(t).forEach(e=>{a.push(V(`/stores/${e}`).then(t=>{n.set(e,t.data)}).catch(t=>{console.warn(`\u95e8\u5e97\u4e0d\u5b58\u5728\uff0c\u5c06\u8fc7\u6ee4\u76f8\u5173\u8ba2\u5355 (storeId: ${e}):`,t.message),s.add(e)}))}),Array.from(r).forEach(e=>{a.push(V(`/therapists/${e}`).then(t=>{o.set(e,t.data)}).catch(t=>{console.error(`\u6279\u91cf\u83b7\u53d6\u6280\u5e08\u4fe1\u606f\u5931\u8d25 (therapistId: ${e}):`,t)}))}),a.length>0&&(yield Promise.allSettled(a));const i=e.filter(e=>!e.storeId||!s.has(e.storeId.toString())||(console.warn(`\u8fc7\u6ee4\u65e0\u6548\u8ba2\u5355: ${e.orderNo}\uff08\u95e8\u5e97 ${e.storeId} \u4e0d\u5b58\u5728\uff09`),!1));return i.forEach(e=>{if(e.storeId&&!e.storeName){const t=n.get(e.storeId.toString());t&&(e.storeName=t.name,e.storeAddress=t.address)}if(e.therapistId&&!e.therapistAvatar){const t=o.get(e.therapistId.toString());t?(e.therapistAvatar=t.avatar,e.therapistName||(e.therapistName=t.name)):e.therapistAvatar="https://img.yzcdn.cn/vant/cat.jpeg"}}),i}catch(t){return console.error("\u6279\u91cf\u8865\u5168\u8ba2\u5355\u5217\u8868\u4fe1\u606f\u5931\u8d25:",t),e}})}createAppointmentOrder(e){return l(this,null,function*(){try{const t=oe();if(!t)throw new Error("\u8bf7\u5148\u767b\u5f55");const{userId:r,userPhone:a}=this.getUserInfo();console.log("\ud83d\udcdd \u521b\u5efa\u8ba2\u5355\u539f\u59cb\u53c2\u6570:",e),console.log("\ud83d\udcdd therapistId\u7c7b\u578b:",typeof e.therapistId,"\u503c:",e.therapistId);const n={therapistId:Number(e.therapistId),storeId:Number(e.storeId),userId:r,userPhone:a,appointmentDate:e.appointmentDate,startTime:e.appointmentTime,duration:e.duration||60,serviceId:e.serviceId,serviceName:e.serviceName,price:100*(e.discountPrice||e.price),paymentMethod:e.paymentMethod};console.log("\ud83d\udce4 \u5b9e\u9645\u53d1\u9001\u7684\u8bf7\u6c42\u6570\u636e:",n),console.log("\ud83d\udce4 \u8f6c\u6362\u540e\u7684therapistId:",n.therapistId,"\u662f\u5426\u4e3aNaN:",isNaN(n.therapistId)),console.log("\ud83d\udce4 \u652f\u4ed8\u65b9\u5f0f:",n.paymentMethod);const o=yield z("/appointments/create-with-order",n,{showLoading:!0,loadingTitle:"\u521b\u5efa\u8ba2\u5355\u4e2d..."}),s=c(i({},o.data.order),{therapistName:e.therapistName,therapistAvatar:e.therapistAvatar,serviceName:e.serviceName,duration:e.duration,appointmentDate:e.appointmentDate,startTime:e.appointmentTime});return{order:s,appointment:o.data.appointment}}catch(t){throw console.error("\u521b\u5efa\u8ba2\u5355\u5931\u8d25:",t),new Error(t.message||"\u521b\u5efa\u8ba2\u5355\u5931\u8d25")}})}getPaymentParams(e){return l(this,null,function*(){var t,r,a;try{const a=yield V(`/orders/${e}/payment-params`);if(console.log("\ud83d\udcb3 \u540e\u7aef\u652f\u4ed8\u53c2\u6570\u54cd\u5e94:",a.data),a.data.wxPayParams){const e=a.data.wxPayParams;return!e.total_fee&&a.data.amount&&(e.total_fee=a.data.amount),console.log("\ud83d\udcb3 \u5fae\u4fe1\u652f\u4ed8\u53c2\u6570\u5df2\u63d0\u53d6:",{timeStamp:e.timeStamp,nonceStr:(null==(t=e.nonceStr)?void 0:t.substring(0,8))+"...",package:e.package,signType:e.signType,paySign:(null==(r=e.paySign)?void 0:r.substring(0,16))+"...",total_fee:e.total_fee}),e}return console.log("\ud83d\udcb0 \u4f59\u989d\u652f\u4ed8\u8ba2\u5355\uff0c\u65e0\u9700\u5fae\u4fe1\u652f\u4ed8\u53c2\u6570"),null}catch(n){throw console.error("\ud83d\udcb3 \u83b7\u53d6\u652f\u4ed8\u53c2\u6570\u5931\u8d25:",n),console.error("\ud83d\udcb3 \u9519\u8bef\u8be6\u60c5:",{message:n.message,response:null==(a=n.response)?void 0:a.data}),new Error("\u83b7\u53d6\u652f\u4ed8\u53c2\u6570\u5931\u8d25")}})}updateOrderStatus(e,t){return l(this,null,function*(){try{const t=yield z("/orders/pay",{orderNo:e,paymentMethod:"balance"});return{orderNo:e,paymentStatus:"paid",paidAt:t.data.paidAt||(new Date).toISOString()}}catch(t){throw console.error("\u66f4\u65b0\u8ba2\u5355\u72b6\u6001\u5931\u8d25:",t),new Error(t.message||"\u652f\u4ed8\u5931\u8d25")}})}getOrderDetail(e){return l(this,null,function*(){try{const t=yield V(`/orders/${e}`),r=t.data;return r.extraData&&(r.appointmentId=r.extraData.appointmentId,r.therapistId=r.extraData.therapistId,r.therapistName=r.extraData.therapistName,r.therapistAvatar=B(r.extraData.therapistAvatar),r.storeId=r.extraData.storeId,r.appointmentDate=r.extraData.appointmentDate,r.startTime=r.extraData.startTime,r.duration=r.extraData.duration,r.serviceName=r.extraData.serviceName||r.title,r.appointmentStatus=r.extraData.appointmentStatus,yield this.enrichOrderWithStoreAndTherapistInfo(r)),r.displayStatus=this.getDisplayStatus(r),r}catch(t){throw console.error("\u83b7\u53d6\u8ba2\u5355\u8be6\u60c5\u5931\u8d25:",t),new Error("\u8ba2\u5355\u4e0d\u5b58\u5728\u6216\u5df2\u5220\u9664")}})}getOrderList(e,t,r=1,a=20){return l(this,null,function*(){try{const{userId:n}=this.getUserInfo(),o={userId:n,page:r,pageSize:a};e&&(o.status=e),t&&(o.orderType=t);const s=yield V("/orders",o),i=s.data.list.map(e=>(e.extraData&&(e.appointmentId=e.extraData.appointmentId,e.therapistId=e.extraData.therapistId,e.therapistName=e.extraData.therapistName,e.therapistAvatar=B(e.extraData.therapistAvatar),e.storeId=e.extraData.storeId,e.storeName=e.extraData.storeName,e.storeAddress=e.extraData.storeAddress,e.appointmentDate=e.extraData.appointmentDate,e.startTime=e.extraData.startTime,e.duration=e.extraData.duration,e.serviceName=e.extraData.serviceName||e.title,e.appointmentStatus=e.extraData.appointmentStatus),e.displayStatus=this.getDisplayStatus(e),e)),c=yield this.enrichOrderListWithStoreAndTherapistInfo(i);return c}catch(n){return console.error("\u83b7\u53d6\u8ba2\u5355\u5217\u8868\u5931\u8d25:",n),[]}})}cancelOrder(e,t="\u7528\u6237\u53d6\u6d88"){return l(this,null,function*(){try{const{userId:r}=this.getUserInfo(),a=yield z("/orders/cancel",{orderNo:e,userId:r,reason:t},{showLoading:!0,loadingTitle:"\u53d6\u6d88\u4e2d..."});return a.data}catch(r){throw console.error("\u53d6\u6d88\u8ba2\u5355\u5931\u8d25:",r),new Error(r.message||"\u53d6\u6d88\u8ba2\u5355\u5931\u8d25")}})}requestRefund(e,t){return l(this,null,function*(){try{const{userId:r}=this.getUserInfo(),a=yield z(`/orders/${e}/refund`,{userId:r,reason:t||"\u7528\u6237\u7533\u8bf7\u9000\u6b3e"},{showLoading:!0,loadingTitle:"\u7533\u8bf7\u9000\u6b3e\u4e2d..."});return a.data}catch(r){throw console.error("\u7533\u8bf7\u9000\u6b3e\u5931\u8d25:",r),new Error(r.message||"\u7533\u8bf7\u9000\u6b3e\u5931\u8d25")}})}getRefundDetail(e){return l(this,null,function*(){try{const t=yield V(`/refunds/${e}`);return t.data}catch(t){throw console.error("\u83b7\u53d6\u9000\u6b3e\u8be6\u60c5\u5931\u8d25:",t),new Error("\u9000\u6b3e\u5355\u4e0d\u5b58\u5728\u6216\u5df2\u5220\u9664")}})}rebookOrder(e){return l(this,null,function*(){try{const t=yield this.getOrderDetail(e);return P("rebookOrderInfo",{therapistId:t.therapistId,therapistName:t.therapistName,storeId:t.storeId,storeName:t.storeName,serviceId:t.serviceId,serviceName:t.serviceName,duration:t.duration}),!0}catch(t){return console.error("\u91cd\u65b0\u9884\u7ea6\u5931\u8d25:",t),!1}})}getOrderStatistics(){return l(this,null,function*(){try{const{userId:e}=this.getUserInfo(),t=yield V("/orders",{userId:e,page:1,pageSize:100}),r=t.data.list;return{total:r.length,pendingPayment:r.filter(e=>"pending"===e.paymentStatus).length,paid:r.filter(e=>"paid"===e.paymentStatus).length,completed:r.filter(e=>"paid"===e.paymentStatus&&new Date(e.appointmentDate+" "+e.startTime)<new Date).length,cancelled:r.filter(e=>"cancelled"===e.paymentStatus).length}}catch(e){return console.error("\u83b7\u53d6\u8ba2\u5355\u7edf\u8ba1\u5931\u8d25:",e),{total:0,pendingPayment:0,paid:0,completed:0,cancelled:0}}})}}const Pe=new xe;class be{constructor(){this.config={useMockPayment:!1,enableBalancePayment:!0,enableWechatPayment:!0}}pay(e){return l(this,null,function*(){const{paymentMethod:t}=e;if("balance"===t)return this.payWithBalance(e);if("wechat"===t)return this.payWithWechat(e);throw new Error("\u4e0d\u652f\u6301\u7684\u652f\u4ed8\u65b9\u5f0f")})}payWithBalance(e){return l(this,null,function*(){try{const t=oe();if(!t)return T({title:"\u8bf7\u5148\u767b\u5f55",icon:"none"}),!1;g({title:"\u652f\u4ed8\u4e2d..."}),console.log("\ud83d\udcb0 \u4f59\u989d\u652f\u4ed8\u8bf7\u6c42\u53c2\u6570:",{orderNo:e.orderNo,paymentMethod:"balance"});const r=yield z("/orders/pay",{orderNo:e.orderNo,paymentMethod:"balance"});if(console.log("\ud83d\udcb0 \u4f59\u989d\u652f\u4ed8\u54cd\u5e94:",r),f(),0===r.code){const e=(r.data.balance||0)/100;return T({title:`\u652f\u4ed8\u6210\u529f\n\u4f59\u989d\uff1a\xa5${e.toFixed(2)}`,icon:"success",duration:2e3}),!0}throw new Error(r.message||"\u4f59\u989d\u4e0d\u8db3")}catch(t){return console.error("\ud83d\udcb0 \u4f59\u989d\u652f\u4ed8\u5931\u8d25:",t),console.error("\ud83d\udcb0 \u9519\u8bef\u8be6\u60c5:",t.response||t.message),f(),T({title:t.message||"\u652f\u4ed8\u5931\u8d25",icon:"none"}),!1}})}payWithWechat(e){return l(this,null,function*(){var t,r;try{console.log("\ud83d\udcb3 \u5f00\u59cb\u771f\u5b9e\u5fae\u4fe1\u652f\u4ed8\uff0c\u8ba2\u5355\u53f7:",e.orderNo);const a=e.wxPayParams;if(!a)throw new Error("\u7f3a\u5c11\u5fae\u4fe1\u652f\u4ed8\u53c2\u6570\uff0c\u8bf7\u5148\u521b\u5efa\u8ba2\u5355");const n=["timeStamp","nonceStr","package","signType","paySign"],o=n.filter(e=>!a[e]);if(o.length>0)throw console.error("\u274c \u5fae\u4fe1\u652f\u4ed8\u53c2\u6570\u4e0d\u5b8c\u6574\uff0c\u7f3a\u5c11\u5b57\u6bb5:",o),new Error(`\u5fae\u4fe1\u652f\u4ed8\u53c2\u6570\u7f3a\u5931: ${o.join(", ")}`);return console.log("\ud83d\udcb3 \u5fae\u4fe1\u652f\u4ed8\u53c2\u6570:",{timeStamp:a.timeStamp,nonceStr:(null==(t=a.nonceStr)?void 0:t.substring(0,8))+"...",package:a.package,signType:a.signType,paySign:(null==(r=a.paySign)?void 0:r.substring(0,16))+"..."}),yield $({timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign}),console.log("\ud83d\udcb3 \u7528\u6237\u5b8c\u6210\u652f\u4ed8\uff0c\u7b49\u5f85\u5fae\u4fe1\u56de\u8c03\u540e\u7aef\u66f4\u65b0\u8ba2\u5355\u72b6\u6001"),T({title:"\u652f\u4ed8\u6210\u529f",icon:"success"}),!0}catch(a){if("requestPayment:fail cancel"===a.errMsg)return console.log("\ud83d\udcb3 \u7528\u6237\u53d6\u6d88\u652f\u4ed8"),!1;throw console.error("\ud83d\udcb3 \u5fae\u4fe1\u652f\u4ed8\u5931\u8d25:",a),console.error("\ud83d\udcb3 \u9519\u8bef\u8be6\u60c5:",{errMsg:a.errMsg,errCode:a.errCode,message:a.message}),T({title:a.errMsg||a.message||"\u652f\u4ed8\u5931\u8d25",icon:"none",duration:3e3}),a}})}checkPaymentEnvironment(){return l(this,null,function*(){return{canUseWechatPay:this.config.enableWechatPayment,canUseBalance:this.config.enableBalancePayment,message:"\u652f\u6301\u5fae\u4fe1\u652f\u4ed8\u548c\u4f59\u989d\u652f\u4ed8"}})}generateRechargeCode(e){return l(this,null,function*(){const t=yield z("/recharge/generate-code",{amount:e});return t.data})}delay(e){return new Promise(t=>setTimeout(t,e))}}const Re=new be;function $e(e){return e||0===e?Math.round(e)/100:0}function Oe(e,t){const{symbol:r="\uffe5",suffix:a="\u5143",precision:n=2}=t||{};if(void 0===e||null===e)return`${r}0.00${a}`;if("number"!==typeof e||isNaN(e))return console.warn("\u26a0\ufe0f formatAmount: \u65e0\u6548\u7684\u91d1\u989d\u8f93\u5165",{amountInCents:e,type:typeof e}),`${r}0.00${a}`;const o=$e(e);return isNaN(o)?(console.error("\u274c formatAmount: \u91d1\u989d\u8f6c\u6362\u7ed3\u679c\u4e3aNaN",{amountInCents:e,yuan:o}),`${r}0.00${a}`):`${r}${o.toFixed(n)}${a}`}export{H as B,he as G,Te as S,te as a,Q as b,ie as c,ae as d,Ne as e,ne as f,M as g,Se as h,De as i,se as j,Re as k,ye as l,re as m,B as n,Pe as o,z as p,Oe as q,K as r,W as s,X as t,ve as u,Ie as v,me as w};
