var e=(e,s,a)=>new Promise((c,l)=>{var r=e=>{try{t(a.next(e))}catch(s){l(s)}},n=e=>{try{t(a.throw(e))}catch(s){l(s)}},t=e=>e.done?c(e.value):Promise.resolve(e.value).then(r,n);t((a=a.apply(e,s)).next())});import{t as s,n as a,j as c,V as l,I as r,T as n,C as t,E as o,k as i,h as d}from"./vendors.fcaa4701.js";import{G as m,k as u}from"./common.326c60a3.js";const h=()=>{const h=s.useRouter(),{cardId:x}=h.params,[j,N]=a.useState(null),[p,g]=a.useState(1e3),[v,f]=a.useState(1);a.useEffect(()=>{if(console.log("\ud83c\udf81 \u7535\u5b50\u793c\u5361\u9875\u9762\u52a0\u8f7d"),console.log("\ud83d\udccd router.params:",{cardId:x}),x){const e=m.getGiftCardById(x);console.log("\ud83d\udd0d \u67e5\u8be2\u793c\u5361\u7ed3\u679c:",{cardId:x,found:!!e,card:e?{id:e.id,name:e.name,image:e.image,type:e.type}:null}),e?(N(e),console.log("\u2705 \u793c\u5361\u4fe1\u606f\u5df2\u8bbe\u7f6e")):console.warn("\u26a0\ufe0f \u793c\u5361\u672a\u627e\u5230:",x)}else console.warn("\u26a0\ufe0f cardId \u672a\u83b7\u53d6\u5230:",x)},[x]);const y=[{value:1e3,label:"\xa51000",bonus:"\u9001100"},{value:3e3,label:"\xa53000",bonus:"\u9001500"}],b=e=>{g(e)},k=e=>{f(e)},w=()=>e(void 0,null,function*(){const e=p;if(e)try{const a=yield m.createGiftCardOrder({cardId:x,amount:100*e,quantity:v,paymentMethod:"wechat",customMessage:"\u4e16\u754c\u4e0a\u6700\u597d\u7684\u7238\u7238"});console.log("\ud83c\udf81 \u8ba2\u5355\u521b\u5efa\u6210\u529f\uff0c\u51c6\u5907\u652f\u4ed8:",{orderNo:a.orderNo,amount:e*v,quantity:v});const c=yield u.pay({orderNo:a.orderNo,amount:e*v*100,paymentMethod:"wechat",title:`\u7535\u5b50\u793c\u5361 \xa5${e} \xd7 ${v}`,wxPayParams:a.wxPayParams});c&&(i({title:"\u652f\u4ed8\u6210\u529f",icon:"success",duration:1500}),setTimeout(()=>{s.navigateBack()},1500))}catch(a){console.error("\u274c \u793c\u5361\u8d2d\u4e70\u5931\u8d25:",a),d(),i({title:a.message||"\u8d2d\u4e70\u5931\u8d25",icon:"none"})}else i({title:"\u8bf7\u9009\u62e9\u9762\u989d",icon:"none"})}),P=()=>p*v;return j?c.jsxs(l,{className:"gift-card-purchase",children:[c.jsxs(l,{className:"card-info-section",children:[c.jsx(l,{className:"card-image",children:c.jsx(r,{className:"card-pic",src:j.image,mode:"aspectFill"})}),c.jsx(n,{className:"card-name",children:j.name}),c.jsx(n,{className:"card-desc",children:j.description})]}),c.jsxs(l,{className:"features-section",children:[c.jsx(n,{className:"section-title",children:"\u793c\u5361\u7279\u8272"}),c.jsx(l,{className:"features-list",children:j.features.map((e,s)=>c.jsxs(l,{className:"feature-item",children:[c.jsx(t,{value:"check-circle",size:"18",color:"#a40035"}),c.jsx(n,{className:"feature-text",children:e})]},s))})]}),c.jsxs(l,{className:"amount-section",children:[c.jsx(n,{className:"section-title",children:"\u8bf7\u9009\u62e9\u9762\u989d"}),c.jsx(l,{className:"amount-grid",children:y.map(e=>c.jsxs(l,{className:"amount-card "+(p===e.value?"active":""),onClick:()=>b(e.value),children:[c.jsx(l,{className:"amount-header",children:c.jsx(n,{className:"amount",children:e.label})}),c.jsx(l,{className:"amount-details",children:c.jsx(n,{className:"bonus",children:e.bonus})}),p===e.value&&c.jsxs(l,{className:"quantity-control",children:[c.jsx(t,{value:"subtract-circle",size:"20",color:"#999",onClick:e=>{e.stopPropagation(),v>1&&k(v-1)}}),c.jsx(n,{className:"quantity",children:v}),c.jsx(t,{value:"add-circle",size:"20",color:"#a40035",onClick:e=>{e.stopPropagation(),k(v+1)}})]}),p!==e.value&&c.jsx(t,{value:"add-circle",size:"24",color:"#a40035"})]},e.value))})]}),c.jsxs(l,{className:"rules-section",children:[c.jsx(n,{className:"section-title",children:"\u4f7f\u7528\u8bf4\u660e"}),c.jsxs(l,{className:"rules-content",children:[c.jsx(n,{className:"rule-item",children:j.terms}),c.jsx(n,{className:"rule-desc",style:{marginTop:"16px"},children:"\u8fd4\u91d1\u989d\u8bf4\u660e\uff1a"}),c.jsx(n,{className:"rule-item",children:"(1) \u7535\u5b50\u5361\u8fd4\u4f59\u989d\u5728\u793c\u5361\u5206\u4eab\u6210\u529f\u540e\uff0c\u81ea\u52a8\u5145\u503c\u81f3\u8d2d\u4e70\u4eba\u7684\u5e38\u4e50\u63a8\u62ff\u4f1a\u5458\u4f59\u989d\u4e2d\u3002"})]})]}),c.jsxs(l,{className:"purchase-bar",children:[c.jsxs(l,{className:"price-info",children:[c.jsx(t,{value:"shopping-bag-2",size:"24",color:"#a40035"}),c.jsxs(n,{className:"total-price",children:["\xa5 ",P()]}),c.jsx(l,{className:"quantity-badge",children:v})]}),c.jsx(o,{className:"purchase-btn",onClick:w,children:"\u53bb\u7ed3\u7b97"})]})]}):c.jsx(l,{className:"gift-card-purchase",children:c.jsx(l,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})})};export{h as default};
