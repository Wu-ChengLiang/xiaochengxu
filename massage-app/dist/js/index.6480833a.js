var e=(e,s,t)=>new Promise((a,n)=>{var l=e=>{try{i(t.next(e))}catch(s){n(s)}},c=e=>{try{i(t.throw(e))}catch(s){n(s)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,c);i((t=t.apply(e,s)).next())});import{a as s,x as t,j as a,V as n,P as l,y as c,T as i,w as r,q as o,I as d,z as m,B as h,C as u}from"./vendors.b1a33877.js";import{s as x}from"./common.d37aa707.js";const j=({onTimeChange:e,defaultValue:r})=>{const[o,d]=s.useState([]),[m,h]=s.useState([]),[u,x]=s.useState([]),[j,p]=s.useState(()=>{const e=new Date,s=e.getHours(),t=s+1;let a=0;return t>=9&&t<=21?a=t-9:t>21&&(a=0),[2,a,0]});s.useEffect(()=>{N()},[]),s.useEffect(()=>{if(o.length>0&&m.length>0&&u.length>0){const s=o[j[0]],t=m[j[1]],a=u[j[2]];e(s.fullDate,t,a)}},[j,o,m,u]);const N=()=>{const e=[],s=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"];for(let r=-2;r<=2;r++){const a=t().add(r,"day"),n=0===r;e.push({date:n?"\u4eca\u5929":`${a.month()+1}\u6708${a.date()}\u65e5`,weekday:n?"":s[a.day()],fullDate:a.format("YYYY-MM-DD"),dateObj:a.toDate()})}d(e);const a=[];for(let t=9;t<=21;t++)a.push(`${t}\u70b9`);h(a);const n=[];for(let t=0;t<60;t+=10)n.push(`${t.toString().padStart(2,"0")}\u5206`);x(n);const l=t(),c=l.hour(),i=c+1;let o=2,m=1,u=0;i>=9&&i<=21?m=i-9:i>21?(o=3,m=0):m=0;const j=r?[r.date,r.hour,r.minute]:[o,m,u];p(j)},f=e=>{const{value:s}=e.detail;p(s)};return a.jsx(n,{className:"time-picker-scroller",children:a.jsxs(l,{indicatorStyle:"height: 50px; background-color: rgba(0,0,0,0.05);",style:{width:"100%",height:"200px"},value:j,onChange:f,children:[a.jsx(c,{children:o.map((e,s)=>a.jsxs(n,{className:"picker-item date-item",children:[a.jsx(i,{className:"date-text "+("\u4eca\u5929"===e.date?"today":""),children:e.date}),e.weekday&&a.jsx(i,{className:"weekday-text",children:e.weekday})]},s))}),a.jsx(c,{children:m.map((e,s)=>a.jsx(n,{className:"picker-item hour-item",children:a.jsx(i,{className:"hour-text",children:e})},s))}),a.jsx(c,{children:u.map((e,s)=>a.jsx(n,{className:"picker-item minute-item",children:a.jsx(i,{className:"minute-text",children:e})},s))})]})})},p=()=>{const t=r.useRouter(),{id:l}=t.params,[c,p]=s.useState(null),[N,f]=s.useState(""),[g,y]=s.useState(""),[b,S]=s.useState(""),[v,k]=s.useState(!0);s.useEffect(()=>{$()},[l]);const $=()=>e(void 0,null,function*(){try{const e=yield x.getStoreDetail(l);p(e.data)}catch(e){o({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{k(!1)}}),w=(e,s,t)=>{f(e),y(s),S(t)},D=()=>{(null==c?void 0:c.phone)&&h({phoneNumber:c.phone})},C=()=>{(null==c?void 0:c.location)&&u({latitude:c.location.latitude,longitude:c.location.longitude,name:c.name,address:c.address})},T=()=>{if(!g||!b)return void o({title:"\u8bf7\u9009\u62e9\u9884\u7ea6\u65f6\u95f4",icon:"none"});const e=`${g.replace("\u70b9","")}:${b.replace("\u5206","")}`,s={storeId:l,storeName:(null==c?void 0:c.name)||"",selectedDate:N,selectedTime:e,from:"store"};r.navigateTo({url:`/pages/appointment/symptom/index?${Object.entries(s).map(([e,s])=>`${e}=${encodeURIComponent(s)}`).join("&")}`})},I=()=>{if(!N||!g||!b)return"\u8bf7\u9009\u62e9\u65f6\u95f4";const e=N===(new Date).toISOString().split("T")[0]?"\u4eca\u5929":N,s=g.replace("\u70b9",""),t=b.replace("\u5206","");return`${e} ${s}:${t}`};return c?a.jsxs(n,{className:"store-appointment-page",children:[a.jsx(n,{className:"store-header",children:a.jsx(d,{className:"store-image",src:c.images[0],mode:"aspectFill"})}),a.jsx(n,{className:"store-info",children:a.jsxs(n,{className:"info-header",children:[a.jsxs(n,{className:"store-details",children:[a.jsxs(n,{className:"name-row",children:[a.jsx(i,{className:"store-name",children:c.name}),a.jsxs(i,{className:"distance",children:[c.distance||9,"km"]})]}),a.jsxs(n,{className:"hours-row",children:[a.jsxs(i,{className:"business-hours",children:[c.businessHours.start,"-",c.businessHours.end]}),a.jsxs(n,{className:`status ${c.status}`,children:["normal"===c.status&&"\u5c31\u8fd1","busy"===c.status&&"\u7e41\u5fd9","full"===c.status&&"\u7206\u6ee1"]})]}),a.jsx(i,{className:"address",children:c.address})]}),a.jsxs(n,{className:"action-buttons",children:[a.jsx(n,{className:"action-btn",onClick:D,children:"\ud83d\udcde"}),a.jsx(n,{className:"action-btn",onClick:C,children:"\ud83d\udccd"})]})]})}),a.jsxs(n,{className:"appointment-section",children:[a.jsx(i,{className:"section-title",children:"\u9884\u7ea6\u65f6\u95f4"}),a.jsxs(n,{className:"promotion-tips",children:[a.jsxs(n,{className:"tip-item main",children:[a.jsx(i,{className:"discount",children:"9.5\u6298"}),a.jsxs(n,{className:"tip-content",children:[a.jsx(i,{className:"tip-title",children:"\u63d0\u524d30\u5206\u949f"}),a.jsx(i,{className:"tip-desc",children:"10:00\u5f00\u59cb"})]})]}),a.jsxs(n,{className:"tip-item",children:[a.jsx(i,{className:"discount",children:"9.0\u6298"}),a.jsx(i,{className:"tip-desc",children:"\u9519\u5cf0\u9884\u7ea6"}),a.jsx(i,{className:"tip-desc",children:"\u70b9\u51fb\u524d\u5f80"})]})]}),a.jsx(j,{onTimeChange:w})]}),a.jsxs(n,{className:"bottom-bar",children:[a.jsxs(i,{className:"selected-time",children:["\u9884\u7ea6\u65f6\u95f4: ",I()]}),a.jsx(m,{className:"submit-btn",type:"primary",onClick:T,disabled:!g||!b,children:"\u9009\u75c7\u72b6"})]})]}):null};export{p as default};
