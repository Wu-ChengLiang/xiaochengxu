"use strict";var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,a=(e,a)=>{for(var n in a||(a={}))s.call(a,n)&&r(e,n,a[n]);if(t)for(var n of t(a))i.call(a,n)&&r(e,n,a[n]);return e},n=(e,t,s)=>new Promise((i,r)=>{var a=e=>{try{o(s.next(e))}catch(t){r(t)}},n=e=>{try{o(s.throw(e))}catch(t){r(t)}},o=e=>e.done?i(e.value):Promise.resolve(e.value).then(a,n);o((s=s.apply(e,t)).next())});const o=require("../../../taro.js"),c=require("../../../common.js"),l="",x=({therapist:e})=>{const[t,s]=o.reactExports.useState(!1),i=a({level:"LV4",rating:e.rating||5,salesCount:e.serviceCount||10109,description:e.description||"\u5f85\u5b8c\u5584"},e),r=()=>{s(!t)};return o.jsxRuntimeExports.jsxs(o.View,{className:"therapist-info",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"therapist-header",children:[o.jsxRuntimeExports.jsx(o.View,{className:"avatar-wrapper",children:o.jsxRuntimeExports.jsx(o.Image,{className:"avatar",src:e.avatar,mode:"aspectFill"})}),o.jsxRuntimeExports.jsxs(o.View,{className:"basic-info",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"name-row",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"name",children:e.name}),o.jsxRuntimeExports.jsx(o.View,{className:"level",children:i.level})]}),o.jsxRuntimeExports.jsxs(o.View,{className:"stats-row",children:[o.jsxRuntimeExports.jsx(o.View,{className:"rating",children:o.jsxRuntimeExports.jsxs(o.Text,{className:"rating-score",children:[i.rating,"\u5206"]})}),o.jsxRuntimeExports.jsx(o.View,{className:"divider",children:"|"}),o.jsxRuntimeExports.jsx(o.View,{className:"sales",children:o.jsxRuntimeExports.jsxs(o.Text,{className:"sales-text",children:["\u9500\u91cf",i.salesCount,"\u5355"]})})]})]})]}),o.jsxRuntimeExports.jsxs(o.View,{className:"description-section",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"description "+(t?"expanded":"collapsed"),children:i.description}),o.jsxRuntimeExports.jsxs(o.View,{className:"expand-toggle",onClick:r,children:[o.jsxRuntimeExports.jsx(o.Text,{className:"expand-text",children:t?"\u6536\u8d77":"\u5c55\u5f00"}),o.jsxRuntimeExports.jsx(o.Text,{className:"expand-icon "+(t?"up":"down"),children:t?"\u25b2":"\u25bc"})]})]})]})},m="",d=({store:e})=>{const t=e=>{switch(e){case"normal":return"\u5c31\u8fd1";case"busy":return"\u7e41\u5fd9";case"full":return"\u7206\u6ee1";default:return""}},s=e=>{switch(e){case"normal":return"status-normal";case"busy":return"status-busy";case"full":return"status-full";default:return""}},i=()=>{e.phone&&o.Taro.makePhoneCall({phoneNumber:e.phone})},r=()=>{e.location&&o.Taro.openLocation({latitude:e.location.latitude,longitude:e.location.longitude,name:e.name,address:e.address})};return o.jsxRuntimeExports.jsx(o.View,{className:"store-info",children:o.jsxRuntimeExports.jsxs(o.View,{className:"store-header",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"store-details",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"name-row",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"store-name",children:e.name}),o.jsxRuntimeExports.jsxs(o.Text,{className:"distance",children:[e.distance||9,"km"]})]}),o.jsxRuntimeExports.jsxs(o.View,{className:"hours-row",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"business-hours",children:e.businessHours?`${e.businessHours.start}-${e.businessHours.end}`:"\u8425\u4e1a\u65f6\u95f4\u672a\u77e5"}),o.jsxRuntimeExports.jsx(o.View,{className:`status ${s(e.status)}`,children:t(e.status)})]}),o.jsxRuntimeExports.jsx(o.Text,{className:"address",children:e.address})]}),o.jsxRuntimeExports.jsxs(o.View,{className:"action-buttons",children:[o.jsxRuntimeExports.jsx(o.View,{className:"action-btn",onClick:i,children:"\ud83d\udcde"}),o.jsxRuntimeExports.jsx(o.View,{className:"action-btn",onClick:r,children:"\ud83d\udccd"})]})]})})},p=[{id:"appointment-001",userId:"user-001",storeId:"store-011",storeName:"\u540d\u533b\u5802\u2022\u9888\u80a9\u8170\u817f\u7279\u8272\u8c03\u7406\uff08\u4e16\u7eaa\u516c\u56ed\u5e97\uff09",therapistId:"therapist-101",therapistName:"\u5b8b\u8001\u5e08",serviceId:"service-001",serviceName:"\u9888\u80a9\u8c03\u7406",appointmentTime:"2024-01-15T14:00:00.000Z",duration:60,price:128,discountPrice:98,status:"confirmed",createdAt:"2024-01-10T10:00:00.000Z",qrCode:"QR001_15012024_1400"},{id:"appointment-002",userId:"user-001",storeId:"store-027",storeName:"\u540d\u533b\u5802\u2022\u9888\u80a9\u8170\u817f\u7279\u8272\u8c03\u7406\uff08\u4e1c\u65b9\u8def\u5e97\uff09",therapistId:"therapist-104",therapistName:"\u6734\u8001\u5e08",serviceId:"service-003",serviceName:"\u8db3\u5e95\u6309\u6469",appointmentTime:"2024-01-12T16:30:00.000Z",duration:45,price:88,status:"completed",createdAt:"2024-01-08T09:30:00.000Z",qrCode:"QR002_12012024_1630"},{id:"appointment-003",userId:"user-001",storeId:"store-011",storeName:"\u540d\u533b\u5802\u2022\u9888\u80a9\u8170\u817f\u7279\u8272\u8c03\u7406\uff08\u4e16\u7eaa\u516c\u56ed\u5e97\uff09",therapistId:"therapist-102",therapistName:"\u949f\u8001\u5e08",serviceId:"service-002",serviceName:"\u5168\u8eab\u63a8\u62ff",appointmentTime:"2024-01-18T10:00:00.000Z",duration:90,price:198,discountPrice:158,status:"pending",createdAt:"2024-01-12T15:20:00.000Z",qrCode:"QR003_18012024_1000"},{id:"appointment-004",userId:"user-002",storeId:"store-027",storeName:"\u540d\u533b\u5802\u2022\u9888\u80a9\u8170\u817f\u7279\u8272\u8c03\u7406\uff08\u4e1c\u65b9\u8def\u5e97\uff09",therapistId:"therapist-105",therapistName:"\u6768\u8001\u5e08",serviceId:"service-004",serviceName:"\u62d4\u7f50\u522e\u75e7",appointmentTime:"2024-01-16T15:00:00.000Z",duration:30,price:68,discountPrice:58,status:"confirmed",createdAt:"2024-01-11T11:45:00.000Z",qrCode:"QR004_16012024_1500"},{id:"appointment-005",userId:"user-001",storeId:"store-011",storeName:"\u540d\u533b\u5802\u2022\u9888\u80a9\u8170\u817f\u7279\u8272\u8c03\u7406\uff08\u4e16\u7eaa\u516c\u56ed\u5e97\uff09",therapistId:"therapist-103",therapistName:"\u9a6c\u8001\u5e08",serviceId:"service-005",serviceName:"\u4e2d\u533b\u7406\u7597",appointmentTime:"2024-01-09T13:30:00.000Z",duration:120,price:298,discountPrice:238,status:"cancelled",createdAt:"2024-01-05T16:10:00.000Z",qrCode:"QR005_09012024_1330"}],u=e=>p.filter(t=>t.userId===e),h=(e=9,t=21)=>{const s=[];for(let i=e;i<=t;i++)for(let e=0;e<60;e+=10){const t=`${i.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`;let r,a=!0;12===i||13===i&&e<30?a=!1:Math.random()<.3&&(a=!1,r=`appointment-${Math.floor(1e3*Math.random())}`),s.push({time:t,available:a,bookedBy:r})}return s},j=()=>{const e=[],t=new Date;for(let s=0;s<7;s++){const i=new Date(t);i.setDate(t.getDate()+s),e.push({date:i.toISOString().split("T")[0],timeSlots:h()})}return e},E=[{therapistId:"therapist-101",availability:j()},{therapistId:"therapist-102",availability:j()},{therapistId:"therapist-103",availability:j()},{therapistId:"therapist-104",availability:j()},{therapistId:"therapist-105",availability:j()}],N=e=>E.find(t=>t.therapistId===e)||null,w=(e,t)=>{const s=N(e);if(!s)return[];const i=s.availability.find(e=>e.date===t);return(null==i?void 0:i.timeSlots)||[]},R=(e,t,s,i)=>{const r=N(e);if(!r)return!1;const a=r.availability.find(e=>e.date===t);if(!a)return!1;const n=a.timeSlots.find(e=>e.time===s);return!(!n||!n.available)&&(n.available=!1,n.bookedBy=i,!0)},f=(e,t,s)=>{const i=N(e);if(!i)return!1;const r=i.availability.find(e=>e.date===t);if(!r)return!1;const a=r.timeSlots.find(e=>e.time===s);return!!a&&(a.available=!0,a.bookedBy=void 0,!0)};class g{getUserAppointments(e,t=1,s=10,i){return n(this,null,function*(){yield c.sleep(300);let r=u(e);i&&(r=r.filter(e=>e.status===i)),r.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());const a=(t-1)*s,n=a+s,o=r.slice(a,n);return{code:200,data:{list:o,total:r.length,page:t,pageSize:s,hasMore:n<r.length},message:"success",timestamp:Date.now()}})}getAppointmentDetail(e){return n(this,null,function*(){yield c.sleep(200);const t=p.find(t=>t.id===e);if(!t)throw new Error("\u9884\u7ea6\u8bb0\u5f55\u4e0d\u5b58\u5728");return{code:200,data:t,message:"success",timestamp:Date.now()}})}getTherapistAvailability(e,t){return n(this,null,function*(){if(yield c.sleep(300),t){const s=w(e,t);return{code:200,data:s,message:"success",timestamp:Date.now()}}{const t=(new Date).toISOString().split("T")[0],s=w(e,t);return{code:200,data:s,message:"success",timestamp:Date.now()}}})}createAppointment(e){return n(this,null,function*(){if(yield c.sleep(500),!e.userId||!e.therapistId||!e.appointmentTime)throw new Error("\u7f3a\u5c11\u5fc5\u9700\u53c2\u6570");const t=new Date(e.appointmentTime),s=t.toISOString().split("T")[0],i=t.toTimeString().slice(0,5),r=w(e.therapistId,s),a=r.find(e=>e.time===i);if(!a||!a.available)throw new Error("\u8be5\u65f6\u95f4\u6bb5\u4e0d\u53ef\u9884\u7ea6");const n=`appointment-${Date.now()}`,o={id:n,userId:e.userId,storeId:e.storeId,storeName:e.storeName,therapistId:e.therapistId,therapistName:e.therapistName,serviceId:e.serviceId,serviceName:e.serviceName,appointmentTime:e.appointmentTime,duration:e.duration,price:e.price,discountPrice:e.discountPrice,status:"pending",createdAt:(new Date).toISOString(),qrCode:`QR${n.slice(-3)}_${s.replace(/-/g,"")}_${i.replace(":","")}`},l=R(e.therapistId,s,i,n);if(!l)throw new Error("\u9884\u7ea6\u65f6\u95f4\u6bb5\u5931\u8d25");return p.push(o),{code:200,data:o,message:"success",timestamp:Date.now()}})}confirmAppointment(e){return n(this,null,function*(){yield c.sleep(300);const t=p.find(t=>t.id===e);if(!t)throw new Error("\u9884\u7ea6\u8bb0\u5f55\u4e0d\u5b58\u5728");if("pending"!==t.status)throw new Error("\u9884\u7ea6\u72b6\u6001\u4e0d\u6b63\u786e");return t.status="confirmed",{code:200,data:t,message:"success",timestamp:Date.now()}})}cancelAppointment(e,t){return n(this,null,function*(){yield c.sleep(300);const t=p.find(t=>t.id===e);if(!t)throw new Error("\u9884\u7ea6\u8bb0\u5f55\u4e0d\u5b58\u5728");if("completed"===t.status||"cancelled"===t.status)throw new Error("\u8be5\u9884\u7ea6\u4e0d\u80fd\u53d6\u6d88");const s=new Date(t.appointmentTime),i=s.toISOString().split("T")[0],r=s.toTimeString().slice(0,5);return f(t.therapistId,i,r),t.status="cancelled",{code:200,data:t,message:"success",timestamp:Date.now()}})}completeAppointment(e){return n(this,null,function*(){yield c.sleep(300);const t=p.find(t=>t.id===e);if(!t)throw new Error("\u9884\u7ea6\u8bb0\u5f55\u4e0d\u5b58\u5728");if("confirmed"!==t.status)throw new Error("\u9884\u7ea6\u72b6\u6001\u4e0d\u6b63\u786e");return t.status="completed",{code:200,data:t,message:"success",timestamp:Date.now()}})}}const v=new g,T="",V=o.reactExports.forwardRef(({services:e,therapistId:t,onServiceSelect:s,onTimeSelect:i},r)=>{const[a,c]=o.reactExports.useState(""),[l,x]=o.reactExports.useState(null),[m,d]=o.reactExports.useState(""),[p,u]=o.reactExports.useState(""),[h,j]=o.reactExports.useState([]),[E,N]=o.reactExports.useState(!1);o.reactExports.useImperativeHandle(r,()=>({clearSelectedTime:()=>{u("")}}),[]);const w=()=>{const e=[],t=new Date;for(let s=0;s<5;s++){const i=new Date(t);i.setDate(t.getDate()+s);const r=i.getMonth()+1,a=i.getDate(),n=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],o=n[i.getDay()];e.push({key:i.toISOString().split("T")[0],display:0===s?"\u4eca\u5929":`${r}\u6708${a}\u65e5`,weekDay:0===s?"":o})}return e},R=e=>n(exports,null,function*(){if(t)try{N(!0);const s=yield v.getTherapistAvailability(t,e);j(s.data)}catch(s){console.error("\u83b7\u53d6\u53ef\u9884\u7ea6\u65f6\u95f4\u5931\u8d25:",s),j([])}finally{N(!1)}});o.reactExports.useEffect(()=>{m&&t&&R(m)},[m,t]);const f=()=>{const e=[];for(let t=9;t<=21;t++){const s=h.filter(e=>{const s=parseInt(e.time.split(":")[0]);return s===t});s.length>0&&e.push({hour:`${t}:00`,slots:s})}return e},g=e=>{if(!p||!l)return!1;const t=p,s=l.duration,i=e=>{const[t,s]=e.split(":").map(Number);return 60*t+s},r=i(t),a=i(e),n=r+s;return a>=r&&a<n},T=e=>{c(e.id),x(e),s(e),u("")},V=e=>{d(e),u("")},S=(e,t)=>{if(!t||!m||!l)return;const s=e=>{const[t,s]=e.split(":").map(Number);return 60*t+s},r=s(e),a=r+l.duration;a>1320||(u(e),i(m,e),setTimeout(()=>{const e=o.taroDocumentProvider.querySelector(".checkout-btn:not(.disabled)");e&&e.click()},300))},I=w(),b=f();return o.jsxRuntimeExports.jsxs(o.View,{className:"booking-selector",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"service-section",children:[o.jsxRuntimeExports.jsx(o.View,{className:"section-title",children:"\u9009\u62e9\u670d\u52a1"}),o.jsxRuntimeExports.jsx(o.ScrollView,{className:"service-tabs",scrollX:!0,children:e.map(e=>o.jsxRuntimeExports.jsxs(o.View,{className:"service-tab "+(a===e.id?"active":""),onClick:()=>T(e),children:[o.jsxRuntimeExports.jsx(o.Text,{className:"service-name",children:e.name}),o.jsxRuntimeExports.jsxs(o.View,{className:"service-info",children:[o.jsxRuntimeExports.jsxs(o.Text,{className:"service-duration",children:[e.duration,"\u5206\u949f"]}),o.jsxRuntimeExports.jsxs(o.Text,{className:"price",children:["\xa5",e.discountPrice||e.price]})]})]},e.id))})]}),a&&o.jsxRuntimeExports.jsxs(o.View,{className:"datetime-section",children:[o.jsxRuntimeExports.jsx(o.ScrollView,{className:"date-tabs",scrollX:!0,children:I.map(e=>o.jsxRuntimeExports.jsxs(o.View,{className:"date-tab "+(m===e.key?"active":""),onClick:()=>V(e.key),children:[o.jsxRuntimeExports.jsx(o.Text,{className:"date-display",children:e.display}),e.weekDay&&o.jsxRuntimeExports.jsx(o.Text,{className:"week-day",children:e.weekDay})]},e.key))}),m&&o.jsxRuntimeExports.jsx(o.ScrollView,{className:"time-grid-container",scrollY:!0,children:o.jsxRuntimeExports.jsx(o.View,{className:"time-grid-wrapper",children:b.map((e,t)=>o.jsxRuntimeExports.jsxs(o.View,{className:"time-row",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"hour-label",children:e.hour}),o.jsxRuntimeExports.jsx(o.View,{className:"time-slots",children:e.slots.map((e,t)=>o.jsxRuntimeExports.jsx(o.View,{className:"time-slot "+(e.available?g(e.time)?"selected":"available":"disabled"),onClick:()=>S(e.time,e.available),children:o.jsxRuntimeExports.jsxs(o.Text,{className:"time-text",children:[":",e.time.split(":")[1]]})},t))})]},t))})})]})]})});V.displayName="BookingSelector";const S="",I=({items:e,therapist:t,onCheckout:s,onMaskClick:i,onContinue:r,hasPendingAction:a=!1})=>{const[n,c]=o.reactExports.useState(!1),[l,x]=o.reactExports.useState(180),m=o.reactExports.useRef(null),d=e.reduce((e,t)=>e+t.price,0),p=e.reduce((e,t)=>e+(t.discountPrice||t.price),0),u=d-p,h=e.length>0;o.reactExports.useEffect(()=>(h&&n?m.current=setInterval(()=>{x(e=>e<=1?(clearInterval(m.current),o.Taro.showToast({title:"\u652f\u4ed8\u8d85\u65f6\u4e86\u5466\uff0c\u5feb\u5feb\u91cd\u65b0\u4e0b\u5355\u5427~",icon:"none"}),c(!1),180):e-1)},1e3):m.current&&clearInterval(m.current),()=>{m.current&&clearInterval(m.current)}),[h,n]);const j=e=>{const t=Math.floor(e/60),s=e%60;return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},E=e=>{const t=new Date(e),s=new Date,i=t.toDateString()===s.toDateString();if(i)return"\u4eca\u5929";const r=t.getMonth()+1,a=t.getDate();return`${r}\u6708${a}\u65e5`},N=()=>{h?c(!0):o.Taro.showToast({title:"\u8bf7\u5148\u9009\u62e9\u670d\u52a1",icon:"none"})},w=()=>{i&&a&&i(),c(!1)},R=()=>{r&&r(),c(!1)},f=()=>{s()};return o.jsxRuntimeExports.jsxs(o.jsxRuntimeExports.Fragment,{children:[n&&o.jsxRuntimeExports.jsx(o.View,{className:"cart-mask",onClick:w}),o.jsxRuntimeExports.jsx(o.View,{className:"shopping-cart",children:o.jsxRuntimeExports.jsxs(o.View,{className:"cart-bar",children:[o.jsxRuntimeExports.jsx(o.View,{className:"cart-info",children:h?o.jsxRuntimeExports.jsxs(o.jsxRuntimeExports.Fragment,{children:[o.jsxRuntimeExports.jsxs(o.Text,{className:"total-price",children:["\xa5",p]}),u>0&&o.jsxRuntimeExports.jsxs(o.Text,{className:"savings",children:["\u5df2\u4f18\u60e0\xa5",u]})]}):o.jsxRuntimeExports.jsx(o.Text,{className:"empty-text",children:"\u8bf7\u9009\u62e9\u670d\u52a1\u9879\u76ee"})}),o.jsxRuntimeExports.jsx(o.View,{className:"checkout-btn "+(h?"":"disabled"),onClick:N,children:"\u53bb\u7ed3\u7b97"})]})}),n&&o.jsxRuntimeExports.jsxs(o.View,{className:"cart-expanded",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"expanded-header",children:[o.jsxRuntimeExports.jsxs(o.Text,{className:"title",children:["\u5df2\u9009\u63a8\u62ff\u5e08(",e.length,")\u4f4d"]}),o.jsxRuntimeExports.jsx(o.Text,{className:"action",onClick:R,children:"\u7ee7\u7eed\u9884\u7ea6"})]}),o.jsxRuntimeExports.jsx(o.View,{className:"service-list",children:e.map((e,s)=>o.jsxRuntimeExports.jsxs(o.View,{className:"service-item",children:[o.jsxRuntimeExports.jsx(o.Image,{className:"therapist-avatar",src:e.therapistAvatar||(null==t?void 0:t.avatar)||""}),o.jsxRuntimeExports.jsxs(o.View,{className:"service-info",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"info-header",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"therapist-name",children:e.therapistName}),o.jsxRuntimeExports.jsxs(o.Text,{className:"duration",children:[e.duration,"\u5206\u949f"]})]}),o.jsxRuntimeExports.jsx(o.View,{className:"info-detail",children:o.jsxRuntimeExports.jsx(o.Text,{className:"service-name",children:e.serviceName})}),o.jsxRuntimeExports.jsx(o.View,{className:"info-time",children:o.jsxRuntimeExports.jsxs(o.Text,{className:"time-text",children:[E(e.date)," ",e.time," \u81f3 ",(()=>{const[t,s]=e.time.split(":").map(Number),i=s+e.duration,r=t+Math.floor(i/60),a=i%60;return`${r}:${a.toString().padStart(2,"0")}`})()]})})]}),o.jsxRuntimeExports.jsx(o.View,{className:"price-info",children:o.jsxRuntimeExports.jsxs(o.Text,{className:"price",children:["\xa5",e.discountPrice||e.price]})})]},s))}),o.jsxRuntimeExports.jsxs(o.View,{className:"addon-section",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"section-title",children:"\u53ef\u9009\u589e\u503c\u9879\u76ee"}),o.jsxRuntimeExports.jsxs(o.View,{className:"addon-list",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"addon-item",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"addon-info",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"addon-name",children:"\u522e\u75e720\u5206\u949f"}),o.jsxRuntimeExports.jsx(o.Text,{className:"addon-price",children:"\xa5 99"})]}),o.jsxRuntimeExports.jsx(o.View,{className:"addon-action",children:"+"})]}),o.jsxRuntimeExports.jsxs(o.View,{className:"addon-item",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"addon-info",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"addon-name",children:"\u52a0\u949f20\u5206\u949f"}),o.jsxRuntimeExports.jsx(o.Text,{className:"addon-price",children:"\xa5 99"})]}),o.jsxRuntimeExports.jsx(o.View,{className:"addon-action",children:"+"})]})]})]}),o.jsxRuntimeExports.jsxs(o.View,{className:"checkout-section",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"price-summary",children:[o.jsxRuntimeExports.jsxs(o.View,{className:"cart-icon",children:[o.jsxRuntimeExports.jsx(o.Text,{className:"icon",children:"\ud83d\uded2"}),o.jsxRuntimeExports.jsx(o.View,{className:"badge",children:"1"})]}),o.jsxRuntimeExports.jsxs(o.View,{className:"price-detail",children:[o.jsxRuntimeExports.jsxs(o.Text,{className:"final-price",children:["\xa5 ",p]}),d>p&&o.jsxRuntimeExports.jsxs(o.Text,{className:"original-price",children:["\xa5 ",d]})]}),o.jsxRuntimeExports.jsx(o.Text,{className:"discount-tip",children:"\u5df2\u4eab\u53d7\u6700\u5927\u4f18\u60e0\u51cf20\u5143"})]}),o.jsxRuntimeExports.jsxs(o.View,{className:"checkout-footer",children:[o.jsxRuntimeExports.jsxs(o.Text,{className:"countdown",children:["\u652f\u4ed8\u5012\u8ba1\u65f6: ",j(l)]}),o.jsxRuntimeExports.jsx(o.View,{className:"confirm-btn",onClick:f,children:"\u53bb\u7ed3\u7b97"})]})]})]})]})},b="",y=()=>{const e=o.taroExports.useRouter(),{therapistId:t,storeId:s}=e.params,[i,r]=o.reactExports.useState(null),[a,l]=o.reactExports.useState(null),[m,p]=o.reactExports.useState(!0),[u,h]=o.reactExports.useState(""),[j,E]=o.reactExports.useState([]),[N,w]=o.reactExports.useState(null),[R,f]=o.reactExports.useState(-1),[g,v]=o.reactExports.useState(!1),T=o.reactExports.useRef(null),S=[{id:"1",name:"\u80a9\u9888\u8c03\u7406",duration:60,price:128,discountPrice:98},{id:"2",name:"\u5168\u8eab\u63a8\u62ff",duration:90,price:198,discountPrice:158},{id:"3",name:"\u8db3\u5e95\u6309\u6469",duration:45,price:88},{id:"4",name:"\u62d4\u7f50\u522e\u75e7",duration:30,price:68,discountPrice:58},{id:"5",name:"\u4e2d\u533b\u7406\u7597",duration:120,price:298,discountPrice:238}];o.reactExports.useEffect(()=>{b()},[t,s]);const b=()=>n(exports,null,function*(){try{if(p(!0),h(""),console.log("TherapistBookingPage params:",{therapistId:t,storeId:s}),!t||!s)return console.error("Missing required params:",{therapistId:t,storeId:s}),void h("\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8fdb\u5165");const[e,i]=yield Promise.all([c.therapistService.getTherapistDetail(t),c.storeService.getStoreDetail(s)]);console.log("Store data response:",i),console.log("Store data.data:",i.data),r(e.data),l(i.data),console.log("Store state after setting:",i.data)}catch(e){console.error("Failed to load data:",e),h("\u52a0\u8f7d\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{p(!1)}}),y=e=>{w(e)},k=(e,t)=>{if(!N||!i)return;-1===R&&(f(j.length),v(!0));const s={serviceId:N.id,serviceName:N.name,duration:N.duration,price:N.price,discountPrice:N.discountPrice,date:e,time:t,therapistName:i.name,therapistAvatar:i.avatar},r=j.findIndex(s=>s.date===e&&s.time===t);if(r>=0){const e=[...j];e[r]=s,E(e),o.Taro.showToast({title:"\u5df2\u66f4\u65b0\u8be5\u65f6\u6bb5\u9884\u7ea6",icon:"success"})}else E([...j,s]),o.Taro.showToast({title:"\u5df2\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66",icon:"success"})},D=()=>{var e;if(g&&R>=0){const t=j.slice(0,R);E(t),null==(e=T.current)||e.clearSelectedTime()}f(-1),v(!1)},C=()=>{f(-1),v(!1)},P=()=>{if(0===j.length)return;f(-1),v(!1);const e={therapistId:t,storeId:s,items:JSON.stringify(j)};o.Taro.navigateTo({url:`/pages/booking/confirm/index?${Object.entries(e).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&")}`})};return m?o.jsxRuntimeExports.jsx(o.View,{className:"therapist-booking-page",children:o.jsxRuntimeExports.jsx(o.View,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})}):!u&&i&&a?o.jsxRuntimeExports.jsxs(o.View,{className:"therapist-booking-page",children:[o.jsxRuntimeExports.jsxs(o.ScrollView,{className:"main-content",scrollY:!0,children:[o.jsxRuntimeExports.jsx(x,{therapist:i}),a&&o.jsxRuntimeExports.jsx(d,{store:a}),o.jsxRuntimeExports.jsx(V,{ref:T,services:S,therapistId:t,onServiceSelect:y,onTimeSelect:k})]}),o.jsxRuntimeExports.jsx(I,{items:j,therapist:i,onCheckout:P,onMaskClick:D,onContinue:C,hasPendingAction:g&&R>=0})]}):o.jsxRuntimeExports.jsx(o.View,{className:"therapist-booking-page",children:o.jsxRuntimeExports.jsx(o.View,{className:"error",children:u||"\u6570\u636e\u52a0\u8f7d\u5931\u8d25"})})};var k={navigationBarTitleText:"\u63a8\u62ff\u5e08\u9884\u7ea6"};Page(o.createPageConfig(y,"pages/appointment/therapist/index",{root:{cn:[]}},k||{}));
