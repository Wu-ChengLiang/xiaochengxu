"use strict";var e=Object.defineProperty,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,a=(e,a)=>{for(var n in a||(a={}))t.call(a,n)&&i(e,n,a[n]);if(s)for(var n of s(a))r.call(a,n)&&i(e,n,a[n]);return e},n=(e,s,t)=>new Promise((r,i)=>{var a=e=>{try{c(t.next(e))}catch(s){i(s)}},n=e=>{try{c(t.throw(e))}catch(s){i(s)}},c=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,n);c((t=t.apply(e,s)).next())});const c=require("../../../taro.js"),o=require("../../../common.js"),x="",l=({therapist:e})=>{const[s,t]=c.reactExports.useState(!1),r=a({level:"LV4",rating:e.rating||5,salesCount:e.serviceCount||10109,description:"\u6bd5\u4e1a\u4e8e\u6210\u90fd\u4e2d\u533b\u836f\u5927\u5b66\u9488\u7078\u63a8\u62ff\u4e13\u4e1a\u3002\u9ad8\u7ea7\u5eb7\u590d\u5e08 \u4ece\u4e1a18\u5e74\uff0c\u4e13\u7814\u8eab\u4f53\u75bc\u75db\u3001\u8fd0\u52a8\u5eb7\u590d\u3001\u4ea7\u540e\u5eb7\u590d\u3001\u4f53\u6001\u8c03\u7406\u3001\u7ecf\u7edc\u758f\u901a\u3001\u7f8e\u5bb9\u517b\u751f\u7b49"},e),i=()=>{t(!s)};return c.jsxRuntimeExports.jsxs(c.View,{className:"therapist-info",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"therapist-header",children:[c.jsxRuntimeExports.jsx(c.View,{className:"avatar-wrapper",children:c.jsxRuntimeExports.jsx(c.Image,{className:"avatar",src:e.avatar,mode:"aspectFill"})}),c.jsxRuntimeExports.jsxs(c.View,{className:"basic-info",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"name-row",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"name",children:e.name}),c.jsxRuntimeExports.jsx(c.View,{className:"level",children:r.level})]}),c.jsxRuntimeExports.jsxs(c.View,{className:"stats-row",children:[c.jsxRuntimeExports.jsx(c.View,{className:"rating",children:c.jsxRuntimeExports.jsxs(c.Text,{className:"rating-score",children:[r.rating,"\u5206"]})}),c.jsxRuntimeExports.jsx(c.View,{className:"divider",children:"|"}),c.jsxRuntimeExports.jsx(c.View,{className:"sales",children:c.jsxRuntimeExports.jsxs(c.Text,{className:"sales-text",children:["\u9500\u91cf",r.salesCount,"\u5355"]})})]})]})]}),c.jsxRuntimeExports.jsxs(c.View,{className:"description-section",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"description "+(s?"expanded":"collapsed"),children:r.description}),c.jsxRuntimeExports.jsxs(c.View,{className:"expand-toggle",onClick:i,children:[c.jsxRuntimeExports.jsx(c.Text,{className:"expand-text",children:s?"\u6536\u8d77":"\u5c55\u5f00"}),c.jsxRuntimeExports.jsx(c.Text,{className:"expand-icon "+(s?"up":"down"),children:s?"\u25b2":"\u25bc"})]})]})]})},m="",u=({store:e})=>{const s=e=>{switch(e){case"normal":return"\u5c31\u8fd1";case"busy":return"\u7e41\u5fd9";case"full":return"\u7206\u6ee1";default:return""}},t=e=>{switch(e){case"normal":return"status-normal";case"busy":return"status-busy";case"full":return"status-full";default:return""}},r=()=>{e.phone&&c.Taro.makePhoneCall({phoneNumber:e.phone})},i=()=>{e.location&&c.Taro.openLocation({latitude:e.location.latitude,longitude:e.location.longitude,name:e.name,address:e.address})};return c.jsxRuntimeExports.jsx(c.View,{className:"store-info",children:c.jsxRuntimeExports.jsxs(c.View,{className:"store-header",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"store-details",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"name-row",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"store-name",children:e.name}),c.jsxRuntimeExports.jsxs(c.Text,{className:"distance",children:[e.distance||9,"km"]})]}),c.jsxRuntimeExports.jsxs(c.View,{className:"hours-row",children:[c.jsxRuntimeExports.jsxs(c.Text,{className:"business-hours",children:[e.businessHours.start,"-",e.businessHours.end]}),c.jsxRuntimeExports.jsx(c.View,{className:`status ${t(e.status)}`,children:s(e.status)})]}),c.jsxRuntimeExports.jsxs(c.Text,{className:"address",children:[e.address," (\u7535\u5f71\u9662\u95e8\u53e3)"]})]}),c.jsxRuntimeExports.jsxs(c.View,{className:"action-buttons",children:[c.jsxRuntimeExports.jsx(c.View,{className:"action-btn",onClick:r,children:"\ud83d\udcde"}),c.jsxRuntimeExports.jsx(c.View,{className:"action-btn",onClick:i,children:"\ud83d\udccd"})]})]})})},d="",p=c.reactExports.forwardRef(({services:e,onServiceSelect:s,onTimeSelect:t},r)=>{const[i,a]=c.reactExports.useState(""),[n,o]=c.reactExports.useState(null),[x,l]=c.reactExports.useState(""),[m,u]=c.reactExports.useState("");c.reactExports.useImperativeHandle(r,()=>({clearSelectedTime:()=>{u("")}}),[]);const d=()=>{const e=[],s=new Date;for(let t=0;t<5;t++){const r=new Date(s);r.setDate(s.getDate()+t);const i=r.getMonth()+1,a=r.getDate(),n=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],c=n[r.getDay()];e.push({key:r.toISOString().split("T")[0],display:0===t?"\u4eca\u5929":`${i}\u6708${a}\u65e5`,weekDay:0===t?"":c})}return e},p=()=>{const e=[];for(let s=9;s<=21;s++){const t=[];for(let e=0;e<60;e+=10){const r=`${s.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`,i=Math.random()>.3;t.push({time:r,available:i})}e.push({hour:`${s}:00`,slots:t})}return e},j=e=>{if(!m||!n)return!1;const s=m,t=n.duration,r=e=>{const[s,t]=e.split(":").map(Number);return 60*s+t},i=r(s),a=r(e),c=i+t;return a>=i&&a<c},h=e=>{a(e.id),o(e),s(e),u("")},E=e=>{l(e),u("")},R=(e,s)=>{if(!s||!x||!n)return;const r=e=>{const[s,t]=e.split(":").map(Number);return 60*s+t},i=r(e),a=i+n.duration;a>1320||(u(e),t(x,e),setTimeout(()=>{const e=c.taroDocumentProvider.querySelector(".checkout-btn:not(.disabled)");e&&e.click()},300))},N=d(),w=p();return c.jsxRuntimeExports.jsxs(c.View,{className:"booking-selector",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"service-section",children:[c.jsxRuntimeExports.jsx(c.View,{className:"section-title",children:"\u9009\u62e9\u670d\u52a1"}),c.jsxRuntimeExports.jsx(c.ScrollView,{className:"service-tabs",scrollX:!0,children:e.map(e=>c.jsxRuntimeExports.jsxs(c.View,{className:"service-tab "+(i===e.id?"active":""),onClick:()=>h(e),children:[c.jsxRuntimeExports.jsx(c.Text,{className:"service-name",children:e.name}),c.jsxRuntimeExports.jsxs(c.View,{className:"service-info",children:[c.jsxRuntimeExports.jsxs(c.Text,{className:"service-duration",children:[e.duration,"\u5206\u949f"]}),c.jsxRuntimeExports.jsxs(c.Text,{className:"price",children:["\xa5",e.discountPrice||e.price]})]})]},e.id))})]}),i&&c.jsxRuntimeExports.jsxs(c.View,{className:"datetime-section",children:[c.jsxRuntimeExports.jsx(c.ScrollView,{className:"date-tabs",scrollX:!0,children:N.map(e=>c.jsxRuntimeExports.jsxs(c.View,{className:"date-tab "+(x===e.key?"active":""),onClick:()=>E(e.key),children:[c.jsxRuntimeExports.jsx(c.Text,{className:"date-display",children:e.display}),e.weekDay&&c.jsxRuntimeExports.jsx(c.Text,{className:"week-day",children:e.weekDay})]},e.key))}),x&&c.jsxRuntimeExports.jsx(c.ScrollView,{className:"time-grid-container",scrollY:!0,children:c.jsxRuntimeExports.jsx(c.View,{className:"time-grid-wrapper",children:w.map((e,s)=>c.jsxRuntimeExports.jsxs(c.View,{className:"time-row",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"hour-label",children:e.hour}),c.jsxRuntimeExports.jsx(c.View,{className:"time-slots",children:e.slots.map((e,s)=>c.jsxRuntimeExports.jsx(c.View,{className:"time-slot "+(e.available?j(e.time)?"selected":"available":"disabled"),onClick:()=>R(e.time,e.available),children:c.jsxRuntimeExports.jsxs(c.Text,{className:"time-text",children:[":",e.time.split(":")[1]]})},s))})]},s))})})]})]})});p.displayName="BookingSelector";const j="",h=({items:e,therapist:s,onCheckout:t,onMaskClick:r,onContinue:i,hasPendingAction:a=!1})=>{const[n,o]=c.reactExports.useState(!1),[x,l]=c.reactExports.useState(180),m=c.reactExports.useRef(null),u=e.reduce((e,s)=>e+s.price,0),d=e.reduce((e,s)=>e+(s.discountPrice||s.price),0),p=u-d,j=e.length>0;c.reactExports.useEffect(()=>(j&&n?m.current=setInterval(()=>{l(e=>e<=1?(clearInterval(m.current),c.Taro.showToast({title:"\u9884\u7ea6\u5df2\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9",icon:"none"}),o(!1),180):e-1)},1e3):m.current&&clearInterval(m.current),()=>{m.current&&clearInterval(m.current)}),[j,n]);const h=e=>{const s=Math.floor(e/60),t=e%60;return`${s.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},E=e=>{const s=new Date(e),t=new Date,r=s.toDateString()===t.toDateString();if(r)return"\u4eca\u5929";const i=s.getMonth()+1,a=s.getDate();return`${i}\u6708${a}\u65e5`},R=()=>{j?o(!0):c.Taro.showToast({title:"\u8bf7\u5148\u9009\u62e9\u670d\u52a1",icon:"none"})},N=()=>{r&&a&&r(),o(!1)},w=()=>{i&&i(),o(!1)},V=()=>{t()};return c.jsxRuntimeExports.jsxs(c.jsxRuntimeExports.Fragment,{children:[n&&c.jsxRuntimeExports.jsx(c.View,{className:"cart-mask",onClick:N}),c.jsxRuntimeExports.jsx(c.View,{className:"shopping-cart",children:c.jsxRuntimeExports.jsxs(c.View,{className:"cart-bar",children:[c.jsxRuntimeExports.jsx(c.View,{className:"cart-info",children:j?c.jsxRuntimeExports.jsxs(c.jsxRuntimeExports.Fragment,{children:[c.jsxRuntimeExports.jsxs(c.Text,{className:"total-price",children:["\xa5",d]}),p>0&&c.jsxRuntimeExports.jsxs(c.Text,{className:"savings",children:["\u5df2\u4f18\u60e0\xa5",p]})]}):c.jsxRuntimeExports.jsx(c.Text,{className:"empty-text",children:"\u8bf7\u9009\u62e9\u670d\u52a1\u9879\u76ee"})}),c.jsxRuntimeExports.jsx(c.View,{className:"checkout-btn "+(j?"":"disabled"),onClick:R,children:"\u53bb\u7ed3\u7b97"})]})}),n&&c.jsxRuntimeExports.jsxs(c.View,{className:"cart-expanded",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"expanded-header",children:[c.jsxRuntimeExports.jsxs(c.Text,{className:"title",children:["\u5df2\u9009\u63a8\u62ff\u5e08(",e.length,")\u4f4d"]}),c.jsxRuntimeExports.jsx(c.Text,{className:"action",onClick:w,children:"\u7ee7\u7eed\u9884\u7ea6"})]}),c.jsxRuntimeExports.jsx(c.View,{className:"service-list",children:e.map((e,t)=>c.jsxRuntimeExports.jsxs(c.View,{className:"service-item",children:[c.jsxRuntimeExports.jsx(c.Image,{className:"therapist-avatar",src:e.therapistAvatar||(null==s?void 0:s.avatar)||""}),c.jsxRuntimeExports.jsxs(c.View,{className:"service-info",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"info-header",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"therapist-name",children:e.therapistName}),c.jsxRuntimeExports.jsxs(c.Text,{className:"duration",children:[e.duration,"\u5206\u949f"]})]}),c.jsxRuntimeExports.jsx(c.View,{className:"info-detail",children:c.jsxRuntimeExports.jsx(c.Text,{className:"service-name",children:e.serviceName})}),c.jsxRuntimeExports.jsx(c.View,{className:"info-time",children:c.jsxRuntimeExports.jsxs(c.Text,{className:"time-text",children:[E(e.date)," ",e.time," \u81f3 ",(()=>{const[s,t]=e.time.split(":").map(Number),r=t+e.duration,i=s+Math.floor(r/60),a=r%60;return`${i}:${a.toString().padStart(2,"0")}`})()]})})]}),c.jsxRuntimeExports.jsx(c.View,{className:"price-info",children:c.jsxRuntimeExports.jsxs(c.Text,{className:"price",children:["\xa5",e.discountPrice||e.price]})})]},t))}),c.jsxRuntimeExports.jsxs(c.View,{className:"addon-section",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"section-title",children:"\u53ef\u9009\u589e\u503c\u9879\u76ee"}),c.jsxRuntimeExports.jsxs(c.View,{className:"addon-list",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"addon-item",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"addon-info",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"addon-name",children:"\u522e\u75e720\u5206\u949f"}),c.jsxRuntimeExports.jsx(c.Text,{className:"addon-price",children:"\xa5 99"})]}),c.jsxRuntimeExports.jsx(c.View,{className:"addon-action",children:"+"})]}),c.jsxRuntimeExports.jsxs(c.View,{className:"addon-item",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"addon-info",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"addon-name",children:"\u52a0\u949f20\u5206\u949f"}),c.jsxRuntimeExports.jsx(c.Text,{className:"addon-price",children:"\xa5 99"})]}),c.jsxRuntimeExports.jsx(c.View,{className:"addon-action",children:"+"})]})]})]}),c.jsxRuntimeExports.jsxs(c.View,{className:"checkout-section",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"price-summary",children:[c.jsxRuntimeExports.jsxs(c.View,{className:"cart-icon",children:[c.jsxRuntimeExports.jsx(c.Text,{className:"icon",children:"\ud83d\uded2"}),c.jsxRuntimeExports.jsx(c.View,{className:"badge",children:"1"})]}),c.jsxRuntimeExports.jsxs(c.View,{className:"price-detail",children:[c.jsxRuntimeExports.jsxs(c.Text,{className:"final-price",children:["\xa5 ",d]}),u>d&&c.jsxRuntimeExports.jsxs(c.Text,{className:"original-price",children:["\xa5 ",u]})]}),c.jsxRuntimeExports.jsx(c.Text,{className:"discount-tip",children:"\u5df2\u4eab\u53d7\u6700\u5927\u4f18\u60e0\u51cf20\u5143"})]}),c.jsxRuntimeExports.jsxs(c.View,{className:"checkout-footer",children:[c.jsxRuntimeExports.jsxs(c.Text,{className:"countdown",children:["\u652f\u4ed8\u5012\u8ba1\u65f6: ",h(x)]}),c.jsxRuntimeExports.jsx(c.View,{className:"confirm-btn",onClick:V,children:"\u53bb\u7ed3\u7b97"})]})]})]})]})},E="",R=()=>{const e=c.taroExports.useRouter(),{therapistId:s,storeId:t}=e.params,[r,i]=c.reactExports.useState(null),[a,x]=c.reactExports.useState(null),[m,d]=c.reactExports.useState(!0),[j,E]=c.reactExports.useState(""),[R,N]=c.reactExports.useState([]),[w,V]=c.reactExports.useState(null),[g,T]=c.reactExports.useState(null),[v,f]=c.reactExports.useState(null),[S,b]=c.reactExports.useState(-1),k=c.reactExports.useRef(null),y=[{id:"1",name:"\u80a9\u9888\u8c03\u7406",duration:60,price:128,discountPrice:98},{id:"2",name:"\u5168\u8eab\u63a8\u62ff",duration:90,price:198,discountPrice:158},{id:"3",name:"\u8db3\u5e95\u6309\u6469",duration:45,price:88},{id:"4",name:"\u62d4\u7f50\u522e\u75e7",duration:30,price:68,discountPrice:58},{id:"5",name:"\u4e2d\u533b\u7406\u7597",duration:120,price:298,discountPrice:238}];c.reactExports.useEffect(()=>{C()},[s,t]);const C=()=>n(exports,null,function*(){try{d(!0),E("");const[e,r]=yield Promise.all([o.therapistService.getTherapistDetail(s),o.storeService.getStoreDetail(t)]);i(e),x(r)}catch(e){console.error("Failed to load data:",e),E("\u52a0\u8f7d\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{d(!1)}}),P=e=>{V(e)},D=(e,s)=>{if(!w||!r)return;const t={serviceId:w.id,serviceName:w.name,duration:w.duration,price:w.price,discountPrice:w.discountPrice,date:e,time:s,therapistName:r.name,therapistAvatar:r.avatar},i=R.findIndex(t=>t.date===e&&t.time===s);if(i>=0){const e=[...R];e[i]=t,N(e),c.Taro.showToast({title:"\u5df2\u66f4\u65b0\u8be5\u65f6\u6bb5\u9884\u7ea6",icon:"success"})}else T(t),f("add"),b(R.length),N([...R,t]),c.Taro.showToast({title:"\u5df2\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66",icon:"success"})},I=()=>{var e;if("add"===v&&S>=0){const s=[...R];s.splice(S,1),N(s),null==(e=k.current)||e.clearSelectedTime(),c.Taro.showToast({title:"\u5df2\u53d6\u6d88\u9884\u7ea6",icon:"none"})}T(null),f(null),b(-1)},$=()=>{T(null),f(null),b(-1)},O=()=>{if(0===R.length)return;T(null),f(null),b(-1);const e={therapistId:s,storeId:t,items:JSON.stringify(R)};c.Taro.navigateTo({url:`/pages/booking/confirm/index?${Object.entries(e).map(([e,s])=>`${e}=${encodeURIComponent(s)}`).join("&")}`})};return m?c.jsxRuntimeExports.jsx(c.View,{className:"therapist-booking-page",children:c.jsxRuntimeExports.jsx(c.View,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})}):!j&&r&&a?c.jsxRuntimeExports.jsxs(c.View,{className:"therapist-booking-page",children:[c.jsxRuntimeExports.jsxs(c.ScrollView,{className:"main-content",scrollY:!0,children:[c.jsxRuntimeExports.jsx(l,{therapist:r}),c.jsxRuntimeExports.jsx(u,{store:a}),c.jsxRuntimeExports.jsx(p,{ref:k,services:y,onServiceSelect:P,onTimeSelect:D})]}),c.jsxRuntimeExports.jsx(h,{items:R,therapist:r,onCheckout:O,onMaskClick:I,onContinue:$,hasPendingAction:null!==v})]}):c.jsxRuntimeExports.jsx(c.View,{className:"therapist-booking-page",children:c.jsxRuntimeExports.jsx(c.View,{className:"error",children:j||"\u6570\u636e\u52a0\u8f7d\u5931\u8d25"})})};var N={navigationBarTitleText:"\u63a8\u62ff\u5e08\u9884\u7ea6"};Page(c.createPageConfig(R,"pages/appointment/therapist/index",{root:{cn:[]}},N||{}));
