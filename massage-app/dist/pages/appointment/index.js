"use strict";var s=(s,e,t)=>new Promise((i,r)=>{var a=s=>{try{o(t.next(s))}catch(e){r(e)}},n=s=>{try{o(t.throw(s))}catch(e){r(e)}},o=s=>s.done?i(s.value):Promise.resolve(s.value).then(a,n);o((t=t.apply(s,e)).next())});const e=require("../../taro.js"),t=require("../../vendors.js"),i=require("../../common.js"),r="",a=({store:s,onClick:r})=>{const a=s=>{switch(s){case"normal":return"\u5c31\u8fd1";case"busy":return"\u7e41\u5fd9";case"full":return"\u7206\u6ee1";default:return""}},n=s=>{switch(s){case"normal":return"status-normal";case"busy":return"status-busy";case"full":return"status-full";default:return""}};return e.jsxRuntimeExports.jsx(e.View,{className:"store-card",onClick:r,children:e.jsxRuntimeExports.jsxs(e.View,{className:"card-content",children:[e.jsxRuntimeExports.jsx(e.View,{className:"store-image-wrapper",children:e.jsxRuntimeExports.jsx(e.Image,{className:"store-image",src:i.ASSETS_CONFIG.store.store1,mode:"aspectFill"})}),e.jsxRuntimeExports.jsxs(e.View,{className:"store-info",children:[e.jsxRuntimeExports.jsx(e.Text,{className:"store-name",children:s.name}),e.jsxRuntimeExports.jsxs(e.View,{className:"business-hours",children:[e.jsxRuntimeExports.jsx(e.Text,{className:"hours-text",children:s.businessHours}),e.jsxRuntimeExports.jsx(e.Text,{className:`status ${n(s.status)}`,children:a(s.status)})]}),e.jsxRuntimeExports.jsx(e.View,{className:"store-address",children:e.jsxRuntimeExports.jsx(e.Text,{className:"address-text",numberOfLines:1,children:s.address})}),e.jsxRuntimeExports.jsxs(e.View,{className:"store-footer",children:[void 0!==s.distance&&null!==s.distance&&e.jsxRuntimeExports.jsxs(e.View,{className:"distance",children:[e.jsxRuntimeExports.jsx(t.AtIcon,{value:"map-pin",size:"12",color:"#999"}),e.jsxRuntimeExports.jsxs(e.Text,{className:"distance-text",children:[s.distance,"km"]})]}),e.jsxRuntimeExports.jsx(i.BookingButton,{size:"small"})]})]})]})})},n="",o=({therapist:r,onClick:a})=>{const[n,o]=e.reactExports.useState(null),[x,c]=e.reactExports.useState(!0);e.reactExports.useEffect(()=>{const e=()=>s(exports,null,function*(){try{const s=yield i.reviewService.getReviewStats(r.id);o(s)}catch(s){console.error("\u83b7\u53d6\u63a8\u62ff\u5e08\u8bc4\u4ef7\u7edf\u8ba1\u5931\u8d25:",s),o(null)}finally{c(!1)}});e()},[r.id]);const l=()=>x?"...":n&&0!==n.totalCount?`${n.averageRating}\u5206`:"\u5f85\u8bc4\u4ef7";return e.jsxRuntimeExports.jsx(e.View,{className:"therapist-card",onClick:a,children:e.jsxRuntimeExports.jsxs(e.View,{className:"card-content",children:[e.jsxRuntimeExports.jsx(e.Image,{className:"therapist-avatar",src:r.avatar,mode:"aspectFill"}),e.jsxRuntimeExports.jsxs(e.View,{className:"therapist-info",children:[e.jsxRuntimeExports.jsxs(e.View,{className:"info-header",children:[e.jsxRuntimeExports.jsx(e.Text,{className:"therapist-name",children:r.name}),void 0!==r.distance&&null!==r.distance&&e.jsxRuntimeExports.jsxs(e.View,{className:"distance",children:[e.jsxRuntimeExports.jsx(t.AtIcon,{value:"map-pin",size:"12",color:"#999"}),e.jsxRuntimeExports.jsxs(e.Text,{className:"distance-text",children:[r.distance,"km"]})]})]}),e.jsxRuntimeExports.jsx(e.View,{className:"expertise-tags",children:r.expertise.map((s,t)=>e.jsxRuntimeExports.jsx(e.Text,{className:"expertise-tag",children:s},t))}),e.jsxRuntimeExports.jsxs(e.View,{className:"therapist-footer",children:[e.jsxRuntimeExports.jsxs(e.View,{className:"rating",children:[e.jsxRuntimeExports.jsx(t.AtIcon,{value:"star-2",size:"12",color:"#faad14"}),e.jsxRuntimeExports.jsx(e.Text,{className:"rating-text",children:l()})]}),e.jsxRuntimeExports.jsx(i.BookingButton,{size:"small"})]})]})]})})},x="",c=({visible:s,title:i,onClose:r,children:a,height:n="70%"})=>{const[o,x]=e.reactExports.useState(!1),[c,l]=e.reactExports.useState(!1);e.reactExports.useEffect(()=>{s?(l(!0),setTimeout(()=>x(!0),50)):(x(!1),setTimeout(()=>l(!1),300))},[s]);const m=()=>{r()},u=s=>{s.stopPropagation()};return c?e.jsxRuntimeExports.jsxs(e.View,{className:"bottom-sheet",onClick:m,children:[e.jsxRuntimeExports.jsx(e.View,{className:"bottom-sheet-mask "+(o?"active":"")}),e.jsxRuntimeExports.jsxs(e.View,{className:"bottom-sheet-content "+(o?"active":""),style:{height:n},onClick:u,children:[e.jsxRuntimeExports.jsxs(e.View,{className:"sheet-header",children:[e.jsxRuntimeExports.jsx(e.Text,{className:"sheet-title",children:i}),e.jsxRuntimeExports.jsx(e.View,{className:"close-btn",onClick:r,children:e.jsxRuntimeExports.jsx(t.AtIcon,{value:"close",size:"20",color:"#999"})})]}),e.jsxRuntimeExports.jsx(e.View,{className:"sheet-body",children:a})]})]}):null},l="",m=()=>{const[r,n]=e.reactExports.useState(!0),[x,l]=e.reactExports.useState([]),[m,u]=e.reactExports.useState([]),[j,p]=e.reactExports.useState([]),[d,h]=e.reactExports.useState(!1),[E,R]=e.reactExports.useState("");e.reactExports.useEffect(()=>{N()},[]);const N=()=>s(exports,null,function*(){try{n(!0);const s=yield i.getLocationService.getCurrentLocation(),e=yield i.storeService.getNearbyStores(s.latitude,s.longitude,1,2);l(e.list);const t=yield i.storeService.getNearbyStores(s.latitude,s.longitude,1,20);u(t.list);const r=yield i.therapistService.getRecommendedTherapistsWithDistance(1,10);p(r.list)}catch(s){console.error("\u52a0\u8f7d\u6570\u636e\u5931\u8d25:",s),e.Taro.showToast({title:"\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none"})}finally{n(!1)}}),w=s=>{e.Taro.navigateTo({url:`/pages/appointment/store/index?id=${s.id}`})},v=s=>{e.Taro.navigateTo({url:`/pages/appointment/therapist/index?therapistId=${s.id}&storeId=${s.storeId}`})},g=()=>{h(!0)},V=()=>{e.Taro.showToast({title:"\u529f\u80fd\u5f00\u53d1\u4e2d",icon:"none"})};return e.jsxRuntimeExports.jsxs(e.View,{className:"appointment-page",children:[e.jsxRuntimeExports.jsxs(e.View,{className:"stores-section",children:[e.jsxRuntimeExports.jsxs(e.View,{className:"section-header",children:[e.jsxRuntimeExports.jsx(e.Text,{className:"section-title",children:"\u95e8\u5e97\u9884\u7ea6"}),e.jsxRuntimeExports.jsxs(e.Text,{className:"more-link",onClick:g,children:["\u66f4\u591a\u95e8\u5e97",e.jsxRuntimeExports.jsx(t.AtIcon,{value:"chevron-right",size:"14",color:"#a40035"})]})]}),e.jsxRuntimeExports.jsx(e.View,{className:"store-list",children:x.map(s=>e.jsxRuntimeExports.jsx(a,{store:s,onClick:()=>w(s)},s.id))})]}),e.jsxRuntimeExports.jsxs(e.View,{className:"therapists-section",children:[e.jsxRuntimeExports.jsxs(e.View,{className:"section-header",children:[e.jsxRuntimeExports.jsx(e.Text,{className:"section-title",children:"\u63a8\u62ff\u5e08\u9884\u7ea6"}),e.jsxRuntimeExports.jsxs(e.Text,{className:"more-link",onClick:V,children:["\u66f4\u591a\u75c7\u72b6",e.jsxRuntimeExports.jsx(t.AtIcon,{value:"chevron-right",size:"14",color:"#a40035"})]})]}),e.jsxRuntimeExports.jsx(e.View,{className:"therapist-list",children:j.map(s=>e.jsxRuntimeExports.jsx(o,{therapist:s,onClick:()=>v(s)},s.id))})]}),e.jsxRuntimeExports.jsxs(c,{visible:d,title:"\u66f4\u591a\u95e8\u5e97",onClose:()=>h(!1),height:"80%",children:[e.jsxRuntimeExports.jsxs(e.View,{className:"store-sheet-header",children:[e.jsxRuntimeExports.jsxs(e.View,{className:"city-selector",children:[e.jsxRuntimeExports.jsx(e.Text,{className:"city-name",children:"\u4e0a\u6d77\u5e02"}),e.jsxRuntimeExports.jsx(e.Text,{className:"city-arrow",children:"\u25bc"})]}),e.jsxRuntimeExports.jsxs(e.View,{className:"search-box",children:[e.jsxRuntimeExports.jsx(t.AtIcon,{value:"search",size:"16",color:"#999"}),e.jsxRuntimeExports.jsx(e.Input,{className:"search-input",placeholder:"\u641c\u7d22\u95e8\u5e97",value:E,onInput:s=>R(s.detail.value)})]})]}),e.jsxRuntimeExports.jsx(e.View,{className:"store-sheet-list",children:m.filter(s=>""===E||s.name.includes(E)||s.address.includes(E)).map(s=>e.jsxRuntimeExports.jsx(a,{store:s,onClick:()=>{w(s),h(!1)}},s.id))})]})]})};var u={};Page(e.createPageConfig(m,"pages/appointment/index",{root:{cn:[]}},u||{}));
