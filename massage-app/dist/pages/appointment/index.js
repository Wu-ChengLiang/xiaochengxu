"use strict";var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,o=(e,s)=>{for(var t in s||(s={}))i.call(s,t)&&n(e,t,s[t]);if(r)for(var t of r(s))a.call(s,t)&&n(e,t,s[t]);return e},c=(e,r)=>s(e,t(r)),l=(e,s,t)=>new Promise((r,i)=>{var a=e=>{try{o(t.next(e))}catch(s){i(s)}},n=e=>{try{o(t.throw(e))}catch(s){i(s)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,n);o((t=t.apply(e,s)).next())});const x=require("../../taro.js"),u=require("../../vendors.js"),m=require("../../common.js"),p="",j=({store:e,onClick:s})=>{const t=e=>{switch(e){case"normal":return"\u5c31\u8fd1";case"busy":return"\u7e41\u5fd9";case"full":return"\u7206\u6ee1";default:return""}},r=e=>{switch(e){case"normal":return"status-normal";case"busy":return"status-busy";case"full":return"status-full";default:return""}};return x.jsxRuntimeExports.jsx(x.View,{className:"store-card",onClick:s,children:x.jsxRuntimeExports.jsxs(x.View,{className:"card-content",children:[x.jsxRuntimeExports.jsx(x.View,{className:"store-image-wrapper",children:x.jsxRuntimeExports.jsx(x.Image,{className:"store-image",src:m.normalizeImageUrl(e.image),mode:"aspectFill"})}),x.jsxRuntimeExports.jsxs(x.View,{className:"store-info",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"store-name",children:e.name}),x.jsxRuntimeExports.jsxs(x.View,{className:"business-hours",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"hours-text",children:e.businessHours}),x.jsxRuntimeExports.jsx(x.Text,{className:`status ${r(e.status)}`,children:t(e.status)})]}),x.jsxRuntimeExports.jsx(x.View,{className:"store-address",children:x.jsxRuntimeExports.jsx(x.Text,{className:"address-text",numberOfLines:1,children:e.address})}),x.jsxRuntimeExports.jsxs(x.View,{className:"store-footer",children:[void 0!==e.distance&&null!==e.distance&&x.jsxRuntimeExports.jsxs(x.View,{className:"distance",children:[x.jsxRuntimeExports.jsx(u.AtIcon,{value:"map-pin",size:"12",color:"#999"}),x.jsxRuntimeExports.jsxs(x.Text,{className:"distance-text",children:[e.distance,"km"]})]}),x.jsxRuntimeExports.jsx(m.BookingButton,{size:"small"})]})]})]})})},d="",h=({therapist:e,onClick:s})=>{const[t,r]=x.reactExports.useState(null),[i,a]=x.reactExports.useState(!0);x.reactExports.useEffect(()=>{const s=()=>l(exports,null,function*(){try{const s=yield m.reviewService.getReviewStats(e.id);r(s)}catch(s){console.error("\u83b7\u53d6\u63a8\u62ff\u5e08\u8bc4\u4ef7\u7edf\u8ba1\u5931\u8d25:",s),r(null)}finally{a(!1)}});s()},[e.id]);const n=()=>i?"...":t&&0!==t.totalCount?`${t.averageRating}\u5206`:"\u5f85\u8bc4\u4ef7";return x.jsxRuntimeExports.jsx(x.View,{className:"therapist-card",onClick:s,children:x.jsxRuntimeExports.jsxs(x.View,{className:"card-content",children:[x.jsxRuntimeExports.jsx(x.Image,{className:"therapist-avatar",src:e.avatar,mode:"aspectFill"}),x.jsxRuntimeExports.jsxs(x.View,{className:"therapist-info",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"info-header",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"therapist-name",children:e.name}),void 0!==e.distance&&null!==e.distance&&x.jsxRuntimeExports.jsxs(x.View,{className:"distance",children:[x.jsxRuntimeExports.jsx(u.AtIcon,{value:"map-pin",size:"12",color:"#999"}),x.jsxRuntimeExports.jsxs(x.Text,{className:"distance-text",children:[e.distance,"km"]})]})]}),x.jsxRuntimeExports.jsx(x.View,{className:"expertise-tags",children:e.expertise.map((e,s)=>x.jsxRuntimeExports.jsx(x.Text,{className:"expertise-tag",children:e},s))}),x.jsxRuntimeExports.jsxs(x.View,{className:"therapist-footer",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"rating",children:[x.jsxRuntimeExports.jsx(u.AtIcon,{value:"star-2",size:"12",color:"#faad14"}),x.jsxRuntimeExports.jsx(x.Text,{className:"rating-text",children:n()})]}),x.jsxRuntimeExports.jsx(m.BookingButton,{size:"small"})]})]})]})})},E="",R=({visible:e,title:s,onClose:t,children:r,height:i="70%"})=>{const[a,n]=x.reactExports.useState(!1),[o,c]=x.reactExports.useState(!1);x.reactExports.useEffect(()=>{e?(c(!0),setTimeout(()=>n(!0),50)):(n(!1),setTimeout(()=>c(!1),300))},[e]);const l=()=>{t()},m=e=>{e.stopPropagation()};return o?x.jsxRuntimeExports.jsxs(x.View,{className:"bottom-sheet",onClick:l,children:[x.jsxRuntimeExports.jsx(x.View,{className:"bottom-sheet-mask "+(a?"active":"")}),x.jsxRuntimeExports.jsxs(x.View,{className:"bottom-sheet-content "+(a?"active":""),style:{height:i},onClick:m,children:[x.jsxRuntimeExports.jsxs(x.View,{className:"sheet-header",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"sheet-title",children:s}),x.jsxRuntimeExports.jsx(x.View,{className:"close-btn",onClick:t,children:x.jsxRuntimeExports.jsx(u.AtIcon,{value:"close",size:"20",color:"#999"})})]}),x.jsxRuntimeExports.jsx(x.View,{className:"sheet-body",children:r})]})]}):null},N="",w=()=>{const[e,s]=x.reactExports.useState(!0),[t,r]=x.reactExports.useState([]),[i,a]=x.reactExports.useState([]),[n,p]=x.reactExports.useState([]),[d,E]=x.reactExports.useState(!1),[N,w]=x.reactExports.useState(""),[g,v]=x.reactExports.useState(!1),[y,f]=x.reactExports.useState(""),[V,T]=x.reactExports.useState([]),[b,S]=x.reactExports.useState(!1),[k,I]=x.reactExports.useState(null);x.reactExports.useEffect(()=>{C()},[]);const C=()=>l(exports,null,function*(){try{s(!0);const t=yield m.getLocationService.getCurrentLocation();I(t);try{const e=yield m.storeService.getNearbyStores(t.latitude,t.longitude,1,2);r(e.list)}catch(e){console.error("\u274c \u83b7\u53d6\u9644\u8fd1\u95e8\u5e97\u5931\u8d25:",e),x.Taro.showToast({title:"\u83b7\u53d6\u9644\u8fd1\u95e8\u5e97\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",icon:"none"}),r([])}try{const e=yield m.storeService.getNearbyStores(t.latitude,t.longitude,1,80);a(e.list)}catch(e){console.error("\u274c \u83b7\u53d6\u6240\u6709\u95e8\u5e97\u5931\u8d25:",e),a([])}try{const e=yield m.therapistService.getRecommendedTherapistsWithDistance(1,10);p(e.list)}catch(e){console.error("\u274c \u83b7\u53d6\u63a8\u8350\u63a8\u62ff\u5e08\u5931\u8d25:",e),x.Taro.showToast({title:"\u83b7\u53d6\u63a8\u62ff\u5e08\u5217\u8868\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",icon:"none"}),p([])}}catch(e){console.error("\u274c \u52a0\u8f7d\u9875\u9762\u6570\u636e\u5931\u8d25:",e),x.Taro.showToast({title:"\u9875\u9762\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",icon:"none"})}finally{s(!1)}}),z=e=>{x.Taro.navigateTo({url:`/pages/appointment/store/index?id=${e.id}`})},P=e=>{x.Taro.navigateTo({url:`/pages/appointment/therapist/index?therapistId=${e.id}&storeId=${e.storeId}`})},O=()=>{E(!0)},A=()=>l(exports,null,function*(){v(!0),f(""),S(!0);try{const e=yield m.therapistService.getRecommendedTherapistsWithDistance(1,100),s=yield $(e.list||[]);T(s)}catch(e){console.error("\u83b7\u53d6\u5168\u90e8\u6280\u5e08\u5931\u8d25:",e),T([])}finally{S(!1)}}),$=e=>l(exports,null,function*(){if(!k)return e;try{const s=yield Promise.all(e.map(e=>l(exports,null,function*(){try{const s=yield m.storeService.getStoreDetail(e.storeId),t=(null==s?void 0:s.data)||s;let r=null;return(null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(r=m.getLocationService.calculateDistance(k.latitude,k.longitude,t.latitude,t.longitude)),c(o({},e),{distance:r})}catch(s){return console.warn(`\u83b7\u53d6\u6280\u5e08 ${e.id} \u95e8\u5e97\u4fe1\u606f\u5931\u8d25:`,s),c(o({},e),{distance:null})}})));return s}catch(s){return console.error("\u8ba1\u7b97\u8ddd\u79bb\u5931\u8d25:",s),e}}),D=e=>l(exports,null,function*(){if(f(e),""!==e.trim())try{S(!0);const s=yield m.therapistService.searchTherapists(e,1,10);console.log("\u2705 \u641c\u7d22\u6280\u5e08\u7ed3\u679c:",s);const t=yield $(s.list||[]);T(t)}catch(s){console.error("\u641c\u7d22\u6280\u5e08\u5931\u8d25:",s),x.Taro.showToast({title:"\u641c\u7d22\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none"}),T([])}finally{S(!1)}else T([])});return x.jsxRuntimeExports.jsxs(x.View,{className:"appointment-page",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"stores-section",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"section-header",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"section-title",children:"\u95e8\u5e97\u9884\u7ea6"}),x.jsxRuntimeExports.jsxs(x.Text,{className:"more-link",onClick:O,children:["\u66f4\u591a\u95e8\u5e97",x.jsxRuntimeExports.jsx(u.AtIcon,{value:"chevron-right",size:"14",color:"#a40035"})]})]}),x.jsxRuntimeExports.jsx(x.View,{className:"store-list",children:t.map(e=>x.jsxRuntimeExports.jsx(j,{store:e,onClick:()=>z(e)},e.id))})]}),x.jsxRuntimeExports.jsxs(x.View,{className:"therapists-section",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"section-header",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"section-title",children:"\u63a8\u62ff\u5e08\u9884\u7ea6"}),x.jsxRuntimeExports.jsxs(x.Text,{className:"more-link",onClick:A,children:["\u66f4\u591a\u6280\u5e08",x.jsxRuntimeExports.jsx(u.AtIcon,{value:"chevron-right",size:"14",color:"#a40035"})]})]}),x.jsxRuntimeExports.jsx(x.View,{className:"therapist-list",children:n.map(e=>x.jsxRuntimeExports.jsx(h,{therapist:e,onClick:()=>P(e)},e.id))})]}),x.jsxRuntimeExports.jsxs(R,{visible:d,title:"\u66f4\u591a\u95e8\u5e97",onClose:()=>E(!1),height:"80%",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"store-sheet-header",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"city-selector",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"city-name",children:"\u4e0a\u6d77\u5e02"}),x.jsxRuntimeExports.jsx(x.Text,{className:"city-arrow",children:"\u25bc"})]}),x.jsxRuntimeExports.jsxs(x.View,{className:"search-box",children:[x.jsxRuntimeExports.jsx(u.AtIcon,{value:"search",size:"16",color:"#999"}),x.jsxRuntimeExports.jsx(x.Input,{className:"search-input",placeholder:"\u641c\u7d22\u95e8\u5e97",value:N,onInput:e=>w(e.detail.value)})]})]}),x.jsxRuntimeExports.jsx(x.View,{className:"store-sheet-list",children:i.filter(e=>""===N||e.name.includes(N)||e.address.includes(N)).map(e=>x.jsxRuntimeExports.jsx(j,{store:e,onClick:()=>{z(e),E(!1)}},e.id))})]}),x.jsxRuntimeExports.jsxs(R,{visible:g,title:"\u66f4\u591a\u6280\u5e08",onClose:()=>v(!1),height:"80%",children:[x.jsxRuntimeExports.jsx(x.View,{className:"therapist-sheet-header",children:x.jsxRuntimeExports.jsxs(x.View,{className:"search-box",children:[x.jsxRuntimeExports.jsx(u.AtIcon,{value:"search",size:"16",color:"#999"}),x.jsxRuntimeExports.jsx(x.Input,{className:"search-input",placeholder:"\u641c\u7d22\u63a8\u62ff\u5e08",value:y,onInput:e=>D(e.detail.value)})]})}),b&&x.jsxRuntimeExports.jsx(x.View,{className:"therapist-sheet-list loading",children:x.jsxRuntimeExports.jsx(x.Text,{children:"\u641c\u7d22\u4e2d..."})}),!b&&x.jsxRuntimeExports.jsx(x.View,{className:"therapist-sheet-list",children:0===V.length?x.jsxRuntimeExports.jsx(x.View,{className:"empty-state",children:x.jsxRuntimeExports.jsx(x.Text,{children:"\u672a\u627e\u5230\u5339\u914d\u7684\u63a8\u62ff\u5e08"})}):V.map(e=>x.jsxRuntimeExports.jsx(h,{therapist:e,onClick:()=>{P(e),v(!1)}},e.id))})]})]})};var g={};Page(x.createPageConfig(w,"pages/appointment/index",{root:{cn:[]}},g||{}));
