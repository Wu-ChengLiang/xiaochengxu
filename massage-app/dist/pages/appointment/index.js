"use strict";var e=(e,s,t)=>new Promise((r,i)=>{var a=e=>{try{o(t.next(e))}catch(s){i(s)}},n=e=>{try{o(t.throw(e))}catch(s){i(s)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,n);o((t=t.apply(e,s)).next())});const s=require("../../taro.js"),t=require("../../vendors.js"),r=require("../../common.js"),i="",a=({store:e,onClick:i})=>{const a=e=>{switch(e){case"normal":return"\u5c31\u8fd1";case"busy":return"\u7e41\u5fd9";case"full":return"\u7206\u6ee1";default:return""}},n=e=>{switch(e){case"normal":return"status-normal";case"busy":return"status-busy";case"full":return"status-full";default:return""}};return s.jsxRuntimeExports.jsx(s.View,{className:"store-card",onClick:i,children:s.jsxRuntimeExports.jsxs(s.View,{className:"card-content",children:[s.jsxRuntimeExports.jsx(s.View,{className:"store-image-wrapper",children:s.jsxRuntimeExports.jsx(s.Image,{className:"store-image",src:r.normalizeImageUrl(e.image),mode:"aspectFill"})}),s.jsxRuntimeExports.jsxs(s.View,{className:"store-info",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"store-name",children:e.name}),s.jsxRuntimeExports.jsxs(s.View,{className:"business-hours",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"hours-text",children:e.businessHours}),s.jsxRuntimeExports.jsx(s.Text,{className:`status ${n(e.status)}`,children:a(e.status)})]}),s.jsxRuntimeExports.jsx(s.View,{className:"store-address",children:s.jsxRuntimeExports.jsx(s.Text,{className:"address-text",numberOfLines:1,children:e.address})}),s.jsxRuntimeExports.jsxs(s.View,{className:"store-footer",children:[void 0!==e.distance&&null!==e.distance&&s.jsxRuntimeExports.jsxs(s.View,{className:"distance",children:[s.jsxRuntimeExports.jsx(t.AtIcon,{value:"map-pin",size:"12",color:"#999"}),s.jsxRuntimeExports.jsxs(s.Text,{className:"distance-text",children:[e.distance,"km"]})]}),s.jsxRuntimeExports.jsx(r.BookingButton,{size:"small"})]})]})]})})},n="",o=({therapist:i,onClick:a})=>{const[n,o]=s.reactExports.useState(null),[c,x]=s.reactExports.useState(!0);s.reactExports.useEffect(()=>{const s=()=>e(exports,null,function*(){try{const e=yield r.reviewService.getReviewStats(i.id);o(e)}catch(e){console.error("\u83b7\u53d6\u63a8\u62ff\u5e08\u8bc4\u4ef7\u7edf\u8ba1\u5931\u8d25:",e),o(null)}finally{x(!1)}});s()},[i.id]);const l=()=>c?"...":n&&0!==n.totalCount?`${n.averageRating}\u5206`:"\u5f85\u8bc4\u4ef7";return s.jsxRuntimeExports.jsx(s.View,{className:"therapist-card",onClick:a,children:s.jsxRuntimeExports.jsxs(s.View,{className:"card-content",children:[s.jsxRuntimeExports.jsx(s.Image,{className:"therapist-avatar",src:i.avatar,mode:"aspectFill"}),s.jsxRuntimeExports.jsxs(s.View,{className:"therapist-info",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"info-header",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"therapist-name",children:i.name}),void 0!==i.distance&&null!==i.distance&&s.jsxRuntimeExports.jsxs(s.View,{className:"distance",children:[s.jsxRuntimeExports.jsx(t.AtIcon,{value:"map-pin",size:"12",color:"#999"}),s.jsxRuntimeExports.jsxs(s.Text,{className:"distance-text",children:[i.distance,"km"]})]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"expertise-tags",children:i.expertise.map((e,t)=>s.jsxRuntimeExports.jsx(s.Text,{className:"expertise-tag",children:e},t))}),s.jsxRuntimeExports.jsxs(s.View,{className:"therapist-footer",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"rating",children:[s.jsxRuntimeExports.jsx(t.AtIcon,{value:"star-2",size:"12",color:"#faad14"}),s.jsxRuntimeExports.jsx(s.Text,{className:"rating-text",children:l()})]}),s.jsxRuntimeExports.jsx(r.BookingButton,{size:"small"})]})]})]})})},c="",x=({visible:e,title:r,onClose:i,children:a,height:n="70%"})=>{const[o,c]=s.reactExports.useState(!1),[x,l]=s.reactExports.useState(!1);s.reactExports.useEffect(()=>{e?(l(!0),setTimeout(()=>c(!0),50)):(c(!1),setTimeout(()=>l(!1),300))},[e]);const m=()=>{i()},u=e=>{e.stopPropagation()};return x?s.jsxRuntimeExports.jsxs(s.View,{className:"bottom-sheet",onClick:m,children:[s.jsxRuntimeExports.jsx(s.View,{className:"bottom-sheet-mask "+(o?"active":"")}),s.jsxRuntimeExports.jsxs(s.View,{className:"bottom-sheet-content "+(o?"active":""),style:{height:n},onClick:u,children:[s.jsxRuntimeExports.jsxs(s.View,{className:"sheet-header",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"sheet-title",children:r}),s.jsxRuntimeExports.jsx(s.View,{className:"close-btn",onClick:i,children:s.jsxRuntimeExports.jsx(t.AtIcon,{value:"close",size:"20",color:"#999"})})]}),s.jsxRuntimeExports.jsx(s.View,{className:"sheet-body",children:a})]})]}):null},l="",m=()=>{const[i,n]=s.reactExports.useState(!0),[c,l]=s.reactExports.useState([]),[m,u]=s.reactExports.useState([]),[j,p]=s.reactExports.useState([]),[d,h]=s.reactExports.useState(!1),[E,R]=s.reactExports.useState("");s.reactExports.useEffect(()=>{N()},[]);const N=()=>e(exports,null,function*(){try{n(!0);const t=yield r.getLocationService.getCurrentLocation();try{const e=yield r.storeService.getNearbyStores(t.latitude,t.longitude,1,2);l(e.list)}catch(e){console.error("\u274c \u83b7\u53d6\u9644\u8fd1\u95e8\u5e97\u5931\u8d25:",e),s.Taro.showToast({title:"\u83b7\u53d6\u9644\u8fd1\u95e8\u5e97\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",icon:"none"}),l([])}try{const e=yield r.storeService.getNearbyStores(t.latitude,t.longitude,1,20);u(e.list)}catch(e){console.error("\u274c \u83b7\u53d6\u6240\u6709\u95e8\u5e97\u5931\u8d25:",e),u([])}try{const e=yield r.therapistService.getRecommendedTherapistsWithDistance(1,10);p(e.list)}catch(e){console.error("\u274c \u83b7\u53d6\u63a8\u8350\u63a8\u62ff\u5e08\u5931\u8d25:",e),s.Taro.showToast({title:"\u83b7\u53d6\u63a8\u62ff\u5e08\u5217\u8868\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",icon:"none"}),p([])}}catch(e){console.error("\u274c \u52a0\u8f7d\u9875\u9762\u6570\u636e\u5931\u8d25:",e),s.Taro.showToast({title:"\u9875\u9762\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",icon:"none"})}finally{n(!1)}}),w=e=>{s.Taro.navigateTo({url:`/pages/appointment/store/index?id=${e.id}`})},g=e=>{s.Taro.navigateTo({url:`/pages/appointment/therapist/index?therapistId=${e.id}&storeId=${e.storeId}`})},v=()=>{h(!0)},V=()=>{s.Taro.showToast({title:"\u529f\u80fd\u5f00\u53d1\u4e2d",icon:"none"})};return s.jsxRuntimeExports.jsxs(s.View,{className:"appointment-page",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"stores-section",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"section-header",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"section-title",children:"\u95e8\u5e97\u9884\u7ea6"}),s.jsxRuntimeExports.jsxs(s.Text,{className:"more-link",onClick:v,children:["\u66f4\u591a\u95e8\u5e97",s.jsxRuntimeExports.jsx(t.AtIcon,{value:"chevron-right",size:"14",color:"#a40035"})]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"store-list",children:c.map(e=>s.jsxRuntimeExports.jsx(a,{store:e,onClick:()=>w(e)},e.id))})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"therapists-section",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"section-header",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"section-title",children:"\u63a8\u62ff\u5e08\u9884\u7ea6"}),s.jsxRuntimeExports.jsxs(s.Text,{className:"more-link",onClick:V,children:["\u66f4\u591a\u75c7\u72b6",s.jsxRuntimeExports.jsx(t.AtIcon,{value:"chevron-right",size:"14",color:"#a40035"})]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"therapist-list",children:j.map(e=>s.jsxRuntimeExports.jsx(o,{therapist:e,onClick:()=>g(e)},e.id))})]}),s.jsxRuntimeExports.jsxs(x,{visible:d,title:"\u66f4\u591a\u95e8\u5e97",onClose:()=>h(!1),height:"80%",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"store-sheet-header",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"city-selector",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"city-name",children:"\u4e0a\u6d77\u5e02"}),s.jsxRuntimeExports.jsx(s.Text,{className:"city-arrow",children:"\u25bc"})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"search-box",children:[s.jsxRuntimeExports.jsx(t.AtIcon,{value:"search",size:"16",color:"#999"}),s.jsxRuntimeExports.jsx(s.Input,{className:"search-input",placeholder:"\u641c\u7d22\u95e8\u5e97",value:E,onInput:e=>R(e.detail.value)})]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"store-sheet-list",children:m.filter(e=>""===E||e.name.includes(E)||e.address.includes(E)).map(e=>s.jsxRuntimeExports.jsx(a,{store:e,onClick:()=>{w(e),h(!1)}},e.id))})]})]})};var u={};Page(s.createPageConfig(m,"pages/appointment/index",{root:{cn:[]}},u||{}));
