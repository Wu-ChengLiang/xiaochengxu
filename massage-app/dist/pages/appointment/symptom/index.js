"use strict";var e=Object.defineProperty,i=Object.defineProperties,s=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,c=(i,s,t)=>s in i?e(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t,n=(e,i)=>{for(var s in i||(i={}))a.call(i,s)&&c(e,s,i[s]);if(t)for(var s of t(i))r.call(i,s)&&c(e,s,i[s]);return e},o=(e,t)=>i(e,s(t)),l=(e,i,s)=>new Promise((t,a)=>{var r=e=>{try{n(s.next(e))}catch(i){a(i)}},c=e=>{try{n(s.throw(e))}catch(i){a(i)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,c);n((s=s.apply(e,i)).next())});const d=require("../../../taro.js"),m=require("../../../vendors.js"),p=require("../../../common.js"),x="",u=({categories:e,activeId:i,onChange:s,className:t})=>d.jsxRuntimeExports.jsx(d.ScrollView,{className:m.classNames("symptom-category-tabs",t),scrollY:!0,showScrollbar:!1,children:e.map(e=>d.jsxRuntimeExports.jsx(d.View,{className:m.classNames("category-item",{active:e.id===i}),onClick:()=>s(e.id),children:d.jsxRuntimeExports.jsx(d.Text,{className:"category-name",children:e.name})},e.id))}),j="",h=({service:e,onAdd:i,isInCart:s=!1,className:t})=>{const a={available:"\u7a7a\u95f2",busy:"\u7e41\u5fd9",full:"\u7206\u6ee1"},r={available:"status-available",busy:"status-busy",full:"status-full"};return d.jsxRuntimeExports.jsxs(d.View,{className:m.classNames("symptom-service-card",t),children:[d.jsxRuntimeExports.jsxs(d.View,{className:"service-header",children:[d.jsxRuntimeExports.jsx(d.Text,{className:"service-name",children:e.name}),d.jsxRuntimeExports.jsx(d.Text,{className:m.classNames("service-status",r[e.availability]),children:a[e.availability]})]}),d.jsxRuntimeExports.jsx(d.Text,{className:"service-description",children:e.description}),d.jsxRuntimeExports.jsxs(d.View,{className:"service-footer",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"service-info",children:[d.jsxRuntimeExports.jsxs(d.Text,{className:"service-duration",children:[e.duration,"\u5206\u949f"]}),d.jsxRuntimeExports.jsxs(d.View,{className:"service-price",children:[d.jsxRuntimeExports.jsxs(d.Text,{className:"price-current",children:["\xa5",e.discountPrice||e.price]}),e.discountPrice&&d.jsxRuntimeExports.jsxs(d.Text,{className:"price-original",children:["\xa5",e.price]})]})]}),d.jsxRuntimeExports.jsx(d.View,{className:m.classNames("add-button",{"in-cart":s,disabled:"full"===e.availability}),onClick:"full"!==e.availability?i:void 0,children:"full"===e.availability?d.jsxRuntimeExports.jsx(d.Text,{className:"button-text",children:"\u5df2\u6ee1"}):d.jsxRuntimeExports.jsx(d.Text,{className:"iconfont icon-add"})})]})]})},v="",y=({services:e,therapists:i,onAddToCart:s,cartServiceIds:t,className:a})=>{const r=i.map(i=>{const s=e.filter(e=>e.therapistId===i.id);return{therapist:i,services:s}}).filter(e=>e.services.length>0);return d.jsxRuntimeExports.jsx(d.ScrollView,{className:`symptom-service-list ${a||""}`,scrollY:!0,showScrollbar:!1,children:d.jsxRuntimeExports.jsx(d.View,{className:"service-list-content",children:r.map(e=>d.jsxRuntimeExports.jsxs(d.View,{className:"therapist-group",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"therapist-header",children:[d.jsxRuntimeExports.jsx(d.Image,{className:"therapist-avatar",src:e.therapist.avatar,mode:"aspectFill"}),d.jsxRuntimeExports.jsxs(d.View,{className:"therapist-info",children:[d.jsxRuntimeExports.jsx(d.Text,{className:"therapist-name",children:e.therapist.name}),d.jsxRuntimeExports.jsxs(d.Text,{className:"therapist-level",children:["LV",e.therapist.level||1]})]}),d.jsxRuntimeExports.jsxs(d.View,{className:"therapist-rating",children:[d.jsxRuntimeExports.jsxs(d.Text,{className:"rating-score",children:[e.therapist.rating,"\u5206"]}),d.jsxRuntimeExports.jsxs(d.Text,{className:"view-details",children:["\u67e5\u770b\u8be6\u60c5",">"]})]})]}),e.services.map(i=>d.jsxRuntimeExports.jsx(h,{service:i,onAdd:()=>s(i,e.therapist.id),isInCart:t.includes(i.id)},i.id))]},e.therapist.id))})})},g="",b=({items:e,onCheckout:i})=>{const[s,t]=d.reactExports.useState(!1),a=e.reduce((e,i)=>e+(i.discountPrice||i.price),0),r=e.reduce((e,i)=>e+i.price,0),c=r-a;return d.jsxRuntimeExports.jsxs(d.View,{className:"shopping-cart",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"cart-summary",onClick:()=>t(!s),children:[d.jsxRuntimeExports.jsx(d.View,{className:"cart-icon",children:d.jsxRuntimeExports.jsx(d.Text,{className:"cart-badge",children:e.length})}),d.jsxRuntimeExports.jsxs(d.View,{className:"price-info",children:[d.jsxRuntimeExports.jsxs(d.Text,{className:"total-price",children:["\xa5",a]}),c>0&&d.jsxRuntimeExports.jsxs(d.Text,{className:"saved-amount",children:["\u5df2\u7701\xa5",c]})]}),d.jsxRuntimeExports.jsx(m.AtButton,{className:"checkout-btn",type:"primary",size:"small",onClick:e=>{e.stopPropagation(),i()},children:"\u53bb\u7ed3\u7b97"})]}),s&&d.jsxRuntimeExports.jsx(d.View,{className:"cart-details",children:e.map((e,i)=>d.jsxRuntimeExports.jsxs(d.View,{className:"cart-item",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"item-info",children:[d.jsxRuntimeExports.jsx(d.Text,{className:"service-name",children:e.serviceName}),d.jsxRuntimeExports.jsxs(d.Text,{className:"therapist-name",children:[e.therapistName," | ",e.duration,"\u5206\u949f"]})]}),d.jsxRuntimeExports.jsx(d.View,{className:"item-price",children:e.discountPrice?d.jsxRuntimeExports.jsxs(d.jsxRuntimeExports.Fragment,{children:[d.jsxRuntimeExports.jsxs(d.Text,{className:"discount-price",children:["\xa5",e.discountPrice]}),d.jsxRuntimeExports.jsxs(d.Text,{className:"original-price",children:["\xa5",e.price]})]}):d.jsxRuntimeExports.jsxs(d.Text,{className:"discount-price",children:["\xa5",e.price]})})]},i))})]})},E=[{id:"1",name:"\u9888\u80a9\u8170\u817f\u75db\u8c03\u7406",order:1},{id:"2",name:"\u809d\u80c6\u813e\u80c3\u8c03\u7406",order:2},{id:"3",name:"\u5931\u7720\u8c03\u7406",order:3},{id:"4",name:"\u5bab\u5bd2\u75db\u7ecf\u8c03\u7406",order:4},{id:"5",name:"\u8159\u7b4b\u6839\u9ab6",order:5},{id:"6",name:"\u8fd0\u52a8\u62c9\u4f38",order:6},{id:"7",name:"\u4f53\u6001\u8c03\u7406",order:7}],N=[{id:"s1",categoryId:"1",name:"\u9888\u690e\u8c03\u7406",description:"\u7f13\u89e3\u9888\u690e\u75bc\u75db\u3001\u843d\u6795",duration:60,price:258,discountPrice:229,availability:"available"},{id:"s2",categoryId:"1",name:"\u80a9\u5468\u708e\u8c03\u7406",description:"\u6539\u5584\u80a9\u90e8\u6d3b\u52a8\u53d7\u9650",duration:60,price:258,discountPrice:229,availability:"available"},{id:"s3",categoryId:"1",name:"\u8170\u817f\u75db\u8c03\u7406",description:"\u7f13\u89e3\u8170\u90e8\u53ca\u817f\u90e8\u75bc\u75db",duration:70,price:298,discountPrice:268,availability:"available"},{id:"s4",categoryId:"2",name:"\u813e\u80c3\u8c03\u7406",description:"\u6539\u5584\u6d88\u5316\u529f\u80fd",duration:60,price:238,discountPrice:218,availability:"available"},{id:"s5",categoryId:"2",name:"\u809d\u80c6\u758f\u901a",description:"\u758f\u809d\u7406\u6c14\u3001\u6392\u6bd2\u517b\u989c",duration:60,price:258,discountPrice:238,availability:"busy"},{id:"s6",categoryId:"2",name:"\u6d88\u5316\u7cfb\u7edf\u8c03\u7406",description:"\u8c03\u7406\u80a0\u80c3\u3001\u6539\u5584\u4fbf\u79d8",duration:50,price:218,discountPrice:198,availability:"available"},{id:"s7",categoryId:"3",name:"\u5b89\u795e\u52a9\u7720",description:"\u6539\u5584\u7761\u7720\u8d28\u91cf",duration:60,price:268,discountPrice:248,availability:"available"},{id:"s8",categoryId:"3",name:"\u5934\u90e8\u653e\u677e",description:"\u7f13\u89e3\u5934\u75db\u3001\u7cbe\u795e\u538b\u529b",duration:45,price:198,discountPrice:178,availability:"available"},{id:"s9",categoryId:"3",name:"\u6df1\u5ea6\u7761\u7720\u8c03\u7406",description:"\u8c03\u8282\u795e\u7ecf\u7cfb\u7edf\u3001\u6df1\u5ea6\u653e\u677e",duration:70,price:318,discountPrice:288,availability:"busy"},{id:"s10",categoryId:"4",name:"\u6e29\u5bab\u6696\u5de2",description:"\u8c03\u7406\u5bab\u5bd2\u3001\u6539\u5584\u624b\u811a\u51b0\u51c9",duration:60,price:278,discountPrice:258,availability:"available"},{id:"s11",categoryId:"4",name:"\u75db\u7ecf\u8c03\u7406",description:"\u7f13\u89e3\u7ecf\u671f\u4e0d\u9002",duration:50,price:238,discountPrice:218,availability:"available"},{id:"s12",categoryId:"4",name:"\u5987\u79d1\u4fdd\u517b",description:"\u8c03\u7406\u6708\u7ecf\u4e0d\u8c03\u3001\u4fdd\u517b\u5375\u5de2",duration:70,price:328,discountPrice:298,availability:"available"},{id:"s13",categoryId:"5",name:"\u7b4b\u819c\u677e\u89e3",description:"\u6df1\u5c42\u7b4b\u819c\u653e\u677e",duration:60,price:298,discountPrice:268,availability:"available"},{id:"s14",categoryId:"5",name:"\u6839\u9ab6\u8c03\u7406",description:"\u9ab6\u9aa8\u77eb\u6b63\u3001\u9aa8\u76c6\u8c03\u6574",duration:70,price:358,discountPrice:328,availability:"busy"},{id:"s15",categoryId:"6",name:"\u8fd0\u52a8\u540e\u6062\u590d",description:"\u7f13\u89e3\u8fd0\u52a8\u540e\u808c\u8089\u9178\u75db",duration:50,price:198,discountPrice:178,availability:"available"},{id:"s16",categoryId:"6",name:"\u7b4b\u819c\u62c9\u4f38",description:"\u63d0\u5347\u8eab\u4f53\u67d4\u97e7\u6027",duration:60,price:238,discountPrice:218,availability:"available"},{id:"s17",categoryId:"6",name:"\u8fd0\u52a8\u635f\u4f24\u8c03\u7406",description:"\u8fd0\u52a8\u635f\u4f24\u5eb7\u590d\u8c03\u7406",duration:70,price:288,discountPrice:258,availability:"available"},{id:"s18",categoryId:"7",name:"\u4f53\u6001\u77eb\u6b63",description:"\u6539\u5584\u4e0d\u826f\u4f53\u6001",duration:60,price:278,discountPrice:248,availability:"available"},{id:"s19",categoryId:"7",name:"\u9a7c\u80cc\u8c03\u7406",description:"\u6539\u5584\u9a7c\u80cc\u3001\u5706\u80a9",duration:60,price:268,discountPrice:238,availability:"available"},{id:"s20",categoryId:"7",name:"\u9aa8\u76c6\u77eb\u6b63",description:"\u8c03\u6574\u9aa8\u76c6\u524d\u503e\u3001\u540e\u503e",duration:70,price:328,discountPrice:298,availability:"full"}],R=e=>N.map(i=>o(n({},i),{therapistId:e,availability:Math.random()>.7?"busy":i.availability})),f=e=>new Promise(i=>setTimeout(i,e)),w={getCategories(){return l(this,null,function*(){return yield f(100),{code:200,data:E,message:"success"}})},getTherapistSymptomServices(e){return l(this,null,function*(){if(yield f(200),!e)throw new Error("\u63a8\u62ff\u5e08ID\u4e0d\u80fd\u4e3a\u7a7a");const i=R(e);return{code:200,data:i,message:"success"}})},getStoreSymptomServices(e){return l(this,null,function*(){if(yield f(200),!e)throw new Error("\u95e8\u5e97ID\u4e0d\u80fd\u4e3a\u7a7a");const i=p.mockTherapists.filter(i=>i.storeId===e),s=[];return i.forEach(e=>{const i=R(e.id);i.forEach(i=>{s.push(o(n({},i),{therapistId:e.id,therapistName:e.name,therapistAvatar:e.avatar}))})}),{code:200,data:s,message:"success"}})},getServicesByCategory(e,i){return l(this,null,function*(){yield f(150);const s=R(e),t=s.filter(e=>e.categoryId===i);return{code:200,data:t,message:"success"}})}},I="",P=()=>{const e=d.taroExports.useRouter(),{storeId:i,storeName:s,selectedDate:t,selectedTime:a}=e.params,[r,c]=d.reactExports.useState([]),[n,o]=d.reactExports.useState([]),[l,m]=d.reactExports.useState([]),[x,j]=d.reactExports.useState(""),[h,v]=d.reactExports.useState([]),[g,E]=d.reactExports.useState(!0);d.reactExports.useEffect(()=>{i&&p.therapistService.getTherapistsByStore(i).then(e=>{c(e.list)})},[i]),d.reactExports.useEffect(()=>{w.getCategories().then(e=>{o(e.data),e.data.length>0&&j(e.data[0].id)})},[]),d.reactExports.useEffect(()=>{i&&(E(!0),w.getStoreSymptomServices(i).then(e=>{m(e.data),E(!1)}))},[i]);const N=d.reactExports.useMemo(()=>l.filter(e=>e.categoryId===x),[l,x]),R=d.reactExports.useMemo(()=>h.map(e=>e.serviceId),[h]),f=(e,i)=>{const s=r.find(e=>e.id===i);if(!s)return;const c={serviceId:e.id,serviceName:e.name,duration:e.duration,price:e.price,discountPrice:e.discountPrice,date:t||(new Date).toISOString().split("T")[0],time:a||"\u5f85\u9009\u62e9",therapistName:s.name,therapistAvatar:s.avatar};v([...h,c]),d.Taro.showToast({title:"\u5df2\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66",icon:"none"})},I=()=>{if(0===h.length)return void d.Taro.showToast({title:"\u8bf7\u5148\u9009\u62e9\u670d\u52a1\u9879\u76ee",icon:"none"});const e={items:JSON.stringify(h),storeId:i,storeName:s,from:"symptom"};d.Taro.navigateTo({url:`/pages/booking/confirm/index?${Object.entries(e).map(([e,i])=>`${e}=${encodeURIComponent(i)}`).join("&")}`})};return g?d.jsxRuntimeExports.jsx(d.View,{className:"symptom-page loading",children:"\u52a0\u8f7d\u4e2d..."}):d.jsxRuntimeExports.jsxs(d.View,{className:"symptom-page",children:[d.jsxRuntimeExports.jsxs(d.View,{className:"symptom-content",children:[d.jsxRuntimeExports.jsx(u,{categories:n,activeId:x,onChange:j}),d.jsxRuntimeExports.jsx(y,{services:N,therapists:r,onAddToCart:f,cartServiceIds:R})]}),d.jsxRuntimeExports.jsx(b,{items:h,onCheckout:I})]})};var T={navigationBarTitleText:"\u63a8\u62ff\u5e08\u9884\u7ea6",navigationBarTextStyle:"black",navigationBarBackgroundColor:"#ffffff"};Page(d.createPageConfig(P,"pages/appointment/symptom/index",{root:{cn:[]}},T||{}));
