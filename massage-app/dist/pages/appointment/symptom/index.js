"use strict";var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,c=(e,s)=>{for(var t in s||(s={}))i.call(s,t)&&o(e,t,s[t]);if(r)for(var t of r(s))a.call(s,t)&&o(e,t,s[t]);return e},n=(e,r)=>s(e,t(r)),l=(e,s,t)=>new Promise((r,i)=>{var a=e=>{try{c(t.next(e))}catch(s){i(s)}},o=e=>{try{c(t.throw(e))}catch(s){i(s)}},c=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);c((t=t.apply(e,s)).next())});const m=require("../../../taro.js"),d=require("../../../vendors.js"),p=require("../../../common.js"),u="",x=({categories:e,activeId:s,onChange:t,className:r})=>m.jsxRuntimeExports.jsx(m.ScrollView,{className:d.classNames("symptom-category-tabs",r),scrollY:!0,showScrollbar:!1,children:e.map(e=>m.jsxRuntimeExports.jsx(m.View,{className:d.classNames("category-item",{active:e.id===s}),onClick:()=>t(e.id),children:m.jsxRuntimeExports.jsx(m.Text,{className:"category-name",children:e.name})},e.id))}),h="",j=({service:e,onAdd:s,isInCart:t=!1,className:r})=>m.jsxRuntimeExports.jsxs(m.View,{className:d.classNames("symptom-service-card",r),children:[m.jsxRuntimeExports.jsx(m.View,{className:"service-header",children:m.jsxRuntimeExports.jsx(m.Text,{className:"service-name",children:e.name})}),m.jsxRuntimeExports.jsx(m.Text,{className:"service-description",children:e.description}),m.jsxRuntimeExports.jsxs(m.View,{className:"service-footer",children:[m.jsxRuntimeExports.jsxs(m.View,{className:"service-info",children:[m.jsxRuntimeExports.jsxs(m.Text,{className:"service-duration",children:[e.duration,"\u5206\u949f"]}),m.jsxRuntimeExports.jsxs(m.View,{className:"service-price",children:[m.jsxRuntimeExports.jsxs(m.Text,{className:"price-current",children:["\xa5",e.discountPrice||e.price]}),e.discountPrice&&m.jsxRuntimeExports.jsxs(m.Text,{className:"price-original",children:["\xa5",e.price]})]})]}),m.jsxRuntimeExports.jsx(m.View,{className:d.classNames("add-button",{"in-cart":t,disabled:"full"===e.availability}),onClick:"full"!==e.availability?s:void 0,children:"full"===e.availability?m.jsxRuntimeExports.jsx(m.Text,{className:"button-text",children:"\u5df2\u6ee1"}):m.jsxRuntimeExports.jsx(m.Text,{className:"iconfont icon-add"})})]})]}),v="",g=({services:e,therapists:s,onAddToCart:t,cartServiceIds:r,className:i})=>{const a=e.map(e=>({service:e,availableTherapists:s}));return m.jsxRuntimeExports.jsx(m.ScrollView,{className:`symptom-service-list ${i||""}`,scrollY:!0,showScrollbar:!1,children:m.jsxRuntimeExports.jsx(m.View,{className:"service-list-content",children:a.map(e=>m.jsxRuntimeExports.jsxs(m.View,{className:"service-item-container",children:[m.jsxRuntimeExports.jsx(j,{service:e.service,onAdd:()=>{},isInCart:r.includes(e.service.id)}),m.jsxRuntimeExports.jsx(m.View,{className:"therapist-options",children:e.availableTherapists.map(s=>m.jsxRuntimeExports.jsxs(m.View,{className:"therapist-option",onClick:()=>t(e.service,s.id),children:[m.jsxRuntimeExports.jsx(m.Image,{className:"therapist-mini-avatar",src:s.avatar,mode:"aspectFill"}),m.jsxRuntimeExports.jsx(m.Text,{className:"therapist-name",children:s.name})]},s.id))})]},e.service.id))})})},E=e=>new Promise(s=>setTimeout(s,e)),y={getCategories(){return l(this,null,function*(){return yield E(100),{code:200,data:p.symptomCategories,message:"success"}})},getTherapistSymptomServices(e){return l(this,null,function*(){if(yield E(200),!e)throw new Error("\u63a8\u62ff\u5e08ID\u4e0d\u80fd\u4e3a\u7a7a");const s=getTherapistSymptomServices(e);return{code:200,data:s,message:"success"}})},getStoreSymptomServices(e){return l(this,null,function*(){if(!e)throw new Error("\u95e8\u5e97ID\u4e0d\u80fd\u4e3a\u7a7a");try{const s=yield p.request(`/stores/${e}`),t=s.data.services||[],r=t.map(e=>{const s=e.name;let t="1";return s.includes("\u9888\u80a9")||s.includes("\u8170\u80cc")||s.includes("\u8170\u817f\u75db")?t="1":s.includes("\u809d")||s.includes("\u80ba")||s.includes("\u813e\u80c3")?t="2":s.includes("\u7cbe\u6cb9")||s.includes("SPA")||s.includes("\u82b3\u9999")?t="3":s.includes("\u94fa\u59dc")||s.includes("\u5bab\u5bd2")?t="4":s.includes("\u62d4\u7f50")||s.includes("\u522e\u75e7")?t="5":s.includes("\u808c\u8089")||s.includes("\u653e\u677e")||s.includes("\u758f\u901a")?t="6":s.includes("\u6574\u810a")||s.includes("\u4f53\u6001")?t="7":s.includes("\u5173\u5143\u7078")||s.includes("\u60ac\u7078")?t="2":s.includes("\u5168\u8eab")&&(t="6"),n(c({},e),{categoryId:t,availability:"available",description:e.name})});return{code:200,data:r,message:"success"}}catch(s){return console.error("\u83b7\u53d6\u95e8\u5e97\u670d\u52a1\u5931\u8d25:",s),{code:200,data:[],message:"success"}}})},getServicesByCategory(e,s){return l(this,null,function*(){yield E(150);const t=getTherapistSymptomServices(e),r=t.filter(e=>e.categoryId===s);return{code:200,data:r,message:"success"}})}},f="",N=()=>{const e=m.taroExports.useRouter(),{storeId:s,storeName:t,selectedDate:r,selectedTime:i}=e.params,a=i?decodeURIComponent(i):"",[o,c]=m.reactExports.useState([]),[n,l]=m.reactExports.useState([]),[d,u]=m.reactExports.useState([]),[h,j]=m.reactExports.useState(""),[v,E]=m.reactExports.useState([]),[f,N]=m.reactExports.useState(!0);m.reactExports.useEffect(()=>{s&&p.therapistService.getTherapistsByStore(s).then(e=>{c(e.list)})},[s]),m.reactExports.useEffect(()=>{y.getCategories().then(e=>{l(e.data),e.data.length>0&&j(e.data[0].id)})},[]),m.reactExports.useEffect(()=>{s&&(N(!0),y.getStoreSymptomServices(s).then(e=>{u(e.data),N(!1)}))},[s]);const w=m.reactExports.useMemo(()=>d.filter(e=>e.categoryId===h),[d,h]),R=m.reactExports.useMemo(()=>v.map(e=>e.serviceId),[v]),S=(e,s)=>{console.log("\ud83c\udfaf \u6dfb\u52a0\u5230\u8d2d\u7269\u8f66 - therapistId:",s);const t=o.find(e=>e.id===s);if(console.log("\ud83c\udfaf \u627e\u5230\u7684\u6280\u5e08:",t),!t)return void console.error("\u274c \u672a\u627e\u5230\u6280\u5e08\uff0ctherapistId:",s);const i={serviceId:e.id,serviceName:e.name,duration:e.duration,price:e.price,discountPrice:e.discountPrice,date:r||(new Date).toISOString().split("T")[0],time:a||"10:00",therapistId:t.id,therapistName:t.name,therapistAvatar:t.avatar};console.log("\ud83c\udfaf \u65b0\u8d2d\u7269\u8f66\u9879\u76ee:",i),console.log("\ud83c\udfaf \u65b0\u9879\u76ee\u7684therapistId:",i.therapistId),E([...v,i]),m.Taro.showToast({title:"\u5df2\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66",icon:"none"})},T=()=>{E([]),m.Taro.showToast({title:"\u8d2d\u7269\u8f66\u5df2\u6e05\u7a7a",icon:"none"})},I=e=>{const s=v.filter((s,t)=>t!==e);E(s),m.Taro.showToast({title:"\u5df2\u79fb\u9664\u5546\u54c1",icon:"none"})},b=()=>{var e;if(0===v.length)return void m.Taro.showToast({title:"\u8bf7\u5148\u9009\u62e9\u670d\u52a1\u9879\u76ee",icon:"none"});console.log("\ud83d\udd04 \u51c6\u5907\u7ed3\u7b97\uff0c\u8d2d\u7269\u8f66\u5185\u5bb9:",v),console.log("\ud83d\udd04 \u7b2c\u4e00\u4e2a\u9879\u76ee:",v[0]),console.log("\ud83d\udd04 \u7b2c\u4e00\u4e2a\u9879\u76ee\u7684therapistId:",null==(e=v[0])?void 0:e.therapistId);const r={items:JSON.stringify(v),storeId:s,storeName:t,from:"symptom"};console.log("\ud83d\udd04 \u4f20\u9012\u7684\u53c2\u6570:",r),m.Taro.navigateTo({url:`/pages/booking/confirm/index?${Object.entries(r).map(([e,s])=>`${e}=${encodeURIComponent(s)}`).join("&")}`})};return f?m.jsxRuntimeExports.jsx(m.View,{className:"symptom-page loading",children:"\u52a0\u8f7d\u4e2d..."}):m.jsxRuntimeExports.jsxs(m.View,{className:"symptom-page",children:[m.jsxRuntimeExports.jsxs(m.View,{className:"symptom-content",children:[m.jsxRuntimeExports.jsx(x,{categories:n,activeId:h,onChange:j}),m.jsxRuntimeExports.jsx(g,{services:w,therapists:o,onAddToCart:S,cartServiceIds:R})]}),m.jsxRuntimeExports.jsx(p.ShoppingCart,{items:v,onCheckout:b,onMaskClick:T,onRemoveItem:I,simpleClearMode:!0})]})};var w={navigationBarTitleText:"\u63a8\u62ff\u5e08\u9884\u7ea6",navigationBarTextStyle:"black",navigationBarBackgroundColor:"#ffffff"};Page(m.createPageConfig(N,"pages/appointment/symptom/index",{root:{cn:[]}},w||{}));
