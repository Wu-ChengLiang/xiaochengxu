"use strict";var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,c=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,n=(e,s)=>{for(var t in s||(s={}))i.call(s,t)&&c(e,t,s[t]);if(r)for(var t of r(s))a.call(s,t)&&c(e,t,s[t]);return e},o=(e,r)=>s(e,t(r)),l=(e,s,t)=>new Promise((r,i)=>{var a=e=>{try{n(t.next(e))}catch(s){i(s)}},c=e=>{try{n(t.throw(e))}catch(s){i(s)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,c);n((t=t.apply(e,s)).next())});const m=require("../../../taro.js"),x=require("../../../vendors.js"),p=require("../../../common.js"),u="",d=({categories:e,activeId:s,onChange:t,className:r})=>m.jsxRuntimeExports.jsx(m.ScrollView,{className:x.classNames("symptom-category-tabs",r),scrollY:!0,showScrollbar:!1,children:e.map(e=>m.jsxRuntimeExports.jsx(m.View,{className:x.classNames("category-item",{active:e.id===s}),onClick:()=>t(e.id),children:m.jsxRuntimeExports.jsx(m.Text,{className:"category-name",children:e.name})},e.id))}),j="",h=({service:e,onAdd:s,isInCart:t=!1,className:r})=>{const i={available:"\u7a7a\u95f2",busy:"\u7e41\u5fd9",full:"\u7206\u6ee1"},a={available:"status-available",busy:"status-busy",full:"status-full"};return m.jsxRuntimeExports.jsxs(m.View,{className:x.classNames("symptom-service-card",r),children:[m.jsxRuntimeExports.jsxs(m.View,{className:"service-header",children:[m.jsxRuntimeExports.jsx(m.Text,{className:"service-name",children:e.name}),m.jsxRuntimeExports.jsx(m.Text,{className:x.classNames("service-status",a[e.availability]),children:i[e.availability]})]}),m.jsxRuntimeExports.jsx(m.Text,{className:"service-description",children:e.description}),m.jsxRuntimeExports.jsxs(m.View,{className:"service-footer",children:[m.jsxRuntimeExports.jsxs(m.View,{className:"service-info",children:[m.jsxRuntimeExports.jsxs(m.Text,{className:"service-duration",children:[e.duration,"\u5206\u949f"]}),m.jsxRuntimeExports.jsxs(m.View,{className:"service-price",children:[m.jsxRuntimeExports.jsxs(m.Text,{className:"price-current",children:["\xa5",e.discountPrice||e.price]}),e.discountPrice&&m.jsxRuntimeExports.jsxs(m.Text,{className:"price-original",children:["\xa5",e.price]})]})]}),m.jsxRuntimeExports.jsx(m.View,{className:x.classNames("add-button",{"in-cart":t,disabled:"full"===e.availability}),onClick:"full"!==e.availability?s:void 0,children:"full"===e.availability?m.jsxRuntimeExports.jsx(m.Text,{className:"button-text",children:"\u5df2\u6ee1"}):m.jsxRuntimeExports.jsx(m.Text,{className:"iconfont icon-add"})})]})]})},E="",v=({services:e,therapists:s,onAddToCart:t,cartServiceIds:r,className:i})=>{const a=s.map(s=>{const t=e.filter(e=>e.therapistId===s.id);return{therapist:s,services:t}}).filter(e=>e.services.length>0);return m.jsxRuntimeExports.jsx(m.ScrollView,{className:`symptom-service-list ${i||""}`,scrollY:!0,showScrollbar:!1,children:m.jsxRuntimeExports.jsx(m.View,{className:"service-list-content",children:a.map(e=>m.jsxRuntimeExports.jsxs(m.View,{className:"therapist-group",children:[m.jsxRuntimeExports.jsxs(m.View,{className:"therapist-header",children:[m.jsxRuntimeExports.jsx(m.Image,{className:"therapist-avatar",src:e.therapist.avatar,mode:"aspectFill"}),m.jsxRuntimeExports.jsxs(m.View,{className:"therapist-info",children:[m.jsxRuntimeExports.jsx(m.Text,{className:"therapist-name",children:e.therapist.name}),m.jsxRuntimeExports.jsxs(m.Text,{className:"therapist-level",children:["LV",e.therapist.level||1]})]}),m.jsxRuntimeExports.jsxs(m.View,{className:"therapist-rating",children:[m.jsxRuntimeExports.jsxs(m.Text,{className:"rating-score",children:[e.therapist.rating,"\u5206"]}),m.jsxRuntimeExports.jsxs(m.Text,{className:"view-details",children:["\u67e5\u770b\u8be6\u60c5",">"]})]})]}),e.services.map(s=>m.jsxRuntimeExports.jsx(h,{service:s,onAdd:()=>t(s,e.therapist.id),isInCart:r.includes(s.id)},s.id))]},e.therapist.id))})})},N="",g=({items:e,onCheckout:s})=>{const[t,r]=m.reactExports.useState(!1),i=e.reduce((e,s)=>e+(s.discountPrice||s.price),0),a=e.reduce((e,s)=>e+s.price,0),c=a-i;return m.jsxRuntimeExports.jsxs(m.View,{className:"shopping-cart",children:[m.jsxRuntimeExports.jsxs(m.View,{className:"cart-summary",onClick:()=>r(!t),children:[m.jsxRuntimeExports.jsx(m.View,{className:"cart-icon",children:m.jsxRuntimeExports.jsx(m.Text,{className:"cart-badge",children:e.length})}),m.jsxRuntimeExports.jsxs(m.View,{className:"price-info",children:[m.jsxRuntimeExports.jsxs(m.Text,{className:"total-price",children:["\xa5",i]}),c>0&&m.jsxRuntimeExports.jsxs(m.Text,{className:"saved-amount",children:["\u5df2\u7701\xa5",c]})]}),m.jsxRuntimeExports.jsx(x.AtButton,{className:"checkout-btn",type:"primary",size:"small",onClick:e=>{e.stopPropagation(),s()},children:"\u53bb\u7ed3\u7b97"})]}),t&&m.jsxRuntimeExports.jsx(m.View,{className:"cart-details",children:e.map((e,s)=>m.jsxRuntimeExports.jsxs(m.View,{className:"cart-item",children:[m.jsxRuntimeExports.jsxs(m.View,{className:"item-info",children:[m.jsxRuntimeExports.jsx(m.Text,{className:"service-name",children:e.serviceName}),m.jsxRuntimeExports.jsxs(m.Text,{className:"therapist-name",children:[e.therapistName," | ",e.duration,"\u5206\u949f"]})]}),m.jsxRuntimeExports.jsx(m.View,{className:"item-price",children:e.discountPrice?m.jsxRuntimeExports.jsxs(m.jsxRuntimeExports.Fragment,{children:[m.jsxRuntimeExports.jsxs(m.Text,{className:"discount-price",children:["\xa5",e.discountPrice]}),m.jsxRuntimeExports.jsxs(m.Text,{className:"original-price",children:["\xa5",e.price]})]}):m.jsxRuntimeExports.jsxs(m.Text,{className:"discount-price",children:["\xa5",e.price]})})]},s))})]})},R=e=>new Promise(s=>setTimeout(s,e)),f={getCategories(){return l(this,null,function*(){return yield R(100),{code:200,data:p.symptomCategories,message:"success"}})},getTherapistSymptomServices(e){return l(this,null,function*(){if(yield R(200),!e)throw new Error("\u63a8\u62ff\u5e08ID\u4e0d\u80fd\u4e3a\u7a7a");const s=p.getTherapistSymptomServices(e);return{code:200,data:s,message:"success"}})},getStoreSymptomServices(e){return l(this,null,function*(){if(yield R(200),!e)throw new Error("\u95e8\u5e97ID\u4e0d\u80fd\u4e3a\u7a7a");const s=p.mockTherapists.filter(s=>s.storeId===e),t=[];return s.forEach(e=>{const s=p.getTherapistSymptomServices(e.id);s.forEach(s=>{t.push(o(n({},s),{therapistId:e.id,therapistName:e.name,therapistAvatar:e.avatar}))})}),{code:200,data:t,message:"success"}})},getServicesByCategory(e,s){return l(this,null,function*(){yield R(150);const t=p.getTherapistSymptomServices(e),r=t.filter(e=>e.categoryId===s);return{code:200,data:r,message:"success"}})}},y="",w=()=>{const e=m.taroExports.useRouter(),{storeId:s,storeName:t,selectedDate:r,selectedTime:i}=e.params,[a,c]=m.reactExports.useState([]),[n,o]=m.reactExports.useState([]),[l,x]=m.reactExports.useState([]),[u,j]=m.reactExports.useState(""),[h,E]=m.reactExports.useState([]),[N,R]=m.reactExports.useState(!0);m.reactExports.useEffect(()=>{s&&p.therapistService.getTherapistsByStore(s).then(e=>{c(e.list)})},[s]),m.reactExports.useEffect(()=>{f.getCategories().then(e=>{o(e.data),e.data.length>0&&j(e.data[0].id)})},[]),m.reactExports.useEffect(()=>{s&&(R(!0),f.getStoreSymptomServices(s).then(e=>{x(e.data),R(!1)}))},[s]);const y=m.reactExports.useMemo(()=>l.filter(e=>e.categoryId===u),[l,u]),w=m.reactExports.useMemo(()=>h.map(e=>e.serviceId),[h]),T=(e,s)=>{const t=a.find(e=>e.id===s);if(!t)return;const c={serviceId:e.id,serviceName:e.name,duration:e.duration,price:e.price,discountPrice:e.discountPrice,date:r||(new Date).toISOString().split("T")[0],time:i||"\u5f85\u9009\u62e9",therapistName:t.name,therapistAvatar:t.avatar};E([...h,c]),m.Taro.showToast({title:"\u5df2\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66",icon:"none"})},S=()=>{if(0===h.length)return void m.Taro.showToast({title:"\u8bf7\u5148\u9009\u62e9\u670d\u52a1\u9879\u76ee",icon:"none"});const e={items:JSON.stringify(h),storeId:s,storeName:t,from:"symptom"};m.Taro.navigateTo({url:`/pages/booking/confirm/index?${Object.entries(e).map(([e,s])=>`${e}=${encodeURIComponent(s)}`).join("&")}`})};return N?m.jsxRuntimeExports.jsx(m.View,{className:"symptom-page loading",children:"\u52a0\u8f7d\u4e2d..."}):m.jsxRuntimeExports.jsxs(m.View,{className:"symptom-page",children:[m.jsxRuntimeExports.jsxs(m.View,{className:"symptom-content",children:[m.jsxRuntimeExports.jsx(d,{categories:n,activeId:u,onChange:j}),m.jsxRuntimeExports.jsx(v,{services:y,therapists:a,onAddToCart:T,cartServiceIds:w})]}),m.jsxRuntimeExports.jsx(g,{items:h,onCheckout:S})]})};var T={navigationBarTitleText:"\u63a8\u62ff\u5e08\u9884\u7ea6",navigationBarTextStyle:"black",navigationBarBackgroundColor:"#ffffff"};Page(m.createPageConfig(w,"pages/appointment/symptom/index",{root:{cn:[]}},T||{}));
