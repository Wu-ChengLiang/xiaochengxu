"use strict";var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,o=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&i(e,s,t[s]);if(r)for(var s of r(t))n.call(t,s)&&i(e,s,t[s]);return e},l=(e,r)=>t(e,s(r)),c=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{o(s.next(e))}catch(t){a(t)}},i=e=>{try{o(s.throw(e))}catch(t){a(t)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,i);o((s=s.apply(e,t)).next())});const x=require("../../../taro.js"),u=require("../../../vendors.js"),m=require("../../../common.js"),d="",p=({onTimeChange:e,defaultValue:t})=>{const[s,r]=x.reactExports.useState([]),[a,n]=x.reactExports.useState([]),[i,o]=x.reactExports.useState([]),[l,c]=x.reactExports.useState(()=>{const e=new Date,t=e.getHours(),s=t+1;let r=0;return s>=9&&s<=21?r=s-9:s>21&&(r=0),[2,r,0]});x.reactExports.useEffect(()=>{m()},[]),x.reactExports.useEffect(()=>{if(s.length>0&&a.length>0&&i.length>0){const t=s[l[0]],r=a[l[1]],n=i[l[2]];e(t.fullDate,r,n)}},[l,s,a,i]);const m=()=>{const e=[],s=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"];for(let t=-2;t<=2;t++){const r=u.dayjs().add(t,"day"),a=0===t;e.push({date:a?"\u4eca\u5929":`${r.month()+1}\u6708${r.date()}\u65e5`,weekday:a?"":s[r.day()],fullDate:r.format("YYYY-MM-DD"),dateObj:r.toDate()})}r(e);const a=[];for(let t=9;t<=21;t++)a.push(`${t}\u70b9`);n(a);const i=[];for(let t=0;t<60;t+=10)i.push(`${t.toString().padStart(2,"0")}\u5206`);o(i);const l=u.dayjs(),x=l.hour(),m=x+1;let d=2,p=1,j=0;m>=9&&m<=21?p=m-9:m>21?(d=3,p=0):p=0;const h=t?[t.date,t.hour,t.minute]:[d,p,j];c(h)},d=e=>{const{value:t}=e.detail;c(t)};return x.jsxRuntimeExports.jsx(x.View,{className:"time-picker-scroller",children:x.jsxRuntimeExports.jsxs(x.PickerView,{indicatorStyle:"height: 50px; background-color: rgba(0,0,0,0.05);",style:{width:"100%",height:"200px"},value:l,onChange:d,children:[x.jsxRuntimeExports.jsx(x.PickerViewColumn,{children:s.map((e,t)=>x.jsxRuntimeExports.jsxs(x.View,{className:"picker-item date-item",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"date-text "+("\u4eca\u5929"===e.date?"today":""),children:e.date}),e.weekday&&x.jsxRuntimeExports.jsx(x.Text,{className:"weekday-text",children:e.weekday})]},t))}),x.jsxRuntimeExports.jsx(x.PickerViewColumn,{children:a.map((e,t)=>x.jsxRuntimeExports.jsx(x.View,{className:"picker-item hour-item",children:x.jsxRuntimeExports.jsx(x.Text,{className:"hour-text",children:e})},t))}),x.jsxRuntimeExports.jsx(x.PickerViewColumn,{children:i.map((e,t)=>x.jsxRuntimeExports.jsx(x.View,{className:"picker-item minute-item",children:x.jsxRuntimeExports.jsx(x.Text,{className:"minute-text",children:e})},t))})]})})},j="",h=()=>{var e;const t=x.taroExports.useRouter(),{id:s}=t.params,[r,a]=x.reactExports.useState(null),[n,i]=x.reactExports.useState((new Date).toISOString().split("T")[0]),[d,j]=x.reactExports.useState("10\u70b9"),[h,E]=x.reactExports.useState("00\u5206"),[g,w]=x.reactExports.useState(!0);x.reactExports.useEffect(()=>{R()},[s]);const R=()=>c(exports,null,function*(){try{const[e,t]=yield Promise.all([m.storeService.getStoreDetail(s),m.getLocationService.getCurrentLocation()]),r=e.data;let n=o({},r);if((null==r?void 0:r.latitude)&&(null==r?void 0:r.longitude)){const e=m.getLocationService.calculateDistance(t.latitude,t.longitude,r.latitude,r.longitude);n=l(o({},r),{distance:e})}a(n)}catch(e){x.Taro.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{w(!1)}}),f=(e,t,s)=>{i(e),j(t),E(s)},N=()=>{(null==r?void 0:r.phone)&&x.Taro.makePhoneCall({phoneNumber:r.phone})},y=()=>{(null==r?void 0:r.latitude)&&(null==r?void 0:r.longitude)&&x.Taro.openLocation({latitude:r.latitude,longitude:r.longitude,name:r.name,address:r.address})},b=()=>{if(!d||!h)return void x.Taro.showToast({title:"\u8bf7\u9009\u62e9\u9884\u7ea6\u65f6\u95f4",icon:"none"});const e=`${d.replace("\u70b9","")}:${h.replace("\u5206","")}`,t={storeId:s,storeName:(null==r?void 0:r.name)||"",selectedDate:n,selectedTime:e,from:"store"};x.Taro.navigateTo({url:`/pages/appointment/symptom/index?${Object.entries(t).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&")}`})},v=()=>{if(!n||!d||!h)return"\u8bf7\u9009\u62e9\u65f6\u95f4";const e=n===(new Date).toISOString().split("T")[0]?"\u4eca\u5929":n,t=d.replace("\u70b9",""),s=h.replace("\u5206","");return`${e} ${t}:${s}`};return r?x.jsxRuntimeExports.jsxs(x.View,{className:"store-appointment-page",children:[x.jsxRuntimeExports.jsx(x.View,{className:"store-header",children:x.jsxRuntimeExports.jsx(x.Image,{className:"store-image",src:m.normalizeImageUrl((null==(e=r.images)?void 0:e[0])||r.image),mode:"aspectFill"})}),x.jsxRuntimeExports.jsx(x.View,{className:"store-info",children:x.jsxRuntimeExports.jsxs(x.View,{className:"info-header",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"store-details",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"name-row",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"store-name",children:r.name}),void 0!==r.distance&&null!==r.distance&&x.jsxRuntimeExports.jsxs(x.Text,{className:"distance",children:[r.distance,"km"]})]}),x.jsxRuntimeExports.jsxs(x.View,{className:"hours-row",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"business-hours",children:r.businessHours}),x.jsxRuntimeExports.jsxs(x.View,{className:`status ${r.status}`,children:["normal"===r.status&&"\u5c31\u8fd1","busy"===r.status&&"\u7e41\u5fd9","full"===r.status&&"\u7206\u6ee1"]})]}),x.jsxRuntimeExports.jsx(x.Text,{className:"address",children:r.address})]}),x.jsxRuntimeExports.jsxs(x.View,{className:"action-buttons",children:[x.jsxRuntimeExports.jsx(x.View,{className:"action-btn",onClick:N,children:"\ud83d\udcde"}),x.jsxRuntimeExports.jsx(x.View,{className:"action-btn",onClick:y,children:"\ud83d\udccd"})]})]})}),x.jsxRuntimeExports.jsxs(x.View,{className:"appointment-section",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"section-title",children:"\u9884\u7ea6\u65f6\u95f4"}),x.jsxRuntimeExports.jsx(p,{onTimeChange:f})]}),x.jsxRuntimeExports.jsxs(x.View,{className:"bottom-bar",children:[x.jsxRuntimeExports.jsxs(x.Text,{className:"selected-time",children:["\u9884\u7ea6\u65f6\u95f4: ",v()]}),x.jsxRuntimeExports.jsx(u.AtButton,{className:"submit-btn",type:"primary",onClick:b,disabled:!d||!h,children:"\u9009\u75c7\u72b6"})]})]}):null};var E={navigationBarTitleText:"\u95e8\u5e97\u9884\u7ea6"};Page(x.createPageConfig(h,"pages/appointment/store/index",{root:{cn:[]}},E||{}));
