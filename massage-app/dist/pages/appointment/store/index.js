"use strict";var e=(e,t,s)=>new Promise((a,r)=>{var n=e=>{try{o(s.next(e))}catch(t){r(t)}},i=e=>{try{o(s.throw(e))}catch(t){r(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,i);o((s=s.apply(e,t)).next())});const t=require("../../../taro.js"),s=require("../../../vendors.js"),a=require("../../../common.js"),r="",n=({onTimeChange:e,defaultValue:a})=>{const[r,n]=t.reactExports.useState([]),[i,o]=t.reactExports.useState([]),[l,c]=t.reactExports.useState([]),[x,m]=t.reactExports.useState(()=>{const e=new Date,t=e.getHours(),s=t+1;let a=0;return s>=9&&s<=21?a=s-9:s>21&&(a=0),[2,a,0]});t.reactExports.useEffect(()=>{u()},[]),t.reactExports.useEffect(()=>{if(r.length>0&&i.length>0&&l.length>0){const t=r[x[0]],s=i[x[1]],a=l[x[2]];e(t.fullDate,s,a)}},[x,r,i,l]);const u=()=>{const e=[],t=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"];for(let a=-2;a<=2;a++){const r=s.dayjs().add(a,"day"),n=0===a;e.push({date:n?"\u4eca\u5929":`${r.month()+1}\u6708${r.date()}\u65e5`,weekday:n?"":t[r.day()],fullDate:r.format("YYYY-MM-DD"),dateObj:r.toDate()})}n(e);const r=[];for(let s=9;s<=21;s++)r.push(`${s}\u70b9`);o(r);const i=[];for(let s=0;s<60;s+=10)i.push(`${s.toString().padStart(2,"0")}\u5206`);c(i);const l=s.dayjs(),x=l.hour(),u=x+1;let d=2,p=1,j=0;u>=9&&u<=21?p=u-9:u>21?(d=3,p=0):p=0;const h=a?[a.date,a.hour,a.minute]:[d,p,j];m(h)},d=e=>{const{value:t}=e.detail;m(t)};return t.jsxRuntimeExports.jsx(t.View,{className:"time-picker-scroller",children:t.jsxRuntimeExports.jsxs(t.PickerView,{indicatorStyle:"height: 50px; background-color: rgba(0,0,0,0.05);",style:{width:"100%",height:"200px"},value:x,onChange:d,children:[t.jsxRuntimeExports.jsx(t.PickerViewColumn,{children:r.map((e,s)=>t.jsxRuntimeExports.jsxs(t.View,{className:"picker-item date-item",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"date-text "+("\u4eca\u5929"===e.date?"today":""),children:e.date}),e.weekday&&t.jsxRuntimeExports.jsx(t.Text,{className:"weekday-text",children:e.weekday})]},s))}),t.jsxRuntimeExports.jsx(t.PickerViewColumn,{children:i.map((e,s)=>t.jsxRuntimeExports.jsx(t.View,{className:"picker-item hour-item",children:t.jsxRuntimeExports.jsx(t.Text,{className:"hour-text",children:e})},s))}),t.jsxRuntimeExports.jsx(t.PickerViewColumn,{children:l.map((e,s)=>t.jsxRuntimeExports.jsx(t.View,{className:"picker-item minute-item",children:t.jsxRuntimeExports.jsx(t.Text,{className:"minute-text",children:e})},s))})]})})},i="",o=()=>{var r;const i=t.taroExports.useRouter(),{id:o}=i.params,[l,c]=t.reactExports.useState(null),[x,m]=t.reactExports.useState((new Date).toISOString().split("T")[0]),[u,d]=t.reactExports.useState("10\u70b9"),[p,j]=t.reactExports.useState("00\u5206"),[h,E]=t.reactExports.useState(!0);t.reactExports.useEffect(()=>{R()},[o]);const R=()=>e(exports,null,function*(){try{const e=yield a.storeService.getStoreDetail(o);c(e.data)}catch(e){t.Taro.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{E(!1)}}),w=(e,t,s)=>{m(e),d(t),j(s)},g=()=>{(null==l?void 0:l.phone)&&t.Taro.makePhoneCall({phoneNumber:l.phone})},N=()=>{(null==l?void 0:l.latitude)&&(null==l?void 0:l.longitude)&&t.Taro.openLocation({latitude:l.latitude,longitude:l.longitude,name:l.name,address:l.address})},T=()=>{if(!u||!p)return void t.Taro.showToast({title:"\u8bf7\u9009\u62e9\u9884\u7ea6\u65f6\u95f4",icon:"none"});const e=`${u.replace("\u70b9","")}:${p.replace("\u5206","")}`,s={storeId:o,storeName:(null==l?void 0:l.name)||"",selectedDate:x,selectedTime:e,from:"store"};t.Taro.navigateTo({url:`/pages/appointment/symptom/index?${Object.entries(s).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&")}`})},f=()=>{if(!x||!u||!p)return"\u8bf7\u9009\u62e9\u65f6\u95f4";const e=x===(new Date).toISOString().split("T")[0]?"\u4eca\u5929":x,t=u.replace("\u70b9",""),s=p.replace("\u5206","");return`${e} ${t}:${s}`};return l?t.jsxRuntimeExports.jsxs(t.View,{className:"store-appointment-page",children:[t.jsxRuntimeExports.jsx(t.View,{className:"store-header",children:t.jsxRuntimeExports.jsx(t.Image,{className:"store-image",src:(null==(r=l.images)?void 0:r[0])||l.image||"/static/images/default-store.jpg",mode:"aspectFill"})}),t.jsxRuntimeExports.jsx(t.View,{className:"store-info",children:t.jsxRuntimeExports.jsxs(t.View,{className:"info-header",children:[t.jsxRuntimeExports.jsxs(t.View,{className:"store-details",children:[t.jsxRuntimeExports.jsxs(t.View,{className:"name-row",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"store-name",children:l.name}),t.jsxRuntimeExports.jsx(t.Text,{className:"distance",children:void 0!==l.distance&&null!==l.distance?`${l.distance}km`:"\u8ddd\u79bb\u672a\u77e5"})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"hours-row",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"business-hours",children:l.businessHours}),t.jsxRuntimeExports.jsxs(t.View,{className:`status ${l.status}`,children:["normal"===l.status&&"\u5c31\u8fd1","busy"===l.status&&"\u7e41\u5fd9","full"===l.status&&"\u7206\u6ee1"]})]}),t.jsxRuntimeExports.jsx(t.Text,{className:"address",children:l.address})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"action-buttons",children:[t.jsxRuntimeExports.jsx(t.View,{className:"action-btn",onClick:g,children:"\ud83d\udcde"}),t.jsxRuntimeExports.jsx(t.View,{className:"action-btn",onClick:N,children:"\ud83d\udccd"})]})]})}),t.jsxRuntimeExports.jsxs(t.View,{className:"appointment-section",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"section-title",children:"\u9884\u7ea6\u65f6\u95f4"}),t.jsxRuntimeExports.jsx(n,{onTimeChange:w})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"bottom-bar",children:[t.jsxRuntimeExports.jsxs(t.Text,{className:"selected-time",children:["\u9884\u7ea6\u65f6\u95f4: ",f()]}),t.jsxRuntimeExports.jsx(s.AtButton,{className:"submit-btn",type:"primary",onClick:T,disabled:!u||!p,children:"\u9009\u75c7\u72b6"})]})]}):null};var l={navigationBarTitleText:"\u95e8\u5e97\u9884\u7ea6"};Page(t.createPageConfig(o,"pages/appointment/store/index",{root:{cn:[]}},l||{}));
