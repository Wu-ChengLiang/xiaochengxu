"use strict";var e=(e,t,s)=>new Promise((a,i)=>{var n=e=>{try{o(s.next(e))}catch(t){i(t)}},r=e=>{try{o(s.throw(e))}catch(t){i(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,r);o((s=s.apply(e,t)).next())});const t=require("../../../taro.js"),s=require("../../../vendors.js"),a=require("../../../common.js"),i="",n=({onTimeChange:e,defaultValue:a})=>{const[i,n]=t.reactExports.useState([]),[r,o]=t.reactExports.useState([]),[c,x]=t.reactExports.useState([]),[l,m]=t.reactExports.useState(()=>{const e=new Date,t=e.getHours(),s=t+1;let a=0;return s>=9&&s<=21?a=s-9:s>21&&(a=0),[2,a,0]});t.reactExports.useEffect(()=>{u()},[]),t.reactExports.useEffect(()=>{if(i.length>0&&r.length>0&&c.length>0){const t=i[l[0]],s=r[l[1]],a=c[l[2]];e(t.fullDate,s,a)}},[l,i,r,c]);const u=()=>{const e=[],t=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"];for(let a=-2;a<=2;a++){const i=s.dayjs().add(a,"day"),n=0===a;e.push({date:n?"\u4eca\u5929":`${i.month()+1}\u6708${i.date()}\u65e5`,weekday:n?"":t[i.day()],fullDate:i.format("YYYY-MM-DD"),dateObj:i.toDate()})}n(e);const i=[];for(let s=9;s<=21;s++)i.push(`${s}\u70b9`);o(i);const r=[];for(let s=0;s<60;s+=10)r.push(`${s.toString().padStart(2,"0")}\u5206`);x(r);const c=s.dayjs(),l=c.hour(),u=l+1;let d=2,p=1,j=0;u>=9&&u<=21?p=u-9:u>21?(d=3,p=0):p=0;const h=a?[a.date,a.hour,a.minute]:[d,p,j];m(h)},d=e=>{const{value:t}=e.detail;m(t)};return t.jsxRuntimeExports.jsx(t.View,{className:"time-picker-scroller",children:t.jsxRuntimeExports.jsxs(t.PickerView,{indicatorStyle:"height: 50px; background-color: rgba(0,0,0,0.05);",style:{width:"100%",height:"200px"},value:l,onChange:d,children:[t.jsxRuntimeExports.jsx(t.PickerViewColumn,{children:i.map((e,s)=>t.jsxRuntimeExports.jsxs(t.View,{className:"picker-item date-item",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"date-text "+("\u4eca\u5929"===e.date?"today":""),children:e.date}),e.weekday&&t.jsxRuntimeExports.jsx(t.Text,{className:"weekday-text",children:e.weekday})]},s))}),t.jsxRuntimeExports.jsx(t.PickerViewColumn,{children:r.map((e,s)=>t.jsxRuntimeExports.jsx(t.View,{className:"picker-item hour-item",children:t.jsxRuntimeExports.jsx(t.Text,{className:"hour-text",children:e})},s))}),t.jsxRuntimeExports.jsx(t.PickerViewColumn,{children:c.map((e,s)=>t.jsxRuntimeExports.jsx(t.View,{className:"picker-item minute-item",children:t.jsxRuntimeExports.jsx(t.Text,{className:"minute-text",children:e})},s))})]})})},r="",o=()=>{var i;const r=t.taroExports.useRouter(),{id:o}=r.params,[c,x]=t.reactExports.useState(null),[l,m]=t.reactExports.useState((new Date).toISOString().split("T")[0]),[u,d]=t.reactExports.useState("10\u70b9"),[p,j]=t.reactExports.useState("00\u5206"),[h,E]=t.reactExports.useState(!0);t.reactExports.useEffect(()=>{R()},[o]);const R=()=>e(exports,null,function*(){try{const e=yield a.storeService.getStoreDetail(o);x(e.data)}catch(e){t.Taro.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{E(!1)}}),N=(e,t,s)=>{m(e),d(t),j(s)},w=()=>{(null==c?void 0:c.phone)&&t.Taro.makePhoneCall({phoneNumber:c.phone})},g=()=>{(null==c?void 0:c.location)&&t.Taro.openLocation({latitude:c.location.latitude,longitude:c.location.longitude,name:c.name,address:c.address})},T=()=>{if(!u||!p)return void t.Taro.showToast({title:"\u8bf7\u9009\u62e9\u9884\u7ea6\u65f6\u95f4",icon:"none"});const e=`${u.replace("\u70b9","")}:${p.replace("\u5206","")}`,s={storeId:o,storeName:(null==c?void 0:c.name)||"",selectedDate:l,selectedTime:e,from:"store"};t.Taro.navigateTo({url:`/pages/appointment/symptom/index?${Object.entries(s).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&")}`})},V=()=>{if(!l||!u||!p)return"\u8bf7\u9009\u62e9\u65f6\u95f4";const e=l===(new Date).toISOString().split("T")[0]?"\u4eca\u5929":l,t=u.replace("\u70b9",""),s=p.replace("\u5206","");return`${e} ${t}:${s}`};return c?t.jsxRuntimeExports.jsxs(t.View,{className:"store-appointment-page",children:[t.jsxRuntimeExports.jsx(t.View,{className:"store-header",children:t.jsxRuntimeExports.jsx(t.Image,{className:"store-image",src:(null==(i=c.images)?void 0:i[0])||c.image||"/static/images/default-store.jpg",mode:"aspectFill"})}),t.jsxRuntimeExports.jsx(t.View,{className:"store-info",children:t.jsxRuntimeExports.jsxs(t.View,{className:"info-header",children:[t.jsxRuntimeExports.jsxs(t.View,{className:"store-details",children:[t.jsxRuntimeExports.jsxs(t.View,{className:"name-row",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"store-name",children:c.name}),t.jsxRuntimeExports.jsx(t.Text,{className:"distance",children:void 0!==c.distance&&null!==c.distance?`${c.distance}km`:"\u8ddd\u79bb\u672a\u77e5"})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"hours-row",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"business-hours",children:c.businessHours}),t.jsxRuntimeExports.jsxs(t.View,{className:`status ${c.status}`,children:["normal"===c.status&&"\u5c31\u8fd1","busy"===c.status&&"\u7e41\u5fd9","full"===c.status&&"\u7206\u6ee1"]})]}),t.jsxRuntimeExports.jsx(t.Text,{className:"address",children:c.address})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"action-buttons",children:[t.jsxRuntimeExports.jsx(t.View,{className:"action-btn",onClick:w,children:"\ud83d\udcde"}),t.jsxRuntimeExports.jsx(t.View,{className:"action-btn",onClick:g,children:"\ud83d\udccd"})]})]})}),t.jsxRuntimeExports.jsxs(t.View,{className:"appointment-section",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"section-title",children:"\u9884\u7ea6\u65f6\u95f4"}),t.jsxRuntimeExports.jsxs(t.View,{className:"promotion-tips",children:[t.jsxRuntimeExports.jsxs(t.View,{className:"tip-item main",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"discount",children:"9.5\u6298"}),t.jsxRuntimeExports.jsxs(t.View,{className:"tip-content",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"tip-title",children:"\u63d0\u524d30\u5206\u949f"}),t.jsxRuntimeExports.jsx(t.Text,{className:"tip-desc",children:"10:00\u5f00\u59cb"})]})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"tip-item",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"discount",children:"9.0\u6298"}),t.jsxRuntimeExports.jsx(t.Text,{className:"tip-desc",children:"\u9519\u5cf0\u9884\u7ea6"}),t.jsxRuntimeExports.jsx(t.Text,{className:"tip-desc",children:"\u70b9\u51fb\u524d\u5f80"})]})]}),t.jsxRuntimeExports.jsx(n,{onTimeChange:N})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"bottom-bar",children:[t.jsxRuntimeExports.jsxs(t.Text,{className:"selected-time",children:["\u9884\u7ea6\u65f6\u95f4: ",V()]}),t.jsxRuntimeExports.jsx(s.AtButton,{className:"submit-btn",type:"primary",onClick:T,disabled:!u||!p,children:"\u9009\u75c7\u72b6"})]})]}):null};var c={navigationBarTitleText:"\u95e8\u5e97\u9884\u7ea6"};Page(t.createPageConfig(o,"pages/appointment/store/index",{root:{cn:[]}},c||{}));
