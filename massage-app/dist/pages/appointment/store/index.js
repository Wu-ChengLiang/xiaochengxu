"use strict";var e=(e,s,t)=>new Promise((a,i)=>{var r=e=>{try{o(t.next(e))}catch(s){i(s)}},n=e=>{try{o(t.throw(e))}catch(s){i(s)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,n);o((t=t.apply(e,s)).next())});const s=require("../../../taro.js"),t=require("../../../vendors.js"),a=require("../../../common.js"),i="",r=({onTimeChange:e,defaultValue:a})=>{const[i,r]=s.reactExports.useState([]),[n,o]=s.reactExports.useState([]),[x,c]=s.reactExports.useState([]),[l,m]=s.reactExports.useState(()=>{const e=new Date,s=e.getHours(),t=s+1;let a=0;return t>=9&&t<=21?a=t-9:t>21&&(a=0),[2,a,0]});s.reactExports.useEffect(()=>{u()},[]),s.reactExports.useEffect(()=>{if(i.length>0&&n.length>0&&x.length>0){const s=i[l[0]],t=n[l[1]],a=x[l[2]];e(s.fullDate,t,a)}},[l,i,n,x]);const u=()=>{const e=[],s=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"];for(let a=-2;a<=2;a++){const i=t.dayjs().add(a,"day"),r=0===a;e.push({date:r?"\u4eca\u5929":`${i.month()+1}\u6708${i.date()}\u65e5`,weekday:r?"":s[i.day()],fullDate:i.format("YYYY-MM-DD"),dateObj:i.toDate()})}r(e);const i=[];for(let t=9;t<=21;t++)i.push(`${t}\u70b9`);o(i);const n=[];for(let t=0;t<60;t+=10)n.push(`${t.toString().padStart(2,"0")}\u5206`);c(n);const x=t.dayjs(),l=x.hour(),u=l+1;let d=2,p=1,j=0;u>=9&&u<=21?p=u-9:u>21?(d=3,p=0):p=0;const h=a?[a.date,a.hour,a.minute]:[d,p,j];m(h)},d=e=>{const{value:s}=e.detail;m(s)};return s.jsxRuntimeExports.jsx(s.View,{className:"time-picker-scroller",children:s.jsxRuntimeExports.jsxs(s.PickerView,{indicatorStyle:"height: 50px; background-color: rgba(0,0,0,0.05);",style:{width:"100%",height:"200px"},value:l,onChange:d,children:[s.jsxRuntimeExports.jsx(s.PickerViewColumn,{children:i.map((e,t)=>s.jsxRuntimeExports.jsxs(s.View,{className:"picker-item date-item",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"date-text "+("\u4eca\u5929"===e.date?"today":""),children:e.date}),e.weekday&&s.jsxRuntimeExports.jsx(s.Text,{className:"weekday-text",children:e.weekday})]},t))}),s.jsxRuntimeExports.jsx(s.PickerViewColumn,{children:n.map((e,t)=>s.jsxRuntimeExports.jsx(s.View,{className:"picker-item hour-item",children:s.jsxRuntimeExports.jsx(s.Text,{className:"hour-text",children:e})},t))}),s.jsxRuntimeExports.jsx(s.PickerViewColumn,{children:x.map((e,t)=>s.jsxRuntimeExports.jsx(s.View,{className:"picker-item minute-item",children:s.jsxRuntimeExports.jsx(s.Text,{className:"minute-text",children:e})},t))})]})})},n="",o=()=>{var i;const n=s.taroExports.useRouter(),{id:o}=n.params,[x,c]=s.reactExports.useState(null),[l,m]=s.reactExports.useState((new Date).toISOString().split("T")[0]),[u,d]=s.reactExports.useState("10\u70b9"),[p,j]=s.reactExports.useState("00\u5206"),[h,E]=s.reactExports.useState(!0);s.reactExports.useEffect(()=>{R()},[o]);const R=()=>e(exports,null,function*(){try{const e=yield a.storeService.getStoreDetail(o);c(e.data)}catch(e){s.Taro.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{E(!1)}}),N=(e,s,t)=>{m(e),d(s),j(t)},w=()=>{(null==x?void 0:x.phone)&&s.Taro.makePhoneCall({phoneNumber:x.phone})},g=()=>{(null==x?void 0:x.location)&&s.Taro.openLocation({latitude:x.location.latitude,longitude:x.location.longitude,name:x.name,address:x.address})},T=()=>{if(!u||!p)return void s.Taro.showToast({title:"\u8bf7\u9009\u62e9\u9884\u7ea6\u65f6\u95f4",icon:"none"});const e=`${u.replace("\u70b9","")}:${p.replace("\u5206","")}`,t={storeId:o,storeName:(null==x?void 0:x.name)||"",selectedDate:l,selectedTime:e,from:"store"};s.Taro.navigateTo({url:`/pages/appointment/symptom/index?${Object.entries(t).map(([e,s])=>`${e}=${encodeURIComponent(s)}`).join("&")}`})},V=()=>{if(!l||!u||!p)return"\u8bf7\u9009\u62e9\u65f6\u95f4";const e=l===(new Date).toISOString().split("T")[0]?"\u4eca\u5929":l,s=u.replace("\u70b9",""),t=p.replace("\u5206","");return`${e} ${s}:${t}`};return x?s.jsxRuntimeExports.jsxs(s.View,{className:"store-appointment-page",children:[s.jsxRuntimeExports.jsx(s.View,{className:"store-header",children:s.jsxRuntimeExports.jsx(s.Image,{className:"store-image",src:(null==(i=x.images)?void 0:i[0])||x.image||"/static/images/default-store.jpg",mode:"aspectFill"})}),s.jsxRuntimeExports.jsx(s.View,{className:"store-info",children:s.jsxRuntimeExports.jsxs(s.View,{className:"info-header",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"store-details",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"name-row",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"store-name",children:x.name}),s.jsxRuntimeExports.jsxs(s.Text,{className:"distance",children:[x.distance||9,"km"]})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"hours-row",children:[s.jsxRuntimeExports.jsxs(s.Text,{className:"business-hours",children:[x.businessHours.start,"-",x.businessHours.end]}),s.jsxRuntimeExports.jsxs(s.View,{className:`status ${x.status}`,children:["normal"===x.status&&"\u5c31\u8fd1","busy"===x.status&&"\u7e41\u5fd9","full"===x.status&&"\u7206\u6ee1"]})]}),s.jsxRuntimeExports.jsx(s.Text,{className:"address",children:x.address})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"action-buttons",children:[s.jsxRuntimeExports.jsx(s.View,{className:"action-btn",onClick:w,children:"\ud83d\udcde"}),s.jsxRuntimeExports.jsx(s.View,{className:"action-btn",onClick:g,children:"\ud83d\udccd"})]})]})}),s.jsxRuntimeExports.jsxs(s.View,{className:"appointment-section",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"section-title",children:"\u9884\u7ea6\u65f6\u95f4"}),s.jsxRuntimeExports.jsxs(s.View,{className:"promotion-tips",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"tip-item main",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"discount",children:"9.5\u6298"}),s.jsxRuntimeExports.jsxs(s.View,{className:"tip-content",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"tip-title",children:"\u63d0\u524d30\u5206\u949f"}),s.jsxRuntimeExports.jsx(s.Text,{className:"tip-desc",children:"10:00\u5f00\u59cb"})]})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"tip-item",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"discount",children:"9.0\u6298"}),s.jsxRuntimeExports.jsx(s.Text,{className:"tip-desc",children:"\u9519\u5cf0\u9884\u7ea6"}),s.jsxRuntimeExports.jsx(s.Text,{className:"tip-desc",children:"\u70b9\u51fb\u524d\u5f80"})]})]}),s.jsxRuntimeExports.jsx(r,{onTimeChange:N})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"bottom-bar",children:[s.jsxRuntimeExports.jsxs(s.Text,{className:"selected-time",children:["\u9884\u7ea6\u65f6\u95f4: ",V()]}),s.jsxRuntimeExports.jsx(t.AtButton,{className:"submit-btn",type:"primary",onClick:T,disabled:!u||!p,children:"\u9009\u75c7\u72b6"})]})]}):null};var x={navigationBarTitleText:"\u95e8\u5e97\u9884\u7ea6"};Page(s.createPageConfig(o,"pages/appointment/store/index",{root:{cn:[]}},x||{}));
