"use strict";var e=(e,s,t)=>new Promise((i,a)=>{var r=e=>{try{n(t.next(e))}catch(s){a(s)}},c=e=>{try{n(t.throw(e))}catch(s){a(s)}},n=e=>e.done?i(e.value):Promise.resolve(e.value).then(r,c);n((t=t.apply(e,s)).next())});const s=require("../../../taro.js"),t=require("../../../common.js"),i="",a=()=>{const i=s.taroExports.useRouter(),[a,r]=s.reactExports.useState(null),[c,n]=s.reactExports.useState(!0),[o,x]=s.reactExports.useState(1),[l,m]=s.reactExports.useState(0);s.reactExports.useEffect(()=>{const e=s.Taro.getCurrentPages(),a=e[e.length-1],{id:c}=a.options;if(console.log("\ud83d\udcf1 Product Detail Page Load",{id:c,pagesLength:e.length,routerParams:i.params}),c){const e=t.GiftService.getProductById(c);console.log("\ud83d\udd0d Product Query Result",{id:c,found:!!e,productName:null==e?void 0:e.name}),e?(r(e),console.log("\u2705 Product Loaded Successfully",e.name)):console.warn("\u26a0\ufe0f Product Not Found:",c),n(!1)}else console.warn("\u26a0\ufe0f No Product ID Provided"),n(!1)},[i]);const u=e=>{"increase"===e?x(o+1):"decrease"===e&&o>1&&x(o-1)},d=()=>e(exports,null,function*(){if(a)try{s.Taro.showLoading({title:"\u521b\u5efa\u8ba2\u5355..."});const e=yield t.GiftService.createProductOrder({productId:a.id,quantity:o,paymentMethod:"wechat"});s.Taro.hideLoading();const i=yield t.paymentService.pay({orderNo:e.orderNo,amount:100*a.price*o,paymentMethod:"wechat",title:a.name,wxPayParams:e.wxPayParams});i&&(s.Taro.showToast({title:"\u8d2d\u4e70\u6210\u529f",icon:"success",duration:1500}),setTimeout(()=>{s.Taro.navigateBack()},1500))}catch(e){s.Taro.hideLoading();const t=e.message||e.errMsg||"\u8d2d\u4e70\u5931\u8d25";s.Taro.showModal({title:"\u8d2d\u4e70\u5931\u8d25",content:t,showCancel:!1,confirmText:"\u77e5\u9053\u4e86"})}}),p=e=>{m(e.detail.scrollTop)},j=((null==a?void 0:a.price)||0)*o;return c?s.jsxRuntimeExports.jsx(s.View,{className:"product-detail-page",children:s.jsxRuntimeExports.jsx(s.View,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})}):a?s.jsxRuntimeExports.jsxs(s.View,{className:"product-detail-page",children:[s.jsxRuntimeExports.jsx(s.View,{className:"navbar "+(l>20?"shadow":""),children:s.jsxRuntimeExports.jsxs(s.View,{className:"navbar-content",children:[s.jsxRuntimeExports.jsx(s.View,{className:"navbar-back",onClick:()=>s.Taro.navigateBack(),children:s.jsxRuntimeExports.jsx(s.View,{className:"back-icon",children:"\u2039"})}),s.jsxRuntimeExports.jsx(s.Text,{className:"navbar-title",children:"\u5546\u54c1\u8be6\u60c5"})]})}),s.jsxRuntimeExports.jsxs(s.View,{className:"page-content",onScroll:p,scrollY:!0,children:[s.jsxRuntimeExports.jsxs(s.View,{className:"product-image-container",children:[s.jsxRuntimeExports.jsx(s.Image,{className:"product-image",src:a.image,mode:"aspectFill"}),s.jsxRuntimeExports.jsx(s.View,{className:"image-badge",children:a.unit})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"product-info-card",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"price-section",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"current-price",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"currency",children:"\xa5"}),s.jsxRuntimeExports.jsx(s.Text,{className:"price-value",children:(a.price/100).toFixed(0)})]}),a.originalPrice&&a.originalPrice>a.price&&s.jsxRuntimeExports.jsxs(s.Text,{className:"original-price",children:["\xa5",(a.originalPrice/100).toFixed(0)]})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"product-title-section",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"product-name",children:a.name}),s.jsxRuntimeExports.jsx(s.Text,{className:"product-description",children:a.description})]})]}),a.features&&a.features.length>0&&s.jsxRuntimeExports.jsxs(s.View,{className:"features-card",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"card-title",children:"\u4ea7\u54c1\u7279\u8272"}),s.jsxRuntimeExports.jsx(s.View,{className:"features-list",children:a.features.map((e,t)=>s.jsxRuntimeExports.jsxs(s.View,{className:"feature-item",children:[s.jsxRuntimeExports.jsx(s.View,{className:"feature-icon",children:"\u2713"}),s.jsxRuntimeExports.jsx(s.Text,{className:"feature-text",children:e})]},t))})]}),a.specifications&&Object.keys(a.specifications).length>0&&s.jsxRuntimeExports.jsxs(s.View,{className:"specs-card",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"card-title",children:"\u89c4\u683c\u53c2\u6570"}),s.jsxRuntimeExports.jsx(s.View,{className:"specs-list",children:Object.entries(a.specifications).map(([e,t],i)=>s.jsxRuntimeExports.jsxs(s.View,{className:"spec-item "+(i!==Object.entries(a.specifications).length-1?"has-border":""),children:[s.jsxRuntimeExports.jsx(s.Text,{className:"spec-label",children:e}),s.jsxRuntimeExports.jsx(s.Text,{className:"spec-value",children:t})]},i))})]}),s.jsxRuntimeExports.jsx(s.View,{className:"bottom-spacer"})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"bottom-bar",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"quantity-container",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"quantity-label",children:"\u6570\u91cf"}),s.jsxRuntimeExports.jsxs(s.View,{className:"quantity-selector",children:[s.jsxRuntimeExports.jsx(s.View,{className:"quantity-btn",onClick:()=>u("decrease"),children:"\u2212"}),s.jsxRuntimeExports.jsx(s.Text,{className:"quantity-value",children:o}),s.jsxRuntimeExports.jsx(s.View,{className:"quantity-btn",onClick:()=>u("increase"),children:"+"})]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"action-buttons",children:s.jsxRuntimeExports.jsx(s.Button,{className:"buy-btn",onClick:d,children:s.jsxRuntimeExports.jsxs(s.View,{className:"btn-content",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"btn-label",children:"\u7acb\u5373\u8d2d\u4e70"}),s.jsxRuntimeExports.jsxs(s.Text,{className:"btn-price",children:["\xa5",(j/100).toFixed(0)]})]})})})]})]}):s.jsxRuntimeExports.jsx(s.View,{className:"product-detail-page",children:s.jsxRuntimeExports.jsx(s.View,{className:"empty",children:"\u5546\u54c1\u4e0d\u5b58\u5728"})})};var r={navigationBarTitleText:"\u5546\u54c1\u8be6\u60c5"};Page(s.createPageConfig(a,"pages/gift/product-detail/index",{root:{cn:[]}},r||{}));
