{"version":3,"file":"index.js","sources":["../../../../src/pages/gift/product-detail/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { View, Text, Image, Button } from '@tarojs/components'\nimport Taro, { useRouter } from '@tarojs/taro'\nimport { GiftService } from '@/services/gift.service'\nimport { paymentService } from '@/services/payment.service'\nimport { Product } from '@/types'\nimport './index.scss'\n\nconst ProductDetail: React.FC = () => {\n  const router = useRouter()\n  const { id } = router.params\n  const [productInfo, setProductInfo] = useState<Product | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [quantity, setQuantity] = useState(1)\n  const [scrollTop, setScrollTop] = useState(0)\n\n  useEffect(() => {\n    if (id) {\n      const product = GiftService.getProductById(id as string)\n      if (product) {\n        setProductInfo(product)\n      }\n      setLoading(false)\n    }\n  }, [id])\n\n  const handleQuantityChange = (type: 'increase' | 'decrease') => {\n    if (type === 'increase') {\n      setQuantity(quantity + 1)\n    } else if (type === 'decrease' && quantity > 1) {\n      setQuantity(quantity - 1)\n    }\n  }\n\n  const handleBuyNow = async () => {\n    if (!productInfo) return\n\n    try {\n      Taro.showLoading({ title: '创建订单...' })\n\n      const order = await GiftService.createProductOrder({\n        productId: productInfo.id,\n        quantity,\n        paymentMethod: 'wechat'\n      })\n\n      Taro.hideLoading()\n\n      const paymentSuccess = await paymentService.pay({\n        orderNo: order.orderNo,\n        amount: productInfo.price * 100 * quantity,\n        paymentMethod: 'wechat',\n        title: productInfo.name,\n        wxPayParams: order.wxPayParams\n      })\n\n      if (paymentSuccess) {\n        Taro.showToast({\n          title: '购买成功',\n          icon: 'success',\n          duration: 1500\n        })\n\n        setTimeout(() => {\n          Taro.navigateBack()\n        }, 1500)\n      }\n    } catch (error: any) {\n      Taro.hideLoading()\n      const errorMessage = error.message || error.errMsg || '购买失败'\n      Taro.showModal({\n        title: '购买失败',\n        content: errorMessage,\n        showCancel: false,\n        confirmText: '知道了'\n      })\n    }\n  }\n\n  const handleScroll = (e: any) => {\n    setScrollTop(e.detail.scrollTop)\n  }\n\n  const totalPrice = (productInfo?.price || 0) * quantity\n\n  if (loading) {\n    return (\n      <View className=\"product-detail-page\">\n        <View className=\"loading\">加载中...</View>\n      </View>\n    )\n  }\n\n  if (!productInfo) {\n    return (\n      <View className=\"product-detail-page\">\n        <View className=\"empty\">商品不存在</View>\n      </View>\n    )\n  }\n\n  return (\n    <View className=\"product-detail-page\">\n      {/* 顶部导航栏 */}\n      <View className={`navbar ${scrollTop > 20 ? 'shadow' : ''}`}>\n        <View className=\"navbar-content\">\n          <View className=\"navbar-back\" onClick={() => Taro.navigateBack()}>\n            <View className=\"back-icon\">‹</View>\n          </View>\n          <Text className=\"navbar-title\">商品详情</Text>\n        </View>\n      </View>\n\n      {/* 页面内容 */}\n      <View className=\"page-content\" onScroll={handleScroll} scrollY>\n        {/* 产品图片展示 */}\n        <View className=\"product-image-container\">\n          <Image\n            className=\"product-image\"\n            src={productInfo.image}\n            mode=\"aspectFill\"\n          />\n          <View className=\"image-badge\">{productInfo.unit}</View>\n        </View>\n\n        {/* 产品基础信息 */}\n        <View className=\"product-info-card\">\n          <View className=\"price-section\">\n            <View className=\"current-price\">\n              <Text className=\"currency\">¥</Text>\n              <Text className=\"price-value\">\n                {(productInfo.price / 100).toFixed(0)}\n              </Text>\n            </View>\n            {productInfo.originalPrice && productInfo.originalPrice > productInfo.price && (\n              <Text className=\"original-price\">\n                ¥{(productInfo.originalPrice / 100).toFixed(0)}\n              </Text>\n            )}\n          </View>\n\n          <View className=\"product-title-section\">\n            <Text className=\"product-name\">{productInfo.name}</Text>\n            <Text className=\"product-description\">{productInfo.description}</Text>\n          </View>\n        </View>\n\n        {/* 产品特色 */}\n        {productInfo.features && productInfo.features.length > 0 && (\n          <View className=\"features-card\">\n            <Text className=\"card-title\">产品特色</Text>\n            <View className=\"features-list\">\n              {productInfo.features.map((feature, index) => (\n                <View key={index} className=\"feature-item\">\n                  <View className=\"feature-icon\">✓</View>\n                  <Text className=\"feature-text\">{feature}</Text>\n                </View>\n              ))}\n            </View>\n          </View>\n        )}\n\n        {/* 规格参数 */}\n        {productInfo.specifications && Object.keys(productInfo.specifications).length > 0 && (\n          <View className=\"specs-card\">\n            <Text className=\"card-title\">规格参数</Text>\n            <View className=\"specs-list\">\n              {Object.entries(productInfo.specifications).map(([key, value], index) => (\n                <View\n                  key={index}\n                  className={`spec-item ${index !== Object.entries(productInfo.specifications).length - 1 ? 'has-border' : ''}`}\n                >\n                  <Text className=\"spec-label\">{key}</Text>\n                  <Text className=\"spec-value\">{value}</Text>\n                </View>\n              ))}\n            </View>\n          </View>\n        )}\n\n        {/* 空白区域，用于防止内容被底部栏遮挡 */}\n        <View className=\"bottom-spacer\" />\n      </View>\n\n      {/* 底部购买栏 */}\n      <View className=\"bottom-bar\">\n        <View className=\"quantity-container\">\n          <Text className=\"quantity-label\">数量</Text>\n          <View className=\"quantity-selector\">\n            <View\n              className=\"quantity-btn\"\n              onClick={() => handleQuantityChange('decrease')}\n            >\n              −\n            </View>\n            <Text className=\"quantity-value\">{quantity}</Text>\n            <View\n              className=\"quantity-btn\"\n              onClick={() => handleQuantityChange('increase')}\n            >\n              +\n            </View>\n          </View>\n        </View>\n\n        <View className=\"action-buttons\">\n          <Button\n            className=\"buy-btn\"\n            onClick={handleBuyNow}\n          >\n            <View className=\"btn-content\">\n              <Text className=\"btn-label\">立即购买</Text>\n              <Text className=\"btn-price\">¥{(totalPrice / 100).toFixed(0)}</Text>\n            </View>\n          </Button>\n        </View>\n      </View>\n    </View>\n  )\n}\n\nexport default ProductDetail\n"],"names":["ProductDetail","router","useRouter","id","params","productInfo","setProductInfo","useState","loading","setLoading","quantity","setQuantity","scrollTop","setScrollTop","useEffect","product","GiftService","getProductById","handleQuantityChange","type","handleBuyNow","Taro","showLoading","title","order","createProductOrder","productId","paymentMethod","hideLoading","paymentSuccess","paymentService","pay","orderNo","amount","price","name","wxPayParams","showToast","icon","duration","setTimeout","navigateBack","error","errorMessage","message","errMsg","showModal","content","showCancel","confirmText","handleScroll","e","detail","totalPrice","jsx","View","jsxs","Text","Image","image","unit","toFixed","originalPrice","description","features","length","map","feature","index","specifications","Object","keys","entries","key","value","Button"],"mappings":"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"}