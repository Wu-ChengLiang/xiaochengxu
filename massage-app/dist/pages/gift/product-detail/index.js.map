{"version":3,"file":"index.js","sources":["../../../../src/pages/gift/product-detail/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { View, Text, Image, Button, Swiper, SwiperItem } from '@tarojs/components'\nimport Taro, { useRouter } from '@tarojs/taro'\nimport { AtIcon } from 'taro-ui'\nimport { GiftService } from '@/services/gift.service'\nimport { paymentService } from '@/services/payment.service'\nimport { Product } from '@/types'\nimport './index.scss'\n\nconst ProductDetail: React.FC = () => {\n  const router = useRouter()\n  const { id } = router.params\n  const [productInfo, setProductInfo] = useState<Product | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [quantity, setQuantity] = useState(1)\n\n  useEffect(() => {\n    if (id) {\n      const product = GiftService.getProductById(id as string)\n      if (product) {\n        setProductInfo(product)\n      }\n      setLoading(false)\n    }\n  }, [id])\n\n  const handleQuantityChange = (type: 'increase' | 'decrease') => {\n    if (type === 'increase') {\n      setQuantity(quantity + 1)\n    } else if (type === 'decrease' && quantity > 1) {\n      setQuantity(quantity - 1)\n    }\n  }\n\n\n  const handleBuyNow = async () => {\n    if (!productInfo) return\n\n    try {\n      Taro.showLoading({ title: '创建订单...' })\n\n      // 创建商品订单\n      const order = await GiftService.createProductOrder({\n        productId: productInfo.id,\n        quantity,\n        paymentMethod: 'wechat'\n      })\n\n      Taro.hideLoading()\n\n      // 使用统一的支付服务处理支付\n      const paymentSuccess = await paymentService.pay({\n        orderNo: order.orderNo,\n        amount: productInfo.price * 100 * quantity,\n        paymentMethod: 'wechat',\n        title: productInfo.name,\n        wxPayParams: order.wxPayParams\n      })\n\n      if (paymentSuccess) {\n        Taro.showToast({\n          title: '购买成功',\n          icon: 'success',\n          duration: 1500\n        })\n\n        setTimeout(() => {\n          Taro.navigateBack()\n        }, 1500)\n      }\n      // 如果支付失败或用户取消，paymentService 内部已处理提示\n    } catch (error: any) {\n      Taro.hideLoading()\n\n      // 显示详细错误信息\n      const errorMessage = error.message || error.errMsg || '购买失败'\n      Taro.showModal({\n        title: '购买失败',\n        content: errorMessage,\n        showCancel: false,\n        confirmText: '知道了'\n      })\n    }\n  }\n\n  if (loading) {\n    return (\n      <View className=\"product-detail-page\">\n        <View className=\"loading\">加载中...</View>\n      </View>\n    )\n  }\n\n  if (!productInfo) {\n    return (\n      <View className=\"product-detail-page\">\n        <View className=\"empty\">商品不存在</View>\n      </View>\n    )\n  }\n\n  return (\n    <View className=\"product-detail-page\">\n      {/* 商品图片轮播卡片 */}\n      <View className=\"product-carousel-card\">\n        {/* 轮播图区域 */}\n        <Swiper className=\"product-swiper\" circular>\n          <SwiperItem>\n            <Image\n              className=\"product-image\"\n              src={productInfo.image}\n              mode=\"aspectFill\"\n            />\n          </SwiperItem>\n        </Swiper>\n\n        {/* 底部信息区域 */}\n        <View className=\"carousel-info\">\n          <View className=\"info-content\">\n            <Text className=\"product-name\">{productInfo.name}</Text>\n            <View className=\"price-row\">\n              <Text className=\"price\">¥{productInfo.price.toFixed(2)}</Text>\n              <Text className=\"original-price\">¥{productInfo.originalPrice.toFixed(2)}</Text>\n            </View>\n          </View>\n\n          {/* 分页指示器 */}\n          <View className=\"pagination-dots\">\n            <View className=\"dot active\" />\n          </View>\n        </View>\n      </View>\n\n      {/* 商品描述信息 */}\n      <View className=\"product-info\">\n        <Text className=\"unit\">单位: {productInfo.unit}</Text>\n        <Text className=\"product-desc\">{productInfo.description}</Text>\n      </View>\n\n      {/* 商品特色 */}\n      <View className=\"features-section\">\n        <Text className=\"section-title\">产品特色</Text>\n        <View className=\"features-list\">\n          {productInfo.features.map((feature: string, index: number) => (\n            <View key={index} className=\"feature-item\">\n              <View className=\"feature-dot\" />\n              <Text className=\"feature-text\">{feature}</Text>\n            </View>\n          ))}\n        </View>\n      </View>\n\n      {/* 规格参数 */}\n      <View className=\"specs-section\">\n        <Text className=\"section-title\">规格参数</Text>\n        <View className=\"specs-list\">\n          {Object.entries(productInfo.specifications).map(([key, value]) => (\n            <View key={key} className=\"spec-item\">\n              <Text className=\"spec-label\">{key}</Text>\n              <Text className=\"spec-value\">{value as string}</Text>\n            </View>\n          ))}\n        </View>\n      </View>\n\n      {/* 数量选择 */}\n      <View className=\"quantity-section\">\n        <Text className=\"section-title\">购买数量</Text>\n        <View className=\"quantity-selector\">\n          <View \n            className=\"quantity-btn\"\n            onClick={() => handleQuantityChange('decrease')}\n          >\n            <AtIcon value=\"subtract\" size=\"20\" color={quantity === 1 ? '#ccc' : '#333'} />\n          </View>\n          <Text className=\"quantity-value\">{quantity}</Text>\n          <View \n            className=\"quantity-btn\"\n            onClick={() => handleQuantityChange('increase')}\n          >\n            <AtIcon value=\"add\" size=\"20\" color=\"#333\" />\n          </View>\n        </View>\n      </View>\n\n      {/* 底部操作栏 */}\n      <View className=\"action-bar\">\n        <Button className=\"action-btn buy-btn\" onClick={handleBuyNow}>\n          立即购买\n        </Button>\n      </View>\n    </View>\n  )\n}\n\nexport default ProductDetail"],"names":["ProductDetail","router","useRouter","id","params","productInfo","setProductInfo","useState","loading","setLoading","quantity","setQuantity","useEffect","product","GiftService","getProductById","handleQuantityChange","type","handleBuyNow","Taro","showLoading","title","order","createProductOrder","productId","paymentMethod","hideLoading","paymentSuccess","paymentService","pay","orderNo","amount","price","name","wxPayParams","showToast","icon","duration","setTimeout","navigateBack","error","errorMessage","message","errMsg","showModal","content","showCancel","confirmText","jsx","View","jsxs","Swiper","SwiperItem","Image","image","Text","toFixed","originalPrice","unit","description","features","map","feature","index","Object","entries","specifications","key","value","AtIcon","Button"],"mappings":"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"}