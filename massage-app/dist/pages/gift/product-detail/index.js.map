{"version":3,"file":"index.js","sources":["../../../../src/pages/gift/product-detail/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { View, Text, Image, Button } from '@tarojs/components'\nimport Taro, { useRouter } from '@tarojs/taro'\nimport { GiftService } from '@/services/gift.service'\nimport { paymentService } from '@/services/payment.service'\nimport { Product } from '@/types'\nimport './index.scss'\n\nconst ProductDetail: React.FC = () => {\n  const router = useRouter()\n  const [productInfo, setProductInfo] = useState<Product | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [quantity, setQuantity] = useState(1)\n  const [scrollTop, setScrollTop] = useState(0)\n\n  useEffect(() => {\n    // ‰ΩøÁî® Taro.getCurrentInstance Ëé∑ÂèñÊõ¥ÂèØÈù†ÁöÑË∑ØÁî±ÂèÇÊï∞\n    const pages = Taro.getCurrentPages()\n    const currentPage = pages[pages.length - 1]\n    const { id } = currentPage.options as any\n\n    console.log('üì± Product Detail Page Load', {\n      id,\n      pagesLength: pages.length,\n      routerParams: router.params\n    })\n\n    if (id) {\n      const product = GiftService.getProductById(id)\n      console.log('üîç Product Query Result', {\n        id,\n        found: !!product,\n        productName: product?.name\n      })\n\n      if (product) {\n        setProductInfo(product)\n        console.log('‚úÖ Product Loaded Successfully', product.name)\n      } else {\n        console.warn('‚ö†Ô∏è Product Not Found:', id)\n      }\n      setLoading(false)\n    } else {\n      console.warn('‚ö†Ô∏è No Product ID Provided')\n      setLoading(false)\n    }\n  }, [router])\n\n  const handleQuantityChange = (type: 'increase' | 'decrease') => {\n    if (type === 'increase') {\n      setQuantity(quantity + 1)\n    } else if (type === 'decrease' && quantity > 1) {\n      setQuantity(quantity - 1)\n    }\n  }\n\n  const handleBuyNow = async () => {\n    if (!productInfo) return\n\n    try {\n      Taro.showLoading({ title: 'ÂàõÂª∫ËÆ¢Âçï...' })\n\n      const order = await GiftService.createProductOrder({\n        productId: productInfo.id,\n        quantity,\n        paymentMethod: 'wechat'\n      })\n\n      Taro.hideLoading()\n\n      const paymentSuccess = await paymentService.pay({\n        orderNo: order.orderNo,\n        amount: productInfo.price * 100 * quantity,\n        paymentMethod: 'wechat',\n        title: productInfo.name,\n        wxPayParams: order.wxPayParams\n      })\n\n      if (paymentSuccess) {\n        Taro.showToast({\n          title: 'Ë¥≠‰π∞ÊàêÂäü',\n          icon: 'success',\n          duration: 1500\n        })\n\n        setTimeout(() => {\n          Taro.navigateBack()\n        }, 1500)\n      }\n    } catch (error: any) {\n      Taro.hideLoading()\n      const errorMessage = error.message || error.errMsg || 'Ë¥≠‰π∞Â§±Ë¥•'\n      Taro.showModal({\n        title: 'Ë¥≠‰π∞Â§±Ë¥•',\n        content: errorMessage,\n        showCancel: false,\n        confirmText: 'Áü•ÈÅì‰∫Ü'\n      })\n    }\n  }\n\n  const handleScroll = (e: any) => {\n    setScrollTop(e.detail.scrollTop)\n  }\n\n  const totalPrice = (productInfo?.price || 0) * quantity\n\n  if (loading) {\n    return (\n      <View className=\"product-detail-page\">\n        <View className=\"loading\">Âä†ËΩΩ‰∏≠...</View>\n      </View>\n    )\n  }\n\n  if (!productInfo) {\n    return (\n      <View className=\"product-detail-page\">\n        <View className=\"empty\">ÂïÜÂìÅ‰∏çÂ≠òÂú®</View>\n      </View>\n    )\n  }\n\n  return (\n    <View className=\"product-detail-page\">\n      {/* È°∂ÈÉ®ÂØºËà™Ê†è */}\n      <View className={`navbar ${scrollTop > 20 ? 'shadow' : ''}`}>\n        <View className=\"navbar-content\">\n          <View className=\"navbar-back\" onClick={() => Taro.navigateBack()}>\n            <View className=\"back-icon\">‚Äπ</View>\n          </View>\n          <Text className=\"navbar-title\">ÂïÜÂìÅËØ¶ÊÉÖ</Text>\n        </View>\n      </View>\n\n      {/* È°µÈù¢ÂÜÖÂÆπ */}\n      <View className=\"page-content\" onScroll={handleScroll} scrollY>\n        {/* ‰∫ßÂìÅÂõæÁâáÂ±ïÁ§∫ */}\n        <View className=\"product-image-container\">\n          <Image\n            className=\"product-image\"\n            src={productInfo.image}\n            mode=\"aspectFill\"\n          />\n          <View className=\"image-badge\">{productInfo.unit}</View>\n        </View>\n\n        {/* ‰∫ßÂìÅÂü∫Á°Ä‰ø°ÊÅØ */}\n        <View className=\"product-info-card\">\n          <View className=\"price-section\">\n            <View className=\"current-price\">\n              <Text className=\"currency\">¬•</Text>\n              <Text className=\"price-value\">\n                {(productInfo.price / 100).toFixed(0)}\n              </Text>\n            </View>\n            {productInfo.originalPrice && productInfo.originalPrice > productInfo.price && (\n              <Text className=\"original-price\">\n                ¬•{(productInfo.originalPrice / 100).toFixed(0)}\n              </Text>\n            )}\n          </View>\n\n          <View className=\"product-title-section\">\n            <Text className=\"product-name\">{productInfo.name}</Text>\n            <Text className=\"product-description\">{productInfo.description}</Text>\n          </View>\n        </View>\n\n        {/* ‰∫ßÂìÅÁâπËâ≤ */}\n        {productInfo.features && productInfo.features.length > 0 && (\n          <View className=\"features-card\">\n            <Text className=\"card-title\">‰∫ßÂìÅÁâπËâ≤</Text>\n            <View className=\"features-list\">\n              {productInfo.features.map((feature, index) => (\n                <View key={index} className=\"feature-item\">\n                  <View className=\"feature-icon\">‚úì</View>\n                  <Text className=\"feature-text\">{feature}</Text>\n                </View>\n              ))}\n            </View>\n          </View>\n        )}\n\n        {/* ËßÑÊ†ºÂèÇÊï∞ */}\n        {productInfo.specifications && Object.keys(productInfo.specifications).length > 0 && (\n          <View className=\"specs-card\">\n            <Text className=\"card-title\">ËßÑÊ†ºÂèÇÊï∞</Text>\n            <View className=\"specs-list\">\n              {Object.entries(productInfo.specifications).map(([key, value], index) => (\n                <View\n                  key={index}\n                  className={`spec-item ${index !== Object.entries(productInfo.specifications).length - 1 ? 'has-border' : ''}`}\n                >\n                  <Text className=\"spec-label\">{key}</Text>\n                  <Text className=\"spec-value\">{value}</Text>\n                </View>\n              ))}\n            </View>\n          </View>\n        )}\n\n        {/* Á©∫ÁôΩÂå∫ÂüüÔºåÁî®‰∫éÈò≤Ê≠¢ÂÜÖÂÆπË¢´Â∫ïÈÉ®Ê†èÈÅÆÊå° */}\n        <View className=\"bottom-spacer\" />\n      </View>\n\n      {/* Â∫ïÈÉ®Ë¥≠‰π∞Ê†è */}\n      <View className=\"bottom-bar\">\n        <View className=\"quantity-container\">\n          <Text className=\"quantity-label\">Êï∞Èáè</Text>\n          <View className=\"quantity-selector\">\n            <View\n              className=\"quantity-btn\"\n              onClick={() => handleQuantityChange('decrease')}\n            >\n              ‚àí\n            </View>\n            <Text className=\"quantity-value\">{quantity}</Text>\n            <View\n              className=\"quantity-btn\"\n              onClick={() => handleQuantityChange('increase')}\n            >\n              +\n            </View>\n          </View>\n        </View>\n\n        <View className=\"action-buttons\">\n          <Button\n            className=\"buy-btn\"\n            onClick={handleBuyNow}\n          >\n            <View className=\"btn-content\">\n              <Text className=\"btn-label\">Á´ãÂç≥Ë¥≠‰π∞</Text>\n              <Text className=\"btn-price\">¬•{(totalPrice / 100).toFixed(0)}</Text>\n            </View>\n          </Button>\n        </View>\n      </View>\n    </View>\n  )\n}\n\nexport default ProductDetail\n"],"names":["ProductDetail","router","useRouter","productInfo","setProductInfo","useState","loading","setLoading","quantity","setQuantity","scrollTop","setScrollTop","useEffect","pages","Taro","getCurrentPages","currentPage","length","id","options","console","log","pagesLength","routerParams","params","product","GiftService","getProductById","found","productName","name","warn","handleQuantityChange","type","handleBuyNow","showLoading","title","order","createProductOrder","productId","paymentMethod","hideLoading","paymentSuccess","paymentService","pay","orderNo","amount","price","wxPayParams","showToast","icon","duration","setTimeout","navigateBack","error","errorMessage","message","errMsg","showModal","content","showCancel","confirmText","handleScroll","e","detail","totalPrice","jsx","View","jsxs","Text","Image","image","unit","toFixed","originalPrice","description","features","map","feature","index","specifications","Object","keys","entries","key","value","Button"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAQA,MAAMA,gBAA0BA,MAAM;AACpC,QAAMC,SAASC,KAAAA,YAAAA;AACf,QAAM,CAACC,aAAaC,cAAc,IAAIC,cAAyB,IAAI;AACnE,QAAM,CAACC,SAASC,UAAU,IAAIF,cAAS,IAAI;AAC3C,QAAM,CAACG,UAAUC,WAAW,IAAIJ,cAAS,CAAC;AAC1C,QAAM,CAACK,WAAWC,YAAY,IAAIN,cAAS,CAAC;AAE5CO,OAAAA,UAAU,MAAM;AAERC,UAAAA,QAAQC,UAAKC;AACnB,UAAMC,cAAcH,MAAMA,MAAMI,SAAS,CAAC;AACpC,UAAA,EAAEC,GAAG,IAAIF,YAAYG;AAE3BC,YAAQC,IAAI,+BAA+B;AAAA,MACzCH;AAAAA,MACAI,aAAaT,MAAMI;AAAAA,MACnBM,cAActB,OAAOuB;AAAAA,IAAAA,CACtB;AAED,QAAIN,IAAI;AACAO,YAAAA,UAAUC,OAAAA,YAAYC,eAAeT,EAAE;AAC7CE,cAAQC,IAAI,2BAA2B;AAAA,QACrCH;AAAAA,QACAU,OAAO,CAAC,CAACH;AAAAA,QACTI,aAAaJ,mCAASK;AAAAA,MAAAA,CACvB;AAED,UAAIL,SAAS;AACXrB,uBAAeqB,OAAO;AACdJ,gBAAAA,IAAI,iCAAiCI,QAAQK,IAAI;AAAA,MAAA,OACpD;AACGC,gBAAAA,KAAK,yBAAyBb,EAAE;AAAA,MAC1C;AACAX,iBAAW,KAAK;AAAA,IAAA,OACX;AACLa,cAAQW,KAAK,2BAA2B;AACxCxB,iBAAW,KAAK;AAAA,IAClB;AAAA,EAAA,GACC,CAACN,MAAM,CAAC;AAEL+B,QAAAA,uBAAuBA,CAACC,SAAkC;AAC9D,QAAIA,SAAS,YAAY;AACvBxB,kBAAYD,WAAW,CAAC;AAAA,IACfyB,WAAAA,SAAS,cAAczB,WAAW,GAAG;AAC9CC,kBAAYD,WAAW,CAAC;AAAA,IAC1B;AAAA,EAAA;AAGF,QAAM0B,eAAe,MAAY;AAC/B,QAAI,CAAC/B;AAAa;AAEd,QAAA;AACFW,WAAAA,KAAKqB,YAAY,EAAEC,OAAO,UAAW,CAAA;AAE/BC,YAAAA,QAAQ,MAAMX,OAAAA,YAAYY,mBAAmB;AAAA,QACjDC,WAAWpC,YAAYe;AAAAA,QACvBV;AAAAA,QACAgC,eAAe;AAAA,MAAA,CAChB;AAED1B,WAAAA,KAAK2B,YAAY;AAEXC,YAAAA,iBAAiB,MAAMC,OAAAA,eAAeC,IAAI;AAAA,QAC9CC,SAASR,MAAMQ;AAAAA,QACfC,QAAQ3C,YAAY4C,QAAQ,MAAMvC;AAAAA,QAClCgC,eAAe;AAAA,QACfJ,OAAOjC,YAAY2B;AAAAA,QACnBkB,aAAaX,MAAMW;AAAAA,MAAAA,CACpB;AAED,UAAIN,gBAAgB;AAClB5B,aAAAA,KAAKmC,UAAU;AAAA,UACbb,OAAO;AAAA,UACPc,MAAM;AAAA,UACNC,UAAU;AAAA,QAAA,CACX;AAEDC,mBAAW,MAAM;AACftC,eAAAA,KAAKuC,aAAa;AAAA,WACjB,IAAI;AAAA,MACT;AAAA,aACOC,OAAY;AACnBxC,WAAAA,KAAK2B,YAAY;AACjB,YAAMc,eAAeD,MAAME,WAAWF,MAAMG,UAAU;AACtD3C,WAAAA,KAAK4C,UAAU;AAAA,QACbtB,OAAO;AAAA,QACPuB,SAASJ;AAAAA,QACTK,YAAY;AAAA,QACZC,aAAa;AAAA,MAAA,CACd;AAAA,IACH;AAAA,EAAA;AAGIC,QAAAA,eAAeA,CAACC,MAAW;AAClBA,iBAAAA,EAAEC,OAAOtD,SAAS;AAAA,EAAA;AAG3BuD,QAAAA,eAAc9D,2CAAa4C,UAAS,KAAKvC;AAE/C,MAAIF,SAAS;AAET,WAAA4D,qBAAAA,IAACC,KAAAA,QAAK,WAAU,uBACd,mCAACA,KAAK,MAAA,EAAA,WAAU,WAAU,UAAA,SAAM,CAAA,EAClC,CAAA;AAAA,EAEJ;AAEA,MAAI,CAAChE,aAAa;AAEd,WAAA+D,qBAAAA,IAACC,KAAAA,QAAK,WAAU,uBACd,mCAACA,KAAK,MAAA,EAAA,WAAU,SAAQ,UAAA,QAAK,CAAA,EAC/B,CAAA;AAAA,EAEJ;AAGE,SAAAC,qBAAA,KAACD,KAAK,MAAA,EAAA,WAAU,uBAEd,UAAA;AAAA,IAACD,qBAAA,IAAAC,KAAA,MAAA,EAAK,WAAW,UAAUzD,YAAY,KAAK,WAAW,EAAE,IACvD,UAAA0D,0BAACD,KAAAA,MAAK,EAAA,WAAU,kBACd,UAAA;AAAA,MAAAD,qBAAA,IAACC,KAAK,MAAA,EAAA,WAAU,eAAc,SAAS,MAAMrD,KAAAA,KAAKuC,aAAa,GAC7D,UAACa,qBAAA,IAAAC,KAAA,MAAA,EAAK,WAAU,aAAY,cAAC,CAAA,GAC/B;AAAA,MACCD,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,gBAAe,UAAI,QAAA;AAAA,IAAA,EAAA,CACrC,EACF,CAAA;AAAA,8BAGCF,KAAAA,MAAK,EAAA,WAAU,gBAAe,UAAUL,cAAc,SAAO,MAE5D,UAAA;AAAA,MAACM,qBAAAA,KAAAD,KAAAA,MAAA,EAAK,WAAU,2BACd,UAAA;AAAA,QAAAD,qBAAA;AAAA,UAACI,KAAA;AAAA,UAAA;AAAA,YACC,WAAU;AAAA,YACV,KAAKnE,YAAYoE;AAAAA,YACjB,MAAK;AAAA,UAAA;AAAA,QAAY;AAAA,QAElBL,qBAAA,IAAAC,KAAA,MAAA,EAAK,WAAU,eAAehE,sBAAYqE,MAAK;AAAA,MAAA,GAClD;AAAA,MAGAJ,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,qBACd,UAAA;AAAA,QAACC,qBAAAA,KAAAD,KAAAA,MAAA,EAAK,WAAU,iBACd,UAAA;AAAA,UAACC,qBAAAA,KAAAD,KAAAA,MAAA,EAAK,WAAU,iBACd,UAAA;AAAA,YAACD,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,YAAW,UAAC,KAAA;AAAA,YAC5BH,qBAAAA,IAACG,aAAK,WAAU,eACZlE,uBAAY4C,QAAQ,KAAK0B,QAAQ,CAAC,EACtC,CAAA;AAAA,UAAA,GACF;AAAA,UACCtE,YAAYuE,iBAAiBvE,YAAYuE,gBAAgBvE,YAAY4C,SACpEqB,qBAAA,KAACC,WAAK,EAAA,WAAU,kBAAgB,UAAA;AAAA,YAAA;AAAA,aAC3BlE,YAAYuE,gBAAgB,KAAKD,QAAQ,CAAC;AAAA,UAAA,GAC/C;AAAA,QAAA,GAEJ;AAAA,QAEAL,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,yBACd,UAAA;AAAA,UAAAD,qBAAA,IAACG,KAAK,MAAA,EAAA,WAAU,gBAAgBlE,UAAAA,YAAY2B,MAAK;AAAA,UAChDoC,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,uBAAuBlE,sBAAYwE,aAAY;AAAA,QAAA,GACjE;AAAA,MAAA,GACF;AAAA,MAGCxE,YAAYyE,YAAYzE,YAAYyE,SAAS3D,SAAS,KACrDmD,qBAAA,KAACD,WAAK,EAAA,WAAU,iBACd,UAAA;AAAA,QAACD,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,cAAa,UAAI,QAAA;AAAA,QAChCH,qBAAA,IAAAC,KAAA,MAAA,EAAK,WAAU,iBACbhE,sBAAYyE,SAASC;AAAAA,UAAI,CAACC,SAASC,WACjCX,qBAAA,KAAAD,KAAA,MAAA,EAAiB,WAAU,gBAC1B,UAAA;AAAA,YAACD,qBAAA,IAAAC,KAAA,MAAA,EAAK,WAAU,gBAAe,UAAC,KAAA;AAAA,YAC/BD,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,gBAAgBS,UAAQ,SAAA;AAAA,UAAA,EAAA,GAF/BC,MAGX;AAAA,QAAA,GAEJ;AAAA,MAAA,GACF;AAAA,MAID5E,YAAY6E,kBAAkBC,OAAOC,KAAK/E,YAAY6E,cAAc,EAAE/D,SAAS,KAC9EmD,qBAAA,KAACD,KAAK,MAAA,EAAA,WAAU,cACd,UAAA;AAAA,QAACD,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,cAAa,UAAI,QAAA;AAAA,QACjCH,qBAAAA,IAACC,aAAK,WAAU,cACbc,iBAAOE,QAAQhF,YAAY6E,cAAc,EAAEH;AAAAA,UAAI,CAAC,CAACO,KAAKC,KAAK,GAAGN,WAC7DX,qBAAA;AAAA,YAACD,KAAA;AAAA,YAAA;AAAA,cAEC,WAAW,aAAaY,WAAUE,OAAOE,QAAQhF,YAAY6E,cAAc,EAAE/D,SAAS,IAAI,eAAe,EAAE;AAAA,cAE3G,UAAA;AAAA,gBAACiD,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,cAAce,UAAI,KAAA;AAAA,gBACjClB,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,cAAcgB,UAAM,OAAA;AAAA,cAAA;AAAA,YAAA;AAAA,YAJ/BN;AAAAA,UAKP;AAAA,QAAA,GAEJ;AAAA,MAAA,GACF;AAAA,MAIFb,qBAAAA,IAACC,KAAK,MAAA,EAAA,WAAU,gBAAe,CAAA;AAAA,IAAA,GACjC;AAAA,IAGAC,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,cACd,UAAA;AAAA,MAACC,qBAAAA,KAAAD,KAAAA,MAAA,EAAK,WAAU,sBACd,UAAA;AAAA,QAACD,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,kBAAiB,UAAE,MAAA;AAAA,QACnCD,qBAAAA,KAACD,KAAAA,MAAK,EAAA,WAAU,qBACd,UAAA;AAAA,UAAAD,qBAAA;AAAA,YAACC,KAAA;AAAA,YAAA;AAAA,cACC,WAAU;AAAA,cACV,SAAS,MAAMnC,qBAAqB,UAAU;AAAA,cAAE,UAAA;AAAA,YAAA;AAAA,UAGlD;AAAA,UACCkC,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,kBAAkB7D,UAAS,UAAA;AAAA,UAC3C0D,qBAAA;AAAA,YAACC,KAAA;AAAA,YAAA;AAAA,cACC,WAAU;AAAA,cACV,SAAS,MAAMnC,qBAAqB,UAAU;AAAA,cAAE,UAAA;AAAA,YAAA;AAAA,UAGlD;AAAA,QAAA,GACF;AAAA,MAAA,GACF;AAAA,MAEAkC,qBAAAA,IAACC,KAAAA,MAAK,EAAA,WAAU,kBACd,UAAAD,qBAAA;AAAA,QAACoB,KAAA;AAAA,QAAA;AAAA,UACC,WAAU;AAAA,UACV,SAASpD;AAAAA,UAET,UAAAkC,qBAAA,KAACD,KAAK,MAAA,EAAA,WAAU,eACd,UAAA;AAAA,YAACD,qBAAA,IAAAG,KAAA,MAAA,EAAK,WAAU,aAAY,UAAI,QAAA;AAAA,YAChCD,qBAAAA,KAACC,KAAAA,MAAK,EAAA,WAAU,aAAY,UAAA;AAAA,cAAA;AAAA,eAAGJ,aAAa,KAAKQ,QAAQ,CAAC;AAAA,YAAA,GAAE;AAAA,UAAA,GAC9D;AAAA,QAAA;AAAA,MAAA,GAEJ;AAAA,IAAA,GACF;AAAA,EACF,EAAA,CAAA;AAEJ;;;;;;;;"}