{"version":3,"file":"index.js","sources":["../../../../src/pages/gift/purchase/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { View, Text, Image, Button } from '@tarojs/components'\nimport Taro, { useRouter } from '@tarojs/taro'\nimport { AtIcon } from 'taro-ui'\nimport { GiftService } from '@/services/gift.service'\nimport { paymentService } from '@/services/payment.service'\nimport { GiftCard } from '@/types'\nimport './index.scss'\n\nconst GiftCardPurchase: React.FC = () => {\n  const router = useRouter()\n  const { cardId } = router.params\n  const [cardInfo, setCardInfo] = useState<GiftCard | null>(null)\n  const [selectedAmount, setSelectedAmount] = useState(1000)\n  const [quantity, setQuantity] = useState(1)  // Êï∞ÈáèÈÄâÊã©\n\n  useEffect(() => {\n    if (cardId) {\n      const card = GiftService.getGiftCardById(cardId as string)\n      if (card) {\n        setCardInfo(card)\n      }\n    }\n  }, [cardId])\n\n  const predefinedAmounts = [\n    { value: 1000, label: '¬•1000', bonus: 'ÈÄÅ100' },\n    { value: 3000, label: '¬•3000', bonus: 'ÈÄÅ500' },\n  ]\n\n  const handleAmountSelect = (amount: number) => {\n    setSelectedAmount(amount)\n  }\n\n  const handleQuantityChange = (value: number) => {\n    setQuantity(value)\n  }\n\n  const handlePurchase = async () => {\n    const amount = selectedAmount\n    if (!amount) {\n      Taro.showToast({\n        title: 'ËØ∑ÈÄâÊã©Èù¢È¢ù',\n        icon: 'none'\n      })\n      return\n    }\n\n    try {\n      // ‚úÖ GiftService.createGiftCardOrder() ÂÜÖÈÉ®Â∑≤Â§ÑÁêÜ loadingÔºå‰∏çÈúÄË¶ÅÂú®ËøôÈáåÈáçÂ§ç\n      const order = await GiftService.createGiftCardOrder({\n        cardId: cardId as string,\n        amount: amount * 100, // ËΩ¨Êç¢‰∏∫ÂàÜ\n        quantity,\n        paymentMethod: 'wechat',\n        customMessage: '‰∏ñÁïå‰∏äÊúÄÂ•ΩÁöÑÁà∏Áà∏'\n      })\n\n      // ‚úÖ ÊñπÊ°àAÔºöÁõ¥Êé•Âú®Ë¥≠‰π∞È°µËøõË°åÊîØ‰ªòÔºå‰∏çË∑≥ËΩ¨Âà∞ËÆ¢ÂçïÁ°ÆËÆ§È°µ\n      console.log('üéÅ ËÆ¢ÂçïÂàõÂª∫ÊàêÂäüÔºåÂáÜÂ§áÊîØ‰ªò:', {\n        orderNo: order.orderNo,\n        amount: amount * quantity,\n        quantity\n      })\n\n      // ËøõË°åÂæÆ‰ø°ÊîØ‰ªò\n      const paymentSuccess = await paymentService.pay({\n        orderNo: order.orderNo,\n        amount: (amount * quantity) * 100, // ËΩ¨Êç¢‰∏∫ÂàÜ\n        paymentMethod: 'wechat',\n        title: `ÁîµÂ≠êÁ§ºÂç° ¬•${amount} √ó ${quantity}`,\n        wxPayParams: order.wxPayParams // ‚úÖ ‰º†ÈÄíÂæÆ‰ø°ÊîØ‰ªòÂèÇÊï∞\n      } as any)\n\n      if (paymentSuccess) {\n        // ÊîØ‰ªòÊàêÂäüÂêéË∑≥ËΩ¨ÂõûÁ§ºÂç°ÂàóË°®\n        Taro.showToast({\n          title: 'ÊîØ‰ªòÊàêÂäü',\n          icon: 'success',\n          duration: 1500\n        })\n\n        setTimeout(() => {\n          Taro.navigateBack()\n        }, 1500)\n      }\n    } catch (error: any) {\n      console.error('‚ùå Á§ºÂç°Ë¥≠‰π∞Â§±Ë¥•:', error)\n      Taro.hideLoading()  // ‚úÖ Á°Æ‰øùÂä†ËΩΩÁä∂ÊÄÅË¢´ÈöêËóè\n      Taro.showToast({\n        title: error.message || 'Ë¥≠‰π∞Â§±Ë¥•',\n        icon: 'none'\n      })\n    }\n  }\n\n  const getTotalPrice = () => {\n    return selectedAmount * quantity\n  }\n\n  if (!cardInfo) {\n    return (\n      <View className=\"gift-card-purchase\">\n        <View className=\"loading\">Âä†ËΩΩ‰∏≠...</View>\n      </View>\n    )\n  }\n\n  return (\n    <View className=\"gift-card-purchase\">\n      {/* Âç°Áâá‰ø°ÊÅØ */}\n      <View className=\"card-info-section\">\n        <View className=\"card-image\">\n          <Image\n            className=\"card-pic\"\n            src={cardInfo.image}\n            mode=\"aspectFill\"\n          />\n        </View>\n        <Text className=\"card-name\">{cardInfo.name}</Text>\n        <Text className=\"card-desc\">{cardInfo.description}</Text>\n      </View>\n\n      {/* ÁâπËâ≤ÂäüËÉΩ */}\n      <View className=\"features-section\">\n        <Text className=\"section-title\">Á§ºÂç°ÁâπËâ≤</Text>\n        <View className=\"features-list\">\n          {cardInfo.features.map((feature: string, index: number) => (\n            <View key={index} className=\"feature-item\">\n              <AtIcon value=\"check-circle\" size=\"18\" color=\"#a40035\" />\n              <Text className=\"feature-text\">{feature}</Text>\n            </View>\n          ))}\n        </View>\n      </View>\n\n      {/* Èù¢È¢ùÈÄâÊã© */}\n      <View className=\"amount-section\">\n        <Text className=\"section-title\">ËØ∑ÈÄâÊã©Èù¢È¢ù</Text>\n        <View className=\"amount-grid\">\n          {predefinedAmounts.map((item) => (\n            <View\n              key={item.value}\n              className={`amount-card ${selectedAmount === item.value ? 'active' : ''}`}\n              onClick={() => handleAmountSelect(item.value)}\n            >\n              <View className=\"amount-header\">\n                <Text className=\"amount\">{item.label}</Text>\n              </View>\n              <View className=\"amount-details\">\n                <Text className=\"bonus\">{item.bonus}</Text>\n              </View>\n              {selectedAmount === item.value && (\n                <View className=\"quantity-control\">\n                  <AtIcon\n                    value=\"subtract-circle\"\n                    size=\"20\"\n                    color=\"#999\"\n                    onClick={(e) => {\n                      e.stopPropagation()\n                      if (quantity > 1) handleQuantityChange(quantity - 1)\n                    }}\n                  />\n                  <Text className=\"quantity\">{quantity}</Text>\n                  <AtIcon\n                    value=\"add-circle\"\n                    size=\"20\"\n                    color=\"#a40035\"\n                    onClick={(e) => {\n                      e.stopPropagation()\n                      handleQuantityChange(quantity + 1)\n                    }}\n                  />\n                </View>\n              )}\n              {selectedAmount !== item.value && (\n                <AtIcon value=\"add-circle\" size=\"24\" color=\"#a40035\" />\n              )}\n            </View>\n          ))}\n          \n        </View>\n      </View>\n\n      {/* ‰ΩøÁî®ËßÑÂàô */}\n      <View className=\"rules-section\">\n        <Text className=\"section-title\">‰ΩøÁî®ËØ¥Êòé</Text>\n        <View className=\"rules-content\">\n          <Text className=\"rule-item\">{cardInfo.terms}</Text>\n          <Text className=\"rule-desc\" style={{ marginTop: '16px' }}>ËøîÈáëÈ¢ùËØ¥ÊòéÔºö</Text>\n          <Text className=\"rule-item\">(1) ÁîµÂ≠êÂç°Ëøî‰ΩôÈ¢ùÂú®Á§ºÂç°ÂàÜ‰∫´ÊàêÂäüÂêéÔºåËá™Âä®ÂÖÖÂÄºËá≥Ë¥≠‰π∞‰∫∫ÁöÑÂ∏∏‰πêÊé®Êãø‰ºöÂëò‰ΩôÈ¢ù‰∏≠„ÄÇ</Text>\n        </View>\n      </View>\n\n      {/* Â∫ïÈÉ®ÁªìÁÆóÊ†è */}\n      <View className=\"purchase-bar\">\n        <View className=\"price-info\">\n          <AtIcon value=\"shopping-bag-2\" size=\"24\" color=\"#a40035\" />\n          <Text className=\"total-price\">¬• {getTotalPrice()}</Text>\n          <View className=\"quantity-badge\">{quantity}</View>\n        </View>\n        <Button className=\"purchase-btn\" onClick={handlePurchase}>\n          ÂéªÁªìÁÆó\n        </Button>\n      </View>\n    </View>\n  )\n}\n\nexport default GiftCardPurchase"],"names":["GiftCardPurchase","router","useRouter","cardId","params","cardInfo","setCardInfo","useState","selectedAmount","setSelectedAmount","quantity","setQuantity","useEffect","card","GiftService","getGiftCardById","predefinedAmounts","value","label","bonus","handleAmountSelect","amount","handleQuantityChange","handlePurchase","Taro","showToast","title","icon","order","createGiftCardOrder","paymentMethod","customMessage","console","log","orderNo","paymentSuccess","paymentService","pay","wxPayParams","duration","setTimeout","navigateBack","error","hideLoading","message","getTotalPrice","jsx","View","jsxs","Image","image","Text","name","description","features","map","feature","index","AtIcon","item","e","stopPropagation","terms","marginTop","Button"],"mappings":"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"}