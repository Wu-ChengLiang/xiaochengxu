{"version":3,"file":"index.js","sources":["../../../../src/pages/gift/purchase/index.tsx"],"sourcesContent":["import React, { useState } from 'react'\nimport { View, Text, Image, Button } from '@tarojs/components'\nimport Taro from '@tarojs/taro'\nimport { AtIcon, AtInputNumber } from 'taro-ui'\nimport { GiftService } from '@/services/gift.service'\nimport './index.scss'\n\nconst GiftCardPurchase: React.FC = () => {\n  const [selectedAmount, setSelectedAmount] = useState(200)\n  const [customAmount, setCustomAmount] = useState(0)\n  const [quantity, setQuantity] = useState(1)\n\n  const predefinedAmounts = [\n    { value: 200, discount: null },\n    { value: 500, discount: 50 },\n    { value: 1000, discount: 100 },\n    { value: 2000, discount: 200 },\n  ]\n\n  const handleAmountSelect = (amount: number) => {\n    setSelectedAmount(amount)\n    setCustomAmount(0)\n  }\n\n  const handleCustomAmount = () => {\n    setSelectedAmount(0)\n  }\n\n  const handleQuantityChange = (value: number) => {\n    setQuantity(value)\n  }\n\n  const handlePurchase = async () => {\n    const amount = selectedAmount || customAmount\n    if (!amount) {\n      Taro.showToast({\n        title: '请选择或输入金额',\n        icon: 'none'\n      })\n      return\n    }\n\n    try {\n      Taro.showLoading({ title: '创建订单...' })\n\n      const order = await GiftService.createGiftCardOrder({\n        amount: amount * 100, // 转换为分\n        quantity,\n        paymentMethod: 'wechat',\n        customMessage: '世界上最好的爸爸'\n      })\n\n      Taro.hideLoading()\n\n      // 跳转到确认页面，传递订单信息\n      Taro.navigateTo({\n        url: `/pages/gift/order-confirm/index?orderNo=${order.orderNo}&amount=${amount}&quantity=${quantity}`\n      })\n    } catch (error: any) {\n      Taro.hideLoading()\n      Taro.showToast({\n        title: error.message || '创建订单失败',\n        icon: 'none'\n      })\n    }\n  }\n\n  const getTotalPrice = () => {\n    const amount = selectedAmount || customAmount || 0\n    return amount * quantity\n  }\n\n  return (\n    <View className=\"gift-card-purchase\">\n      {/* 礼卡展示 */}\n      <View className=\"card-preview\">\n        <Image \n          className=\"card-image\"\n          src=\"/assets/images/gift/card/gift-card.png\"\n          mode=\"aspectFit\"\n        />\n        <View className=\"card-content\">\n          <Text className=\"card-title\">世界上</Text>\n          <Text className=\"card-subtitle\">最好的爸爸</Text>\n          <Text className=\"card-label\">HEALTH CARD</Text>\n          <View className=\"panda-illustration\">\n            {/* 熊猫插画占位 */}\n          </View>\n          <View className=\"brand-tag\">\n            <Text>常乐</Text>\n          </View>\n        </View>\n        <Button className=\"diy-button\">DIY自定义</Button>\n      </View>\n\n      {/* 面额选择 */}\n      <View className=\"amount-section\">\n        <Text className=\"section-title\">请选择面额</Text>\n        <View className=\"amount-grid\">\n          {predefinedAmounts.map((item) => (\n            <View\n              key={item.value}\n              className={`amount-card ${selectedAmount === item.value ? 'active' : ''}`}\n              onClick={() => handleAmountSelect(item.value)}\n            >\n              <Text className=\"amount\">¥{item.value}</Text>\n              {item.discount && (\n                <Text className=\"discount\">返余额{item.discount}.00元</Text>\n              )}\n              {selectedAmount === item.value && (\n                <View className=\"quantity-control\">\n                  <AtIcon \n                    value=\"subtract-circle\" \n                    size=\"20\" \n                    color=\"#999\"\n                    onClick={(e) => {\n                      e.stopPropagation()\n                      if (quantity > 1) handleQuantityChange(quantity - 1)\n                    }}\n                  />\n                  <Text className=\"quantity\">{quantity}</Text>\n                  <AtIcon \n                    value=\"add-circle\" \n                    size=\"20\" \n                    color=\"#a40035\"\n                    onClick={(e) => {\n                      e.stopPropagation()\n                      handleQuantityChange(quantity + 1)\n                    }}\n                  />\n                </View>\n              )}\n              {!item.discount && selectedAmount !== item.value && (\n                <AtIcon value=\"add-circle\" size=\"24\" color=\"#a40035\" />\n              )}\n            </View>\n          ))}\n          \n          {/* 自定义金额 */}\n          <View \n            className={`amount-card custom ${selectedAmount === 0 && customAmount > 0 ? 'active' : ''}`}\n            onClick={handleCustomAmount}\n          >\n            <Text className=\"custom-label\">自定义金额</Text>\n            {selectedAmount === 0 && (\n              <AtInputNumber\n                min={1}\n                max={10000}\n                step={1}\n                value={customAmount}\n                onChange={(value) => setCustomAmount(value as number)}\n              />\n            )}\n            {selectedAmount !== 0 && (\n              <AtIcon value=\"add-circle\" size=\"24\" color=\"#999\" />\n            )}\n          </View>\n\n          {/* 礼卡集采 */}\n          <View className=\"amount-card bulk\">\n            <Text className=\"bulk-label\">礼卡集采</Text>\n            <AtIcon value=\"chevron-right\" size=\"20\" color=\"#999\" />\n          </View>\n        </View>\n      </View>\n\n      {/* 使用规则 */}\n      <View className=\"rules-section\">\n        <Text className=\"section-title\">使用规则</Text>\n        <View className=\"rules-content\">\n          <Text className=\"rule-desc\">返金额说明：</Text>\n          <Text className=\"rule-item\">(1) 电子卡返余额在礼卡分享成功后，自动充值至购买人的常乐推拿会员余额中。</Text>\n        </View>\n      </View>\n\n      {/* 底部结算栏 */}\n      <View className=\"purchase-bar\">\n        <View className=\"price-info\">\n          <AtIcon value=\"shopping-bag-2\" size=\"24\" color=\"#a40035\" />\n          <Text className=\"total-price\">¥ {getTotalPrice()}</Text>\n          <View className=\"quantity-badge\">{quantity}</View>\n        </View>\n        <Button className=\"purchase-btn\" onClick={handlePurchase}>\n          去结算\n        </Button>\n      </View>\n    </View>\n  )\n}\n\nexport default GiftCardPurchase"],"names":["GiftCardPurchase","selectedAmount","setSelectedAmount","useState","customAmount","setCustomAmount","quantity","setQuantity","predefinedAmounts","value","discount","handleAmountSelect","amount","handleCustomAmount","handleQuantityChange","handlePurchase","Taro","showToast","title","icon","showLoading","order","GiftService","createGiftCardOrder","paymentMethod","customMessage","hideLoading","navigateTo","url","orderNo","error","message","getTotalPrice","jsxs","View","jsx","Image","Text","Button","map","item","AtIcon","e","stopPropagation","AtInputNumber"],"mappings":"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"}