{"version":3,"file":"index.js","sources":["../../../../src/pages/gift/purchase/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { View, Text, Image, Button } from '@tarojs/components'\nimport Taro, { useRouter } from '@tarojs/taro'\nimport { AtIcon } from 'taro-ui'\nimport { GiftService } from '@/services/gift.service'\nimport { paymentService } from '@/services/payment.service'\nimport { GiftCard } from '@/types'\nimport './index.scss'\n\nconst GiftCardPurchase: React.FC = () => {\n  const router = useRouter()\n  const { cardId } = router.params\n  const [cardInfo, setCardInfo] = useState<GiftCard | null>(null)\n  const [selectedAmount, setSelectedAmount] = useState(1000)\n  const [quantity, setQuantity] = useState(1)  // Êï∞ÈáèÈÄâÊã©\n\n  useEffect(() => {\n    // üéÅ Ë∞ÉËØïÊó•ÂøóÔºöÊ£ÄÊü•Á§ºÂç°Âä†ËΩΩ\n    console.log('üéÅ ÁîµÂ≠êÁ§ºÂç°È°µÈù¢Âä†ËΩΩ')\n    console.log('üìç router.params:', { cardId })\n\n    if (cardId) {\n      const card = GiftService.getGiftCardById(cardId as string)\n      console.log('üîç Êü•ËØ¢Á§ºÂç°ÁªìÊûú:', {\n        cardId,\n        found: !!card,\n        card: card ? {\n          id: card.id,\n          name: card.name,\n          image: card.image,\n          type: card.type\n        } : null\n      })\n\n      if (card) {\n        setCardInfo(card)\n        console.log('‚úÖ Á§ºÂç°‰ø°ÊÅØÂ∑≤ËÆæÁΩÆ')\n      } else {\n        console.warn('‚ö†Ô∏è Á§ºÂç°Êú™ÊâæÂà∞:', cardId)\n      }\n    } else {\n      console.warn('‚ö†Ô∏è cardId Êú™Ëé∑ÂèñÂà∞:', cardId)\n    }\n  }, [cardId])\n\n  const predefinedAmounts = [\n    { value: 1000, label: '¬•1000', bonus: 'ÈÄÅ100' },\n    { value: 3000, label: '¬•3000', bonus: 'ÈÄÅ500' },\n  ]\n\n  const handleAmountSelect = (amount: number) => {\n    setSelectedAmount(amount)\n  }\n\n  const handleQuantityChange = (value: number) => {\n    setQuantity(value)\n  }\n\n  const handlePurchase = async () => {\n    const amount = selectedAmount\n    if (!amount) {\n      Taro.showToast({\n        title: 'ËØ∑ÈÄâÊã©Èù¢È¢ù',\n        icon: 'none'\n      })\n      return\n    }\n\n    try {\n      // ‚úÖ GiftService.createGiftCardOrder() ÂÜÖÈÉ®Â∑≤Â§ÑÁêÜ loadingÔºå‰∏çÈúÄË¶ÅÂú®ËøôÈáåÈáçÂ§ç\n      const order = await GiftService.createGiftCardOrder({\n        cardId: cardId as string,\n        amount: amount * 100, // ËΩ¨Êç¢‰∏∫ÂàÜ\n        quantity,\n        paymentMethod: 'wechat',\n        customMessage: '‰∏ñÁïå‰∏äÊúÄÂ•ΩÁöÑÁà∏Áà∏'\n      })\n\n      // ‚úÖ ÊñπÊ°àAÔºöÁõ¥Êé•Âú®Ë¥≠‰π∞È°µËøõË°åÊîØ‰ªòÔºå‰∏çË∑≥ËΩ¨Âà∞ËÆ¢ÂçïÁ°ÆËÆ§È°µ\n      console.log('üéÅ ËÆ¢ÂçïÂàõÂª∫ÊàêÂäüÔºåÂáÜÂ§áÊîØ‰ªò:', {\n        orderNo: order.orderNo,\n        amount: amount * quantity,\n        quantity\n      })\n\n      // ËøõË°åÂæÆ‰ø°ÊîØ‰ªò\n      const paymentSuccess = await paymentService.pay({\n        orderNo: order.orderNo,\n        amount: (amount * quantity) * 100, // ËΩ¨Êç¢‰∏∫ÂàÜ\n        paymentMethod: 'wechat',\n        title: `ÁîµÂ≠êÁ§ºÂç° ¬•${amount} √ó ${quantity}`,\n        wxPayParams: order.wxPayParams // ‚úÖ ‰º†ÈÄíÂæÆ‰ø°ÊîØ‰ªòÂèÇÊï∞\n      } as any)\n\n      if (paymentSuccess) {\n        // ÊîØ‰ªòÊàêÂäüÂêéË∑≥ËΩ¨ÂõûÁ§ºÂç°ÂàóË°®\n        Taro.showToast({\n          title: 'ÊîØ‰ªòÊàêÂäü',\n          icon: 'success',\n          duration: 1500\n        })\n\n        setTimeout(() => {\n          Taro.navigateBack()\n        }, 1500)\n      }\n    } catch (error: any) {\n      console.error('‚ùå Á§ºÂç°Ë¥≠‰π∞Â§±Ë¥•:', error)\n      Taro.hideLoading()  // ‚úÖ Á°Æ‰øùÂä†ËΩΩÁä∂ÊÄÅË¢´ÈöêËóè\n      Taro.showToast({\n        title: error.message || 'Ë¥≠‰π∞Â§±Ë¥•',\n        icon: 'none'\n      })\n    }\n  }\n\n  const getTotalPrice = () => {\n    return selectedAmount * quantity\n  }\n\n  if (!cardInfo) {\n    return (\n      <View className=\"gift-card-purchase\">\n        <View className=\"loading\">Âä†ËΩΩ‰∏≠...</View>\n      </View>\n    )\n  }\n\n  return (\n    <View className=\"gift-card-purchase\">\n      {/* Âç°Áâá‰ø°ÊÅØ */}\n      <View className=\"card-info-section\">\n        <View className=\"card-image\">\n          <Image\n            className=\"card-pic\"\n            src={cardInfo.image}\n            mode=\"aspectFill\"\n          />\n        </View>\n        <Text className=\"card-name\">{cardInfo.name}</Text>\n        <Text className=\"card-desc\">{cardInfo.description}</Text>\n      </View>\n\n      {/* ÁâπËâ≤ÂäüËÉΩ */}\n      <View className=\"features-section\">\n        <Text className=\"section-title\">Á§ºÂç°ÁâπËâ≤</Text>\n        <View className=\"features-list\">\n          {cardInfo.features.map((feature: string, index: number) => (\n            <View key={index} className=\"feature-item\">\n              <AtIcon value=\"check-circle\" size=\"18\" color=\"#a40035\" />\n              <Text className=\"feature-text\">{feature}</Text>\n            </View>\n          ))}\n        </View>\n      </View>\n\n      {/* Èù¢È¢ùÈÄâÊã© */}\n      <View className=\"amount-section\">\n        <Text className=\"section-title\">ËØ∑ÈÄâÊã©Èù¢È¢ù</Text>\n        <View className=\"amount-grid\">\n          {predefinedAmounts.map((item) => (\n            <View\n              key={item.value}\n              className={`amount-card ${selectedAmount === item.value ? 'active' : ''}`}\n              onClick={() => handleAmountSelect(item.value)}\n            >\n              <View className=\"amount-header\">\n                <Text className=\"amount\">{item.label}</Text>\n              </View>\n              <View className=\"amount-details\">\n                <Text className=\"bonus\">{item.bonus}</Text>\n              </View>\n              {selectedAmount === item.value && (\n                <View className=\"quantity-control\">\n                  <AtIcon\n                    value=\"subtract-circle\"\n                    size=\"20\"\n                    color=\"#999\"\n                    onClick={(e) => {\n                      e.stopPropagation()\n                      if (quantity > 1) handleQuantityChange(quantity - 1)\n                    }}\n                  />\n                  <Text className=\"quantity\">{quantity}</Text>\n                  <AtIcon\n                    value=\"add-circle\"\n                    size=\"20\"\n                    color=\"#a40035\"\n                    onClick={(e) => {\n                      e.stopPropagation()\n                      handleQuantityChange(quantity + 1)\n                    }}\n                  />\n                </View>\n              )}\n              {selectedAmount !== item.value && (\n                <AtIcon value=\"add-circle\" size=\"24\" color=\"#a40035\" />\n              )}\n            </View>\n          ))}\n          \n        </View>\n      </View>\n\n      {/* ‰ΩøÁî®ËßÑÂàô */}\n      <View className=\"rules-section\">\n        <Text className=\"section-title\">‰ΩøÁî®ËØ¥Êòé</Text>\n        <View className=\"rules-content\">\n          <Text className=\"rule-item\">{cardInfo.terms}</Text>\n          <Text className=\"rule-desc\" style={{ marginTop: '16px' }}>ËøîÈáëÈ¢ùËØ¥ÊòéÔºö</Text>\n          <Text className=\"rule-item\">(1) ÁîµÂ≠êÂç°Ëøî‰ΩôÈ¢ùÂú®Á§ºÂç°ÂàÜ‰∫´ÊàêÂäüÂêéÔºåËá™Âä®ÂÖÖÂÄºËá≥Ë¥≠‰π∞‰∫∫ÁöÑÂ∏∏‰πêÊé®Êãø‰ºöÂëò‰ΩôÈ¢ù‰∏≠„ÄÇ</Text>\n        </View>\n      </View>\n\n      {/* Â∫ïÈÉ®ÁªìÁÆóÊ†è */}\n      <View className=\"purchase-bar\">\n        <View className=\"price-info\">\n          <AtIcon value=\"shopping-bag-2\" size=\"24\" color=\"#a40035\" />\n          <Text className=\"total-price\">¬• {getTotalPrice()}</Text>\n          <View className=\"quantity-badge\">{quantity}</View>\n        </View>\n        <Button className=\"purchase-btn\" onClick={handlePurchase}>\n          ÂéªÁªìÁÆó\n        </Button>\n      </View>\n    </View>\n  )\n}\n\nexport default GiftCardPurchase"],"names":["GiftCardPurchase","router","useRouter","cardId","params","cardInfo","setCardInfo","useState","selectedAmount","setSelectedAmount","quantity","setQuantity","useEffect","console","log","card","GiftService","getGiftCardById","found","id","name","image","type","warn","predefinedAmounts","value","label","bonus","handleAmountSelect","amount","handleQuantityChange","handlePurchase","Taro","showToast","title","icon","order","createGiftCardOrder","paymentMethod","customMessage","orderNo","paymentSuccess","paymentService","pay","wxPayParams","duration","setTimeout","navigateBack","error","hideLoading","message","getTotalPrice","jsx","View","jsxs","Image","Text","description","features","map","feature","index","AtIcon","item","e","stopPropagation","terms","marginTop","Button"],"mappings":"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"}