"use strict";var e=(e,s,t)=>new Promise((a,i)=>{var r=e=>{try{n(t.next(e))}catch(s){i(s)}},c=e=>{try{n(t.throw(e))}catch(s){i(s)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,c);n((t=t.apply(e,s)).next())});const s=require("../../../taro.js"),t=require("../../../vendors.js"),a=require("../../../common.js"),i="",r=()=>{const[i,r]=s.reactExports.useState([]),[c,n]=s.reactExports.useState(null),[o,x]=s.reactExports.useState(1),[l,m]=s.reactExports.useState(0),[u,d]=s.reactExports.useState(!1);s.reactExports.useEffect(()=>{const e=a.GiftService.getNuantieProducts();r(e),e.length>0&&(n(e[0]),d(!0))},[]);const p=e=>{m(e),n(i[e]),x(1)},j=e=>{m(e.detail.current)},h=e=>{"increase"===e?x(o+1):"decrease"===e&&o>1&&x(o-1)},E=()=>e(exports,null,function*(){if(c)try{s.Taro.showLoading({title:"\u521b\u5efa\u8ba2\u5355..."});const e=yield a.GiftService.createProductOrder({productId:c.id,quantity:o,paymentMethod:"wechat"});s.Taro.hideLoading();const t=yield a.paymentService.pay({orderNo:e.orderNo,amount:100*c.price*o,paymentMethod:"wechat",title:c.name,wxPayParams:e.wxPayParams});t&&(s.Taro.showToast({title:"\u8d2d\u4e70\u6210\u529f",icon:"success",duration:1500}),setTimeout(()=>{s.Taro.navigateBack()},1500))}catch(e){s.Taro.hideLoading();const t=e.message||e.errMsg||"\u8d2d\u4e70\u5931\u8d25";s.Taro.showModal({title:"\u8d2d\u4e70\u5931\u8d25",content:t,showCancel:!1,confirmText:"\u77e5\u9053\u4e86"})}}),w=()=>{d(!1),s.Taro.navigateBack()};return c?s.jsxRuntimeExports.jsx(s.View,{className:"nuantie-page",children:u&&s.jsxRuntimeExports.jsx(s.View,{className:"modal-overlay",onClick:w,children:s.jsxRuntimeExports.jsxs(s.View,{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsxRuntimeExports.jsxs(s.View,{className:"modal-top",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"carousel-container",children:[s.jsxRuntimeExports.jsx(s.Swiper,{className:"product-swiper",circular:!0,current:l,onChange:j,children:i.map((e,t)=>s.jsxRuntimeExports.jsx(s.SwiperItem,{children:s.jsxRuntimeExports.jsx(s.Image,{className:"product-image",src:e.image,mode:"aspectFill"})},e.id))}),s.jsxRuntimeExports.jsx(s.View,{className:"pagination-dots",children:i.map((e,t)=>s.jsxRuntimeExports.jsx(s.View,{className:"dot "+(l===t?"active":"")},t))})]}),s.jsxRuntimeExports.jsx(s.View,{className:"close-btn",onClick:w,children:s.jsxRuntimeExports.jsx(t.AtIcon,{value:"close",size:"24",color:"#fff"})})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"modal-bottom",children:[s.jsxRuntimeExports.jsx(s.View,{className:"product-list",children:i.map((e,t)=>s.jsxRuntimeExports.jsxs(s.View,{className:"product-item "+(c.id===e.id?"active":""),onClick:()=>p(t),children:[s.jsxRuntimeExports.jsxs(s.View,{className:"product-header",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"product-name",children:e.name}),s.jsxRuntimeExports.jsxs(s.Text,{className:"product-price",children:["\xa5",(e.price/100).toFixed(0)]})]}),s.jsxRuntimeExports.jsx(s.Text,{className:"product-desc",children:e.description})]},e.id))}),s.jsxRuntimeExports.jsxs(s.View,{className:"quantity-section",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"label",children:"\u8d2d\u4e70\u6570\u91cf"}),s.jsxRuntimeExports.jsxs(s.View,{className:"quantity-selector",children:[s.jsxRuntimeExports.jsx(s.View,{className:"quantity-btn",onClick:()=>h("decrease"),children:s.jsxRuntimeExports.jsx(t.AtIcon,{value:"subtract",size:"20",color:1===o?"#ccc":"#333"})}),s.jsxRuntimeExports.jsx(s.Text,{className:"quantity-value",children:o}),s.jsxRuntimeExports.jsx(s.View,{className:"quantity-btn",onClick:()=>h("increase"),children:s.jsxRuntimeExports.jsx(t.AtIcon,{value:"add",size:"20",color:"#333"})})]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"action-bar",children:s.jsxRuntimeExports.jsxs(s.Button,{className:"buy-btn",onClick:E,children:["\u7acb\u5373\u8d2d\u4e70 \xa5",(c.price/100*o).toFixed(0)]})})]})]})})}):s.jsxRuntimeExports.jsx(s.View,{className:"nuantie-page",children:s.jsxRuntimeExports.jsx(s.View,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})})};var c={navigationBarTitleText:"\u6696\u8d34"};Page(s.createPageConfig(r,"pages/gift/nuantie/index",{root:{cn:[]}},c||{}));
