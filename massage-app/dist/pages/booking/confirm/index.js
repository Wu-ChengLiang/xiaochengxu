"use strict";var e=(e,s,t)=>new Promise((a,r)=>{var i=e=>{try{o(t.next(e))}catch(s){r(s)}},n=e=>{try{o(t.throw(e))}catch(s){r(s)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);o((t=t.apply(e,s)).next())});const s=require("../../../taro.js"),t="",a=()=>{const t=s.taroExports.useRouter(),a=t.params,[r,i]=s.reactExports.useState([]),[n,o]=s.reactExports.useState(null),[c,x]=s.reactExports.useState(null),[l,m]=s.reactExports.useState(!0),[p,u]=s.reactExports.useState(180),[d,j]=s.reactExports.useState("wechat"),h=s.reactExports.useRef(null);s.reactExports.useEffect(()=>{try{const e=JSON.parse(decodeURIComponent(a.items||"[]"));i(e),E()}catch(e){s.Taro.showToast({title:"\u6570\u636e\u89e3\u6790\u5931\u8d25",icon:"none"}),setTimeout(()=>s.Taro.navigateBack(),1500)}},[a]),s.reactExports.useEffect(()=>(!l&&r.length>0&&(h.current=setInterval(()=>{u(e=>e<=1?(clearInterval(h.current),s.Taro.showModal({title:"\u652f\u4ed8\u8d85\u65f6\u4e86\u5466",content:"\u5feb\u5feb\u91cd\u65b0\u4e0b\u5355\u5427~",showCancel:!1,success:()=>{s.Taro.navigateBack()}}),0):e-1)},1e3)),()=>{h.current&&clearInterval(h.current)}),[l,r]);const E=()=>e(exports,null,function*(){try{m(!0);const e={id:a.therapistId,name:"\u738b\u5fd7\u9999",avatar:"https://img.yzcdn.cn/vant/cat.jpeg",rating:4.8,serviceCount:10109},s={id:a.storeId,name:"\u4e0a\u6d77\u4e07\u8c61\u57ce\u5e97",address:"\u95f5\u884c\u533a\u5434\u4e2d\u8def1599\u53f7\u4e07\u8c61\u57ceL501b\uff08\u7535\u5f71\u9662\u95e8\u53e3\uff09",distance:8.8};o(e),x(s),m(!1)}catch(e){m(!1),s.Taro.showToast({title:"\u83b7\u53d6\u4fe1\u606f\u5931\u8d25",icon:"none"})}}),N=e=>{const s=Math.floor(e/60),t=e%60;return`${s.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},w=e=>{const s=new Date(e),t=s.getMonth()+1,a=s.getDate();return`${t.toString().padStart(2,"0")}\u6708${a.toString().padStart(2,"0")}\u65e5`},R=(e,s)=>{const[t,a]=e.split(":").map(Number),r=a+s,i=t+Math.floor(r/60),n=r%60;return`${i}:${n.toString().padStart(2,"0")}`},g=()=>r.reduce((e,s)=>e+(s.discountPrice||s.price),0),T=()=>e(exports,null,function*(){const e=`ORD${Date.now()}`;s.Taro.showLoading({title:"\u6b63\u5728\u652f\u4ed8..."}),setTimeout(()=>{s.Taro.hideLoading(),s.Taro.showToast({title:"\u652f\u4ed8\u6210\u529f",icon:"success",duration:1500}),setTimeout(()=>{s.Taro.redirectTo({url:`/pages/booking/success/index?orderNo=${e}`})},1500)},2e3)});return l?s.jsxRuntimeExports.jsx(s.View,{className:"order-confirm-page",children:s.jsxRuntimeExports.jsx(s.View,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})}):s.jsxRuntimeExports.jsxs(s.ScrollView,{className:"order-confirm-page",scrollY:!0,children:[s.jsxRuntimeExports.jsxs(s.View,{className:"store-section",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"store-name",children:null==c?void 0:c.name}),s.jsxRuntimeExports.jsxs(s.Text,{className:"store-distance",children:["\ud83d\udccd ",null==c?void 0:c.distance,"km"]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"booking-info",children:r.map((e,t)=>s.jsxRuntimeExports.jsxs(s.View,{className:"booking-item",children:[s.jsxRuntimeExports.jsx(s.Image,{className:"therapist-avatar",src:e.therapistAvatar||(null==n?void 0:n.avatar)}),s.jsxRuntimeExports.jsxs(s.View,{className:"booking-details",children:[s.jsxRuntimeExports.jsx(s.View,{className:"therapist-name",children:e.therapistName}),s.jsxRuntimeExports.jsxs(s.View,{className:"service-time",children:[w(e.date)," ",e.time," \u81f3 ",R(e.time,e.duration)]}),s.jsxRuntimeExports.jsx(s.View,{className:"service-name",children:e.serviceName})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"service-price",children:["\xa5",e.discountPrice||e.price]})]},t))}),s.jsxRuntimeExports.jsxs(s.View,{className:"refund-policy",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"policy-title",children:"\u9000\u5355\u8bf4\u660e"}),s.jsxRuntimeExports.jsxs(s.View,{className:"policy-list",children:[s.jsxRuntimeExports.jsx(s.View,{className:"policy-item",children:"\u2022 \u4e0b\u535515\u5206\u949f\u5185\u6216\u8ddd\u8ba2\u5355\u5f00\u59cb\u65f6\u95f4>6\u5c0f\u65f6\u9000\u5355\uff0c\u9000100%"}),s.jsxRuntimeExports.jsx(s.View,{className:"policy-item",children:"\u2022 \u8ddd\u8ba2\u5355\u5f00\u59cb\u524d<6\u5c0f\u65f6\u9000\u5355\uff0c\u9000\u5b9e\u4ed8\u91d1\u989d90%"}),s.jsxRuntimeExports.jsx(s.View,{className:"policy-item",children:"\u2022 \u8ba2\u5355\u65f6\u95f4\u5f00\u59cb\u540e\u9000\u5355\uff0c\u9000\u5b9e\u4ed8\u91d1\u989d80%"})]})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"customer-note",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"note-title",children:"\u5ba2\u6237\u5907\u6ce8"}),s.jsxRuntimeExports.jsx(s.Text,{className:"note-hint",children:"\u60a8\u5bf9\u8336\u6c34\u3001\u623f\u95f4\u3001\u6309\u6469\u670d\u7b49\u662f\u5426\u6709\u7279\u6b8a\u9700\u6c42\uff0c\u6211\u4eec\u5c06\u63d0\u524d\u4e3a\u60a8\u505a\u597d\u51c6\u5907"})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"payment-section",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"section-title",children:"\u652f\u4ed8\u65b9\u5f0f"}),s.jsxRuntimeExports.jsx(s.View,{className:"payment-methods",children:s.jsxRuntimeExports.jsxs(s.View,{className:"payment-method "+("wechat"===d?"active":""),onClick:()=>j("wechat"),children:[s.jsxRuntimeExports.jsxs(s.View,{className:"method-info",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"method-icon",children:"\u2705"}),s.jsxRuntimeExports.jsx(s.Text,{className:"method-name",children:"\u5fae\u4fe1\u652f\u4ed8"})]}),s.jsxRuntimeExports.jsx(s.View,{className:"check-icon "+("wechat"===d?"checked":"")})]})})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"payment-bar",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"price-info",children:[s.jsxRuntimeExports.jsxs(s.Text,{className:"total-price",children:["\xa5 ",g()]}),s.jsxRuntimeExports.jsxs(s.Text,{className:"countdown",children:["\u652f\u4ed8\u5012\u8ba1\u65f6: ",N(p)]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"pay-button",onClick:T,children:"\u53bb\u652f\u4ed8"})]})]})};var r={navigationBarTitleText:"\u8ba2\u5355\u786e\u8ba4"};Page(s.createPageConfig(a,"pages/booking/confirm/index",{root:{cn:[]}},r||{}));
