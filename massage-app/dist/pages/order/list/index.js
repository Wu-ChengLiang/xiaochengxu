"use strict";var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,i=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&o(e,s,t[s]);if(r)for(var s of r(t))a.call(t,s)&&o(e,s,t[s]);return e},c=(e,r)=>t(e,s(r)),l=(e,t,s)=>new Promise((r,n)=>{var a=e=>{try{i(s.next(e))}catch(t){n(t)}},o=e=>{try{i(s.throw(e))}catch(t){n(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);i((s=s.apply(e,t)).next())});const x=require("../../../taro.js"),p=require("../../../vendors.js"),d=require("../../../common.js"),u="",m=()=>{const[e,t]=x.reactExports.useState(0),[s,r]=x.reactExports.useState([]),[n,a]=x.reactExports.useState(!0),[o,u]=x.reactExports.useState(!1),[m,j]=x.reactExports.useState(1),h=[{title:"\u5168\u90e8"},{title:"\u5f85\u652f\u4ed8"},{title:"\u5f85\u670d\u52a1"},{title:"\u5df2\u5b8c\u6210"}],g={0:void 0,1:"pending",2:"paid",3:"completed"};x.taroExports.useDidShow(()=>{j(1),E(1)}),x.reactExports.useEffect(()=>{j(1),E(1)},[e]),x.taroExports.usePullDownRefresh(()=>l(exports,null,function*(){yield E(1),x.Taro.stopPullDownRefresh()}));const E=(...t)=>l(exports,[...t],function*(t=m){try{a(!0);const s=g[e];let n=yield d.orderService.getOrderList(void 0,"service",t,100);s&&(n=n.filter(e=>{const t=e.displayStatus||e.paymentStatus;return"completed"===s?"completed"===t:"paid"===s?"paid"===t:"pending"===s?"pending"===t:t===s}));const o=n.slice(0,20);r(1===t?o:e=>[...e,...o]),j(t),u(20===o.length)}catch(s){console.error("\u83b7\u53d6\u8ba2\u5355\u5931\u8d25:",s),1===t&&r([])}finally{a(!1)}}),y=e=>{t(e)},w=e=>{x.Taro.navigateTo({url:`/pages/order/detail/index?orderNo=${e}`})},f=(e,t)=>l(exports,null,function*(){e.stopPropagation();try{const e=yield d.orderService.getPaymentParams(t.orderNo);x.Taro.requestPayment(c(i({},e),{success:()=>l(exports,null,function*(){yield d.orderService.updateOrderStatus(t.orderNo,"paid"),x.Taro.showToast({title:"\u652f\u4ed8\u6210\u529f",icon:"success"}),E()}),fail:e=>{"requestPayment:fail cancel"!==e.errMsg&&x.Taro.showToast({title:"\u652f\u4ed8\u5931\u8d25",icon:"none"})}}))}catch(s){x.Taro.showToast({title:"\u83b7\u53d6\u652f\u4ed8\u53c2\u6570\u5931\u8d25",icon:"none"})}}),N=(e,t)=>l(exports,null,function*(){e.stopPropagation(),x.Taro.showModal({title:"\u53d6\u6d88\u8ba2\u5355",content:"\u786e\u5b9a\u8981\u53d6\u6d88\u8be5\u8ba2\u5355\u5417\uff1f",success:e=>l(exports,null,function*(){if(e.confirm)try{const e=yield d.orderService.cancelOrder(t.orderNo);e.refundAmount&&e.refundAmount>0?x.Taro.showToast({title:`\u5df2\u53d6\u6d88\uff0c\u9000\u6b3e\uffe5${(e.refundAmount/100).toFixed(2)}`,icon:"success",duration:2500}):x.Taro.showToast({title:"\u8ba2\u5355\u5df2\u53d6\u6d88",icon:"success"}),E(1)}catch(s){x.Taro.showToast({title:s.message||"\u53d6\u6d88\u5931\u8d25",icon:"none"})}})})}),R=(e,t)=>{e.stopPropagation(),x.Taro.switchTab({url:"/pages/appointment/index"})},T=e=>{const t=e.displayStatus||e.paymentStatus,s={pending:"\u5f85\u652f\u4ed8",paid:"\u5f85\u670d\u52a1",serving:"\u670d\u52a1\u4e2d",completed:"\u5df2\u5b8c\u6210",cancelled:"\u5df2\u53d6\u6d88",refunded:"\u5df2\u9000\u6b3e"};return s[t]||t},S=e=>{const t=e.displayStatus||e.paymentStatus,s={pending:"status-pending",paid:"status-paid",serving:"status-serving",completed:"status-completed",cancelled:"status-cancelled",refunded:"status-refunded"};return s[t]||""},v=e=>{const t=new Date(e),s=t.getMonth()+1,r=t.getDate(),n=t.getHours(),a=t.getMinutes();return`${s}\u6708${r}\u65e5 ${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},b=e=>x.jsxRuntimeExports.jsxs(x.View,{className:"order-item",onClick:()=>w(e.orderNo),children:[x.jsxRuntimeExports.jsxs(x.View,{className:"order-header",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"store-name",children:e.storeName}),x.jsxRuntimeExports.jsx(x.Text,{className:`order-status ${S(e)}`,children:T(e)})]}),x.jsxRuntimeExports.jsxs(x.View,{className:"order-content",children:[x.jsxRuntimeExports.jsx(x.Image,{className:"therapist-avatar",src:e.therapistAvatar||"https://img.yzcdn.cn/vant/cat.jpeg"}),x.jsxRuntimeExports.jsxs(x.View,{className:"order-info",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"info-row",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"therapist-name",children:e.therapistName}),x.jsxRuntimeExports.jsx(x.Text,{className:"service-name",children:e.serviceName})]}),x.jsxRuntimeExports.jsx(x.View,{className:"info-row",children:x.jsxRuntimeExports.jsxs(x.Text,{className:"appointment-time",children:["\u9884\u7ea6\u65f6\u95f4\uff1a",v(`${e.appointmentDate} ${e.appointmentTime}`)]})}),x.jsxRuntimeExports.jsx(x.View,{className:"info-row",children:x.jsxRuntimeExports.jsxs(x.Text,{className:"order-no",children:["\u8ba2\u5355\u53f7\uff1a",e.orderNo]})})]})]}),x.jsxRuntimeExports.jsxs(x.View,{className:"order-footer",children:[x.jsxRuntimeExports.jsxs(x.View,{className:"price-info",children:[x.jsxRuntimeExports.jsx(x.Text,{className:"label",children:"\u5b9e\u4ed8\uff1a"}),x.jsxRuntimeExports.jsxs(x.Text,{className:"price",children:["\xa5",e.totalAmount]})]}),x.jsxRuntimeExports.jsxs(x.View,{className:"action-buttons",children:["pending"===(e.displayStatus||e.paymentStatus)&&x.jsxRuntimeExports.jsxs(x.jsxRuntimeExports.Fragment,{children:[x.jsxRuntimeExports.jsx(x.View,{className:"button cancel",onClick:t=>N(t,e),children:"\u53d6\u6d88\u8ba2\u5355"}),x.jsxRuntimeExports.jsx(x.View,{className:"button pay",onClick:t=>f(t,e),children:"\u53bb\u652f\u4ed8"})]}),"paid"===(e.displayStatus||e.paymentStatus)&&x.jsxRuntimeExports.jsx(x.View,{className:"button cancel",onClick:t=>N(t,e),children:"\u53d6\u6d88\u8ba2\u5355"}),"serving"===(e.displayStatus||e.paymentStatus)&&null,["completed","cancelled","refunded"].includes(e.displayStatus||e.paymentStatus)&&x.jsxRuntimeExports.jsx(x.View,{className:"button rebook",onClick:e=>R(e),children:"\u518d\u6b21\u9884\u7ea6"})]})]})]},e.orderNo),P=()=>x.jsxRuntimeExports.jsxs(x.View,{className:"empty-state",children:[x.jsxRuntimeExports.jsx(p.AtIcon,{value:"file-generic",size:"60",color:"#ccc"}),x.jsxRuntimeExports.jsx(x.Text,{className:"empty-text",children:"\u6682\u65e0\u8ba2\u5355"})]}),V=()=>x.jsxRuntimeExports.jsx(x.View,{className:"loading-state",children:x.jsxRuntimeExports.jsx(x.Text,{children:"\u52a0\u8f7d\u4e2d..."})});return x.jsxRuntimeExports.jsx(x.View,{className:"order-list-page",children:x.jsxRuntimeExports.jsx(p.AtTabs,{current:e,tabList:h,onClick:y,className:"order-tabs",children:h.map((t,r)=>x.jsxRuntimeExports.jsx(p.AtTabsPane,{current:e,index:r,children:x.jsxRuntimeExports.jsx(x.ScrollView,{scrollY:!0,className:"order-list",children:n?V():s.length>0?s.map(b):P()})},r))})})};var j={navigationBarTitleText:"\u6211\u7684\u8ba2\u5355",enablePullDownRefresh:!0,backgroundTextStyle:"dark"};Page(x.createPageConfig(m,"pages/order/list/index",{root:{cn:[]}},j||{}));
