{"version":3,"file":"index.js","sources":["../../../../src/pages/mine/balance/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { View, Text, ScrollView } from '@tarojs/components'\nimport Taro, { useReachBottom } from '@tarojs/taro'\nimport { AtIcon } from 'taro-ui'\nimport { walletService, Transaction } from '@/services/wallet.service'\nimport './index.scss'\n\nconst Balance: React.FC = () => {\n  const [balance, setBalance] = useState(0)\n  const [transactions, setTransactions] = useState<Transaction[]>([])\n  const [loading, setLoading] = useState(false)\n  const [page, setPage] = useState(1)\n  const [hasMore, setHasMore] = useState(true)\n\n  useEffect(() => {\n    fetchBalance()\n    fetchTransactions()\n  }, [])\n\n  // 触底加载更多\n  useReachBottom(() => {\n    if (hasMore && !loading) {\n      fetchTransactions(page + 1)\n    }\n  })\n\n  const fetchBalance = async () => {\n    const currentBalance = await walletService.getBalance()\n    setBalance(currentBalance)\n  }\n\n  const fetchTransactions = async (pageNum: number = 1) => {\n    if (loading) return\n\n    setLoading(true)\n    try {\n      const list = await walletService.getTransactions(pageNum, 20)\n\n      if (pageNum === 1) {\n        setTransactions(list)\n      } else {\n        setTransactions(prev => [...prev, ...list])\n      }\n\n      setPage(pageNum)\n      setHasMore(list.length === 20)\n    } catch (error) {\n      Taro.showToast({\n        title: '加载失败',\n        icon: 'none'\n      })\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRecharge = () => {\n    Taro.navigateTo({\n      url: '/pages/mine/recharge/index'\n    })\n  }\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr)\n    const month = date.getMonth() + 1\n    const day = date.getDate()\n    const hours = date.getHours()\n    const minutes = date.getMinutes()\n\n    const today = new Date()\n    const isToday = date.toDateString() === today.toDateString()\n\n    const dateString = isToday ? '今天' : `${month}月${day}日`\n    const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`\n\n    return `${dateString} ${timeString}`\n  }\n\n  const getTransactionIcon = (type: Transaction['type']) => {\n    switch (type) {\n      case 'recharge':\n        return 'add-circle'\n      case 'consume':\n        return 'subtract-circle'\n      case 'refund':\n        return 'reload'\n      default:\n        return 'money'\n    }\n  }\n\n  const getTransactionColor = (type: Transaction['type']) => {\n    switch (type) {\n      case 'recharge':\n      case 'refund':\n        return '#52c41a'\n      case 'consume':\n        return '#333'\n      default:\n        return '#999'\n    }\n  }\n\n  const formatAmount = (amount: number) => {\n    return amount > 0 ? `+${amount.toFixed(2)}` : amount.toFixed(2)\n  }\n\n  return (\n    <View className=\"balance-page\">\n      {/* 余额卡片 */}\n      <View className=\"balance-card\">\n        <View className=\"card-content\">\n          <Text className=\"label\">当前余额</Text>\n          <View className=\"amount-wrapper\">\n            <Text className=\"currency\">¥</Text>\n            <Text className=\"amount\">{balance.toFixed(2)}</Text>\n          </View>\n          <View className=\"action-btn\" onClick={handleRecharge}>\n            <AtIcon value=\"add\" size=\"16\" color=\"#fff\" />\n            <Text>充值</Text>\n          </View>\n        </View>\n      </View>\n\n      {/* 交易记录 */}\n      <View className=\"transaction-section\">\n        <Text className=\"section-title\">交易记录</Text>\n\n        {transactions.length === 0 ? (\n          <View className=\"empty\">\n            <AtIcon value=\"file-generic\" size=\"48\" color=\"#ccc\" />\n            <Text className=\"empty-text\">暂无交易记录</Text>\n          </View>\n        ) : (\n          <ScrollView className=\"transaction-list\" scrollY>\n            {transactions.map((transaction) => (\n              <View key={transaction.id} className=\"transaction-item\">\n                <View className=\"left\">\n                  <AtIcon\n                    value={getTransactionIcon(transaction.type)}\n                    size=\"32\"\n                    color={getTransactionColor(transaction.type)}\n                  />\n                  <View className=\"info\">\n                    <Text className=\"description\">{transaction.description}</Text>\n                    <Text className=\"time\">{formatDate(transaction.createdAt)}</Text>\n                  </View>\n                </View>\n                <View className=\"right\">\n                  <Text\n                    className={`amount ${transaction.amount > 0 ? 'income' : 'expense'}`}\n                  >\n                    {formatAmount(transaction.amount)}\n                  </Text>\n                  <Text className=\"balance\">余额: {transaction.balance.toFixed(2)}</Text>\n                </View>\n              </View>\n            ))}\n\n            {loading && (\n              <View className=\"loading\">\n                <Text>加载中...</Text>\n              </View>\n            )}\n\n            {!hasMore && transactions.length > 0 && (\n              <View className=\"no-more\">\n                <Text>没有更多了</Text>\n              </View>\n            )}\n          </ScrollView>\n        )}\n      </View>\n    </View>\n  )\n}\n\nexport default Balance"],"names":["Balance","balance","setBalance","useState","transactions","setTransactions","loading","setLoading","page","setPage","hasMore","setHasMore","useEffect","useReachBottom","fetchTransactions","fetchBalance","currentBalance","walletService","getBalance","pageNum","list","getTransactions","prev","length","error","Taro","showToast","title","icon","handleRecharge","navigateTo","url","formatDate","dateStr","date","Date","month","getMonth","day","getDate","hours","getHours","minutes","getMinutes","today","isToday","toDateString","dateString","timeString","toString","padStart","getTransactionIcon","type","getTransactionColor","formatAmount","amount","toFixed","jsxs","View","jsx","Text","AtIcon","ScrollView","map","transaction","description","createdAt","id"],"mappings":"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"}