"use strict";var e=(e,t,s)=>new Promise((r,n)=>{var a=e=>{try{i(s.next(e))}catch(t){n(t)}},c=e=>{try{i(s.throw(e))}catch(t){n(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,c);i((s=s.apply(e,t)).next())});const t=require("../../../taro.js"),s=require("../../../vendors.js"),r=require("../../../common.js"),n="",a=()=>{const[n,a]=t.reactExports.useState(0),[c,i]=t.reactExports.useState([]),[x,o]=t.reactExports.useState(!1),[l,u]=t.reactExports.useState(1),[m,j]=t.reactExports.useState(!0),p=t.React.useRef(!1);t.reactExports.useEffect(()=>{p.current||(p.current=!0,d(),h())},[]),t.taroExports.useReachBottom(()=>{m&&!x&&h(l+1)});const d=()=>e(exports,null,function*(){const e=yield r.walletService.getBalance();a(e)}),h=(s=1)=>e(exports,null,function*(){if(!x){o(!0);try{const e=yield r.walletService.getTransactions(s,20);i(1===s?e:t=>[...t,...e]),u(s),j(20===e.length)}catch(e){t.Taro.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{o(!1)}}}),E=()=>{t.Taro.navigateTo({url:"/pages/mine/recharge/index"})},R=e=>{const t=new Date(e),s=t.getMonth()+1,r=t.getDate(),n=t.getHours(),a=t.getMinutes(),c=new Date,i=t.toDateString()===c.toDateString(),x=i?"\u4eca\u5929":`${s}\u6708${r}\u65e5`,o=`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`;return`${x} ${o}`},g=e=>{switch(e){case"recharge":return"add-circle";case"consume":return"subtract-circle";case"refund":return"reload";default:return"money"}},w=e=>{switch(e){case"recharge":case"refund":return"#52c41a";case"consume":return"#333";default:return"#999"}},N=e=>e>0?`+${e.toFixed(2)}`:e.toFixed(2);return t.jsxRuntimeExports.jsxs(t.View,{className:"balance-page",children:[t.jsxRuntimeExports.jsx(t.View,{className:"balance-card",children:t.jsxRuntimeExports.jsxs(t.View,{className:"card-content",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"label",children:"\u5f53\u524d\u4f59\u989d"}),t.jsxRuntimeExports.jsxs(t.View,{className:"amount-wrapper",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"currency",children:"\xa5"}),t.jsxRuntimeExports.jsx(t.Text,{className:"amount",children:n.toFixed(2)})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"action-btn",onClick:E,children:[t.jsxRuntimeExports.jsx(s.AtIcon,{value:"add",size:"16",color:"#fff"}),t.jsxRuntimeExports.jsx(t.Text,{children:"\u5145\u503c"})]})]})}),t.jsxRuntimeExports.jsxs(t.View,{className:"transaction-section",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"section-title",children:"\u4ea4\u6613\u8bb0\u5f55"}),0===c.length?t.jsxRuntimeExports.jsxs(t.View,{className:"empty",children:[t.jsxRuntimeExports.jsx(s.AtIcon,{value:"file-generic",size:"48",color:"#ccc"}),t.jsxRuntimeExports.jsx(t.Text,{className:"empty-text",children:"\u6682\u65e0\u4ea4\u6613\u8bb0\u5f55"})]}):t.jsxRuntimeExports.jsxs(t.ScrollView,{className:"transaction-list",scrollY:!0,children:[c.map(e=>t.jsxRuntimeExports.jsxs(t.View,{className:"transaction-item",children:[t.jsxRuntimeExports.jsxs(t.View,{className:"left",children:[t.jsxRuntimeExports.jsx(s.AtIcon,{value:g(e.type),size:"32",color:w(e.type)}),t.jsxRuntimeExports.jsxs(t.View,{className:"info",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"description",children:e.description}),t.jsxRuntimeExports.jsx(t.Text,{className:"time",children:R(e.createdAt)})]})]}),t.jsxRuntimeExports.jsxs(t.View,{className:"right",children:[t.jsxRuntimeExports.jsx(t.Text,{className:"amount "+(e.amount>0?"income":"expense"),children:N(e.amount)}),t.jsxRuntimeExports.jsxs(t.Text,{className:"balance",children:["\u4f59\u989d: ",e.balance.toFixed(2)]})]})]},e.id)),x&&t.jsxRuntimeExports.jsx(t.View,{className:"loading",children:t.jsxRuntimeExports.jsx(t.Text,{children:"\u52a0\u8f7d\u4e2d..."})}),!m&&c.length>0&&t.jsxRuntimeExports.jsx(t.View,{className:"no-more",children:t.jsxRuntimeExports.jsx(t.Text,{children:"\u6ca1\u6709\u66f4\u591a\u4e86"})})]})]})]})};var c={navigationBarTitleText:"\u4f59\u989d\u660e\u7ec6"};Page(t.createPageConfig(a,"pages/mine/balance/index",{root:{cn:[]}},c||{}));
