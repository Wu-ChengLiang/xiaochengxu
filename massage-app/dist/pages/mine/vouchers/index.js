"use strict";var e=(e,s,t)=>new Promise((r,i)=>{var n=e=>{try{c(t.next(e))}catch(s){i(s)}},x=e=>{try{c(t.throw(e))}catch(s){i(s)}},c=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,x);c((t=t.apply(e,s)).next())});const s=require("../../../taro.js"),t=require("../../../vendors.js"),r=require("../../../common.js"),i="",n=()=>{const[i,n]=s.reactExports.useState(0),[x,c]=s.reactExports.useState([]),[a,o]=s.reactExports.useState(!0),l=[{title:"\u53ef\u7528\u5238"},{title:"\u5df2\u4f7f\u7528"},{title:"\u5df2\u8fc7\u671f"}];s.reactExports.useEffect(()=>{u()},[]);const u=()=>e(exports,null,function*(){o(!0);try{const e=yield r.voucherService.getMyVouchers();c(e)}catch(e){console.error("\u52a0\u8f7d\u793c\u5238\u5931\u8d25:",e),s.Taro.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{o(!1)}}),m=e=>{const s=new Date;return x.filter(t=>{if("expired"===e){const e=new Date(t.validTo);return e<s&&"used"!==t.status}return t.status===e})},j=e=>{const s=new Date(e),t=s.getFullYear(),r=s.getMonth()+1,i=s.getDate();return`${t}.${r.toString().padStart(2,"0")}.${i.toString().padStart(2,"0")}`},d=e=>{const r=new Date(e.validTo)<new Date,i="used"===e.status;return s.jsxRuntimeExports.jsxs(s.View,{className:`voucher-card ${i?"used":""} ${r?"expired":""}`,children:[s.jsxRuntimeExports.jsxs(s.View,{className:"voucher-left",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"discount-value",children:["discount"===e.type&&e.discountPercentage&&s.jsxRuntimeExports.jsxs(s.jsxRuntimeExports.Fragment,{children:[s.jsxRuntimeExports.jsx(s.Text,{className:"discount-number",children:e.discountPercentage}),s.jsxRuntimeExports.jsx(s.Text,{className:"discount-unit",children:"%"})]}),"cash"===e.type&&e.cashValue&&s.jsxRuntimeExports.jsxs(s.jsxRuntimeExports.Fragment,{children:[s.jsxRuntimeExports.jsx(s.Text,{className:"discount-unit",children:"\xa5"}),s.jsxRuntimeExports.jsx(s.Text,{className:"discount-number",children:(e.cashValue/100).toFixed(0)})]})]}),s.jsxRuntimeExports.jsx(s.Text,{className:"discount-type",children:"\u4f18\u60e0\u5238"})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"voucher-right",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"voucher-info",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"voucher-name",children:e.name}),s.jsxRuntimeExports.jsx(s.Text,{className:"voucher-desc",children:e.description}),e.minAmount&&e.minAmount>0&&s.jsxRuntimeExports.jsxs(s.Text,{className:"voucher-condition",children:["\u6ee1",(e.minAmount/100).toFixed(0),"\u5143\u53ef\u7528"]}),s.jsxRuntimeExports.jsxs(s.Text,{className:"voucher-validity",children:["\u6709\u6548\u671f\u81f3 ",j(e.validTo)]})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"voucher-status",children:[i&&s.jsxRuntimeExports.jsxs(s.View,{className:"status-tag used",children:[s.jsxRuntimeExports.jsx(t.AtIcon,{value:"check-circle",size:"14"}),s.jsxRuntimeExports.jsx(s.Text,{children:"\u5df2\u4f7f\u7528"})]}),r&&!i&&s.jsxRuntimeExports.jsxs(s.View,{className:"status-tag expired",children:[s.jsxRuntimeExports.jsx(t.AtIcon,{value:"clock",size:"14"}),s.jsxRuntimeExports.jsx(s.Text,{children:"\u5df2\u8fc7\u671f"})]}),!i&&!r&&s.jsxRuntimeExports.jsx(s.View,{className:"use-btn",onClick:()=>{s.Taro.navigateTo({url:"/pages/appointment/index"})},children:"\u7acb\u5373\u4f7f\u7528"})]})]})]},e.id)},p=e=>s.jsxRuntimeExports.jsxs(s.View,{className:"empty-state",children:[s.jsxRuntimeExports.jsx(t.AtIcon,{value:"tag",size:"60",color:"#ccc"}),s.jsxRuntimeExports.jsxs(s.Text,{className:"empty-text",children:["\u6682\u65e0",e]}),"\u53ef\u7528\u5238"===e&&s.jsxRuntimeExports.jsx(s.View,{className:"go-shop-btn",onClick:()=>{s.Taro.switchTab({url:"/pages/appointment/index"})},children:"\u53bb\u9884\u7ea6\u670d\u52a1"})]});if(a)return s.jsxRuntimeExports.jsx(s.View,{className:"vouchers-page",children:s.jsxRuntimeExports.jsx(s.View,{className:"loading",children:"\u52a0\u8f7d\u4e2d..."})});const h=m("unused"),E=m("used"),R=m("expired");return s.jsxRuntimeExports.jsxs(s.View,{className:"vouchers-page",children:[s.jsxRuntimeExports.jsxs(t.AtTabs,{current:i,tabList:l,onClick:n,children:[s.jsxRuntimeExports.jsx(t.AtTabsPane,{current:i,index:0,children:s.jsxRuntimeExports.jsx(s.ScrollView,{scrollY:!0,className:"voucher-list",children:h.length>0?h.map(d):p("\u53ef\u7528\u5238")})}),s.jsxRuntimeExports.jsx(t.AtTabsPane,{current:i,index:1,children:s.jsxRuntimeExports.jsx(s.ScrollView,{scrollY:!0,className:"voucher-list",children:E.length>0?E.map(d):p("\u5df2\u4f7f\u7528\u7684\u5238")})}),s.jsxRuntimeExports.jsx(t.AtTabsPane,{current:i,index:2,children:s.jsxRuntimeExports.jsx(s.ScrollView,{scrollY:!0,className:"voucher-list",children:R.length>0?R.map(d):p("\u5df2\u8fc7\u671f\u7684\u5238")})})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"rules-section",children:[s.jsxRuntimeExports.jsx(s.View,{className:"rules-title",children:"\u4f7f\u7528\u89c4\u5219"}),s.jsxRuntimeExports.jsxs(s.View,{className:"rules-content",children:[s.jsxRuntimeExports.jsx(s.View,{className:"rule-item",children:"1. \u4f18\u60e0\u5238\u5728\u6709\u6548\u671f\u5185\u53ef\u7528\u4e8e\u9884\u7ea6\u670d\u52a1"}),s.jsxRuntimeExports.jsx(s.View,{className:"rule-item",children:"2. \u6bcf\u6b21\u9884\u7ea6\u4ec5\u53ef\u4f7f\u7528\u4e00\u5f20\u4f18\u60e0\u5238"}),s.jsxRuntimeExports.jsx(s.View,{className:"rule-item",children:"3. \u4f18\u60e0\u5238\u4e0d\u53ef\u5151\u73b0\u3001\u4e0d\u53ef\u8f6c\u8ba9"}),s.jsxRuntimeExports.jsx(s.View,{className:"rule-item",children:"4. \u6700\u7ec8\u89e3\u91ca\u6743\u5f52\u540d\u533b\u5802\u6240\u6709"})]})]})]})};var x={};Page(s.createPageConfig(n,"pages/mine/vouchers/index",{root:{cn:[]}},x||{}));
