{"version":3,"file":"index.js","sources":["../../../../src/pages/mine/vouchers/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { View, Text, ScrollView } from '@tarojs/components'\nimport { AtTabs, AtTabsPane, AtIcon } from 'taro-ui'\nimport Taro from '@tarojs/taro'\nimport { voucherService } from '@/services/voucher.service'\nimport { Voucher } from '@/types/voucher'\nimport './index.scss'\n\nconst VouchersPage: React.FC = () => {\n  const [current, setCurrent] = useState(0)\n  const [vouchers, setVouchers] = useState<Voucher[]>([])\n  const [loading, setLoading] = useState(true)\n\n  const tabList = [\n    { title: '可用券' },\n    { title: '已使用' },\n    { title: '已过期' }\n  ]\n\n  useEffect(() => {\n    loadVouchers()\n  }, [])\n\n  const loadVouchers = async () => {\n    setLoading(true)\n    try {\n      const allVouchers = await voucherService.getMyVouchers()\n      setVouchers(allVouchers)\n    } catch (error) {\n      console.error('加载礼券失败:', error)\n      Taro.showToast({\n        title: '加载失败',\n        icon: 'none'\n      })\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // 过滤不同状态的券\n  const getFilteredVouchers = (status: 'unused' | 'used' | 'expired') => {\n    const now = new Date()\n    return vouchers.filter(voucher => {\n      if (status === 'expired') {\n        // 检查是否过期\n        const validTo = new Date(voucher.validTo)\n        return validTo < now && voucher.status !== 'used'\n      }\n      return voucher.status === status\n    })\n  }\n\n  // 格式化有效期\n  const formatValidDate = (dateStr: string) => {\n    const date = new Date(dateStr)\n    const year = date.getFullYear()\n    const month = date.getMonth() + 1\n    const day = date.getDate()\n    return `${year}.${month.toString().padStart(2, '0')}.${day.toString().padStart(2, '0')}`\n  }\n\n  // 渲染券卡片\n  const renderVoucherCard = (voucher: Voucher) => {\n    const isExpired = new Date(voucher.validTo) < new Date()\n    const isUsed = voucher.status === 'used'\n\n    return (\n      <View\n        key={voucher.id}\n        className={`voucher-card ${isUsed ? 'used' : ''} ${isExpired ? 'expired' : ''}`}\n      >\n        <View className=\"voucher-left\">\n          <View className=\"discount-value\">\n            {voucher.type === 'discount' && voucher.discountPercentage && (\n              <>\n                <Text className=\"discount-number\">{voucher.discountPercentage}</Text>\n                <Text className=\"discount-unit\">%</Text>\n              </>\n            )}\n            {voucher.type === 'cash' && voucher.cashValue && (\n              <>\n                <Text className=\"discount-unit\">¥</Text>\n                <Text className=\"discount-number\">{(voucher.cashValue / 100).toFixed(0)}</Text>\n              </>\n            )}\n          </View>\n          <Text className=\"discount-type\">优惠券</Text>\n        </View>\n\n        <View className=\"voucher-right\">\n          <View className=\"voucher-info\">\n            <Text className=\"voucher-name\">{voucher.name}</Text>\n            <Text className=\"voucher-desc\">{voucher.description}</Text>\n            {voucher.minAmount && voucher.minAmount > 0 && (\n              <Text className=\"voucher-condition\">\n                满{(voucher.minAmount / 100).toFixed(0)}元可用\n              </Text>\n            )}\n            <Text className=\"voucher-validity\">\n              有效期至 {formatValidDate(voucher.validTo)}\n            </Text>\n          </View>\n\n          <View className=\"voucher-status\">\n            {isUsed && (\n              <View className=\"status-tag used\">\n                <AtIcon value=\"check-circle\" size=\"14\" />\n                <Text>已使用</Text>\n              </View>\n            )}\n            {isExpired && !isUsed && (\n              <View className=\"status-tag expired\">\n                <AtIcon value=\"clock\" size=\"14\" />\n                <Text>已过期</Text>\n              </View>\n            )}\n            {!isUsed && !isExpired && (\n              <View\n                className=\"use-btn\"\n                onClick={() => {\n                  Taro.navigateTo({ url: '/pages/appointment/index' })\n                }}\n              >\n                立即使用\n              </View>\n            )}\n          </View>\n        </View>\n      </View>\n    )\n  }\n\n  const renderEmptyState = (type: string) => {\n    return (\n      <View className=\"empty-state\">\n        <AtIcon value=\"tag\" size=\"60\" color=\"#ccc\" />\n        <Text className=\"empty-text\">暂无{type}</Text>\n        {type === '可用券' && (\n          <View\n            className=\"go-shop-btn\"\n            onClick={() => {\n              Taro.switchTab({ url: '/pages/appointment/index' })\n            }}\n          >\n            去预约服务\n          </View>\n        )}\n      </View>\n    )\n  }\n\n  if (loading) {\n    return (\n      <View className=\"vouchers-page\">\n        <View className=\"loading\">加载中...</View>\n      </View>\n    )\n  }\n\n  const availableVouchers = getFilteredVouchers('unused')\n  const usedVouchers = getFilteredVouchers('used')\n  const expiredVouchers = getFilteredVouchers('expired')\n\n  return (\n    <View className=\"vouchers-page\">\n      <AtTabs current={current} tabList={tabList} onClick={setCurrent}>\n        <AtTabsPane current={current} index={0}>\n          <ScrollView scrollY className=\"voucher-list\">\n            {availableVouchers.length > 0 ? (\n              availableVouchers.map(renderVoucherCard)\n            ) : (\n              renderEmptyState('可用券')\n            )}\n          </ScrollView>\n        </AtTabsPane>\n\n        <AtTabsPane current={current} index={1}>\n          <ScrollView scrollY className=\"voucher-list\">\n            {usedVouchers.length > 0 ? (\n              usedVouchers.map(renderVoucherCard)\n            ) : (\n              renderEmptyState('已使用的券')\n            )}\n          </ScrollView>\n        </AtTabsPane>\n\n        <AtTabsPane current={current} index={2}>\n          <ScrollView scrollY className=\"voucher-list\">\n            {expiredVouchers.length > 0 ? (\n              expiredVouchers.map(renderVoucherCard)\n            ) : (\n              renderEmptyState('已过期的券')\n            )}\n          </ScrollView>\n        </AtTabsPane>\n      </AtTabs>\n\n      {/* 使用规则说明 */}\n      <View className=\"rules-section\">\n        <View className=\"rules-title\">使用规则</View>\n        <View className=\"rules-content\">\n          <View className=\"rule-item\">1. 优惠券在有效期内可用于预约服务</View>\n          <View className=\"rule-item\">2. 每次预约仅可使用一张优惠券</View>\n          <View className=\"rule-item\">3. 优惠券不可兑现、不可转让</View>\n          <View className=\"rule-item\">4. 最终解释权归名医堂所有</View>\n        </View>\n      </View>\n    </View>\n  )\n}\n\nexport default VouchersPage"],"names":["VouchersPage","current","setCurrent","useState","vouchers","setVouchers","loading","setLoading","tabList","title","useEffect","loadVouchers","allVouchers","voucherService","getMyVouchers","error","Taro","showToast","icon","getFilteredVouchers","status","now","Date","filter","voucher","validTo","formatValidDate","dateStr","date","year","getFullYear","month","getMonth","day","getDate","toString","padStart","renderVoucherCard","isExpired","isUsed","jsxs","View","type","discountPercentage","Fragment","jsx","Text","cashValue","toFixed","name","description","minAmount","AtIcon","navigateTo","url","id","renderEmptyState","switchTab","availableVouchers","usedVouchers","expiredVouchers","AtTabs","AtTabsPane","ScrollView","length","map"],"mappings":"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"}