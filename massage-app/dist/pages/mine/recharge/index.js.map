{"version":3,"file":"index.js","sources":["../../../../src/pages/mine/recharge/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { View, Text, Button } from '@tarojs/components'\nimport Taro from '@tarojs/taro'\nimport { AtIcon } from 'taro-ui'\nimport { walletService, RechargeOption } from '@/services/wallet.service'\nimport { paymentService } from '@/services/payment.service'  // ‚úÖ Ê∑ªÂä†Áº∫Â§±ÁöÑÂØºÂÖ•\nimport './index.scss'\n\nconst Recharge: React.FC = () => {\n  const [selectedAmount, setSelectedAmount] = useState(0)\n  const [selectedBonus, setSelectedBonus] = useState(0)\n  const [customAmount, setCustomAmount] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [rechargeOptions, setRechargeOptions] = useState<RechargeOption[]>([])\n\n  // ‰ªéAPIËé∑ÂèñÂÖÖÂÄºÈÖçÁΩÆ\n  useEffect(() => {\n    loadRechargeOptions()\n  }, [])\n\n  const loadRechargeOptions = async () => {\n    try {\n      const options = await walletService.getRechargeOptions()\n      setRechargeOptions(options)\n    } catch (error) {\n      console.error('Ëé∑ÂèñÂÖÖÂÄºÈÖçÁΩÆÂ§±Ë¥•:', error)\n      // ‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆÔºà‰∏éÁ§ºÂç°È°µÈù¢‰øùÊåÅ‰∏ÄËá¥Ôºâ\n      setRechargeOptions([\n        { id: 1, amount: 1000, bonus: 100, label: '¬•1000', sortOrder: 1 },\n        { id: 2, amount: 3000, bonus: 500, label: '¬•3000', sortOrder: 2 }\n      ])\n    }\n  }\n\n  const handleAmountSelect = (amount: number, bonus: number = 0) => {\n    setSelectedAmount(amount)\n    setSelectedBonus(bonus)\n    setCustomAmount('')\n  }\n\n  const handleCustomAmountChange = (e: any) => {\n    const value = e.detail?.value || e.target?.value || ''\n    if (/^\\d*$/.test(value)) {\n      setCustomAmount(value)\n      setSelectedAmount(0)\n      setSelectedBonus(0)\n    }\n  }\n\n  const handleRecharge = async () => {\n    const amount = selectedAmount || Number(customAmount)\n    const bonus = selectedBonus || 0\n\n    if (!amount || amount <= 0) {\n      Taro.showToast({\n        title: 'ËØ∑ÈÄâÊã©ÊàñËæìÂÖ•ÂÖÖÂÄºÈáëÈ¢ù',\n        icon: 'none'\n      })\n      return\n    }\n\n    if (amount > 50000) {\n      Taro.showToast({\n        title: 'ÂçïÊ¨°ÂÖÖÂÄºÈáëÈ¢ù‰∏çËÉΩË∂ÖËøá5‰∏áÂÖÉ',\n        icon: 'none'\n      })\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      // ÂàõÂª∫ÂÖÖÂÄºËÆ¢Âçï\n      const order = await walletService.createRechargeOrder(amount, bonus)\n\n      console.log('üí∞ ÂÖÖÂÄºËÆ¢ÂçïÂàõÂª∫ÊàêÂäü:', order)\n      console.log('üí∞ ËÆ¢ÂçïÂè∑:', order.orderNo)\n      console.log('üí∞ ÊîØ‰ªòÂèÇÊï∞:', order.wxPayParams)\n\n      // Ë∞ÉËµ∑ÂæÆ‰ø°ÊîØ‰ªò\n      if (order.wxPayParams) {\n        // ‰ΩøÁî®Áªü‰∏ÄÊîØ‰ªòÊúçÂä°\n        // ‚úÖ order.amount Â∑≤ÁªèÊòØÂàÜÔºàwallet.service.ts ‰∏≠Â∑≤ËΩ¨Êç¢Ôºâ\n        const paymentSuccess = await paymentService.pay({\n          orderNo: order.orderNo,\n          amount: order.amount || (amount * 100), // ‰ΩøÁî®ËÆ¢Âçï‰∏≠ÁöÑÈáëÈ¢ùÔºàÂ∑≤ÊòØÂàÜÔºâ\n          paymentMethod: 'wechat',\n          title: `ÂÖÖÂÄº${amount}ÂÖÉ${bonus > 0 ? `(Ëµ†${bonus}ÂÖÉ)` : ''}`,\n          wxPayParams: order.wxPayParams\n        } as any)\n\n        if (paymentSuccess) {\n          Taro.showToast({\n            title: 'ÂÖÖÂÄºÊàêÂäü',\n            icon: 'success',\n            duration: 2000\n          })\n\n          setTimeout(() => {\n            Taro.navigateBack()\n          }, 2000)\n        }\n      } else {\n        throw new Error('Ëé∑ÂèñÊîØ‰ªòÂèÇÊï∞Â§±Ë¥•')\n      }\n    } catch (error: any) {\n      if (error.message?.includes('Áî®Êà∑ÂèñÊ∂à') || error.errMsg?.includes('cancel')) {\n        Taro.showToast({\n          title: 'ÊîØ‰ªòÂ∑≤ÂèñÊ∂à',\n          icon: 'none'\n        })\n      } else {\n        Taro.showToast({\n          title: error.message || 'ÂÖÖÂÄºÂ§±Ë¥•ÔºåËØ∑ÈáçËØï',\n          icon: 'none'\n        })\n      }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <View className=\"recharge-page\">\n      {/* ÂÖÖÂÄºÈáëÈ¢ùÈÄâÊã© */}\n      <View className=\"amount-section\">\n        <Text className=\"section-title\">ÈÄâÊã©ÂÖÖÂÄºÈáëÈ¢ù</Text>\n        <View className=\"amount-grid\">\n          {rechargeOptions.map((option) => (\n            <View\n              key={option.id || option.amount}\n              className={`amount-card ${selectedAmount === option.amount ? 'active' : ''}`}\n              onClick={() => handleAmountSelect(option.amount, option.bonus)}\n            >\n              <Text className=\"amount\">¬•{(option.amount / 100).toFixed(0)}</Text>\n              {option.bonus > 0 && (\n                <Text className=\"bonus\">Ëµ†ÈÄÅ{(option.bonus / 100).toFixed(0)}ÂÖÉ</Text>\n              )}\n            </View>\n          ))}\n        </View>\n\n        {/* Ëá™ÂÆö‰πâÈáëÈ¢ù */}\n        <View className=\"custom-amount\">\n          <Text className=\"label\">ÂÖ∂‰ªñÈáëÈ¢ù</Text>\n          <View className=\"input-wrapper\">\n            <Text className=\"prefix\">¬•</Text>\n            <input\n              className=\"input\"\n              type=\"number\"\n              placeholder=\"ËØ∑ËæìÂÖ•ÂÖÖÂÄºÈáëÈ¢ù\"\n              value={customAmount}\n              onInput={handleCustomAmountChange}\n            />\n          </View>\n        </View>\n      </View>\n\n      {/* ÂÖÖÂÄºËØ¥Êòé */}\n      <View className=\"tips-section\">\n        <Text className=\"section-title\">ÂÖÖÂÄºËØ¥Êòé</Text>\n        <View className=\"tips-list\">\n          <View className=\"tip-item\">\n            <Text className=\"dot\">‚Ä¢</Text>\n            <Text className=\"text\">ÂÖÖÂÄºÈáëÈ¢ùÂ∞ÜÂÆûÊó∂Âà∞Ë¥¶ÔºåÂèØÁî®‰∫éÊîØ‰ªòÊé®ÊãøÊúçÂä°</Text>\n          </View>\n          <View className=\"tip-item\">\n            <Text className=\"dot\">‚Ä¢</Text>\n            <Text className=\"text\">‰ΩôÈ¢ù‰∏çÊîØÊåÅÊèêÁé∞ÔºåËØ∑ÂêàÁêÜÂÖÖÂÄº</Text>\n          </View>\n          <View className=\"tip-item\">\n            <Text className=\"dot\">‚Ä¢</Text>\n            <Text className=\"text\">ÂÖÖÂÄºËµ†ÈÄÅÈáëÈ¢ù‰∏éÊú¨ÈáëÂêåÁ≠â‰ΩøÁî®</Text>\n          </View>\n        </View>\n      </View>\n\n      {/* Â∫ïÈÉ®ÂÖÖÂÄºÊåâÈíÆ */}\n      <View className=\"bottom-bar\">\n        <Button\n          className=\"recharge-btn\"\n          onClick={handleRecharge}\n          disabled={loading}\n        >\n          <AtIcon value=\"credit-card\" size=\"20\" />\n          <Text>Á´ãÂç≥ÂÖÖÂÄº</Text>\n        </Button>\n      </View>\n    </View>\n  )\n}\n\nexport default Recharge"],"names":["Recharge","selectedAmount","setSelectedAmount","useState","selectedBonus","setSelectedBonus","customAmount","setCustomAmount","loading","setLoading","rechargeOptions","setRechargeOptions","useEffect","loadRechargeOptions","options","walletService","getRechargeOptions","error","id","amount","bonus","label","sortOrder","handleAmountSelect","handleCustomAmountChange","e","value","detail","target","test","handleRecharge","Number","Taro","showToast","title","icon","order","createRechargeOrder","log","orderNo","wxPayParams","paymentSuccess","paymentService","pay","paymentMethod","duration","setTimeout","navigateBack","Error","message","includes","errMsg","jsxs","View","jsx","Text","map","option","toFixed","Button","AtIcon"],"mappings":"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"}