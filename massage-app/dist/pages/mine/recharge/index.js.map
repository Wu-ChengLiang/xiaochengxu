{"version":3,"file":"index.js","sources":["../../../../src/pages/mine/recharge/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { View, Text, Button } from '@tarojs/components'\nimport Taro from '@tarojs/taro'\nimport { AtIcon } from 'taro-ui'\nimport { walletService, RechargeOption } from '@/services/wallet.service'\nimport './index.scss'\n\nconst Recharge: React.FC = () => {\n  const [selectedAmount, setSelectedAmount] = useState(0)\n  const [selectedBonus, setSelectedBonus] = useState(0)\n  const [customAmount, setCustomAmount] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [rechargeOptions, setRechargeOptions] = useState<RechargeOption[]>([])\n\n  // 从API获取充值配置\n  useEffect(() => {\n    loadRechargeOptions()\n  }, [])\n\n  const loadRechargeOptions = async () => {\n    try {\n      const options = await walletService.getRechargeOptions()\n      setRechargeOptions(options)\n    } catch (error) {\n      console.error('获取充值配置失败:', error)\n      // 使用默认配置\n      setRechargeOptions([\n        { id: 1, amount: 100, bonus: 0, label: '100元', sortOrder: 1 },\n        { id: 2, amount: 200, bonus: 0, label: '200元', sortOrder: 2 },\n        { id: 3, amount: 500, bonus: 50, label: '500元', sortOrder: 3 },\n        { id: 4, amount: 1000, bonus: 100, label: '1000元', sortOrder: 4 },\n        { id: 5, amount: 2000, bonus: 300, label: '2000元', sortOrder: 5 },\n        { id: 6, amount: 5000, bonus: 1000, label: '5000元', sortOrder: 6 }\n      ])\n    }\n  }\n\n  const handleAmountSelect = (amount: number, bonus: number = 0) => {\n    setSelectedAmount(amount)\n    setSelectedBonus(bonus)\n    setCustomAmount('')\n  }\n\n  const handleCustomAmountChange = (e: any) => {\n    const value = e.detail?.value || e.target?.value || ''\n    if (/^\\d*$/.test(value)) {\n      setCustomAmount(value)\n      setSelectedAmount(0)\n      setSelectedBonus(0)\n    }\n  }\n\n  const handleRecharge = async () => {\n    const amount = selectedAmount || Number(customAmount)\n    const bonus = selectedBonus || 0\n\n    if (!amount || amount <= 0) {\n      Taro.showToast({\n        title: '请选择或输入充值金额',\n        icon: 'none'\n      })\n      return\n    }\n\n    if (amount > 50000) {\n      Taro.showToast({\n        title: '单次充值金额不能超过5万元',\n        icon: 'none'\n      })\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      // 创建充值订单\n      const order = await walletService.createRechargeOrder(amount, bonus)\n\n      // 调起微信支付\n      if (order.wxPayParams) {\n        await walletService.handleWechatPay(order.wxPayParams)\n\n        Taro.showToast({\n          title: '充值成功',\n          icon: 'success',\n          duration: 2000\n        })\n\n        setTimeout(() => {\n          Taro.navigateBack()\n        }, 2000)\n      } else {\n        throw new Error('获取支付参数失败')\n      }\n    } catch (error: any) {\n      if (error.message?.includes('用户取消')) {\n        Taro.showToast({\n          title: '支付已取消',\n          icon: 'none'\n        })\n      } else {\n        Taro.showToast({\n          title: error.message || '充值失败，请重试',\n          icon: 'none'\n        })\n      }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <View className=\"recharge-page\">\n      {/* 充值金额选择 */}\n      <View className=\"amount-section\">\n        <Text className=\"section-title\">选择充值金额</Text>\n        <View className=\"amount-grid\">\n          {rechargeOptions.map((option) => (\n            <View\n              key={option.id || option.amount}\n              className={`amount-card ${selectedAmount === option.amount ? 'active' : ''}`}\n              onClick={() => handleAmountSelect(option.amount, option.bonus)}\n            >\n              <Text className=\"amount\">¥{option.amount}</Text>\n              {option.bonus > 0 && (\n                <Text className=\"bonus\">赠送{option.bonus}元</Text>\n              )}\n            </View>\n          ))}\n        </View>\n\n        {/* 自定义金额 */}\n        <View className=\"custom-amount\">\n          <Text className=\"label\">其他金额</Text>\n          <View className=\"input-wrapper\">\n            <Text className=\"prefix\">¥</Text>\n            <input\n              className=\"input\"\n              type=\"number\"\n              placeholder=\"请输入充值金额\"\n              value={customAmount}\n              onInput={handleCustomAmountChange}\n            />\n          </View>\n        </View>\n      </View>\n\n      {/* 充值说明 */}\n      <View className=\"tips-section\">\n        <Text className=\"section-title\">充值说明</Text>\n        <View className=\"tips-list\">\n          <View className=\"tip-item\">\n            <Text className=\"dot\">•</Text>\n            <Text className=\"text\">充值金额将实时到账，可用于支付推拿服务</Text>\n          </View>\n          <View className=\"tip-item\">\n            <Text className=\"dot\">•</Text>\n            <Text className=\"text\">余额不支持提现，请合理充值</Text>\n          </View>\n          <View className=\"tip-item\">\n            <Text className=\"dot\">•</Text>\n            <Text className=\"text\">充值赠送金额与本金同等使用</Text>\n          </View>\n        </View>\n      </View>\n\n      {/* 底部充值按钮 */}\n      <View className=\"bottom-bar\">\n        <Button\n          className=\"recharge-btn\"\n          onClick={handleRecharge}\n          disabled={loading}\n        >\n          <AtIcon value=\"credit-card\" size=\"20\" />\n          <Text>立即充值</Text>\n        </Button>\n      </View>\n    </View>\n  )\n}\n\nexport default Recharge"],"names":["Recharge","selectedAmount","setSelectedAmount","useState","selectedBonus","setSelectedBonus","customAmount","setCustomAmount","loading","setLoading","rechargeOptions","setRechargeOptions","useEffect","loadRechargeOptions","options","walletService","getRechargeOptions","error","id","amount","bonus","label","sortOrder","handleAmountSelect","handleCustomAmountChange","e","value","detail","target","test","handleRecharge","Number","Taro","showToast","title","icon","order","createRechargeOrder","wxPayParams","handleWechatPay","duration","setTimeout","navigateBack","Error","message","includes","jsxs","View","jsx","Text","map","option","Button","AtIcon"],"mappings":"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"}