{"version":3,"file":"index.js","sources":["../../../../src/pages/appointment/store/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport Taro, { useRouter } from '@tarojs/taro'\nimport { View, Text, Image, ScrollView } from '@tarojs/components'\nimport { AtButton, AtIcon } from 'taro-ui'\nimport { storeService } from '@/services/store'\nimport type { Store } from '@/types'\nimport './index.scss'\n\ninterface TimeSlot {\n  date: string\n  weekday: string\n  slots: {\n    time: string\n    points: number\n    duration: number\n    available: boolean\n  }[]\n}\n\nconst StoreAppointmentPage: React.FC = () => {\n  const router = useRouter()\n  const { id } = router.params\n  const [store, setStore] = useState<Store | null>(null)\n  const [selectedDate, setSelectedDate] = useState('')\n  const [selectedTime, setSelectedTime] = useState('')\n  const [timeSlots, setTimeSlots] = useState<TimeSlot[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    loadStoreData()\n    generateTimeSlots()\n  }, [id])\n\n  const loadStoreData = async () => {\n    try {\n      const storeData = await storeService.getStoreDetail(id!)\n      setStore(storeData)\n    } catch (error) {\n      Taro.showToast({\n        title: '加载失败',\n        icon: 'none'\n      })\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const generateTimeSlots = () => {\n    // 生成未来7天的时间段\n    const slots: TimeSlot[] = []\n    const weekdays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六']\n    \n    for (let i = 0; i < 7; i++) {\n      const date = new Date()\n      date.setDate(date.getDate() + i)\n      \n      const dateStr = `${date.getMonth() + 1}月${date.getDate()}日`\n      const weekday = weekdays[date.getDay()]\n      \n      // 为每天生成时间段\n      const daySlots = [\n        { time: '10:00', points: 8, duration: 0, available: i > 0 },\n        { time: '11:00', points: 9, duration: 10, available: true },\n        { time: '12:00', points: 10, duration: 20, available: true },\n        { time: '14:00', points: 10, duration: 0, available: true },\n        { time: '15:00', points: 9, duration: 10, available: true },\n        { time: '16:00', points: 8, duration: 20, available: i !== 2 },\n        { time: '17:00', points: 8, duration: 30, available: true },\n        { time: '18:00', points: 9, duration: 0, available: true },\n        { time: '19:00', points: 10, duration: 0, available: true },\n        { time: '20:00', points: 10, duration: 10, available: true }\n      ]\n      \n      slots.push({\n        date: dateStr,\n        weekday: weekday,\n        slots: daySlots\n      })\n    }\n    \n    setTimeSlots(slots)\n    // 默认选择明天\n    if (slots.length > 1) {\n      setSelectedDate(slots[1].date)\n    }\n  }\n\n  const handleDateSelect = (date: string) => {\n    setSelectedDate(date)\n    setSelectedTime('')\n  }\n\n  const handleTimeSelect = (time: string) => {\n    setSelectedTime(time)\n  }\n\n  const handleCallStore = () => {\n    if (store?.phone) {\n      Taro.makePhoneCall({\n        phoneNumber: store.phone\n      })\n    }\n  }\n\n  const handleShowLocation = () => {\n    if (store?.location) {\n      Taro.openLocation({\n        latitude: store.location.latitude,\n        longitude: store.location.longitude,\n        name: store.name,\n        address: store.address\n      })\n    }\n  }\n\n  const handleSubmit = () => {\n    if (!selectedTime) {\n      Taro.showToast({\n        title: '请选择预约时间',\n        icon: 'none'\n      })\n      return\n    }\n\n    // 跳转到预约确认页面\n    Taro.navigateTo({\n      url: `/pages/booking/confirm/index?type=store&id=${id}&date=${selectedDate}&time=${selectedTime}`\n    })\n  }\n\n  const getCurrentTimeSlot = () => {\n    const current = timeSlots.find(slot => slot.date === selectedDate)\n    return current?.slots || []\n  }\n\n  if (!store) return null\n\n  return (\n    <View className=\"store-appointment-page\">\n      {/* 门店信息头部 */}\n      <View className=\"store-header\">\n        <Image \n          className=\"store-image\" \n          src={store.images[0]} \n          mode=\"aspectFill\"\n        />\n        <View className=\"store-actions\">\n          <Text className=\"action-text\">一客一换</Text>\n          <Text className=\"action-text\">干净整洁</Text>\n        </View>\n      </View>\n\n      {/* 门店基本信息 */}\n      <View className=\"store-info\">\n        <View className=\"info-header\">\n          <View className=\"store-details\">\n            <View className=\"name-row\">\n              <Text className=\"store-name\">{store.name}</Text>\n              <Text className=\"distance\">{store.distance || 9.0}km</Text>\n            </View>\n            <View className=\"hours-row\">\n              <Text className=\"business-hours\">\n                {store.businessHours.start}-{store.businessHours.end}\n              </Text>\n              <View className={`status ${store.status}`}>\n                {store.status === 'normal' && '就近'}\n                {store.status === 'busy' && '繁忙'}\n                {store.status === 'full' && '爆满'}\n              </View>\n            </View>\n            <Text className=\"address\">{store.address}</Text>\n          </View>\n          <View className=\"action-buttons\">\n            <View className=\"action-btn\" onClick={handleCallStore}>\n              <AtIcon value=\"phone\" size=\"24\" color=\"#D9455F\" />\n            </View>\n            <View className=\"action-btn\" onClick={handleShowLocation}>\n              <AtIcon value=\"map-pin\" size=\"24\" color=\"#D9455F\" />\n            </View>\n          </View>\n        </View>\n      </View>\n\n      {/* 预约时间选择 */}\n      <View className=\"appointment-section\">\n        <Text className=\"section-title\">预约时间</Text>\n        \n        {/* 特价时段提示 */}\n        <View className=\"promotion-tips\">\n          <View className=\"tip-item main\">\n            <Text className=\"discount\">9.5折</Text>\n            <View className=\"tip-content\">\n              <Text className=\"tip-title\">提前30分钟</Text>\n              <Text className=\"tip-desc\">10:00开始</Text>\n            </View>\n          </View>\n          <View className=\"tip-item\">\n            <Text className=\"discount\">9.0折</Text>\n            <Text className=\"tip-desc\">错峰预约<br />点击前往</Text>\n          </View>\n        </View>\n\n        {/* 日期选择 */}\n        <ScrollView scrollX className=\"date-selector\">\n          {timeSlots.map(slot => (\n            <View\n              key={slot.date}\n              className={`date-item ${selectedDate === slot.date ? 'active' : ''}`}\n              onClick={() => handleDateSelect(slot.date)}\n            >\n              <Text className=\"date\">{slot.date}</Text>\n              <Text className=\"weekday\">{slot.weekday}</Text>\n            </View>\n          ))}\n        </ScrollView>\n\n        {/* 时间段选择 */}\n        <View className=\"time-slots\">\n          {getCurrentTimeSlot().map(slot => (\n            <View\n              key={slot.time}\n              className={`time-slot ${!slot.available ? 'disabled' : ''} ${selectedTime === slot.time ? 'active' : ''}`}\n              onClick={() => slot.available && handleTimeSelect(slot.time)}\n            >\n              <View className=\"time-info\">\n                <Text className=\"time\">{slot.time}</Text>\n                <Text className=\"points\">{slot.points}点</Text>\n              </View>\n              {slot.duration > 0 && (\n                <Text className=\"duration\">{slot.duration}分</Text>\n              )}\n            </View>\n          ))}\n        </View>\n      </View>\n\n      {/* 底部预约栏 */}\n      <View className=\"bottom-bar\">\n        <Text className=\"selected-time\">\n          预约时间：{selectedDate} {selectedTime || '请选择时间'}\n        </Text>\n        <AtButton \n          className=\"submit-btn\"\n          type=\"primary\"\n          onClick={handleSubmit}\n          disabled={!selectedTime}\n        >\n          选症状\n        </AtButton>\n      </View>\n    </View>\n  )\n}\n\nexport default StoreAppointmentPage"],"names":["StoreAppointmentPage","router","useRouter","id","params","store","setStore","useState","selectedDate","setSelectedDate","selectedTime","setSelectedTime","timeSlots","setTimeSlots","loading","setLoading","useEffect","loadStoreData","storeData","storeService","getStoreDetail","error","Taro","showToast","title","icon","generateTimeSlots","slots","weekdays","i","date","Date","setDate","getDate","dateStr","getMonth","weekday","getDay","daySlots","time","points","duration","available","push","length","handleDateSelect","handleTimeSelect","handleCallStore","phone","makePhoneCall","phoneNumber","handleShowLocation","location","openLocation","latitude","longitude","name","address","handleSubmit","navigateTo","url","getCurrentTimeSlot","current","find","slot","jsxs","View","jsx","Image","images","Text","distance","businessHours","start","end","status","AtIcon","ScrollView","map","AtButton"],"mappings":"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"}