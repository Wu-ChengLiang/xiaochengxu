"use strict";var e=(e,s,t)=>new Promise((i,a)=>{var n=e=>{try{r(t.next(e))}catch(s){a(s)}},o=e=>{try{r(t.throw(e))}catch(s){a(s)}},r=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,o);r((t=t.apply(e,s)).next())});const s=require("../../../taro.js"),t=require("../../../vendors.js"),i=require("../../../common.js"),a="",n=()=>{const a=s.taroExports.useRouter(),{id:n}=a.params,[o,r]=s.reactExports.useState(null),[l,x]=s.reactExports.useState(""),[c,m]=s.reactExports.useState(""),[u,d]=s.reactExports.useState([]),[p,j]=s.reactExports.useState(!0);s.reactExports.useEffect(()=>{h(),E()},[n]);const h=()=>e(exports,null,function*(){try{const e=yield i.storeService.getStoreDetail(n);r(e)}catch(e){s.Taro.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}finally{j(!1)}}),E=()=>{const e=[],s=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"];for(let t=0;t<7;t++){const i=new Date;i.setDate(i.getDate()+t);const a=`${i.getMonth()+1}\u6708${i.getDate()}\u65e5`,n=s[i.getDay()],o=[{time:"10:00",points:8,duration:0,available:t>0},{time:"11:00",points:9,duration:10,available:!0},{time:"12:00",points:10,duration:20,available:!0},{time:"14:00",points:10,duration:0,available:!0},{time:"15:00",points:9,duration:10,available:!0},{time:"16:00",points:8,duration:20,available:2!==t},{time:"17:00",points:8,duration:30,available:!0},{time:"18:00",points:9,duration:0,available:!0},{time:"19:00",points:10,duration:0,available:!0},{time:"20:00",points:10,duration:10,available:!0}];e.push({date:a,weekday:n,slots:o})}d(e),e.length>1&&x(e[1].date)},R=e=>{x(e),m("")},N=e=>{m(e)},w=()=>{(null==o?void 0:o.phone)&&s.Taro.makePhoneCall({phoneNumber:o.phone})},v=()=>{(null==o?void 0:o.location)&&s.Taro.openLocation({latitude:o.location.latitude,longitude:o.location.longitude,name:o.name,address:o.address})},b=()=>{c?s.Taro.navigateTo({url:`/pages/booking/confirm/index?type=store&id=${n}&date=${l}&time=${c}`}):s.Taro.showToast({title:"\u8bf7\u9009\u62e9\u9884\u7ea6\u65f6\u95f4",icon:"none"})},T=()=>{const e=u.find(e=>e.date===l);return(null==e?void 0:e.slots)||[]};return o?s.jsxRuntimeExports.jsxs(s.View,{className:"store-appointment-page",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"store-header",children:[s.jsxRuntimeExports.jsx(s.Image,{className:"store-image",src:o.images[0],mode:"aspectFill"}),s.jsxRuntimeExports.jsxs(s.View,{className:"store-actions",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"action-text",children:"\u4e00\u5ba2\u4e00\u6362"}),s.jsxRuntimeExports.jsx(s.Text,{className:"action-text",children:"\u5e72\u51c0\u6574\u6d01"})]})]}),s.jsxRuntimeExports.jsx(s.View,{className:"store-info",children:s.jsxRuntimeExports.jsxs(s.View,{className:"info-header",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"store-details",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"name-row",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"store-name",children:o.name}),s.jsxRuntimeExports.jsxs(s.Text,{className:"distance",children:[o.distance||9,"km"]})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"hours-row",children:[s.jsxRuntimeExports.jsxs(s.Text,{className:"business-hours",children:[o.businessHours.start,"-",o.businessHours.end]}),s.jsxRuntimeExports.jsxs(s.View,{className:`status ${o.status}`,children:["normal"===o.status&&"\u5c31\u8fd1","busy"===o.status&&"\u7e41\u5fd9","full"===o.status&&"\u7206\u6ee1"]})]}),s.jsxRuntimeExports.jsx(s.Text,{className:"address",children:o.address})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"action-buttons",children:[s.jsxRuntimeExports.jsx(s.View,{className:"action-btn",onClick:w,children:s.jsxRuntimeExports.jsx(t.AtIcon,{value:"phone",size:"24",color:"#D9455F"})}),s.jsxRuntimeExports.jsx(s.View,{className:"action-btn",onClick:v,children:s.jsxRuntimeExports.jsx(t.AtIcon,{value:"map-pin",size:"24",color:"#D9455F"})})]})]})}),s.jsxRuntimeExports.jsxs(s.View,{className:"appointment-section",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"section-title",children:"\u9884\u7ea6\u65f6\u95f4"}),s.jsxRuntimeExports.jsxs(s.View,{className:"promotion-tips",children:[s.jsxRuntimeExports.jsxs(s.View,{className:"tip-item main",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"discount",children:"9.5\u6298"}),s.jsxRuntimeExports.jsxs(s.View,{className:"tip-content",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"tip-title",children:"\u63d0\u524d30\u5206\u949f"}),s.jsxRuntimeExports.jsx(s.Text,{className:"tip-desc",children:"10:00\u5f00\u59cb"})]})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"tip-item",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"discount",children:"9.0\u6298"}),s.jsxRuntimeExports.jsxs(s.Text,{className:"tip-desc",children:["\u9519\u5cf0\u9884\u7ea6",s.jsxRuntimeExports.jsx("br",{}),"\u70b9\u51fb\u524d\u5f80"]})]})]}),s.jsxRuntimeExports.jsx(s.ScrollView,{scrollX:!0,className:"date-selector",children:u.map(e=>s.jsxRuntimeExports.jsxs(s.View,{className:"date-item "+(l===e.date?"active":""),onClick:()=>R(e.date),children:[s.jsxRuntimeExports.jsx(s.Text,{className:"date",children:e.date}),s.jsxRuntimeExports.jsx(s.Text,{className:"weekday",children:e.weekday})]},e.date))}),s.jsxRuntimeExports.jsx(s.View,{className:"time-slots",children:T().map(e=>s.jsxRuntimeExports.jsxs(s.View,{className:`time-slot ${e.available?"":"disabled"} ${c===e.time?"active":""}`,onClick:()=>e.available&&N(e.time),children:[s.jsxRuntimeExports.jsxs(s.View,{className:"time-info",children:[s.jsxRuntimeExports.jsx(s.Text,{className:"time",children:e.time}),s.jsxRuntimeExports.jsxs(s.Text,{className:"points",children:[e.points,"\u70b9"]})]}),e.duration>0&&s.jsxRuntimeExports.jsxs(s.Text,{className:"duration",children:[e.duration,"\u5206"]})]},e.time))})]}),s.jsxRuntimeExports.jsxs(s.View,{className:"bottom-bar",children:[s.jsxRuntimeExports.jsxs(s.Text,{className:"selected-time",children:["\u9884\u7ea6\u65f6\u95f4\uff1a",l," ",c||"\u8bf7\u9009\u62e9\u65f6\u95f4"]}),s.jsxRuntimeExports.jsx(t.AtButton,{className:"submit-btn",type:"primary",onClick:b,disabled:!c,children:"\u9009\u75c7\u72b6"})]})]}):null};var o={navigationBarTitleText:"\u95e8\u5e97\u9884\u7ea6"};Page(s.createPageConfig(n,"pages/appointment/store/index",{root:{cn:[]}},o||{}));
