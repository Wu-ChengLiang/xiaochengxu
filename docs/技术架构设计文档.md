# æ¨æ‹¿é¢„çº¦å°ç¨‹åºæŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£

## ä¸€ã€æŠ€æœ¯æ¶æ„æ€»è§ˆ

### 1.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯å±•ç¤ºå±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  å¾®ä¿¡å°ç¨‹åº   â”‚  â”‚   H5 ç½‘é¡µ    â”‚  â”‚  ç®¡ç†åå°    â”‚         â”‚
â”‚  â”‚   (Taro)    â”‚  â”‚   (Taro)    â”‚  â”‚  (React)    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç½‘å…³å±‚                                â”‚
â”‚                   Nginx + API Gateway                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨æœåŠ¡å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ç”¨æˆ·æœåŠ¡   â”‚  â”‚é¢„çº¦æœåŠ¡   â”‚  â”‚é—¨åº—æœåŠ¡   â”‚  â”‚æ”¯ä»˜æœåŠ¡   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚æ¨æ‹¿å¸ˆæœåŠ¡ â”‚  â”‚ä¼˜æƒ åˆ¸æœåŠ¡ â”‚  â”‚æ¶ˆæ¯æœåŠ¡   â”‚  â”‚æ–‡ä»¶æœåŠ¡   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ•°æ®å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MySQL   â”‚  â”‚  Redis   â”‚  â”‚ MongoDB  â”‚  â”‚   OSS    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯é€‰å‹

#### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**ï¼šTaro 3.x + React Hooks
- **UI ç»„ä»¶åº“**ï¼šTaro UI / NutUI
- **çŠ¶æ€ç®¡ç†**ï¼šMobX / Zustand
- **æ ·å¼**ï¼šSass + CSS Modules
- **è¯·æ±‚åº“**ï¼šTaro.request å°è£…
- **å·¥å…·åº“**ï¼šdayjs, lodash-es

#### åç«¯æŠ€æœ¯æ ˆï¼ˆå½“å‰ï¼‰
- **å¼€å‘è¯­è¨€**ï¼šNode.js (TypeScript)
- **Web æ¡†æ¶**ï¼šExpress.js
- **æ•°æ®åº“**ï¼šSQLite (è½»é‡çº§åµŒå…¥å¼æ•°æ®åº“)
- **API æ–‡æ¡£**ï¼šMarkdown æ ¼å¼ (è§ `api-docs/` ç›®å½•)
- **è¿›ç¨‹ç®¡ç†**ï¼šnpm scripts / PM2

> **è¯´æ˜**ï¼šå½“å‰ä¸ºå•ä½“åº”ç”¨æ¶æ„ï¼Œåç»­å¯æŒ‰åŠŸèƒ½æ¨¡å—åŒ–å‡çº§ä¸ºå¾®æœåŠ¡

## äºŒã€å‰ç«¯æ¶æ„è®¾è®¡

### 2.1 é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆå®é™…ï¼‰

```
src/
â”œâ”€â”€ app.tsx                   # åº”ç”¨å…¥å£
â”œâ”€â”€ app.config.ts            # å…¨å±€é…ç½®
â”œâ”€â”€ app.scss                 # å…¨å±€æ ·å¼
â”œâ”€â”€ assets/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/              # å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ icons/               # å›¾æ ‡èµ„æº
â”œâ”€â”€ components/              # å¯å¤ç”¨UIç»„ä»¶
â”‚   â”œâ”€â”€ Layout/              # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ Card/                # å¡ç‰‡ç»„ä»¶
â”‚   â”œâ”€â”€ Loading/             # åŠ è½½ç»„ä»¶
â”‚   â””â”€â”€ ...                  # å…¶ä»–ä¸šåŠ¡ç»„ä»¶
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ index.ts             # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ api.ts               # APIåœ°å€é…ç½®
â”‚   â””â”€â”€ assets.ts            # èµ„æºé…ç½®
â”œâ”€â”€ pages/                   # é¡µé¢æ–‡ä»¶
â”‚   â”œâ”€â”€ appointment/         # é¢„çº¦ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ index.tsx        # é¦–é¡µ/é¢„çº¦åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ store/           # é—¨åº—é€‰æ‹©
â”‚   â”‚   â”œâ”€â”€ symptom/         # ç—‡çŠ¶é€‰æ‹©
â”‚   â”‚   â””â”€â”€ therapist/       # æ¨æ‹¿å¸ˆé€‰æ‹©
â”‚   â”œâ”€â”€ booking/             # é¢„çº¦ç¡®è®¤æµç¨‹
â”‚   â”‚   â”œâ”€â”€ confirm/         # ç¡®è®¤é¡µ
â”‚   â”‚   â”œâ”€â”€ select-time/     # æ—¶é—´é€‰æ‹©
â”‚   â”‚   â””â”€â”€ success/         # æˆåŠŸé¡µ
â”‚   â”œâ”€â”€ order/               # è®¢å•ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ list/            # è®¢å•åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ detail/          # è®¢å•è¯¦æƒ…
â”‚   â”œâ”€â”€ store/               # é—¨åº—ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ list/            # é—¨åº—åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ detail/          # é—¨åº—è¯¦æƒ…
â”‚   â”œâ”€â”€ therapist/           # æ¨æ‹¿å¸ˆç›¸å…³
â”‚   â”‚   â””â”€â”€ detail/          # æ¨æ‹¿å¸ˆè¯¦æƒ…
â”‚   â””â”€â”€ mine/                # ä¸ªäººä¸­å¿ƒ
â”‚       â”œâ”€â”€ index.tsx        # æˆ‘çš„é¡µ
â”‚       â”œâ”€â”€ balance/         # è´¦æˆ·ä½™é¢
â”‚       â”œâ”€â”€ recharge/        # å……å€¼é¡µ
â”‚       â”œâ”€â”€ vouchers/        # ä¼˜æƒ åˆ¸
â”‚       â””â”€â”€ about/           # å…³äºé¡µ
â”œâ”€â”€ services/                # API æœåŠ¡å±‚ (è§ä¸‹æ–‡3.1)
â”‚   â”œâ”€â”€ store.ts             # é—¨åº—æœåŠ¡
â”‚   â”œâ”€â”€ therapist.ts         # æ¨æ‹¿å¸ˆæœåŠ¡
â”‚   â”œâ”€â”€ order.ts             # è®¢å•æœåŠ¡
â”‚   â”œâ”€â”€ payment.service.ts   # æ”¯ä»˜æœåŠ¡
â”‚   â”œâ”€â”€ wallet.service.ts    # é’±åŒ…æœåŠ¡
â”‚   â”œâ”€â”€ voucher.service.ts   # ä¼˜æƒ åˆ¸æœåŠ¡
â”‚   â”œâ”€â”€ gift.service.ts      # ç¤¼å¡æœåŠ¡
â”‚   â”œâ”€â”€ review.ts            # è¯„ä»·æœåŠ¡
â”‚   â”œâ”€â”€ symptom.ts           # ç—‡çŠ¶æœåŠ¡
â”‚   â”œâ”€â”€ location.ts          # ä½ç½®æœåŠ¡
â”‚   â””â”€â”€ __tests__/           # æœåŠ¡å•å…ƒæµ‹è¯•
â”œâ”€â”€ styles/                  # å…¨å±€æ ·å¼
â”œâ”€â”€ types/                   # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts             # æ‰€æœ‰ä¸šåŠ¡ç±»å‹
â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ request.ts           # ç½‘ç»œè¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ location.ts          # ä½ç½®è®¡ç®— (Haversine)
â”‚   â”œâ”€â”€ image.ts             # å›¾ç‰‡å¤„ç† (HTTPâ†’HTTPS)
â”‚   â”œâ”€â”€ format.ts            # æ•°æ®æ ¼å¼åŒ–
â”‚   â””â”€â”€ user.ts              # ç”¨æˆ·å·¥å…·å‡½æ•°
â”œâ”€â”€ mock/                    # Mock æ•°æ®
â””â”€â”€ __mocks__/               # æµ‹è¯• Mock
```

### 2.2 æ ¸å¿ƒæ¨¡å—è®¾è®¡

å…³é”®çš„æ¨¡å—åŒ…æ‹¬ï¼š

1. **ä½ç½®æœåŠ¡** (`src/utils/location.ts`)
   - è·å–ç”¨æˆ·å½“å‰ä½ç½®
   - ä½¿ç”¨ Haversine å…¬å¼è®¡ç®—ä¸¤ç‚¹é—´è·ç¦»
   - ç”¨äºæ¨èé™„è¿‘çš„é—¨åº—å’Œæ¨æ‹¿å¸ˆ

2. **è¯·æ±‚å°è£…** (`src/utils/request.ts`)
   - ç»Ÿä¸€çš„ HTTP è¯·æ±‚å¤„ç†
   - è‡ªåŠ¨æ·»åŠ è®¤è¯ä¿¡æ¯å’Œé”™è¯¯å¤„ç†
   - æ”¯æŒ API ç‰ˆæœ¬ç®¡ç†ï¼ˆv2ï¼‰

3. **é¡µé¢ç»„ä»¶** (`src/pages/`)
   - React + Hooks ç»„ä»¶å¼€å‘
   - ä½¿ç”¨ Taro ç»„ä»¶åº“ï¼ˆView, Image, ScrollView ç­‰ï¼‰
   - MobX æˆ– Zustand è¿›è¡ŒçŠ¶æ€ç®¡ç†

è¯¦ç»†çš„ä»£ç å®ç°å’Œ Taro æ¡†æ¶ä½¿ç”¨è¯´æ˜ï¼Œè¯·å‚è€ƒï¼š
- ğŸ“š **Taro æ¡†æ¶æ–‡æ¡£**: è§ `api-docs/` æˆ–å®˜æ–¹æ–‡æ¡£
- ğŸ¯ **æ ¸å¿ƒæœåŠ¡å®ç°**: è§ä¸‹æ–‡ 4.1-4.2 èŠ‚

## ä¸‰ã€åç«¯æ¶æ„è®¾è®¡

### 3.1 æœåŠ¡å±‚ç»“æ„ï¼ˆExpress å•ä½“åº”ç”¨ï¼‰

å½“å‰åç«¯é‡‡ç”¨ **Express.js å•ä½“åº”ç”¨æ¶æ„**ï¼ŒæŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†æœåŠ¡ï¼š

#### æ ¸å¿ƒæœåŠ¡æ¨¡å—

| æœåŠ¡æ¨¡å— | åŠŸèƒ½è¯´æ˜ | APIæ–‡æ¡£ä½ç½® |
|---------|---------|-----------|
| **ç”¨æˆ·æœåŠ¡** | æ³¨å†Œ/ç™»å½•ã€ç”¨æˆ·ä¿¡æ¯ã€ä¼šå‘˜ç­‰çº§ã€ç§¯åˆ† | `api-docs/04-ç”¨æˆ·API.md` |
| **é—¨åº—æœåŠ¡** | é—¨åº—åˆ—è¡¨ã€é—¨åº—è¯¦æƒ…ã€é—¨åº—æ¨æ‹¿å¸ˆ | `api-docs/01-é—¨åº—API.md` |
| **æ¨æ‹¿å¸ˆæœåŠ¡** | æ¨æ‹¿å¸ˆåˆ—è¡¨ã€æ¨æ‹¿å¸ˆè¯¦æƒ…ã€æ’ç­æŸ¥è¯¢ | `api-docs/02-æ¨æ‹¿å¸ˆAPI.md` |
| **é¢„çº¦æœåŠ¡** | åˆ›å»ºé¢„çº¦ã€æŸ¥è¯¢é¢„çº¦ã€é¢„çº¦æ ¸é”€ | `api-docs/03-é¢„çº¦API.md` |
| **è®¢å•æ”¯ä»˜æœåŠ¡** | è®¢å•åˆ›å»ºã€å¾®ä¿¡æ”¯ä»˜ã€ä½™é¢æ”¯ä»˜ã€é€€æ¬¾ | `api-docs/06-è®¢å•æ”¯ä»˜API.md` |
| **è¯„ä»·æœåŠ¡** | åˆ›å»ºè¯„ä»·ã€æŸ¥è¯¢è¯„ä»·ã€è¯„åˆ†ç»Ÿè®¡ | `api-docs/07-è¯„ä»·API.md` |
| **å¾®ä¿¡æˆæƒæœåŠ¡** | æ‰‹æœºå·ç»‘å®šã€æˆæƒæŸ¥è¯¢ | `api-docs/08-å¾®ä¿¡æ‰‹æœºå·API.md` |

> **æœªæ¥è§„åˆ’**ï¼šå½“åº”ç”¨å¤æ‚åº¦å¢åŠ æ—¶ï¼Œå¯æŒ‰ä¸Šè¿°æœåŠ¡æ¨¡å—æ‹†åˆ†ä¸ºå¾®æœåŠ¡æ¶æ„

### 3.2 API æ¥å£è§„èŒƒ

#### 3.2.1 é€šç”¨è§„èŒƒ
è¯¦è§ `api-docs/00-é€šç”¨è§„èŒƒ.md`ï¼ŒåŒ…æ‹¬ï¼š
- RESTful è·¯ç”±è§„èŒƒï¼ˆåŸºäº `/api/v2/` å‰ç¼€ï¼‰
- ç»Ÿä¸€çš„è¯·æ±‚/å“åº”æ ¼å¼
- é”™è¯¯ç å®šä¹‰
- åˆ†é¡µå‚æ•°è§„èŒƒ
- æ•°æ®éªŒè¯è§„èŒƒ

#### 3.2.2 API æ–‡æ¡£å¯¼èˆª

```
api-docs/
â”œâ”€â”€ README.md                      # APIæ–‡æ¡£æ€»è§ˆ
â”œâ”€â”€ 00-é€šç”¨è§„èŒƒ.md                 # é€šç”¨è§„èŒƒï¼ˆå¿…è¯»ï¼‰
â”œâ”€â”€ 01-é—¨åº—API.md                  # é—¨åº—ç›¸å…³API
â”œâ”€â”€ 02-æ¨æ‹¿å¸ˆAPI.md                # æ¨æ‹¿å¸ˆç›¸å…³API
â”œâ”€â”€ 03-é¢„çº¦API.md                  # é¢„çº¦ç›¸å…³API
â”œâ”€â”€ 04-ç”¨æˆ·API.md                  # ç”¨æˆ·ç›¸å…³API
â”œâ”€â”€ 05-å®æ–½æŒ‡å—.md                 # å®ç°æŒ‡å—
â”œâ”€â”€ 06-è®¢å•æ”¯ä»˜API.md              # è®¢å•å’Œæ”¯ä»˜API
â”œâ”€â”€ 07-è¯„ä»·API.md                  # è¯„ä»·ç›¸å…³API
â”œâ”€â”€ 08-å¾®ä¿¡æ‰‹æœºå·API.md            # å¾®ä¿¡æˆæƒAPI
â””â”€â”€ æ ¸é”€æ–¹æ¡ˆè¯´æ˜.md                # æ ¸é”€æµç¨‹è¯´æ˜
```

**å¦‚ä½•æŸ¥é˜…**: æ ¹æ®éœ€è¦å®ç°çš„åŠŸèƒ½ï¼Œæ‰¾åˆ°å¯¹åº”çš„APIæ–‡æ¡£ï¼Œäº†è§£ï¼š
- è¯·æ±‚å‚æ•°
- å“åº”æ ¼å¼
- é”™è¯¯å¤„ç†
- TypeScript æ¥å£å®šä¹‰

#### 3.2.3 å“åº”æ ¼å¼ï¼ˆç»Ÿä¸€ï¼‰
```json
{
  "code": 0,
  "message": "success",
  "data": {
    // ä¸šåŠ¡æ•°æ®
  },
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "totalPages": 10
  }
}
```

### 3.3 æ•°æ®åº“è®¾è®¡

è¯¦è§ `docs/æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md`

---

## å››ã€å‰ç«¯æœåŠ¡å±‚ï¼ˆFrontend Servicesï¼‰

å‰ç«¯æœåŠ¡å±‚ä½äº `src/services/`ï¼Œè´Ÿè´£ä¸åç«¯ API é€šä¿¡å’Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚

### 4.1 æœåŠ¡æ¨¡å—è¯¦è§£

#### 4.1.1 é—¨åº—æœåŠ¡ï¼ˆstore.tsï¼‰
```typescript
class StoreService {
  // è·å–é—¨åº—åˆ—è¡¨ï¼ˆå¸¦è·ç¦»æ’åºï¼‰
  async getNearbyStores(latitude: number, longitude: number)

  // è·å–é—¨åº—è¯¦æƒ…
  async getStoreDetail(storeId: string)

  // æœç´¢é—¨åº—
  async searchStores(keyword: string)
}
```
**APIå‚è€ƒ**: `api-docs/01-é—¨åº—API.md`

#### 4.1.2 æ¨æ‹¿å¸ˆæœåŠ¡ï¼ˆtherapist.tsï¼‰
```typescript
class TherapistService {
  // è·å–æ¨èæ¨æ‹¿å¸ˆï¼ˆåŸºäºä½ç½®å’Œè¯„åˆ†ï¼‰
  async getRecommendedTherapists(
    page: number,
    pageSize: number,
    userLocation?: {latitude, longitude}
  )

  // è·å–æ¨æ‹¿å¸ˆè¯¦æƒ…
  async getTherapistDetail(therapistId: string)

  // è·å–æ¨æ‹¿å¸ˆæ’ç­
  async getTherapistSchedule(therapistId: string)
}
```
**APIå‚è€ƒ**: `api-docs/02-æ¨æ‹¿å¸ˆAPI.md`

#### 4.1.3 è®¢å•æœåŠ¡ï¼ˆorder.tsï¼‰
```typescript
class OrderService {
  // åˆ›å»ºè®¢å•ï¼ˆæ”¯ä»˜/å……å€¼/ç¤¼å¡ï¼‰
  async createOrder(request: CreateOrderRequest)

  // è·å–è®¢å•åˆ—è¡¨
  async getOrders(userId: string, page: number)

  // è·å–è®¢å•è¯¦æƒ…
  async getOrderDetail(orderNo: string)

  // æŸ¥è¯¢è®¢å•çŠ¶æ€
  async getOrderStatus(orderNo: string)
}
```
**APIå‚è€ƒ**: `api-docs/06-è®¢å•æ”¯ä»˜API.md`

#### 4.1.4 æ”¯ä»˜æœåŠ¡ï¼ˆpayment.service.tsï¼‰â­
```typescript
class PaymentService {
  // è°ƒç”¨å¾®ä¿¡æ”¯ä»˜
  async requestWeChatPayment(wxPayParams: WxPayParams)

  // æ”¯ä»˜è®¢å•ï¼ˆå¾®ä¿¡/ä½™é¢ï¼‰
  async payOrder(orderNo: string, paymentMethod: 'wechat' | 'balance')

  // æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
  async queryPaymentStatus(orderNo: string)
}
```
**é‡è¦**: æ”¯ä»˜é›†æˆæ¶‰åŠæ•æ„Ÿæ“ä½œï¼Œè¯¦è§ `docs/å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜å¯†é’¥é…ç½®è°ƒç ”.md`

#### 4.1.5 é’±åŒ…æœåŠ¡ï¼ˆwallet.service.tsï¼‰â­
```typescript
class WalletService {
  // è·å–ä½™é¢
  async getBalance(userId: string): Promise<{balance, frozenBalance}>

  // ä½™é¢æ”¯ä»˜
  async payWithBalance(userId: string, amount: number)

  // å……å€¼é€»è¾‘
  async recharge(userId: string, amount: number, paymentMethod: string)
}
```
**æ³¨æ„**: æ‰€æœ‰é‡‘é¢ä»¥ **åˆ†** ä¸ºå•ä½ï¼ˆ100åˆ† = 1å…ƒï¼‰

#### 4.1.6 ä¼˜æƒ åˆ¸æœåŠ¡ï¼ˆvoucher.service.tsï¼‰
```typescript
class VoucherService {
  // è·å–ç”¨æˆ·ä¼˜æƒ åˆ¸åˆ—è¡¨
  async getUserVouchers(userId: string)

  // æŸ¥è¯¢å¯ç”¨çš„ä¼˜æƒ åˆ¸
  async getAvailableVouchers(userId: string, appointmentPrice: number)

  // ä½¿ç”¨ä¼˜æƒ åˆ¸
  async useVoucher(voucherId: string, appointmentId: string)
}
```

#### 4.1.7 ç¤¼å¡æœåŠ¡ï¼ˆgift.service.tsï¼‰
```typescript
class GiftService {
  // è·å–ç¤¼å¡åˆ—è¡¨
  async getGiftCards()

  // è´­ä¹°ç¤¼å¡
  async purchaseGiftCard(giftCardId: string, quantity: number)

  // æŸ¥è¯¢æˆ‘çš„ç¤¼å¡
  async getMyGiftCards(userId: string)
}
```

#### 4.1.8 è¯„ä»·æœåŠ¡ï¼ˆreview.tsï¼‰
```typescript
class ReviewService {
  // åˆ›å»ºè¯„ä»·
  async createReview(appointmentId: string, rating: number, comment: string)

  // è·å–æ¨æ‹¿å¸ˆè¯„ä»·åˆ—è¡¨
  async getTherapistReviews(therapistId: string, page: number)

  // è·å–é—¨åº—è¯„ä»·ç»Ÿè®¡
  async getStoreRatingStats(storeId: string)
}
```
**APIå‚è€ƒ**: `api-docs/07-è¯„ä»·API.md`

### 4.2 å·¥å…·å‡½æ•°

#### 4.2.1 è¯·æ±‚å°è£…ï¼ˆutils/request.tsï¼‰
- ç»Ÿä¸€çš„ HTTP è¯·æ±‚å¤„ç†
- è‡ªåŠ¨æ·»åŠ  userId å‚æ•°
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- Token ç®¡ç†ï¼ˆå¦‚éœ€è¦ï¼‰

#### 4.2.2 ä½ç½®è®¡ç®—ï¼ˆutils/location.tsï¼‰
- **Haversine å…¬å¼** è®¡ç®—ä¸¤ç‚¹è·ç¦»
- ç”¨äºè·ç¦»æ’åºï¼ˆé—¨åº—ã€æ¨æ‹¿å¸ˆï¼‰
- è¿”å›å•ä½ï¼šå…¬é‡Œï¼ˆkmï¼‰

```typescript
calculateDistance(lat1, lng1, lat2, lng2): number
```

#### 4.2.3 å›¾ç‰‡å¤„ç†ï¼ˆutils/image.tsï¼‰
- **HTTP â†’ HTTPS è‡ªåŠ¨è½¬æ¢**
- å¾®ä¿¡å°ç¨‹åºè¦æ±‚æ‰€æœ‰å›¾ç‰‡å¿…é¡» HTTPS
- API è¿”å›çš„å›¾ç‰‡ URL è‡ªåŠ¨è§„èŒƒåŒ–

```typescript
normalizeImageUrl(url: string): string
// 'http://example.com/img.jpg' â†’ 'https://example.com/img.jpg'
```

### 4.3 å•å…ƒæµ‹è¯•

æµ‹è¯•æ–‡ä»¶ä½äº `src/services/__tests__/`

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼
npm test -- --watch

# è¿è¡Œç‰¹å®šæµ‹è¯•
npm test -- therapist.service.test
```

**æµ‹è¯•æ¡†æ¶**: Jest + ts-jest

---

## äº”ã€æ ¸å¿ƒæµç¨‹è¯´æ˜

### 5.1 é¢„çº¦æµç¨‹

```
é€‰æ‹©é—¨åº— â†’ é€‰æ‹©æ¨æ‹¿å¸ˆ â†’ é€‰æ‹©æ—¶é—´ â†’ é€‰æ‹©æœåŠ¡ â†’ ç¡®è®¤é¢„çº¦
  â†“          â†“          â†“         â†“          â†“
  API: 01   API: 02    API: 03   API: 01   API: 03 + 06 (æ”¯ä»˜)
  â†“                                        â†“
  é—¨åº—åˆ—è¡¨    æ¨æ‹¿å¸ˆåˆ—è¡¨   æ—¶é—´æ’ç­      åˆ›å»ºè®¢å• â†’ æ”¯ä»˜ â†’ é¢„çº¦æˆåŠŸ
```

**ç›¸å…³æœåŠ¡**:
- `storeService.getNearbyStores()`
- `therapistService.getRecommendedTherapists()`
- `therapistService.getTherapistSchedule()`
- `orderService.createOrder()`
- `paymentService.payOrder()`

### 5.2 æ”¯ä»˜æµç¨‹

```
åˆ›å»ºè®¢å• â†’ é€‰æ‹©æ”¯ä»˜æ–¹å¼ â†’ å‘èµ·æ”¯ä»˜ â†’ æ”¯ä»˜å›è°ƒ â†’ æ›´æ–°è®¢å•çŠ¶æ€
   â†“            â†“          â†“        â†“         â†“
API: 06      ä½™é¢/å¾®ä¿¡   æ”¯ä»˜API   åç«¯å›è°ƒ  æœ¬åœ°æ›´æ–°
```

**æ”¯ä»˜æ–¹å¼**:
- å¾®ä¿¡æ”¯ä»˜ï¼š`paymentService.requestWeChatPayment()`
- ä½™é¢æ”¯ä»˜ï¼š`walletService.payWithBalance()`

> **é‡è¦**: è§ `api-docs/06-è®¢å•æ”¯ä»˜API.md` å’Œ `docs/å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜å¯†é’¥é…ç½®è°ƒç ”.md`

### 5.3 ä½ç½®ä¸æ¨èæµç¨‹

```
è·å–ç”¨æˆ·ä½ç½® â†’ è¯·æ±‚é—¨åº—åˆ—è¡¨ â†’ è®¡ç®—è·ç¦» â†’ æŒ‰è·ç¦»æ’åº â†’ æ˜¾ç¤ºé—¨åº—
    â†“            â†“          â†“        â†“         â†“
Taro API     store.ts    è·ç¦»å…¬å¼   å‰ç«¯æ’åº   UIå±•ç¤º
```

**å®ç°ç»†èŠ‚**:
1. ä½¿ç”¨ `Taro.getLocation()` è·å–ç”¨æˆ·ä½ç½®
2. è°ƒç”¨ `storeService.getNearbyStores(lat, lng)`
3. ä½¿ç”¨ `calculateDistance()` è®¡ç®—æ¯ä¸ªé—¨åº—è·ç¦»
4. æŒ‰è·ç¦»å‡åºæ’åˆ—ï¼Œæ˜¾ç¤ºæœ€è¿‘çš„é—¨åº—

---

## å…­ã€å¼€å‘æŒ‡å—

### å¦‚ä½•æ·»åŠ æ–°çš„ API é›†æˆï¼Ÿ

1. **æŸ¥çœ‹ API æ–‡æ¡£**: æ‰¾åˆ°å¯¹åº”çš„ `api-docs/*.md`
2. **å®šä¹‰ TypeScript ç±»å‹**: æ›´æ–° `src/types/index.ts`
3. **åˆ›å»ºæœåŠ¡æ–¹æ³•**: åœ¨ `src/services/` ä¸­å®ç°è°ƒç”¨é€»è¾‘
4. **é¡µé¢ä¸­ä½¿ç”¨**: åœ¨é¡µé¢ç»„ä»¶ä¸­è°ƒç”¨æœåŠ¡æ–¹æ³•
5. **æ·»åŠ å•å…ƒæµ‹è¯•**: åœ¨ `src/services/__tests__/` ä¸­æµ‹è¯•

### ä¾‹å­ï¼šæ·»åŠ "è·å–é—¨åº—è¯„ä»·"åŠŸèƒ½

```typescript
// 1. å®šä¹‰ç±»å‹ (src/types/index.ts)
export interface StoreReview {
  id: string
  rating: number
  comment: string
  createdAt: string
}

// 2. æ·»åŠ æœåŠ¡æ–¹æ³• (src/services/review.ts)
async getStoreReviews(storeId: string, page: number = 1) {
  const data = await request('/stores/{storeId}/reviews', {
    data: { page, pageSize: 10 }
  })
  return data.data // è¿”å›åˆ—è¡¨
}

// 3. åœ¨é¡µé¢ä¸­ä½¿ç”¨
import { reviewService } from '@/services'

const reviews = await reviewService.getStoreReviews(storeId)

// 4. æ·»åŠ æµ‹è¯•
// src/services/__tests__/review.service.test.ts
```